<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link href="list-test.css" rel="stylesheet" type="text/css" media="screen"/><link href="../list-test.css" rel="stylesheet" type="text/css" media="screen"/></head><body><pre id="l0"><span class="adr"></span>	                <span id="code0"></span></pre>
<pre id="l1"><span class="adr"></span>	                <span class="cmt">;**************************************************************</span></pre>
<pre id="l2"><span class="adr"></span>	                <span class="cmt">;*</span></pre>
<pre id="l3"><span class="adr"></span>	                <span class="cmt">;*             C P / M   version   2 . 2</span></pre>
<pre id="l4"><span class="adr"></span>	                <span class="cmt">;*</span></pre>
<pre id="l5"><span class="adr"></span>	                <span class="cmt">;*   Reconstructed from memory image on February 27, 1981</span></pre>
<pre id="l6"><span class="adr"></span>	                <span class="cmt">;*</span></pre>
<pre id="l7"><span class="adr"></span>	                <span class="cmt">;*                by Clark A. Calkins</span></pre>
<pre id="l8"><span class="adr"></span>	                <span class="cmt">;*</span></pre>
<pre id="l9"><span class="adr"></span>	                <span class="cmt">;**************************************************************</span></pre>
<pre id="l10"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l11"><span class="adr"></span>	                <span class="cmt">;   Set memory limit here. This is the amount of contigeous</span></pre>
<pre id="l12"><span class="adr"></span>	                <span class="cmt">; ram starting from 0000. CP/M will reside at the end of this space.</span></pre>
<pre id="l13"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l14"><span class="adr"></span>	                <span class="l" id="label14">MEM</span>	<span id="code14">EQU	62	</span><span class="cmt">;for a 62k system (TS802 TEST - WORKS OK).</span></pre>
<pre id="l15"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l16"><span class="adr"></span>	                <span class="l" id="label16">IOBYTE</span>	<span id="code16">EQU	3	</span><span class="cmt">;i/o definition byte.</span></pre>
<pre id="l17"><span class="adr"></span>	                <span class="l" id="label17">TDRIVE</span>	<span id="code17">EQU	4	</span><span class="cmt">;current drive name and user number.</span></pre>
<pre id="l18"><span class="adr"></span>	                <span class="l" id="label18">ENTRY</span>	<span id="code18">EQU	5	</span><span class="cmt">;entry point for the cp/m bdos.</span></pre>
<pre id="l19"><span class="adr"></span>	                <span class="l" id="label19">TFCB</span>	<span id="code19">EQU	5CH	</span><span class="cmt">;default file control block.</span></pre>
<pre id="l20"><span class="adr"></span>	                <span class="l" id="label20">TBUFF</span>	<span id="code20">EQU	80H	</span><span class="cmt">;i/o buffer and command line storage.</span></pre>
<pre id="l21"><span class="adr"></span>	                <span class="l" id="label21">TBASE</span>	<span id="code21">EQU	100H	</span><span class="cmt">;transiant program storage area.</span></pre>
<pre id="l22"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l23"><span class="adr"></span>	                <span class="cmt">;   Set control character equates.</span></pre>
<pre id="l24"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l25"><span class="adr"></span>	                <span class="l" id="label25">CNTRLC</span>	<span id="code25">EQU	3	</span><span class="cmt">;control-c</span></pre>
<pre id="l26"><span class="adr"></span>	                <span class="l" id="label26">CNTRLE</span>	<span id="code26">EQU	05H	</span><span class="cmt">;control-e</span></pre>
<pre id="l27"><span class="adr"></span>	                <span class="l" id="label27">BS</span>	<span id="code27">EQU	08H	</span><span class="cmt">;backspace</span></pre>
<pre id="l28"><span class="adr"></span>	                <span class="l" id="label28">TAB</span>	<span id="code28">EQU	09H	</span><span class="cmt">;tab</span></pre>
<pre id="l29"><span class="adr"></span>	                <span class="l" id="label29">LF</span>	<span id="code29">EQU	0AH	</span><span class="cmt">;line feed</span></pre>
<pre id="l30"><span class="adr"></span>	                <span class="l" id="label30">FF</span>	<span id="code30">EQU	0CH	</span><span class="cmt">;form feed</span></pre>
<pre id="l31"><span class="adr"></span>	                <span class="l" id="label31">CR</span>	<span id="code31">EQU	0DH	</span><span class="cmt">;carriage return</span></pre>
<pre id="l32"><span class="adr"></span>	                <span class="l" id="label32">CNTRLP</span>	<span id="code32">EQU	10H	</span><span class="cmt">;control-p</span></pre>
<pre id="l33"><span class="adr"></span>	                <span class="l" id="label33">CNTRLR</span>	<span id="code33">EQU	12H	</span><span class="cmt">;control-r</span></pre>
<pre id="l34"><span class="adr"></span>	                <span class="l" id="label34">CNTRLS</span>	<span id="code34">EQU	13H	</span><span class="cmt">;control-s</span></pre>
<pre id="l35"><span class="adr"></span>	                <span class="l" id="label35">CNTRLU</span>	<span id="code35">EQU	15H	</span><span class="cmt">;control-u</span></pre>
<pre id="l36"><span class="adr"></span>	                <span class="l" id="label36">CNTRLX</span>	<span id="code36">EQU	18H	</span><span class="cmt">;control-x</span></pre>
<pre id="l37"><span class="adr"></span>	                <span class="l" id="label37">CNTRLZ</span>	<span id="code37">EQU	1AH	</span><span class="cmt">;control-z (end-of-file mark)</span></pre>
<pre id="l38"><span class="adr"></span>	                <span class="l" id="label38">DEL</span>	<span id="code38">EQU	7FH	</span><span class="cmt">;rubout</span></pre>
<pre id="l39"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l40"><span class="adr"></span>	                <span class="cmt">;   Set origin for CP/M</span></pre>
<pre id="l41"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l42"><span class="adr"></span>	                	<span id="code42">ORG	(MEM-7)*1024</span></pre>
<pre id="l43"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l44"><span class="adr">DC00</span>	C3 5C DF        <span class="l" id="label44">CBASE</span>	<span id="code44">JMP	COMMAND	</span><span class="cmt">;execute command processor (ccp).</span></pre>
<pre id="l45"><span class="adr">DC03</span>	C3 58 DF        	<span id="code45">JMP	CLEARBUF	</span><span class="cmt">;entry to empty input buffer before starting ccp.</span></pre>
<pre id="l46"><span class="adr"></span>	                <span id="code46"></span></pre>
<pre id="l47"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l48"><span class="adr"></span>	                <span class="cmt">;   Standard cp/m ccp input buffer. Format is (max length),</span></pre>
<pre id="l49"><span class="adr"></span>	                <span class="cmt">; (actual length), (char #1), (char #2), (char #3), etc.</span></pre>
<pre id="l50"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l51"><span class="adr">DC06</span>	7F              <span class="l" id="label51">INBUFF</span>	<span id="code51">DB	127	</span><span class="cmt">;length of input buffer.</span></pre>
<pre id="l52"><span class="adr">DC07</span>	00              	<span id="code52">DB	0	</span><span class="cmt">;current length of contents.</span></pre>
<pre id="l53"><span class="adr">DC08</span>	43 6F 70 79     	<span id="code53">DB	'Copyright'</span><br/>	.&nbsp;.&nbsp;.&nbsp;<br/>DC10	74 <br/></pre>
<pre id="l54"><span class="adr">DC11</span>	20 31 39 37     	<span id="code54">DB	' 1979 (c) by Digital Research      '</span><br/>	.&nbsp;.&nbsp;.&nbsp;<br/>DC31	20 20 20 <br/></pre>
<pre id="l55"><span class="adr">DC34</span>	00 00 00 00     	<span id="code55">DB	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0</span><br/>	.&nbsp;.&nbsp;.&nbsp;<br/>DC48	00 00 00 <br/></pre>
<pre id="l56"><span class="adr">DC4B</span>	00 00 00 00     	<span id="code56">DB	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0</span><br/>	.&nbsp;.&nbsp;.&nbsp;<br/>DC5F	00 00 00 <br/></pre>
<pre id="l57"><span class="adr">DC62</span>	00 00 00 00     	<span id="code57">DB	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0</span><br/>	.&nbsp;.&nbsp;.&nbsp;<br/>DC76	00 00 00 <br/></pre>
<pre id="l58"><span class="adr">DC79</span>	00 00 00 00     	<span id="code58">DB	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0</span><br/>	.&nbsp;.&nbsp;.&nbsp;<br/>DC85	00 00 00 <br/></pre>
<pre id="l59"><span class="adr">DC88</span>	08 DC           <span class="l" id="label59">INPOINT</span>	<span id="code59">DW	INBUFF+2</span><span class="cmt">;input line pointer</span></pre>
<pre id="l60"><span class="adr">DC8A</span>	00 00           <span class="l" id="label60">NAMEPNT</span>	<span id="code60">DW	0	</span><span class="cmt">;input line pointer used for error message. Points to</span></pre>
<pre id="l61"><span class="adr"></span>	                <span class="cmt">;			;start of name in error.</span></pre>
<pre id="l62"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l63"><span class="adr"></span>	                <span class="cmt">;   Routine to print (A) on the console. All registers used.</span></pre>
<pre id="l64"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l65"><span class="adr">DC8C</span>	5F              <span class="l" id="label65">PRINT</span>	<span id="code65">MOV	E,A	</span><span class="cmt">;setup bdos call.</span></pre>
<pre id="l66"><span class="adr">DC8D</span>	0E 02           	<span id="code66">MVI	C,2</span></pre>
<pre id="l67"><span class="adr">DC8F</span>	C3 05 00        	<span id="code67">JMP	ENTRY</span></pre>
<pre id="l68"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l69"><span class="adr"></span>	                <span class="cmt">;   Routine to print (A) on the console and to save (BC).</span></pre>
<pre id="l70"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l71"><span class="adr">DC92</span>	C5              <span class="l" id="label71">PRINTB</span>	<span id="code71">PUSH	B</span></pre>
<pre id="l72"><span class="adr">DC93</span>	CD 8C DC        	<span id="code72">CALL	PRINT</span></pre>
<pre id="l73"><span class="adr">DC96</span>	C1              	<span id="code73">POP	B</span></pre>
<pre id="l74"><span class="adr">DC97</span>	C9              	<span id="code74">RET</span></pre>
<pre id="l75"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l76"><span class="adr"></span>	                <span class="cmt">;   Routine to send a carriage return, line feed combination</span></pre>
<pre id="l77"><span class="adr"></span>	                <span class="cmt">; to the console.</span></pre>
<pre id="l78"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l79"><span class="adr">DC98</span>	3E 0D           <span class="l" id="label79">CRLF</span>	<span id="code79">MVI	A,CR</span></pre>
<pre id="l80"><span class="adr">DC9A</span>	CD 92 DC        	<span id="code80">CALL	PRINTB</span></pre>
<pre id="l81"><span class="adr">DC9D</span>	3E 0A           	<span id="code81">MVI	A,LF</span></pre>
<pre id="l82"><span class="adr">DC9F</span>	C3 92 DC        	<span id="code82">JMP	PRINTB</span></pre>
<pre id="l83"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l84"><span class="adr"></span>	                <span class="cmt">;   Routine to send one space to the console and save (BC).</span></pre>
<pre id="l85"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l86"><span class="adr">DCA2</span>	3E 20           <span class="l" id="label86">SPACE</span>	<span id="code86">MVI	A,' '</span></pre>
<pre id="l87"><span class="adr">DCA4</span>	C3 92 DC        	<span id="code87">JMP	PRINTB</span></pre>
<pre id="l88"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l89"><span class="adr"></span>	                <span class="cmt">;   Routine to print character string pointed to be (BC) on the</span></pre>
<pre id="l90"><span class="adr"></span>	                <span class="cmt">; console. It must terminate with a null byte.</span></pre>
<pre id="l91"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l92"><span class="adr">DCA7</span>	C5              <span class="l" id="label92">PLINE</span>	<span id="code92">PUSH	B</span></pre>
<pre id="l93"><span class="adr">DCA8</span>	CD 98 DC        	<span id="code93">CALL	CRLF</span></pre>
<pre id="l94"><span class="adr">DCAB</span>	E1              	<span id="code94">POP	H</span></pre>
<pre id="l95"><span class="adr">DCAC</span>	7E              <span class="l" id="label95">PLINE2</span>	<span id="code95">MOV	A,M</span></pre>
<pre id="l96"><span class="adr">DCAD</span>	B7              	<span id="code96">ORA	A</span></pre>
<pre id="l97"><span class="adr">DCAE</span>	C8              	<span id="code97">RZ</span></pre>
<pre id="l98"><span class="adr">DCAF</span>	23              	<span id="code98">INX	H</span></pre>
<pre id="l99"><span class="adr">DCB0</span>	E5              	<span id="code99">PUSH	H</span></pre>
<pre id="l100"><span class="adr">DCB1</span>	CD 8C DC        	<span id="code100">CALL	PRINT</span></pre>
<pre id="l101"><span class="adr">DCB4</span>	E1              	<span id="code101">POP	H</span></pre>
<pre id="l102"><span class="adr">DCB5</span>	C3 AC DC        	<span id="code102">JMP	PLINE2</span></pre>
<pre id="l103"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l104"><span class="adr"></span>	                <span class="cmt">;   Routine to reset the disk system.</span></pre>
<pre id="l105"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l106"><span class="adr">DCB8</span>	0E 0D           <span class="l" id="label106">RESDSK</span>	<span id="code106">MVI	C,13</span></pre>
<pre id="l107"><span class="adr">DCBA</span>	C3 05 00        	<span id="code107">JMP	ENTRY</span></pre>
<pre id="l108"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l109"><span class="adr"></span>	                <span class="cmt">;   Routine to select disk (A).</span></pre>
<pre id="l110"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l111"><span class="adr">DCBD</span>	5F              <span class="l" id="label111">DSKSEL</span>	<span id="code111">MOV	E,A</span></pre>
<pre id="l112"><span class="adr">DCBE</span>	0E 0E           	<span id="code112">MVI	C,14</span></pre>
<pre id="l113"><span class="adr">DCC0</span>	C3 05 00        	<span id="code113">JMP	ENTRY</span></pre>
<pre id="l114"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l115"><span class="adr"></span>	                <span class="cmt">;   Routine to call bdos and save the return code. The zero</span></pre>
<pre id="l116"><span class="adr"></span>	                <span class="cmt">; flag is set on a return of 0ffh.</span></pre>
<pre id="l117"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l118"><span class="adr">DCC3</span>	CD 05 00        <span class="l" id="label118">ENTRY1</span>	<span id="code118">CALL	ENTRY</span></pre>
<pre id="l119"><span class="adr">DCC6</span>	32 EE E3        	<span id="code119">STA	RTNCODE	</span><span class="cmt">;save return code.</span></pre>
<pre id="l120"><span class="adr">DCC9</span>	3C              	<span id="code120">INR	A	</span><span class="cmt">;set zero if 0ffh returned.</span></pre>
<pre id="l121"><span class="adr">DCCA</span>	C9              	<span id="code121">RET</span></pre>
<pre id="l122"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l123"><span class="adr"></span>	                <span class="cmt">;   Routine to open a file. (DE) must point to the FCB.</span></pre>
<pre id="l124"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l125"><span class="adr">DCCB</span>	0E 0F           <span class="l" id="label125">OPEN</span>	<span id="code125">MVI	C,15</span></pre>
<pre id="l126"><span class="adr">DCCD</span>	C3 C3 DC        	<span id="code126">JMP	ENTRY1</span></pre>
<pre id="l127"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l128"><span class="adr"></span>	                <span class="cmt">;   Routine to open file at (FCB).</span></pre>
<pre id="l129"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l130"><span class="adr">DCD0</span>	AF              <span class="l" id="label130">OPENFCB</span>	<span id="code130">XRA	A	</span><span class="cmt">;clear the record number byte at fcb+32</span></pre>
<pre id="l131"><span class="adr">DCD1</span>	32 ED E3        	<span id="code131">STA	FCB+32</span></pre>
<pre id="l132"><span class="adr">DCD4</span>	11 CD E3        	<span id="code132">LXI	D,FCB</span></pre>
<pre id="l133"><span class="adr">DCD7</span>	C3 CB DC        	<span id="code133">JMP	OPEN</span></pre>
<pre id="l134"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l135"><span class="adr"></span>	                <span class="cmt">;   Routine to close a file. (DE) points to FCB.</span></pre>
<pre id="l136"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l137"><span class="adr">DCDA</span>	0E 10           <span class="l" id="label137">CLOSE</span>	<span id="code137">MVI	C,16</span></pre>
<pre id="l138"><span class="adr">DCDC</span>	C3 C3 DC        	<span id="code138">JMP	ENTRY1</span></pre>
<pre id="l139"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l140"><span class="adr"></span>	                <span class="cmt">;   Routine to search for the first file with ambigueous name</span></pre>
<pre id="l141"><span class="adr"></span>	                <span class="cmt">; (DE).</span></pre>
<pre id="l142"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l143"><span class="adr">DCDF</span>	0E 11           <span class="l" id="label143">SRCHFST</span>	<span id="code143">MVI	C,17</span></pre>
<pre id="l144"><span class="adr">DCE1</span>	C3 C3 DC        	<span id="code144">JMP	ENTRY1</span></pre>
<pre id="l145"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l146"><span class="adr"></span>	                <span class="cmt">;   Search for the next ambigeous file name.</span></pre>
<pre id="l147"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l148"><span class="adr">DCE4</span>	0E 12           <span class="l" id="label148">SRCHNXT</span>	<span id="code148">MVI	C,18</span></pre>
<pre id="l149"><span class="adr">DCE6</span>	C3 C3 DC        	<span id="code149">JMP	ENTRY1</span></pre>
<pre id="l150"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l151"><span class="adr"></span>	                <span class="cmt">;   Search for file at (FCB).</span></pre>
<pre id="l152"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l153"><span class="adr">DCE9</span>	11 CD E3        <span class="l" id="label153">SRCHFCB</span>	<span id="code153">LXI	D,FCB</span></pre>
<pre id="l154"><span class="adr">DCEC</span>	C3 DF DC        	<span id="code154">JMP	SRCHFST</span></pre>
<pre id="l155"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l156"><span class="adr"></span>	                <span class="cmt">;   Routine to delete a file pointed to by (DE).</span></pre>
<pre id="l157"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l158"><span class="adr">DCEF</span>	0E 13           <span class="l" id="label158">DELETE</span>	<span id="code158">MVI	C,19</span></pre>
<pre id="l159"><span class="adr">DCF1</span>	C3 05 00        	<span id="code159">JMP	ENTRY</span></pre>
<pre id="l160"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l161"><span class="adr"></span>	                <span class="cmt">;   Routine to call the bdos and set the zero flag if a zero</span></pre>
<pre id="l162"><span class="adr"></span>	                <span class="cmt">; status is returned.</span></pre>
<pre id="l163"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l164"><span class="adr">DCF4</span>	CD 05 00        <span class="l" id="label164">ENTRY2</span>	<span id="code164">CALL	ENTRY</span></pre>
<pre id="l165"><span class="adr">DCF7</span>	B7              	<span id="code165">ORA	A	</span><span class="cmt">;set zero flag if appropriate.</span></pre>
<pre id="l166"><span class="adr">DCF8</span>	C9              	<span id="code166">RET</span></pre>
<pre id="l167"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l168"><span class="adr"></span>	                <span class="cmt">;   Routine to read the next record from a sequential file.</span></pre>
<pre id="l169"><span class="adr"></span>	                <span class="cmt">; (DE) points to the FCB.</span></pre>
<pre id="l170"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l171"><span class="adr">DCF9</span>	0E 14           <span class="l" id="label171">RDREC</span>	<span id="code171">MVI	C,20</span></pre>
<pre id="l172"><span class="adr">DCFB</span>	C3 F4 DC        	<span id="code172">JMP	ENTRY2</span></pre>
<pre id="l173"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l174"><span class="adr"></span>	                <span class="cmt">;   Routine to read file at (FCB).</span></pre>
<pre id="l175"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l176"><span class="adr">DCFE</span>	11 CD E3        <span class="l" id="label176">READFCB</span>	<span id="code176">LXI	D,FCB</span></pre>
<pre id="l177"><span class="adr">DD01</span>	C3 F9 DC        	<span id="code177">JMP	RDREC</span></pre>
<pre id="l178"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l179"><span class="adr"></span>	                <span class="cmt">;   Routine to write the next record of a sequential file.</span></pre>
<pre id="l180"><span class="adr"></span>	                <span class="cmt">; (DE) points to the FCB.</span></pre>
<pre id="l181"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l182"><span class="adr">DD04</span>	0E 15           <span class="l" id="label182">WRTREC</span>	<span id="code182">MVI	C,21</span></pre>
<pre id="l183"><span class="adr">DD06</span>	C3 F4 DC        	<span id="code183">JMP	ENTRY2</span></pre>
<pre id="l184"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l185"><span class="adr"></span>	                <span class="cmt">;   Routine to create the file pointed to by (DE).</span></pre>
<pre id="l186"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l187"><span class="adr">DD09</span>	0E 16           <span class="l" id="label187">CREATE</span>	<span id="code187">MVI	C,22</span></pre>
<pre id="l188"><span class="adr">DD0B</span>	C3 C3 DC        	<span id="code188">JMP	ENTRY1</span></pre>
<pre id="l189"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l190"><span class="adr"></span>	                <span class="cmt">;   Routine to rename the file pointed to by (DE). Note that</span></pre>
<pre id="l191"><span class="adr"></span>	                <span class="cmt">; the new name starts at (DE+16).</span></pre>
<pre id="l192"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l193"><span class="adr">DD0E</span>	0E 17           <span class="l" id="label193">RENAM</span>	<span id="code193">MVI	C,23</span></pre>
<pre id="l194"><span class="adr">DD10</span>	C3 05 00        	<span id="code194">JMP	ENTRY</span></pre>
<pre id="l195"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l196"><span class="adr"></span>	                <span class="cmt">;   Get the current user code.</span></pre>
<pre id="l197"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l198"><span class="adr">DD13</span>	1E FF           <span class="l" id="label198">GETUSR</span>	<span id="code198">MVI	E,0FFH</span></pre>
<pre id="l199"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l200"><span class="adr"></span>	                <span class="cmt">;   Routne to get or set the current user code.</span></pre>
<pre id="l201"><span class="adr"></span>	                <span class="cmt">; If (E) is FF then this is a GET, else it is a SET.</span></pre>
<pre id="l202"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l203"><span class="adr">DD15</span>	0E 20           <span class="l" id="label203">GETSETUC</span><span id="code203">:MVI	C,32</span></pre>
<pre id="l204"><span class="adr">DD17</span>	C3 05 00        	<span id="code204">JMP	ENTRY</span></pre>
<pre id="l205"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l206"><span class="adr"></span>	                <span class="cmt">;   Routine to set the current drive byte at (TDRIVE).</span></pre>
<pre id="l207"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l208"><span class="adr">DD1A</span>	CD 13 DD        <span class="l" id="label208">SETCDRV</span>	<span id="code208">CALL	GETUSR	</span><span class="cmt">;get user number</span></pre>
<pre id="l209"><span class="adr">DD1D</span>	87              	<span id="code209">ADD	A	</span><span class="cmt">;and shift into the upper 4 bits.</span></pre>
<pre id="l210"><span class="adr">DD1E</span>	87              	<span id="code210">ADD	A</span></pre>
<pre id="l211"><span class="adr">DD1F</span>	87              	<span id="code211">ADD	A</span></pre>
<pre id="l212"><span class="adr">DD20</span>	87              	<span id="code212">ADD	A</span></pre>
<pre id="l213"><span class="adr">DD21</span>	21 EF E3        	<span id="code213">LXI	H,CDRIVE</span><span class="cmt">;now add in the current drive number.</span></pre>
<pre id="l214"><span class="adr">DD24</span>	B6              	<span id="code214">ORA	M</span></pre>
<pre id="l215"><span class="adr">DD25</span>	32 04 00        	<span id="code215">STA	TDRIVE	</span><span class="cmt">;and save.</span></pre>
<pre id="l216"><span class="adr">DD28</span>	C9              	<span id="code216">RET</span></pre>
<pre id="l217"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l218"><span class="adr"></span>	                <span class="cmt">;   Move currently active drive down to (TDRIVE).</span></pre>
<pre id="l219"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l220"><span class="adr">DD29</span>	3A EF E3        <span class="l" id="label220">MOVECD</span>	<span id="code220">LDA	CDRIVE</span></pre>
<pre id="l221"><span class="adr">DD2C</span>	32 04 00        	<span id="code221">STA	TDRIVE</span></pre>
<pre id="l222"><span class="adr">DD2F</span>	C9              	<span id="code222">RET</span></pre>
<pre id="l223"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l224"><span class="adr"></span>	                <span class="cmt">;   Routine to convert (A) into upper case ascii. Only letters</span></pre>
<pre id="l225"><span class="adr"></span>	                <span class="cmt">; are affected.</span></pre>
<pre id="l226"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l227"><span class="adr">DD30</span>	FE 61           <span class="l" id="label227">UPPER</span>	<span id="code227">CPI	'a'	</span><span class="cmt">;check for letters in the range of 'a' to 'z'.</span></pre>
<pre id="l228"><span class="adr">DD32</span>	D8              	<span id="code228">RC</span></pre>
<pre id="l229"><span class="adr">DD33</span>	FE 7B           	<span id="code229">CPI	'{'</span></pre>
<pre id="l230"><span class="adr">DD35</span>	D0              	<span id="code230">RNC</span></pre>
<pre id="l231"><span class="adr">DD36</span>	E6 5F           	<span id="code231">ANI	5FH	</span><span class="cmt">;convert it if found.</span></pre>
<pre id="l232"><span class="adr">DD38</span>	C9              	<span id="code232">RET</span></pre>
<pre id="l233"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l234"><span class="adr"></span>	                <span class="cmt">;   Routine to get a line of input. We must check to see if the</span></pre>
<pre id="l235"><span class="adr"></span>	                <span class="cmt">; user is in (BATCH) mode. If so, then read the input from file</span></pre>
<pre id="l236"><span class="adr"></span>	                <span class="cmt">; ($$$.SUB). At the end, reset to console input.</span></pre>
<pre id="l237"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l238"><span class="adr">DD39</span>	3A AB E3        <span class="l" id="label238">GETINP</span>	<span id="code238">LDA	BATCH	</span><span class="cmt">;if =0, then use console input.</span></pre>
<pre id="l239"><span class="adr">DD3C</span>	B7              	<span id="code239">ORA	A</span></pre>
<pre id="l240"><span class="adr">DD3D</span>	CA 96 DD        	<span id="code240">JZ	GETINP1</span></pre>
<pre id="l241"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l242"><span class="adr"></span>	                <span class="cmt">;   Use the submit file ($$$.sub) which is prepared by a</span></pre>
<pre id="l243"><span class="adr"></span>	                <span class="cmt">; SUBMIT run. It must be on drive (A) and it will be deleted</span></pre>
<pre id="l244"><span class="adr"></span>	                <span class="cmt">; if and error occures (like eof).</span></pre>
<pre id="l245"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l246"><span class="adr">DD40</span>	3A EF E3        	<span id="code246">LDA	CDRIVE	</span><span class="cmt">;select drive 0 if need be.</span></pre>
<pre id="l247"><span class="adr">DD43</span>	B7              	<span id="code247">ORA	A</span></pre>
<pre id="l248"><span class="adr">DD44</span>	3E 00           	<span id="code248">MVI	A,0	</span><span class="cmt">;always use drive A for submit.</span></pre>
<pre id="l249"><span class="adr">DD46</span>	C4 BD DC        	<span id="code249">CNZ	DSKSEL	</span><span class="cmt">;select it if required.</span></pre>
<pre id="l250"><span class="adr">DD49</span>	11 AC E3        	<span id="code250">LXI	D,BATCHFCB</span></pre>
<pre id="l251"><span class="adr">DD4C</span>	CD CB DC        	<span id="code251">CALL	OPEN	</span><span class="cmt">;look for it.</span></pre>
<pre id="l252"><span class="adr">DD4F</span>	CA 96 DD        	<span id="code252">JZ	GETINP1	</span><span class="cmt">;if not there, use normal input.</span></pre>
<pre id="l253"><span class="adr">DD52</span>	3A BB E3        	<span id="code253">LDA	BATCHFCB+15</span><span class="cmt">;get last record number+1.</span></pre>
<pre id="l254"><span class="adr">DD55</span>	3D              	<span id="code254">DCR	A</span></pre>
<pre id="l255"><span class="adr">DD56</span>	32 CC E3        	<span id="code255">STA	BATCHFCB+32</span></pre>
<pre id="l256"><span class="adr">DD59</span>	11 AC E3        	<span id="code256">LXI	D,BATCHFCB</span></pre>
<pre id="l257"><span class="adr">DD5C</span>	CD F9 DC        	<span id="code257">CALL	RDREC	</span><span class="cmt">;read last record.</span></pre>
<pre id="l258"><span class="adr">DD5F</span>	C2 96 DD        	<span id="code258">JNZ	GETINP1	</span><span class="cmt">;quit on end of file.</span></pre>
<pre id="l259"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l260"><span class="adr"></span>	                <span class="cmt">;   Move this record into input buffer.</span></pre>
<pre id="l261"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l262"><span class="adr">DD62</span>	11 07 DC        	<span id="code262">LXI	D,INBUFF+1</span></pre>
<pre id="l263"><span class="adr">DD65</span>	21 80 00        	<span id="code263">LXI	H,TBUFF	</span><span class="cmt">;data was read into buffer here.</span></pre>
<pre id="l264"><span class="adr">DD68</span>	06 80           	<span id="code264">MVI	B,128	</span><span class="cmt">;all 128 characters may be used.</span></pre>
<pre id="l265"><span class="adr">DD6A</span>	CD 42 E0        	<span id="code265">CALL	HL2DE	</span><span class="cmt">;(HL) to (DE), (B) bytes.</span></pre>
<pre id="l266"><span class="adr">DD6D</span>	21 BA E3        	<span id="code266">LXI	H,BATCHFCB+14</span></pre>
<pre id="l267"><span class="adr">DD70</span>	36 00           	<span id="code267">MVI	M,0	</span><span class="cmt">;zero out the 's2' byte.</span></pre>
<pre id="l268"><span class="adr">DD72</span>	23              	<span id="code268">INX	H	</span><span class="cmt">;and decrement the record count.</span></pre>
<pre id="l269"><span class="adr">DD73</span>	35              	<span id="code269">DCR	M</span></pre>
<pre id="l270"><span class="adr">DD74</span>	11 AC E3        	<span id="code270">LXI	D,BATCHFCB</span><span class="cmt">;close the batch file now.</span></pre>
<pre id="l271"><span class="adr">DD77</span>	CD DA DC        	<span id="code271">CALL	CLOSE</span></pre>
<pre id="l272"><span class="adr">DD7A</span>	CA 96 DD        	<span id="code272">JZ	GETINP1	</span><span class="cmt">;quit on an error.</span></pre>
<pre id="l273"><span class="adr">DD7D</span>	3A EF E3        	<span id="code273">LDA	CDRIVE	</span><span class="cmt">;re-select previous drive if need be.</span></pre>
<pre id="l274"><span class="adr">DD80</span>	B7              	<span id="code274">ORA	A</span></pre>
<pre id="l275"><span class="adr">DD81</span>	C4 BD DC        	<span id="code275">CNZ	DSKSEL	</span><span class="cmt">;don't do needless selects.</span></pre>
<pre id="l276"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l277"><span class="adr"></span>	                <span class="cmt">;   Print line just read on console.</span></pre>
<pre id="l278"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l279"><span class="adr">DD84</span>	21 08 DC        	<span id="code279">LXI	H,INBUFF+2</span></pre>
<pre id="l280"><span class="adr">DD87</span>	CD AC DC        	<span id="code280">CALL	PLINE2</span></pre>
<pre id="l281"><span class="adr">DD8A</span>	CD C2 DD        	<span id="code281">CALL	CHKCON	</span><span class="cmt">;check console, quit on a key.</span></pre>
<pre id="l282"><span class="adr">DD8D</span>	CA A7 DD        	<span id="code282">JZ	GETINP2	</span><span class="cmt">;jump if no key is pressed.</span></pre>
<pre id="l283"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l284"><span class="adr"></span>	                <span class="cmt">;   Terminate the submit job on any keyboard input. Delete this</span></pre>
<pre id="l285"><span class="adr"></span>	                <span class="cmt">; file such that it is not re-started and jump to normal keyboard</span></pre>
<pre id="l286"><span class="adr"></span>	                <span class="cmt">; input section.</span></pre>
<pre id="l287"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l288"><span class="adr">DD90</span>	CD DD DD        	<span id="code288">CALL	DELBATCH</span><span class="cmt">;delete the batch file.</span></pre>
<pre id="l289"><span class="adr">DD93</span>	C3 82 DF        	<span id="code289">JMP	CMMND1	</span><span class="cmt">;and restart command input.</span></pre>
<pre id="l290"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l291"><span class="adr"></span>	                <span class="cmt">;   Get here for normal keyboard input. Delete the submit file</span></pre>
<pre id="l292"><span class="adr"></span>	                <span class="cmt">; incase there was one.</span></pre>
<pre id="l293"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l294"><span class="adr">DD96</span>	CD DD DD        <span class="l" id="label294">GETINP1</span>	<span id="code294">CALL	DELBATCH</span><span class="cmt">;delete file ($$$.sub).</span></pre>
<pre id="l295"><span class="adr">DD99</span>	CD 1A DD        	<span id="code295">CALL	SETCDRV	</span><span class="cmt">;reset active disk.</span></pre>
<pre id="l296"><span class="adr">DD9C</span>	0E 0A           	<span id="code296">MVI	C,10	</span><span class="cmt">;get line from console device.</span></pre>
<pre id="l297"><span class="adr">DD9E</span>	11 06 DC        	<span id="code297">LXI	D,INBUFF</span></pre>
<pre id="l298"><span class="adr">DDA1</span>	CD 05 00        	<span id="code298">CALL	ENTRY</span></pre>
<pre id="l299"><span class="adr">DDA4</span>	CD 29 DD        	<span id="code299">CALL	MOVECD	</span><span class="cmt">;reset current drive (again).</span></pre>
<pre id="l300"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l301"><span class="adr"></span>	                <span class="cmt">;   Convert input line to upper case.</span></pre>
<pre id="l302"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l303"><span class="adr">DDA7</span>	21 07 DC        <span class="l" id="label303">GETINP2</span>	<span id="code303">LXI	H,INBUFF+1</span></pre>
<pre id="l304"><span class="adr">DDAA</span>	46              	<span id="code304">MOV	B,M	</span><span class="cmt">;(B)=character counter.</span></pre>
<pre id="l305"><span class="adr">DDAB</span>	23              <span class="l" id="label305">GETINP3</span>	<span id="code305">INX	H</span></pre>
<pre id="l306"><span class="adr">DDAC</span>	78              	<span id="code306">MOV	A,B	</span><span class="cmt">;end of the line?</span></pre>
<pre id="l307"><span class="adr">DDAD</span>	B7              	<span id="code307">ORA	A</span></pre>
<pre id="l308"><span class="adr">DDAE</span>	CA BA DD        	<span id="code308">JZ	GETINP4</span></pre>
<pre id="l309"><span class="adr">DDB1</span>	7E              	<span id="code309">MOV	A,M	</span><span class="cmt">;convert to upper case.</span></pre>
<pre id="l310"><span class="adr">DDB2</span>	CD 30 DD        	<span id="code310">CALL	UPPER</span></pre>
<pre id="l311"><span class="adr">DDB5</span>	77              	<span id="code311">MOV	M,A</span></pre>
<pre id="l312"><span class="adr">DDB6</span>	05              	<span id="code312">DCR	B	</span><span class="cmt">;adjust character count.</span></pre>
<pre id="l313"><span class="adr">DDB7</span>	C3 AB DD        	<span id="code313">JMP	GETINP3</span></pre>
<pre id="l314"><span class="adr">DDBA</span>	77              <span class="l" id="label314">GETINP4</span>	<span id="code314">MOV	M,A	</span><span class="cmt">;add trailing null.</span></pre>
<pre id="l315"><span class="adr">DDBB</span>	21 08 DC        	<span id="code315">LXI	H,INBUFF+2</span></pre>
<pre id="l316"><span class="adr">DDBE</span>	22 88 DC        	<span id="code316">SHLD	INPOINT	</span><span class="cmt">;reset input line pointer.</span></pre>
<pre id="l317"><span class="adr">DDC1</span>	C9              	<span id="code317">RET</span></pre>
<pre id="l318"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l319"><span class="adr"></span>	                <span class="cmt">;   Routine to check the console for a key pressed. The zero</span></pre>
<pre id="l320"><span class="adr"></span>	                <span class="cmt">; flag is set is none, else the character is returned in (A).</span></pre>
<pre id="l321"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l322"><span class="adr">DDC2</span>	0E 0B           <span class="l" id="label322">CHKCON</span>	<span id="code322">MVI	C,11	</span><span class="cmt">;check console.</span></pre>
<pre id="l323"><span class="adr">DDC4</span>	CD 05 00        	<span id="code323">CALL	ENTRY</span></pre>
<pre id="l324"><span class="adr">DDC7</span>	B7              	<span id="code324">ORA	A</span></pre>
<pre id="l325"><span class="adr">DDC8</span>	C8              	<span id="code325">RZ		</span><span class="cmt">;return if nothing.</span></pre>
<pre id="l326"><span class="adr">DDC9</span>	0E 01           	<span id="code326">MVI	C,1	</span><span class="cmt">;else get character.</span></pre>
<pre id="l327"><span class="adr">DDCB</span>	CD 05 00        	<span id="code327">CALL	ENTRY</span></pre>
<pre id="l328"><span class="adr">DDCE</span>	B7              	<span id="code328">ORA	A	</span><span class="cmt">;clear zero flag and return.</span></pre>
<pre id="l329"><span class="adr">DDCF</span>	C9              	<span id="code329">RET</span></pre>
<pre id="l330"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l331"><span class="adr"></span>	                <span class="cmt">;   Routine to get the currently active drive number.</span></pre>
<pre id="l332"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l333"><span class="adr">DDD0</span>	0E 19           <span class="l" id="label333">GETDSK</span>	<span id="code333">MVI	C,25</span></pre>
<pre id="l334"><span class="adr">DDD2</span>	C3 05 00        	<span id="code334">JMP	ENTRY</span></pre>
<pre id="l335"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l336"><span class="adr"></span>	                <span class="cmt">;   Set the stabdard dma address.</span></pre>
<pre id="l337"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l338"><span class="adr">DDD5</span>	11 80 00        <span class="l" id="label338">STDDMA</span>	<span id="code338">LXI	D,TBUFF</span></pre>
<pre id="l339"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l340"><span class="adr"></span>	                <span class="cmt">;   Routine to set the dma address to (DE).</span></pre>
<pre id="l341"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l342"><span class="adr">DDD8</span>	0E 1A           <span class="l" id="label342">DMASET</span>	<span id="code342">MVI	C,26</span></pre>
<pre id="l343"><span class="adr">DDDA</span>	C3 05 00        	<span id="code343">JMP	ENTRY</span></pre>
<pre id="l344"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l345"><span class="adr"></span>	                <span class="cmt">;  Delete the batch file created by SUBMIT.</span></pre>
<pre id="l346"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l347"><span class="adr">DDDD</span>	21 AB E3        <span class="l" id="label347">DELBATCH</span><span id="code347">:LXI	H,BATCH	</span><span class="cmt">;is batch active?</span></pre>
<pre id="l348"><span class="adr">DDE0</span>	7E              	<span id="code348">MOV	A,M</span></pre>
<pre id="l349"><span class="adr">DDE1</span>	B7              	<span id="code349">ORA	A</span></pre>
<pre id="l350"><span class="adr">DDE2</span>	C8              	<span id="code350">RZ</span></pre>
<pre id="l351"><span class="adr">DDE3</span>	36 00           	<span id="code351">MVI	M,0	</span><span class="cmt">;yes, de-activate it.</span></pre>
<pre id="l352"><span class="adr">DDE5</span>	AF              	<span id="code352">XRA	A</span></pre>
<pre id="l353"><span class="adr">DDE6</span>	CD BD DC        	<span id="code353">CALL	DSKSEL	</span><span class="cmt">;select drive 0 for sure.</span></pre>
<pre id="l354"><span class="adr">DDE9</span>	11 AC E3        	<span id="code354">LXI	D,BATCHFCB</span><span class="cmt">;and delete this file.</span></pre>
<pre id="l355"><span class="adr">DDEC</span>	CD EF DC        	<span id="code355">CALL	DELETE</span></pre>
<pre id="l356"><span class="adr">DDEF</span>	3A EF E3        	<span id="code356">LDA	CDRIVE	</span><span class="cmt">;reset current drive.</span></pre>
<pre id="l357"><span class="adr">DDF2</span>	C3 BD DC        	<span id="code357">JMP	DSKSEL</span></pre>
<pre id="l358"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l359"><span class="adr"></span>	                <span class="cmt">;   Check to two strings at (PATTRN1) and (PATTRN2). They must be</span></pre>
<pre id="l360"><span class="adr"></span>	                <span class="cmt">; the same or we halt....</span></pre>
<pre id="l361"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l362"><span class="adr">DDF5</span>	11 28 DF        <span class="l" id="label362">VERIFY</span>	<span id="code362">LXI	D,PATTRN1</span><span class="cmt">;these are the serial number bytes.</span></pre>
<pre id="l363"><span class="adr">DDF8</span>	21 00 E4        	<span id="code363">LXI	H,PATTRN2</span><span class="cmt">;ditto, but how could they be different?</span></pre>
<pre id="l364"><span class="adr">DDFB</span>	06 06           	<span id="code364">MVI	B,6	</span><span class="cmt">;6 bytes each.</span></pre>
<pre id="l365"><span class="adr">DDFD</span>	1A              <span class="l" id="label365">VERIFY1</span>	<span id="code365">LDAX	D</span></pre>
<pre id="l366"><span class="adr">DDFE</span>	BE              	<span id="code366">CMP	M</span></pre>
<pre id="l367"><span class="adr">DDFF</span>	C2 CF DF        	<span id="code367">JNZ	HALT	</span><span class="cmt">;jump to halt routine.</span></pre>
<pre id="l368"><span class="adr">DE02</span>	13              	<span id="code368">INX	D</span></pre>
<pre id="l369"><span class="adr">DE03</span>	23              	<span id="code369">INX	H</span></pre>
<pre id="l370"><span class="adr">DE04</span>	05              	<span id="code370">DCR	B</span></pre>
<pre id="l371"><span class="adr">DE05</span>	C2 FD DD        	<span id="code371">JNZ	VERIFY1</span></pre>
<pre id="l372"><span class="adr">DE08</span>	C9              	<span id="code372">RET</span></pre>
<pre id="l373"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l374"><span class="adr"></span>	                <span class="cmt">;   Print back file name with a '?' to indicate a syntax error.</span></pre>
<pre id="l375"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l376"><span class="adr">DE09</span>	CD 98 DC        <span class="l" id="label376">SYNERR</span>	<span id="code376">CALL	CRLF	</span><span class="cmt">;end current line.</span></pre>
<pre id="l377"><span class="adr">DE0C</span>	2A 8A DC        	<span id="code377">LHLD	NAMEPNT	</span><span class="cmt">;this points to name in error.</span></pre>
<pre id="l378"><span class="adr">DE0F</span>	7E              <span class="l" id="label378">SYNERR1</span>	<span id="code378">MOV	A,M	</span><span class="cmt">;print it until a space or null is found.</span></pre>
<pre id="l379"><span class="adr">DE10</span>	FE 20           	<span id="code379">CPI	' '</span></pre>
<pre id="l380"><span class="adr">DE12</span>	CA 22 DE        	<span id="code380">JZ	SYNERR2</span></pre>
<pre id="l381"><span class="adr">DE15</span>	B7              	<span id="code381">ORA	A</span></pre>
<pre id="l382"><span class="adr">DE16</span>	CA 22 DE        	<span id="code382">JZ	SYNERR2</span></pre>
<pre id="l383"><span class="adr">DE19</span>	E5              	<span id="code383">PUSH	H</span></pre>
<pre id="l384"><span class="adr">DE1A</span>	CD 8C DC        	<span id="code384">CALL	PRINT</span></pre>
<pre id="l385"><span class="adr">DE1D</span>	E1              	<span id="code385">POP	H</span></pre>
<pre id="l386"><span class="adr">DE1E</span>	23              	<span id="code386">INX	H</span></pre>
<pre id="l387"><span class="adr">DE1F</span>	C3 0F DE        	<span id="code387">JMP	SYNERR1</span></pre>
<pre id="l388"><span class="adr">DE22</span>	3E 3F           <span class="l" id="label388">SYNERR2</span>	<span id="code388">MVI	A,'?'	</span><span class="cmt">;add trailing '?'.</span></pre>
<pre id="l389"><span class="adr">DE24</span>	CD 8C DC        	<span id="code389">CALL	PRINT</span></pre>
<pre id="l390"><span class="adr">DE27</span>	CD 98 DC        	<span id="code390">CALL	CRLF</span></pre>
<pre id="l391"><span class="adr">DE2A</span>	CD DD DD        	<span id="code391">CALL	DELBATCH</span><span class="cmt">;delete any batch file.</span></pre>
<pre id="l392"><span class="adr">DE2D</span>	C3 82 DF        	<span id="code392">JMP	CMMND1	</span><span class="cmt">;and restart from console input.</span></pre>
<pre id="l393"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l394"><span class="adr"></span>	                <span class="cmt">;   Check character at (DE) for legal command input. Note that the</span></pre>
<pre id="l395"><span class="adr"></span>	                <span class="cmt">; zero flag is set if the character is a delimiter.</span></pre>
<pre id="l396"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l397"><span class="adr">DE30</span>	1A              <span class="l" id="label397">CHECK</span>	<span id="code397">LDAX	D</span></pre>
<pre id="l398"><span class="adr">DE31</span>	B7              	<span id="code398">ORA	A</span></pre>
<pre id="l399"><span class="adr">DE32</span>	C8              	<span id="code399">RZ</span></pre>
<pre id="l400"><span class="adr">DE33</span>	FE 20           	<span id="code400">CPI	' '	</span><span class="cmt">;control characters are not legal here.</span></pre>
<pre id="l401"><span class="adr">DE35</span>	DA 09 DE        	<span id="code401">JC	SYNERR</span></pre>
<pre id="l402"><span class="adr">DE38</span>	C8              	<span id="code402">RZ		</span><span class="cmt">;check for valid delimiter.</span></pre>
<pre id="l403"><span class="adr">DE39</span>	FE 3D           	<span id="code403">CPI	'='</span></pre>
<pre id="l404"><span class="adr">DE3B</span>	C8              	<span id="code404">RZ</span></pre>
<pre id="l405"><span class="adr">DE3C</span>	FE 5F           	<span id="code405">CPI	'_'</span></pre>
<pre id="l406"><span class="adr">DE3E</span>	C8              	<span id="code406">RZ</span></pre>
<pre id="l407"><span class="adr">DE3F</span>	FE 2E           	<span id="code407">CPI	'.'</span></pre>
<pre id="l408"><span class="adr">DE41</span>	C8              	<span id="code408">RZ</span></pre>
<pre id="l409"><span class="adr">DE42</span>	FE 3A           	<span id="code409">CPI	':'</span></pre>
<pre id="l410"><span class="adr">DE44</span>	C8              	<span id="code410">RZ</span></pre>
<pre id="l411"><span class="adr">DE45</span>	FE 3B           	<span id="code411">CPI	'</span><span class="cmt">;'</span></pre>
<pre id="l412"><span class="adr">DE47</span>	C8              	<span id="code412">RZ</span></pre>
<pre id="l413"><span class="adr">DE48</span>	FE 3C           	<span id="code413">CPI	'<'</span></pre>
<pre id="l414"><span class="adr">DE4A</span>	C8              	<span id="code414">RZ</span></pre>
<pre id="l415"><span class="adr">DE4B</span>	FE 3E           	<span id="code415">CPI	'>'</span></pre>
<pre id="l416"><span class="adr">DE4D</span>	C8              	<span id="code416">RZ</span></pre>
<pre id="l417"><span class="adr">DE4E</span>	C9              	<span id="code417">RET</span></pre>
<pre id="l418"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l419"><span class="adr"></span>	                <span class="cmt">;   Get the next non-blank character from (DE).</span></pre>
<pre id="l420"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l421"><span class="adr">DE4F</span>	1A              <span class="l" id="label421">NONBLANK</span><span id="code421">:LDAX	D</span></pre>
<pre id="l422"><span class="adr">DE50</span>	B7              	<span id="code422">ORA	A	</span><span class="cmt">;string ends with a null.</span></pre>
<pre id="l423"><span class="adr">DE51</span>	C8              	<span id="code423">RZ</span></pre>
<pre id="l424"><span class="adr">DE52</span>	FE 20           	<span id="code424">CPI	' '</span></pre>
<pre id="l425"><span class="adr">DE54</span>	C0              	<span id="code425">RNZ</span></pre>
<pre id="l426"><span class="adr">DE55</span>	13              	<span id="code426">INX	D</span></pre>
<pre id="l427"><span class="adr">DE56</span>	C3 4F DE        	<span id="code427">JMP	NONBLANK</span></pre>
<pre id="l428"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l429"><span class="adr"></span>	                <span class="cmt">;   Add (HL)=(HL)+(A)</span></pre>
<pre id="l430"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l431"><span class="adr">DE59</span>	85              <span class="l" id="label431">ADDHL</span>	<span id="code431">ADD	L</span></pre>
<pre id="l432"><span class="adr">DE5A</span>	6F              	<span id="code432">MOV	L,A</span></pre>
<pre id="l433"><span class="adr">DE5B</span>	D0              	<span id="code433">RNC	</span><span class="cmt">;take care of any carry.</span></pre>
<pre id="l434"><span class="adr">DE5C</span>	24              	<span id="code434">INR	H</span></pre>
<pre id="l435"><span class="adr">DE5D</span>	C9              	<span id="code435">RET</span></pre>
<pre id="l436"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l437"><span class="adr"></span>	                <span class="cmt">;   Convert the first name in (FCB).</span></pre>
<pre id="l438"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l439"><span class="adr">DE5E</span>	3E 00           <span class="l" id="label439">CONVFST</span>	<span id="code439">MVI	A,0</span></pre>
<pre id="l440"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l441"><span class="adr"></span>	                <span class="cmt">;   Format a file name (convert * to '?', etc.). On return,</span></pre>
<pre id="l442"><span class="adr"></span>	                <span class="cmt">; (A)=0 is an unambigeous name was specified. Enter with (A) equal to</span></pre>
<pre id="l443"><span class="adr"></span>	                <span class="cmt">; the position within the fcb for the name (either 0 or 16).</span></pre>
<pre id="l444"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l445"><span class="adr">DE60</span>	21 CD E3        <span class="l" id="label445">CONVERT</span>	<span id="code445">LXI	H,FCB</span></pre>
<pre id="l446"><span class="adr">DE63</span>	CD 59 DE        	<span id="code446">CALL	ADDHL</span></pre>
<pre id="l447"><span class="adr">DE66</span>	E5              	<span id="code447">PUSH	H</span></pre>
<pre id="l448"><span class="adr">DE67</span>	E5              	<span id="code448">PUSH	H</span></pre>
<pre id="l449"><span class="adr">DE68</span>	AF              	<span id="code449">XRA	A</span></pre>
<pre id="l450"><span class="adr">DE69</span>	32 F0 E3        	<span id="code450">STA	CHGDRV	</span><span class="cmt">;initialize drive change flag.</span></pre>
<pre id="l451"><span class="adr">DE6C</span>	2A 88 DC        	<span id="code451">LHLD	INPOINT	</span><span class="cmt">;set (HL) as pointer into input line.</span></pre>
<pre id="l452"><span class="adr">DE6F</span>	EB              	<span id="code452">XCHG</span></pre>
<pre id="l453"><span class="adr">DE70</span>	CD 4F DE        	<span id="code453">CALL	NONBLANK</span><span class="cmt">;get next non-blank character.</span></pre>
<pre id="l454"><span class="adr">DE73</span>	EB              	<span id="code454">XCHG</span></pre>
<pre id="l455"><span class="adr">DE74</span>	22 8A DC        	<span id="code455">SHLD	NAMEPNT	</span><span class="cmt">;save pointer here for any error message.</span></pre>
<pre id="l456"><span class="adr">DE77</span>	EB              	<span id="code456">XCHG</span></pre>
<pre id="l457"><span class="adr">DE78</span>	E1              	<span id="code457">POP	H</span></pre>
<pre id="l458"><span class="adr">DE79</span>	1A              	<span id="code458">LDAX	D	</span><span class="cmt">;get first character.</span></pre>
<pre id="l459"><span class="adr">DE7A</span>	B7              	<span id="code459">ORA	A</span></pre>
<pre id="l460"><span class="adr">DE7B</span>	CA 89 DE        	<span id="code460">JZ	CONVRT1</span></pre>
<pre id="l461"><span class="adr">DE7E</span>	DE 60           	<span id="code461">SBI	'A'-1	</span><span class="cmt">;might be a drive name, convert to binary.</span></pre>
<pre id="l462"><span class="adr">DE80</span>	47              	<span id="code462">MOV	B,A	</span><span class="cmt">;and save.</span></pre>
<pre id="l463"><span class="adr">DE81</span>	13              	<span id="code463">INX	D	</span><span class="cmt">;check next character for a ':'.</span></pre>
<pre id="l464"><span class="adr">DE82</span>	1A              	<span id="code464">LDAX	D</span></pre>
<pre id="l465"><span class="adr">DE83</span>	FE 3A           	<span id="code465">CPI	':'</span></pre>
<pre id="l466"><span class="adr">DE85</span>	CA 90 DE        	<span id="code466">JZ	CONVRT2</span></pre>
<pre id="l467"><span class="adr">DE88</span>	1B              	<span id="code467">DCX	D	</span><span class="cmt">;nope, move pointer back to the start of the line.</span></pre>
<pre id="l468"><span class="adr">DE89</span>	3A EF E3        <span class="l" id="label468">CONVRT1</span>	<span id="code468">LDA	CDRIVE</span></pre>
<pre id="l469"><span class="adr">DE8C</span>	77              	<span id="code469">MOV	M,A</span></pre>
<pre id="l470"><span class="adr">DE8D</span>	C3 96 DE        	<span id="code470">JMP	CONVRT3</span></pre>
<pre id="l471"><span class="adr">DE90</span>	78              <span class="l" id="label471">CONVRT2</span>	<span id="code471">MOV	A,B</span></pre>
<pre id="l472"><span class="adr">DE91</span>	32 F0 E3        	<span id="code472">STA	CHGDRV	</span><span class="cmt">;set change in drives flag.</span></pre>
<pre id="l473"><span class="adr">DE94</span>	70              	<span id="code473">MOV	M,B</span></pre>
<pre id="l474"><span class="adr">DE95</span>	13              	<span id="code474">INX	D</span></pre>
<pre id="l475"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l476"><span class="adr"></span>	                <span class="cmt">;   Convert the basic file name.</span></pre>
<pre id="l477"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l478"><span class="adr">DE96</span>	06 08           <span class="l" id="label478">CONVRT3</span>	<span id="code478">MVI	B,08H</span></pre>
<pre id="l479"><span class="adr">DE98</span>	CD 30 DE        <span class="l" id="label479">CONVRT4</span>	<span id="code479">CALL	CHECK</span></pre>
<pre id="l480"><span class="adr">DE9B</span>	CA B9 DE        	<span id="code480">JZ	CONVRT8</span></pre>
<pre id="l481"><span class="adr">DE9E</span>	23              	<span id="code481">INX	H</span></pre>
<pre id="l482"><span class="adr">DE9F</span>	FE 2A           	<span id="code482">CPI	'*'	</span><span class="cmt">;note that an '*' will fill the remaining</span></pre>
<pre id="l483"><span class="adr">DEA1</span>	C2 A9 DE        	<span id="code483">JNZ	CONVRT5	</span><span class="cmt">;field with '?'.</span></pre>
<pre id="l484"><span class="adr">DEA4</span>	36 3F           	<span id="code484">MVI	M,'?'</span></pre>
<pre id="l485"><span class="adr">DEA6</span>	C3 AB DE        	<span id="code485">JMP	CONVRT6</span></pre>
<pre id="l486"><span class="adr">DEA9</span>	77              <span class="l" id="label486">CONVRT5</span>	<span id="code486">MOV	M,A</span></pre>
<pre id="l487"><span class="adr">DEAA</span>	13              	<span id="code487">INX	D</span></pre>
<pre id="l488"><span class="adr">DEAB</span>	05              <span class="l" id="label488">CONVRT6</span>	<span id="code488">DCR	B</span></pre>
<pre id="l489"><span class="adr">DEAC</span>	C2 98 DE        	<span id="code489">JNZ	CONVRT4</span></pre>
<pre id="l490"><span class="adr">DEAF</span>	CD 30 DE        <span class="l" id="label490">CONVRT7</span>	<span id="code490">CALL	CHECK	</span><span class="cmt">;get next delimiter.</span></pre>
<pre id="l491"><span class="adr">DEB2</span>	CA C0 DE        	<span id="code491">JZ	GETEXT</span></pre>
<pre id="l492"><span class="adr">DEB5</span>	13              	<span id="code492">INX	D</span></pre>
<pre id="l493"><span class="adr">DEB6</span>	C3 AF DE        	<span id="code493">JMP	CONVRT7</span></pre>
<pre id="l494"><span class="adr">DEB9</span>	23              <span class="l" id="label494">CONVRT8</span>	<span id="code494">INX	H	</span><span class="cmt">;blank fill the file name.</span></pre>
<pre id="l495"><span class="adr">DEBA</span>	36 20           	<span id="code495">MVI	M,' '</span></pre>
<pre id="l496"><span class="adr">DEBC</span>	05              	<span id="code496">DCR	B</span></pre>
<pre id="l497"><span class="adr">DEBD</span>	C2 B9 DE        	<span id="code497">JNZ	CONVRT8</span></pre>
<pre id="l498"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l499"><span class="adr"></span>	                <span class="cmt">;   Get the extension and convert it.</span></pre>
<pre id="l500"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l501"><span class="adr">DEC0</span>	06 03           <span class="l" id="label501">GETEXT</span>	<span id="code501">MVI	B,03H</span></pre>
<pre id="l502"><span class="adr">DEC2</span>	FE 2E           	<span id="code502">CPI	'.'</span></pre>
<pre id="l503"><span class="adr">DEC4</span>	C2 E9 DE        	<span id="code503">JNZ	GETEXT5</span></pre>
<pre id="l504"><span class="adr">DEC7</span>	13              	<span id="code504">INX	D</span></pre>
<pre id="l505"><span class="adr">DEC8</span>	CD 30 DE        <span class="l" id="label505">GETEXT1</span>	<span id="code505">CALL	CHECK</span></pre>
<pre id="l506"><span class="adr">DECB</span>	CA E9 DE        	<span id="code506">JZ	GETEXT5</span></pre>
<pre id="l507"><span class="adr">DECE</span>	23              	<span id="code507">INX	H</span></pre>
<pre id="l508"><span class="adr">DECF</span>	FE 2A           	<span id="code508">CPI	'*'</span></pre>
<pre id="l509"><span class="adr">DED1</span>	C2 D9 DE        	<span id="code509">JNZ	GETEXT2</span></pre>
<pre id="l510"><span class="adr">DED4</span>	36 3F           	<span id="code510">MVI	M,'?'</span></pre>
<pre id="l511"><span class="adr">DED6</span>	C3 DB DE        	<span id="code511">JMP	GETEXT3</span></pre>
<pre id="l512"><span class="adr">DED9</span>	77              <span class="l" id="label512">GETEXT2</span>	<span id="code512">MOV	M,A</span></pre>
<pre id="l513"><span class="adr">DEDA</span>	13              	<span id="code513">INX	D</span></pre>
<pre id="l514"><span class="adr">DEDB</span>	05              <span class="l" id="label514">GETEXT3</span>	<span id="code514">DCR	B</span></pre>
<pre id="l515"><span class="adr">DEDC</span>	C2 C8 DE        	<span id="code515">JNZ	GETEXT1</span></pre>
<pre id="l516"><span class="adr">DEDF</span>	CD 30 DE        <span class="l" id="label516">GETEXT4</span>	<span id="code516">CALL	CHECK</span></pre>
<pre id="l517"><span class="adr">DEE2</span>	CA F0 DE        	<span id="code517">JZ	GETEXT6</span></pre>
<pre id="l518"><span class="adr">DEE5</span>	13              	<span id="code518">INX	D</span></pre>
<pre id="l519"><span class="adr">DEE6</span>	C3 DF DE        	<span id="code519">JMP	GETEXT4</span></pre>
<pre id="l520"><span class="adr">DEE9</span>	23              <span class="l" id="label520">GETEXT5</span>	<span id="code520">INX	H</span></pre>
<pre id="l521"><span class="adr">DEEA</span>	36 20           	<span id="code521">MVI	M,' '</span></pre>
<pre id="l522"><span class="adr">DEEC</span>	05              	<span id="code522">DCR	B</span></pre>
<pre id="l523"><span class="adr">DEED</span>	C2 E9 DE        	<span id="code523">JNZ	GETEXT5</span></pre>
<pre id="l524"><span class="adr">DEF0</span>	06 03           <span class="l" id="label524">GETEXT6</span>	<span id="code524">MVI	B,3</span></pre>
<pre id="l525"><span class="adr">DEF2</span>	23              <span class="l" id="label525">GETEXT7</span>	<span id="code525">INX	H</span></pre>
<pre id="l526"><span class="adr">DEF3</span>	36 00           	<span id="code526">MVI	M,0</span></pre>
<pre id="l527"><span class="adr">DEF5</span>	05              	<span id="code527">DCR	B</span></pre>
<pre id="l528"><span class="adr">DEF6</span>	C2 F2 DE        	<span id="code528">JNZ	GETEXT7</span></pre>
<pre id="l529"><span class="adr">DEF9</span>	EB              	<span id="code529">XCHG</span></pre>
<pre id="l530"><span class="adr">DEFA</span>	22 88 DC        	<span id="code530">SHLD	INPOINT	</span><span class="cmt">;save input line pointer.</span></pre>
<pre id="l531"><span class="adr">DEFD</span>	E1              	<span id="code531">POP	H</span></pre>
<pre id="l532"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l533"><span class="adr"></span>	                <span class="cmt">;   Check to see if this is an ambigeous file name specification.</span></pre>
<pre id="l534"><span class="adr"></span>	                <span class="cmt">; Set the (A) register to non zero if it is.</span></pre>
<pre id="l535"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l536"><span class="adr">DEFE</span>	01 0B 00        	<span id="code536">LXI	B,11	</span><span class="cmt">;set name length.</span></pre>
<pre id="l537"><span class="adr">DF01</span>	23              <span class="l" id="label537">GETEXT8</span>	<span id="code537">INX	H</span></pre>
<pre id="l538"><span class="adr">DF02</span>	7E              	<span id="code538">MOV	A,M</span></pre>
<pre id="l539"><span class="adr">DF03</span>	FE 3F           	<span id="code539">CPI	'?'	</span><span class="cmt">;any question marks?</span></pre>
<pre id="l540"><span class="adr">DF05</span>	C2 09 DF        	<span id="code540">JNZ	GETEXT9</span></pre>
<pre id="l541"><span class="adr">DF08</span>	04              	<span id="code541">INR	B	</span><span class="cmt">;count them.</span></pre>
<pre id="l542"><span class="adr">DF09</span>	0D              <span class="l" id="label542">GETEXT9</span>	<span id="code542">DCR	C</span></pre>
<pre id="l543"><span class="adr">DF0A</span>	C2 01 DF        	<span id="code543">JNZ	GETEXT8</span></pre>
<pre id="l544"><span class="adr">DF0D</span>	78              	<span id="code544">MOV	A,B</span></pre>
<pre id="l545"><span class="adr">DF0E</span>	B7              	<span id="code545">ORA	A</span></pre>
<pre id="l546"><span class="adr">DF0F</span>	C9              	<span id="code546">RET</span></pre>
<pre id="l547"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l548"><span class="adr"></span>	                <span class="cmt">;   CP/M command table. Note commands can be either 3 or 4 characters long.</span></pre>
<pre id="l549"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l550"><span class="adr"></span>	                <span class="l" id="label550">NUMCMDS</span>	<span id="code550">EQU	6	</span><span class="cmt">;number of commands</span></pre>
<pre id="l551"><span class="adr">DF10</span>	44 49 52 20     <span class="l" id="label551">CMDTBL</span>	<span id="code551">DB	'DIR '</span></pre>
<pre id="l552"><span class="adr">DF14</span>	45 52 41 20     	<span id="code552">DB	'ERA '</span></pre>
<pre id="l553"><span class="adr">DF18</span>	54 59 50 45     	<span id="code553">DB	'TYPE'</span></pre>
<pre id="l554"><span class="adr">DF1C</span>	53 41 56 45     	<span id="code554">DB	'SAVE'</span></pre>
<pre id="l555"><span class="adr">DF20</span>	52 45 4E 20     	<span id="code555">DB	'REN '</span></pre>
<pre id="l556"><span class="adr">DF24</span>	55 53 45 52     	<span id="code556">DB	'USER'</span></pre>
<pre id="l557"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l558"><span class="adr"></span>	                <span class="cmt">;   The following six bytes must agree with those at (PATTRN2)</span></pre>
<pre id="l559"><span class="adr"></span>	                <span class="cmt">; or cp/m will HALT. Why?</span></pre>
<pre id="l560"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l561"><span class="adr">DF28</span>	00 16 00 00     <span class="l" id="label561">PATTRN1</span>	<span id="code561">DB	0,22,0,0,0,0</span><span class="cmt">;(* serial number bytes *).</span><br/>	.&nbsp;.&nbsp;.&nbsp;<br/>DF2C	00 00 <br/></pre>
<pre id="l562"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l563"><span class="adr"></span>	                <span class="cmt">;   Search the command table for a match with what has just</span></pre>
<pre id="l564"><span class="adr"></span>	                <span class="cmt">; been entered. If a match is found, then we jump to the</span></pre>
<pre id="l565"><span class="adr"></span>	                <span class="cmt">; proper section. Else jump to (UNKNOWN).</span></pre>
<pre id="l566"><span class="adr"></span>	                <span class="cmt">; On return, the (C) register is set to the command number</span></pre>
<pre id="l567"><span class="adr"></span>	                <span class="cmt">; that matched (or NUMCMDS+1 if no match).</span></pre>
<pre id="l568"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l569"><span class="adr">DF2E</span>	21 10 DF        <span class="l" id="label569">SEARCH</span>	<span id="code569">LXI	H,CMDTBL</span></pre>
<pre id="l570"><span class="adr">DF31</span>	0E 00           	<span id="code570">MVI	C,0</span></pre>
<pre id="l571"><span class="adr">DF33</span>	79              <span class="l" id="label571">SEARCH1</span>	<span id="code571">MOV	A,C</span></pre>
<pre id="l572"><span class="adr">DF34</span>	FE 06           	<span id="code572">CPI	NUMCMDS	</span><span class="cmt">;this commands exists.</span></pre>
<pre id="l573"><span class="adr">DF36</span>	D0              	<span id="code573">RNC</span></pre>
<pre id="l574"><span class="adr">DF37</span>	11 CE E3        	<span id="code574">LXI	D,FCB+1	</span><span class="cmt">;check this one.</span></pre>
<pre id="l575"><span class="adr">DF3A</span>	06 04           	<span id="code575">MVI	B,4	</span><span class="cmt">;max command length.</span></pre>
<pre id="l576"><span class="adr">DF3C</span>	1A              <span class="l" id="label576">SEARCH2</span>	<span id="code576">LDAX	D</span></pre>
<pre id="l577"><span class="adr">DF3D</span>	BE              	<span id="code577">CMP	M</span></pre>
<pre id="l578"><span class="adr">DF3E</span>	C2 4F DF        	<span id="code578">JNZ	SEARCH3	</span><span class="cmt">;not a match.</span></pre>
<pre id="l579"><span class="adr">DF41</span>	13              	<span id="code579">INX	D</span></pre>
<pre id="l580"><span class="adr">DF42</span>	23              	<span id="code580">INX	H</span></pre>
<pre id="l581"><span class="adr">DF43</span>	05              	<span id="code581">DCR	B</span></pre>
<pre id="l582"><span class="adr">DF44</span>	C2 3C DF        	<span id="code582">JNZ	SEARCH2</span></pre>
<pre id="l583"><span class="adr">DF47</span>	1A              	<span id="code583">LDAX	D	</span><span class="cmt">;allow a 3 character command to match.</span></pre>
<pre id="l584"><span class="adr">DF48</span>	FE 20           	<span id="code584">CPI	' '</span></pre>
<pre id="l585"><span class="adr">DF4A</span>	C2 54 DF        	<span id="code585">JNZ	SEARCH4</span></pre>
<pre id="l586"><span class="adr">DF4D</span>	79              	<span id="code586">MOV	A,C	</span><span class="cmt">;set return register for this command.</span></pre>
<pre id="l587"><span class="adr">DF4E</span>	C9              	<span id="code587">RET</span></pre>
<pre id="l588"><span class="adr">DF4F</span>	23              <span class="l" id="label588">SEARCH3</span>	<span id="code588">INX	H</span></pre>
<pre id="l589"><span class="adr">DF50</span>	05              	<span id="code589">DCR	B</span></pre>
<pre id="l590"><span class="adr">DF51</span>	C2 4F DF        	<span id="code590">JNZ	SEARCH3</span></pre>
<pre id="l591"><span class="adr">DF54</span>	0C              <span class="l" id="label591">SEARCH4</span>	<span id="code591">INR	C</span></pre>
<pre id="l592"><span class="adr">DF55</span>	C3 33 DF        	<span id="code592">JMP	SEARCH1</span></pre>
<pre id="l593"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l594"><span class="adr"></span>	                <span class="cmt">;   Set the input buffer to empty and then start the command</span></pre>
<pre id="l595"><span class="adr"></span>	                <span class="cmt">; processor (ccp).</span></pre>
<pre id="l596"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l597"><span class="adr">DF58</span>	AF              <span class="l" id="label597">CLEARBUF</span><span id="code597">:XRA	A</span></pre>
<pre id="l598"><span class="adr">DF59</span>	32 07 DC        	<span id="code598">STA	INBUFF+1</span><span class="cmt">;second byte is actual length.</span></pre>
<pre id="l599"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l600"><span class="adr"></span>	                <span class="cmt">;**************************************************************</span></pre>
<pre id="l601"><span class="adr"></span>	                <span class="cmt">;*</span></pre>
<pre id="l602"><span class="adr"></span>	                <span class="cmt">;*</span></pre>
<pre id="l603"><span class="adr"></span>	                <span class="cmt">;* C C P  -   C o n s o l e   C o m m a n d   P r o c e s s o r</span></pre>
<pre id="l604"><span class="adr"></span>	                <span class="cmt">;*</span></pre>
<pre id="l605"><span class="adr"></span>	                <span class="cmt">;**************************************************************</span></pre>
<pre id="l606"><span class="adr"></span>	                <span class="cmt">;*</span></pre>
<pre id="l607"><span class="adr">DF5C</span>	31 AB E3        <span class="l" id="label607">COMMAND</span>	<span id="code607">LXI	SP,CCPSTACK</span><span class="cmt">;setup stack area.</span></pre>
<pre id="l608"><span class="adr">DF5F</span>	C5              	<span id="code608">PUSH	B	</span><span class="cmt">;note that (C) should be equal to:</span></pre>
<pre id="l609"><span class="adr">DF60</span>	79              	<span id="code609">MOV	A,C	</span><span class="cmt">;(uuuudddd) where 'uuuu' is the user number</span></pre>
<pre id="l610"><span class="adr">DF61</span>	1F              	<span id="code610">RAR		</span><span class="cmt">;and 'dddd' is the drive number.</span></pre>
<pre id="l611"><span class="adr">DF62</span>	1F              	<span id="code611">RAR</span></pre>
<pre id="l612"><span class="adr">DF63</span>	1F              	<span id="code612">RAR</span></pre>
<pre id="l613"><span class="adr">DF64</span>	1F              	<span id="code613">RAR</span></pre>
<pre id="l614"><span class="adr">DF65</span>	E6 0F           	<span id="code614">ANI	0FH	</span><span class="cmt">;isolate the user number.</span></pre>
<pre id="l615"><span class="adr">DF67</span>	5F              	<span id="code615">MOV	E,A</span></pre>
<pre id="l616"><span class="adr">DF68</span>	CD 15 DD        	<span id="code616">CALL	GETSETUC</span><span class="cmt">;and set it.</span></pre>
<pre id="l617"><span class="adr">DF6B</span>	CD B8 DC        	<span id="code617">CALL	RESDSK	</span><span class="cmt">;reset the disk system.</span></pre>
<pre id="l618"><span class="adr">DF6E</span>	32 AB E3        	<span id="code618">STA	BATCH	</span><span class="cmt">;clear batch mode flag.</span></pre>
<pre id="l619"><span class="adr">DF71</span>	C1              	<span id="code619">POP	B</span></pre>
<pre id="l620"><span class="adr">DF72</span>	79              	<span id="code620">MOV	A,C</span></pre>
<pre id="l621"><span class="adr">DF73</span>	E6 0F           	<span id="code621">ANI	0FH	</span><span class="cmt">;isolate the drive number.</span></pre>
<pre id="l622"><span class="adr">DF75</span>	32 EF E3        	<span id="code622">STA	CDRIVE	</span><span class="cmt">;and save.</span></pre>
<pre id="l623"><span class="adr">DF78</span>	CD BD DC        	<span id="code623">CALL	DSKSEL	</span><span class="cmt">;...and select.</span></pre>
<pre id="l624"><span class="adr">DF7B</span>	3A 07 DC        	<span id="code624">LDA	INBUFF+1</span></pre>
<pre id="l625"><span class="adr">DF7E</span>	B7              	<span id="code625">ORA	A	</span><span class="cmt">;anything in input buffer already?</span></pre>
<pre id="l626"><span class="adr">DF7F</span>	C2 98 DF        	<span id="code626">JNZ	CMMND2	</span><span class="cmt">;yes, we just process it.</span></pre>
<pre id="l627"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l628"><span class="adr"></span>	                <span class="cmt">;   Entry point to get a command line from the console.</span></pre>
<pre id="l629"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l630"><span class="adr">DF82</span>	31 AB E3        <span class="l" id="label630">CMMND1</span>	<span id="code630">LXI	SP,CCPSTACK</span><span class="cmt">;set stack straight.</span></pre>
<pre id="l631"><span class="adr">DF85</span>	CD 98 DC        	<span id="code631">CALL	CRLF	</span><span class="cmt">;start a new line on the screen.</span></pre>
<pre id="l632"><span class="adr">DF88</span>	CD D0 DD        	<span id="code632">CALL	GETDSK	</span><span class="cmt">;get current drive.</span></pre>
<pre id="l633"><span class="adr">DF8B</span>	C6 61           	<span id="code633">ADI	'a'</span></pre>
<pre id="l634"><span class="adr">DF8D</span>	CD 8C DC        	<span id="code634">CALL	PRINT	</span><span class="cmt">;print current drive.</span></pre>
<pre id="l635"><span class="adr">DF90</span>	3E 3E           	<span id="code635">MVI	A,'>'</span></pre>
<pre id="l636"><span class="adr">DF92</span>	CD 8C DC        	<span id="code636">CALL	PRINT	</span><span class="cmt">;and add prompt.</span></pre>
<pre id="l637"><span class="adr">DF95</span>	CD 39 DD        	<span id="code637">CALL	GETINP	</span><span class="cmt">;get line from user.</span></pre>
<pre id="l638"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l639"><span class="adr"></span>	                <span class="cmt">;   Process command line here.</span></pre>
<pre id="l640"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l641"><span class="adr">DF98</span>	11 80 00        <span class="l" id="label641">CMMND2</span>	<span id="code641">LXI	D,TBUFF</span></pre>
<pre id="l642"><span class="adr">DF9B</span>	CD D8 DD        	<span id="code642">CALL	DMASET	</span><span class="cmt">;set standard dma address.</span></pre>
<pre id="l643"><span class="adr">DF9E</span>	CD D0 DD        	<span id="code643">CALL	GETDSK</span></pre>
<pre id="l644"><span class="adr">DFA1</span>	32 EF E3        	<span id="code644">STA	CDRIVE	</span><span class="cmt">;set current drive.</span></pre>
<pre id="l645"><span class="adr">DFA4</span>	CD 5E DE        	<span id="code645">CALL	CONVFST	</span><span class="cmt">;convert name typed in.</span></pre>
<pre id="l646"><span class="adr">DFA7</span>	C4 09 DE        	<span id="code646">CNZ	SYNERR	</span><span class="cmt">;wild cards are not allowed.</span></pre>
<pre id="l647"><span class="adr">DFAA</span>	3A F0 E3        	<span id="code647">LDA	CHGDRV	</span><span class="cmt">;if a change in drives was indicated,</span></pre>
<pre id="l648"><span class="adr">DFAD</span>	B7              	<span id="code648">ORA	A	</span><span class="cmt">;then treat this as an unknown command</span></pre>
<pre id="l649"><span class="adr">DFAE</span>	C2 A5 E2        	<span id="code649">JNZ	UNKNOWN	</span><span class="cmt">;which gets executed.</span></pre>
<pre id="l650"><span class="adr">DFB1</span>	CD 2E DF        	<span id="code650">CALL	SEARCH	</span><span class="cmt">;else search command table for a match.</span></pre>
<pre id="l651"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l652"><span class="adr"></span>	                <span class="cmt">;   Note that an unknown command returns</span></pre>
<pre id="l653"><span class="adr"></span>	                <span class="cmt">; with (A) pointing to the last address</span></pre>
<pre id="l654"><span class="adr"></span>	                <span class="cmt">; in our table which is (UNKNOWN).</span></pre>
<pre id="l655"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l656"><span class="adr">DFB4</span>	21 C1 DF        	<span id="code656">LXI	H,CMDADR</span><span class="cmt">;now, look thru our address table for command (A).</span></pre>
<pre id="l657"><span class="adr">DFB7</span>	5F              	<span id="code657">MOV	E,A	</span><span class="cmt">;set (DE) to command number.</span></pre>
<pre id="l658"><span class="adr">DFB8</span>	16 00           	<span id="code658">MVI	D,0</span></pre>
<pre id="l659"><span class="adr">DFBA</span>	19              	<span id="code659">DAD	D</span></pre>
<pre id="l660"><span class="adr">DFBB</span>	19              	<span id="code660">DAD	D	</span><span class="cmt">;(HL)=(CMDADR)+2*(command number).</span></pre>
<pre id="l661"><span class="adr">DFBC</span>	7E              	<span id="code661">MOV	A,M	</span><span class="cmt">;now pick out this address.</span></pre>
<pre id="l662"><span class="adr">DFBD</span>	23              	<span id="code662">INX	H</span></pre>
<pre id="l663"><span class="adr">DFBE</span>	66              	<span id="code663">MOV	H,M</span></pre>
<pre id="l664"><span class="adr">DFBF</span>	6F              	<span id="code664">MOV	L,A</span></pre>
<pre id="l665"><span class="adr">DFC0</span>	E9              	<span id="code665">PCHL		</span><span class="cmt">;now execute it.</span></pre>
<pre id="l666"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l667"><span class="adr"></span>	                <span class="cmt">;   CP/M command address table.</span></pre>
<pre id="l668"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l669"><span class="adr">DFC1</span>	77 E0 1F E1     <span class="l" id="label669">CMDADR</span>	<span id="code669">DW	DIRECT,ERASE,TYPE,SAVE</span><br/>	.&nbsp;.&nbsp;.&nbsp;<br/>DFC5	5D E1 AD E1 <br/></pre>
<pre id="l670"><span class="adr">DFC9</span>	10 E2 8E E2     	<span id="code670">DW	RENAME,USER,UNKNOWN</span><br/>	.&nbsp;.&nbsp;.&nbsp;<br/>DFCD	A5 E2 <br/></pre>
<pre id="l671"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l672"><span class="adr"></span>	                <span class="cmt">;   Halt the system. Reason for this is unknown at present.</span></pre>
<pre id="l673"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l674"><span class="adr">DFCF</span>	21 F3 76        <span class="l" id="label674">HALT</span>	<span id="code674">LXI	H,76F3H	</span><span class="cmt">;'DI HLT' instructions.</span></pre>
<pre id="l675"><span class="adr">DFD2</span>	22 00 DC        	<span id="code675">SHLD	CBASE</span></pre>
<pre id="l676"><span class="adr">DFD5</span>	21 00 DC        	<span id="code676">LXI	H,CBASE</span></pre>
<pre id="l677"><span class="adr">DFD8</span>	E9              	<span id="code677">PCHL</span></pre>
<pre id="l678"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l679"><span class="adr"></span>	                <span class="cmt">;   Read error while TYPEing a file.</span></pre>
<pre id="l680"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l681"><span class="adr">DFD9</span>	01 DF DF        <span class="l" id="label681">RDERROR</span>	<span id="code681">LXI	B,RDERR</span></pre>
<pre id="l682"><span class="adr">DFDC</span>	C3 A7 DC        	<span id="code682">JMP	PLINE</span></pre>
<pre id="l683"><span class="adr">DFDF</span>	52 65 61 64     <span class="l" id="label683">RDERR</span>	<span id="code683">DB	'Read error',0</span><br/>	.&nbsp;.&nbsp;.&nbsp;<br/>DFE7	6F 72 00 <br/></pre>
<pre id="l684"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l685"><span class="adr"></span>	                <span class="cmt">;   Required file was not located.</span></pre>
<pre id="l686"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l687"><span class="adr">DFEA</span>	01 F0 DF        <span class="l" id="label687">NONE</span>	<span id="code687">LXI	B,NOFILE</span></pre>
<pre id="l688"><span class="adr">DFED</span>	C3 A7 DC        	<span id="code688">JMP	PLINE</span></pre>
<pre id="l689"><span class="adr">DFF0</span>	4E 6F 20 66     <span class="l" id="label689">NOFILE</span>	<span id="code689">DB	'No file',0</span><br/>	.&nbsp;.&nbsp;.&nbsp;<br/>DFF4	69 6C 65 00 <br/></pre>
<pre id="l690"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l691"><span class="adr"></span>	                <span class="cmt">;   Decode a command of the form 'A>filename number{ filename}.</span></pre>
<pre id="l692"><span class="adr"></span>	                <span class="cmt">; Note that a drive specifier is not allowed on the first file</span></pre>
<pre id="l693"><span class="adr"></span>	                <span class="cmt">; name. On return, the number is in register (A). Any error</span></pre>
<pre id="l694"><span class="adr"></span>	                <span class="cmt">; causes 'filename?' to be printed and the command is aborted.</span></pre>
<pre id="l695"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l696"><span class="adr">DFF8</span>	CD 5E DE        <span class="l" id="label696">DECODE</span>	<span id="code696">CALL	CONVFST	</span><span class="cmt">;convert filename.</span></pre>
<pre id="l697"><span class="adr">DFFB</span>	3A F0 E3        	<span id="code697">LDA	CHGDRV	</span><span class="cmt">;do not allow a drive to be specified.</span></pre>
<pre id="l698"><span class="adr">DFFE</span>	B7              	<span id="code698">ORA	A</span></pre>
<pre id="l699"><span class="adr">DFFF</span>	C2 09 DE        	<span id="code699">JNZ	SYNERR</span></pre>
<pre id="l700"><span class="adr">E002</span>	21 CE E3        	<span id="code700">LXI	H,FCB+1	</span><span class="cmt">;convert number now.</span></pre>
<pre id="l701"><span class="adr">E005</span>	01 0B 00        	<span id="code701">LXI	B,11	</span><span class="cmt">;(B)=sum register, (C)=max digit count.</span></pre>
<pre id="l702"><span class="adr">E008</span>	7E              <span class="l" id="label702">DECODE1</span>	<span id="code702">MOV	A,M</span></pre>
<pre id="l703"><span class="adr">E009</span>	FE 20           	<span id="code703">CPI	' '	</span><span class="cmt">;a space terminates the numeral.</span></pre>
<pre id="l704"><span class="adr">E00B</span>	CA 33 E0        	<span id="code704">JZ	DECODE3</span></pre>
<pre id="l705"><span class="adr">E00E</span>	23              	<span id="code705">INX	H</span></pre>
<pre id="l706"><span class="adr">E00F</span>	D6 30           	<span id="code706">SUI	'0'	</span><span class="cmt">;make binary from ascii.</span></pre>
<pre id="l707"><span class="adr">E011</span>	FE 0A           	<span id="code707">CPI	10	</span><span class="cmt">;legal digit?</span></pre>
<pre id="l708"><span class="adr">E013</span>	D2 09 DE        	<span id="code708">JNC	SYNERR</span></pre>
<pre id="l709"><span class="adr">E016</span>	57              	<span id="code709">MOV	D,A	</span><span class="cmt">;yes, save it in (D).</span></pre>
<pre id="l710"><span class="adr">E017</span>	78              	<span id="code710">MOV	A,B	</span><span class="cmt">;compute (B)=(B)*10 and check for overflow.</span></pre>
<pre id="l711"><span class="adr">E018</span>	E6 E0           	<span id="code711">ANI	0E0H</span></pre>
<pre id="l712"><span class="adr">E01A</span>	C2 09 DE        	<span id="code712">JNZ	SYNERR</span></pre>
<pre id="l713"><span class="adr">E01D</span>	78              	<span id="code713">MOV	A,B</span></pre>
<pre id="l714"><span class="adr">E01E</span>	07              	<span id="code714">RLC</span></pre>
<pre id="l715"><span class="adr">E01F</span>	07              	<span id="code715">RLC</span></pre>
<pre id="l716"><span class="adr">E020</span>	07              	<span id="code716">RLC	</span><span class="cmt">;(A)=(B)*8</span></pre>
<pre id="l717"><span class="adr">E021</span>	80              	<span id="code717">ADD	B	</span><span class="cmt">;.......*9</span></pre>
<pre id="l718"><span class="adr">E022</span>	DA 09 DE        	<span id="code718">JC	SYNERR</span></pre>
<pre id="l719"><span class="adr">E025</span>	80              	<span id="code719">ADD	B	</span><span class="cmt">;.......*10</span></pre>
<pre id="l720"><span class="adr">E026</span>	DA 09 DE        	<span id="code720">JC	SYNERR</span></pre>
<pre id="l721"><span class="adr">E029</span>	82              	<span id="code721">ADD	D	</span><span class="cmt">;add in new digit now.</span></pre>
<pre id="l722"><span class="adr">E02A</span>	DA 09 DE        <span class="l" id="label722">DECODE2</span>	<span id="code722">JC	SYNERR</span></pre>
<pre id="l723"><span class="adr">E02D</span>	47              	<span id="code723">MOV	B,A	</span><span class="cmt">;and save result.</span></pre>
<pre id="l724"><span class="adr">E02E</span>	0D              	<span id="code724">DCR	C	</span><span class="cmt">;only look at 11 digits.</span></pre>
<pre id="l725"><span class="adr">E02F</span>	C2 08 E0        	<span id="code725">JNZ	DECODE1</span></pre>
<pre id="l726"><span class="adr">E032</span>	C9              	<span id="code726">RET</span></pre>
<pre id="l727"><span class="adr">E033</span>	7E              <span class="l" id="label727">DECODE3</span>	<span id="code727">MOV	A,M	</span><span class="cmt">;spaces must follow (why?).</span></pre>
<pre id="l728"><span class="adr">E034</span>	FE 20           	<span id="code728">CPI	' '</span></pre>
<pre id="l729"><span class="adr">E036</span>	C2 09 DE        	<span id="code729">JNZ	SYNERR</span></pre>
<pre id="l730"><span class="adr">E039</span>	23              	<span id="code730">INX	H</span></pre>
<pre id="l731"><span class="adr">E03A</span>	0D              <span class="l" id="label731">DECODE4</span>	<span id="code731">DCR	C</span></pre>
<pre id="l732"><span class="adr">E03B</span>	C2 33 E0        	<span id="code732">JNZ	DECODE3</span></pre>
<pre id="l733"><span class="adr">E03E</span>	78              	<span id="code733">MOV	A,B	</span><span class="cmt">;set (A)=the numeric value entered.</span></pre>
<pre id="l734"><span class="adr">E03F</span>	C9              	<span id="code734">RET</span></pre>
<pre id="l735"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l736"><span class="adr"></span>	                <span class="cmt">;   Move 3 bytes from (HL) to (DE). Note that there is only</span></pre>
<pre id="l737"><span class="adr"></span>	                <span class="cmt">; one reference to this at (A2D5h).</span></pre>
<pre id="l738"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l739"><span class="adr">E040</span>	06 03           <span class="l" id="label739">MOVE3</span>	<span id="code739">MVI	B,3</span></pre>
<pre id="l740"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l741"><span class="adr"></span>	                <span class="cmt">;   Move (B) bytes from (HL) to (DE).</span></pre>
<pre id="l742"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l743"><span class="adr">E042</span>	7E              <span class="l" id="label743">HL2DE</span>	<span id="code743">MOV	A,M</span></pre>
<pre id="l744"><span class="adr">E043</span>	12              	<span id="code744">STAX	D</span></pre>
<pre id="l745"><span class="adr">E044</span>	23              	<span id="code745">INX	H</span></pre>
<pre id="l746"><span class="adr">E045</span>	13              	<span id="code746">INX	D</span></pre>
<pre id="l747"><span class="adr">E046</span>	05              	<span id="code747">DCR	B</span></pre>
<pre id="l748"><span class="adr">E047</span>	C2 42 E0        	<span id="code748">JNZ	HL2DE</span></pre>
<pre id="l749"><span class="adr">E04A</span>	C9              	<span id="code749">RET</span></pre>
<pre id="l750"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l751"><span class="adr"></span>	                <span class="cmt">;   Compute (HL)=(TBUFF)+(A)+(C) and get the byte that's here.</span></pre>
<pre id="l752"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l753"><span class="adr">E04B</span>	21 80 00        <span class="l" id="label753">EXTRACT</span>	<span id="code753">LXI	H,TBUFF</span></pre>
<pre id="l754"><span class="adr">E04E</span>	81              	<span id="code754">ADD	C</span></pre>
<pre id="l755"><span class="adr">E04F</span>	CD 59 DE        	<span id="code755">CALL	ADDHL</span></pre>
<pre id="l756"><span class="adr">E052</span>	7E              	<span id="code756">MOV	A,M</span></pre>
<pre id="l757"><span class="adr">E053</span>	C9              	<span id="code757">RET</span></pre>
<pre id="l758"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l759"><span class="adr"></span>	                <span class="cmt">;  Check drive specified. If it means a change, then the new</span></pre>
<pre id="l760"><span class="adr"></span>	                <span class="cmt">; drive will be selected. In any case, the drive byte of the</span></pre>
<pre id="l761"><span class="adr"></span>	                <span class="cmt">; fcb will be set to null (means use current drive).</span></pre>
<pre id="l762"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l763"><span class="adr">E054</span>	AF              <span class="l" id="label763">DSELECT</span>	<span id="code763">XRA	A	</span><span class="cmt">;null out first byte of fcb.</span></pre>
<pre id="l764"><span class="adr">E055</span>	32 CD E3        	<span id="code764">STA	FCB</span></pre>
<pre id="l765"><span class="adr">E058</span>	3A F0 E3        	<span id="code765">LDA	CHGDRV	</span><span class="cmt">;a drive change indicated?</span></pre>
<pre id="l766"><span class="adr">E05B</span>	B7              	<span id="code766">ORA	A</span></pre>
<pre id="l767"><span class="adr">E05C</span>	C8              	<span id="code767">RZ</span></pre>
<pre id="l768"><span class="adr">E05D</span>	3D              	<span id="code768">DCR	A	</span><span class="cmt">;yes, is it the same as the current drive?</span></pre>
<pre id="l769"><span class="adr">E05E</span>	21 EF E3        	<span id="code769">LXI	H,CDRIVE</span></pre>
<pre id="l770"><span class="adr">E061</span>	BE              	<span id="code770">CMP	M</span></pre>
<pre id="l771"><span class="adr">E062</span>	C8              	<span id="code771">RZ</span></pre>
<pre id="l772"><span class="adr">E063</span>	C3 BD DC        	<span id="code772">JMP	DSKSEL	</span><span class="cmt">;no. Select it then.</span></pre>
<pre id="l773"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l774"><span class="adr"></span>	                <span class="cmt">;   Check the drive selection and reset it to the previous</span></pre>
<pre id="l775"><span class="adr"></span>	                <span class="cmt">; drive if it was changed for the preceeding command.</span></pre>
<pre id="l776"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l777"><span class="adr">E066</span>	3A F0 E3        <span class="l" id="label777">RESETDR</span>	<span id="code777">LDA	CHGDRV	</span><span class="cmt">;drive change indicated?</span></pre>
<pre id="l778"><span class="adr">E069</span>	B7              	<span id="code778">ORA	A</span></pre>
<pre id="l779"><span class="adr">E06A</span>	C8              	<span id="code779">RZ</span></pre>
<pre id="l780"><span class="adr">E06B</span>	3D              	<span id="code780">DCR	A	</span><span class="cmt">;yes, was it a different drive?</span></pre>
<pre id="l781"><span class="adr">E06C</span>	21 EF E3        	<span id="code781">LXI	H,CDRIVE</span></pre>
<pre id="l782"><span class="adr">E06F</span>	BE              	<span id="code782">CMP	M</span></pre>
<pre id="l783"><span class="adr">E070</span>	C8              	<span id="code783">RZ</span></pre>
<pre id="l784"><span class="adr">E071</span>	3A EF E3        	<span id="code784">LDA	CDRIVE	</span><span class="cmt">;yes, re-select our old drive.</span></pre>
<pre id="l785"><span class="adr">E074</span>	C3 BD DC        	<span id="code785">JMP	DSKSEL</span></pre>
<pre id="l786"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l787"><span class="adr"></span>	                <span class="cmt">;**************************************************************</span></pre>
<pre id="l788"><span class="adr"></span>	                <span class="cmt">;*</span></pre>
<pre id="l789"><span class="adr"></span>	                <span class="cmt">;*           D I R E C T O R Y   C O M M A N D</span></pre>
<pre id="l790"><span class="adr"></span>	                <span class="cmt">;*</span></pre>
<pre id="l791"><span class="adr"></span>	                <span class="cmt">;**************************************************************</span></pre>
<pre id="l792"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l793"><span class="adr">E077</span>	CD 5E DE        <span class="l" id="label793">DIRECT</span>	<span id="code793">CALL	CONVFST	</span><span class="cmt">;convert file name.</span></pre>
<pre id="l794"><span class="adr">E07A</span>	CD 54 E0        	<span id="code794">CALL	DSELECT	</span><span class="cmt">;select indicated drive.</span></pre>
<pre id="l795"><span class="adr">E07D</span>	21 CE E3        	<span id="code795">LXI	H,FCB+1	</span><span class="cmt">;was any file indicated?</span></pre>
<pre id="l796"><span class="adr">E080</span>	7E              	<span id="code796">MOV	A,M</span></pre>
<pre id="l797"><span class="adr">E081</span>	FE 20           	<span id="code797">CPI	' '</span></pre>
<pre id="l798"><span class="adr">E083</span>	C2 8F E0        	<span id="code798">JNZ	DIRECT2</span></pre>
<pre id="l799"><span class="adr">E086</span>	06 0B           	<span id="code799">MVI	B,11	</span><span class="cmt">;no. Fill field with '?' - same as *.*.</span></pre>
<pre id="l800"><span class="adr">E088</span>	36 3F           <span class="l" id="label800">DIRECT1</span>	<span id="code800">MVI	M,'?'</span></pre>
<pre id="l801"><span class="adr">E08A</span>	23              	<span id="code801">INX	H</span></pre>
<pre id="l802"><span class="adr">E08B</span>	05              	<span id="code802">DCR	B</span></pre>
<pre id="l803"><span class="adr">E08C</span>	C2 88 E0        	<span id="code803">JNZ	DIRECT1</span></pre>
<pre id="l804"><span class="adr">E08F</span>	1E 00           <span class="l" id="label804">DIRECT2</span>	<span id="code804">MVI	E,0	</span><span class="cmt">;set initial cursor position.</span></pre>
<pre id="l805"><span class="adr">E091</span>	D5              	<span id="code805">PUSH	D</span></pre>
<pre id="l806"><span class="adr">E092</span>	CD E9 DC        	<span id="code806">CALL	SRCHFCB	</span><span class="cmt">;get first file name.</span></pre>
<pre id="l807"><span class="adr">E095</span>	CC EA DF        	<span id="code807">CZ	NONE	</span><span class="cmt">;none found at all?</span></pre>
<pre id="l808"><span class="adr">E098</span>	CA 1B E1        <span class="l" id="label808">DIRECT3</span>	<span id="code808">JZ	DIRECT9	</span><span class="cmt">;terminate if no more names.</span></pre>
<pre id="l809"><span class="adr">E09B</span>	3A EE E3        	<span id="code809">LDA	RTNCODE	</span><span class="cmt">;get file's position in segment (0-3).</span></pre>
<pre id="l810"><span class="adr">E09E</span>	0F              	<span id="code810">RRC</span></pre>
<pre id="l811"><span class="adr">E09F</span>	0F              	<span id="code811">RRC</span></pre>
<pre id="l812"><span class="adr">E0A0</span>	0F              	<span id="code812">RRC</span></pre>
<pre id="l813"><span class="adr">E0A1</span>	E6 60           	<span id="code813">ANI	60H	</span><span class="cmt">;(A)=position*32</span></pre>
<pre id="l814"><span class="adr">E0A3</span>	4F              	<span id="code814">MOV	C,A</span></pre>
<pre id="l815"><span class="adr">E0A4</span>	3E 0A           	<span id="code815">MVI	A,10</span></pre>
<pre id="l816"><span class="adr">E0A6</span>	CD 4B E0        	<span id="code816">CALL	EXTRACT	</span><span class="cmt">;extract the tenth entry in fcb.</span></pre>
<pre id="l817"><span class="adr">E0A9</span>	17              	<span id="code817">RAL		</span><span class="cmt">;check system file status bit.</span></pre>
<pre id="l818"><span class="adr">E0AA</span>	DA 0F E1        	<span id="code818">JC	DIRECT8	</span><span class="cmt">;we don't list them.</span></pre>
<pre id="l819"><span class="adr">E0AD</span>	D1              	<span id="code819">POP	D</span></pre>
<pre id="l820"><span class="adr">E0AE</span>	7B              	<span id="code820">MOV	A,E	</span><span class="cmt">;bump name count.</span></pre>
<pre id="l821"><span class="adr">E0AF</span>	1C              	<span id="code821">INR	E</span></pre>
<pre id="l822"><span class="adr">E0B0</span>	D5              	<span id="code822">PUSH	D</span></pre>
<pre id="l823"><span class="adr">E0B1</span>	E6 03           	<span id="code823">ANI	03H	</span><span class="cmt">;at end of line?</span></pre>
<pre id="l824"><span class="adr">E0B3</span>	F5              	<span id="code824">PUSH	PSW</span></pre>
<pre id="l825"><span class="adr">E0B4</span>	C2 CC E0        	<span id="code825">JNZ	DIRECT4</span></pre>
<pre id="l826"><span class="adr">E0B7</span>	CD 98 DC        	<span id="code826">CALL	CRLF	</span><span class="cmt">;yes, end this line and start another.</span></pre>
<pre id="l827"><span class="adr">E0BA</span>	C5              	<span id="code827">PUSH	B</span></pre>
<pre id="l828"><span class="adr">E0BB</span>	CD D0 DD        	<span id="code828">CALL	GETDSK	</span><span class="cmt">;start line with ('A:').</span></pre>
<pre id="l829"><span class="adr">E0BE</span>	C1              	<span id="code829">POP	B</span></pre>
<pre id="l830"><span class="adr">E0BF</span>	C6 41           	<span id="code830">ADI	'A'</span></pre>
<pre id="l831"><span class="adr">E0C1</span>	CD 92 DC        	<span id="code831">CALL	PRINTB</span></pre>
<pre id="l832"><span class="adr">E0C4</span>	3E 3A           	<span id="code832">MVI	A,':'</span></pre>
<pre id="l833"><span class="adr">E0C6</span>	CD 92 DC        	<span id="code833">CALL	PRINTB</span></pre>
<pre id="l834"><span class="adr">E0C9</span>	C3 D4 E0        	<span id="code834">JMP	DIRECT5</span></pre>
<pre id="l835"><span class="adr">E0CC</span>	CD A2 DC        <span class="l" id="label835">DIRECT4</span>	<span id="code835">CALL	SPACE	</span><span class="cmt">;add seperator between file names.</span></pre>
<pre id="l836"><span class="adr">E0CF</span>	3E 3A           	<span id="code836">MVI	A,':'</span></pre>
<pre id="l837"><span class="adr">E0D1</span>	CD 92 DC        	<span id="code837">CALL	PRINTB</span></pre>
<pre id="l838"><span class="adr">E0D4</span>	CD A2 DC        <span class="l" id="label838">DIRECT5</span>	<span id="code838">CALL	SPACE</span></pre>
<pre id="l839"><span class="adr">E0D7</span>	06 01           	<span id="code839">MVI	B,1	</span><span class="cmt">;'extract' each file name character at a time.</span></pre>
<pre id="l840"><span class="adr">E0D9</span>	78              <span class="l" id="label840">DIRECT6</span>	<span id="code840">MOV	A,B</span></pre>
<pre id="l841"><span class="adr">E0DA</span>	CD 4B E0        	<span id="code841">CALL	EXTRACT</span></pre>
<pre id="l842"><span class="adr">E0DD</span>	E6 7F           	<span id="code842">ANI	7FH	</span><span class="cmt">;strip bit 7 (status bit).</span></pre>
<pre id="l843"><span class="adr">E0DF</span>	FE 20           	<span id="code843">CPI	' '	</span><span class="cmt">;are we at the end of the name?</span></pre>
<pre id="l844"><span class="adr">E0E1</span>	C2 F9 E0        	<span id="code844">JNZ	DRECT65</span></pre>
<pre id="l845"><span class="adr">E0E4</span>	F1              	<span id="code845">POP	PSW	</span><span class="cmt">;yes, don't print spaces at the end of a line.</span></pre>
<pre id="l846"><span class="adr">E0E5</span>	F5              	<span id="code846">PUSH	PSW</span></pre>
<pre id="l847"><span class="adr">E0E6</span>	FE 03           	<span id="code847">CPI	3</span></pre>
<pre id="l848"><span class="adr">E0E8</span>	C2 F7 E0        	<span id="code848">JNZ	DRECT63</span></pre>
<pre id="l849"><span class="adr">E0EB</span>	3E 09           	<span id="code849">MVI	A,9	</span><span class="cmt">;first check for no extension.</span></pre>
<pre id="l850"><span class="adr">E0ED</span>	CD 4B E0        	<span id="code850">CALL	EXTRACT</span></pre>
<pre id="l851"><span class="adr">E0F0</span>	E6 7F           	<span id="code851">ANI	7FH</span></pre>
<pre id="l852"><span class="adr">E0F2</span>	FE 20           	<span id="code852">CPI	' '</span></pre>
<pre id="l853"><span class="adr">E0F4</span>	CA 0E E1        	<span id="code853">JZ	DIRECT7	</span><span class="cmt">;don't print spaces.</span></pre>
<pre id="l854"><span class="adr">E0F7</span>	3E 20           <span class="l" id="label854">DRECT63</span>	<span id="code854">MVI	A,' '	</span><span class="cmt">;else print them.</span></pre>
<pre id="l855"><span class="adr">E0F9</span>	CD 92 DC        <span class="l" id="label855">DRECT65</span>	<span id="code855">CALL	PRINTB</span></pre>
<pre id="l856"><span class="adr">E0FC</span>	04              	<span id="code856">INR	B	</span><span class="cmt">;bump to next character psoition.</span></pre>
<pre id="l857"><span class="adr">E0FD</span>	78              	<span id="code857">MOV	A,B</span></pre>
<pre id="l858"><span class="adr">E0FE</span>	FE 0C           	<span id="code858">CPI	12	</span><span class="cmt">;end of the name?</span></pre>
<pre id="l859"><span class="adr">E100</span>	D2 0E E1        	<span id="code859">JNC	DIRECT7</span></pre>
<pre id="l860"><span class="adr">E103</span>	FE 09           	<span id="code860">CPI	9	</span><span class="cmt">;nope, starting extension?</span></pre>
<pre id="l861"><span class="adr">E105</span>	C2 D9 E0        	<span id="code861">JNZ	DIRECT6</span></pre>
<pre id="l862"><span class="adr">E108</span>	CD A2 DC        	<span id="code862">CALL	SPACE	</span><span class="cmt">;yes, add seperating space.</span></pre>
<pre id="l863"><span class="adr">E10B</span>	C3 D9 E0        	<span id="code863">JMP	DIRECT6</span></pre>
<pre id="l864"><span class="adr">E10E</span>	F1              <span class="l" id="label864">DIRECT7</span>	<span id="code864">POP	PSW	</span><span class="cmt">;get the next file name.</span></pre>
<pre id="l865"><span class="adr">E10F</span>	CD C2 DD        <span class="l" id="label865">DIRECT8</span>	<span id="code865">CALL	CHKCON	</span><span class="cmt">;first check console, quit on anything.</span></pre>
<pre id="l866"><span class="adr">E112</span>	C2 1B E1        	<span id="code866">JNZ	DIRECT9</span></pre>
<pre id="l867"><span class="adr">E115</span>	CD E4 DC        	<span id="code867">CALL	SRCHNXT	</span><span class="cmt">;get next name.</span></pre>
<pre id="l868"><span class="adr">E118</span>	C3 98 E0        	<span id="code868">JMP	DIRECT3	</span><span class="cmt">;and continue with our list.</span></pre>
<pre id="l869"><span class="adr">E11B</span>	D1              <span class="l" id="label869">DIRECT9</span>	<span id="code869">POP	D	</span><span class="cmt">;restore the stack and return to command level.</span></pre>
<pre id="l870"><span class="adr">E11C</span>	C3 86 E3        	<span id="code870">JMP	GETBACK</span></pre>
<pre id="l871"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l872"><span class="adr"></span>	                <span class="cmt">;**************************************************************</span></pre>
<pre id="l873"><span class="adr"></span>	                <span class="cmt">;*</span></pre>
<pre id="l874"><span class="adr"></span>	                <span class="cmt">;*                E R A S E   C O M M A N D</span></pre>
<pre id="l875"><span class="adr"></span>	                <span class="cmt">;*</span></pre>
<pre id="l876"><span class="adr"></span>	                <span class="cmt">;**************************************************************</span></pre>
<pre id="l877"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l878"><span class="adr">E11F</span>	CD 5E DE        <span class="l" id="label878">ERASE</span>	<span id="code878">CALL	CONVFST	</span><span class="cmt">;convert file name.</span></pre>
<pre id="l879"><span class="adr">E122</span>	FE 0B           	<span id="code879">CPI	11	</span><span class="cmt">;was '*.*' entered?</span></pre>
<pre id="l880"><span class="adr">E124</span>	C2 42 E1        	<span id="code880">JNZ	ERASE1</span></pre>
<pre id="l881"><span class="adr">E127</span>	01 52 E1        	<span id="code881">LXI	B,YESNO	</span><span class="cmt">;yes, ask for confirmation.</span></pre>
<pre id="l882"><span class="adr">E12A</span>	CD A7 DC        	<span id="code882">CALL	PLINE</span></pre>
<pre id="l883"><span class="adr">E12D</span>	CD 39 DD        	<span id="code883">CALL	GETINP</span></pre>
<pre id="l884"><span class="adr">E130</span>	21 07 DC        	<span id="code884">LXI	H,INBUFF+1</span></pre>
<pre id="l885"><span class="adr">E133</span>	35              	<span id="code885">DCR	M	</span><span class="cmt">;must be exactly 'y'.</span></pre>
<pre id="l886"><span class="adr">E134</span>	C2 82 DF        	<span id="code886">JNZ	CMMND1</span></pre>
<pre id="l887"><span class="adr">E137</span>	23              	<span id="code887">INX	H</span></pre>
<pre id="l888"><span class="adr">E138</span>	7E              	<span id="code888">MOV	A,M</span></pre>
<pre id="l889"><span class="adr">E139</span>	FE 59           	<span id="code889">CPI	'Y'</span></pre>
<pre id="l890"><span class="adr">E13B</span>	C2 82 DF        	<span id="code890">JNZ	CMMND1</span></pre>
<pre id="l891"><span class="adr">E13E</span>	23              	<span id="code891">INX	H</span></pre>
<pre id="l892"><span class="adr">E13F</span>	22 88 DC        	<span id="code892">SHLD	INPOINT	</span><span class="cmt">;save input line pointer.</span></pre>
<pre id="l893"><span class="adr">E142</span>	CD 54 E0        <span class="l" id="label893">ERASE1</span>	<span id="code893">CALL	DSELECT	</span><span class="cmt">;select desired disk.</span></pre>
<pre id="l894"><span class="adr">E145</span>	11 CD E3        	<span id="code894">LXI	D,FCB</span></pre>
<pre id="l895"><span class="adr">E148</span>	CD EF DC        	<span id="code895">CALL	DELETE	</span><span class="cmt">;delete the file.</span></pre>
<pre id="l896"><span class="adr">E14B</span>	3C              	<span id="code896">INR	A</span></pre>
<pre id="l897"><span class="adr">E14C</span>	CC EA DF        	<span id="code897">CZ	NONE	</span><span class="cmt">;not there?</span></pre>
<pre id="l898"><span class="adr">E14F</span>	C3 86 E3        	<span id="code898">JMP	GETBACK	</span><span class="cmt">;return to command level now.</span></pre>
<pre id="l899"><span class="adr">E152</span>	41 6C 6C 20     <span class="l" id="label899">YESNO</span>	<span id="code899">DB	'All (y/n)?',0</span><br/>	.&nbsp;.&nbsp;.&nbsp;<br/>E15A	29 3F 00 <br/></pre>
<pre id="l900"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l901"><span class="adr"></span>	                <span class="cmt">;**************************************************************</span></pre>
<pre id="l902"><span class="adr"></span>	                <span class="cmt">;*</span></pre>
<pre id="l903"><span class="adr"></span>	                <span class="cmt">;*            T Y P E   C O M M A N D</span></pre>
<pre id="l904"><span class="adr"></span>	                <span class="cmt">;*</span></pre>
<pre id="l905"><span class="adr"></span>	                <span class="cmt">;**************************************************************</span></pre>
<pre id="l906"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l907"><span class="adr">E15D</span>	CD 5E DE        <span class="l" id="label907">TYPE</span>	<span id="code907">CALL	CONVFST	</span><span class="cmt">;convert file name.</span></pre>
<pre id="l908"><span class="adr">E160</span>	C2 09 DE        	<span id="code908">JNZ	SYNERR	</span><span class="cmt">;wild cards not allowed.</span></pre>
<pre id="l909"><span class="adr">E163</span>	CD 54 E0        	<span id="code909">CALL	DSELECT	</span><span class="cmt">;select indicated drive.</span></pre>
<pre id="l910"><span class="adr">E166</span>	CD D0 DC        	<span id="code910">CALL	OPENFCB	</span><span class="cmt">;open the file.</span></pre>
<pre id="l911"><span class="adr">E169</span>	CA A7 E1        	<span id="code911">JZ	TYPE5	</span><span class="cmt">;not there?</span></pre>
<pre id="l912"><span class="adr">E16C</span>	CD 98 DC        	<span id="code912">CALL	CRLF	</span><span class="cmt">;ok, start a new line on the screen.</span></pre>
<pre id="l913"><span class="adr">E16F</span>	21 F1 E3        	<span id="code913">LXI	H,NBYTES</span><span class="cmt">;initialize byte counter.</span></pre>
<pre id="l914"><span class="adr">E172</span>	36 FF           	<span id="code914">MVI	M,0FFH	</span><span class="cmt">;set to read first sector.</span></pre>
<pre id="l915"><span class="adr">E174</span>	21 F1 E3        <span class="l" id="label915">TYPE1</span>	<span id="code915">LXI	H,NBYTES</span></pre>
<pre id="l916"><span class="adr">E177</span>	7E              <span class="l" id="label916">TYPE2</span>	<span id="code916">MOV	A,M	</span><span class="cmt">;have we written the entire sector?</span></pre>
<pre id="l917"><span class="adr">E178</span>	FE 80           	<span id="code917">CPI	128</span></pre>
<pre id="l918"><span class="adr">E17A</span>	DA 87 E1        	<span id="code918">JC	TYPE3</span></pre>
<pre id="l919"><span class="adr">E17D</span>	E5              	<span id="code919">PUSH	H	</span><span class="cmt">;yes, read in the next one.</span></pre>
<pre id="l920"><span class="adr">E17E</span>	CD FE DC        	<span id="code920">CALL	READFCB</span></pre>
<pre id="l921"><span class="adr">E181</span>	E1              	<span id="code921">POP	H</span></pre>
<pre id="l922"><span class="adr">E182</span>	C2 A0 E1        	<span id="code922">JNZ	TYPE4	</span><span class="cmt">;end or error?</span></pre>
<pre id="l923"><span class="adr">E185</span>	AF              	<span id="code923">XRA	A	</span><span class="cmt">;ok, clear byte counter.</span></pre>
<pre id="l924"><span class="adr">E186</span>	77              	<span id="code924">MOV	M,A</span></pre>
<pre id="l925"><span class="adr">E187</span>	34              <span class="l" id="label925">TYPE3</span>	<span id="code925">INR	M	</span><span class="cmt">;count this byte.</span></pre>
<pre id="l926"><span class="adr">E188</span>	21 80 00        	<span id="code926">LXI	H,TBUFF	</span><span class="cmt">;and get the (A)th one from the buffer (TBUFF).</span></pre>
<pre id="l927"><span class="adr">E18B</span>	CD 59 DE        	<span id="code927">CALL	ADDHL</span></pre>
<pre id="l928"><span class="adr">E18E</span>	7E              	<span id="code928">MOV	A,M</span></pre>
<pre id="l929"><span class="adr">E18F</span>	FE 1A           	<span id="code929">CPI	CNTRLZ	</span><span class="cmt">;end of file mark?</span></pre>
<pre id="l930"><span class="adr">E191</span>	CA 86 E3        	<span id="code930">JZ	GETBACK</span></pre>
<pre id="l931"><span class="adr">E194</span>	CD 8C DC        	<span id="code931">CALL	PRINT	</span><span class="cmt">;no, print it.</span></pre>
<pre id="l932"><span class="adr">E197</span>	CD C2 DD        	<span id="code932">CALL	CHKCON	</span><span class="cmt">;check console, quit if anything ready.</span></pre>
<pre id="l933"><span class="adr">E19A</span>	C2 86 E3        	<span id="code933">JNZ	GETBACK</span></pre>
<pre id="l934"><span class="adr">E19D</span>	C3 74 E1        	<span id="code934">JMP	TYPE1</span></pre>
<pre id="l935"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l936"><span class="adr"></span>	                <span class="cmt">;   Get here on an end of file or read error.</span></pre>
<pre id="l937"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l938"><span class="adr">E1A0</span>	3D              <span class="l" id="label938">TYPE4</span>	<span id="code938">DCR	A	</span><span class="cmt">;read error?</span></pre>
<pre id="l939"><span class="adr">E1A1</span>	CA 86 E3        	<span id="code939">JZ	GETBACK</span></pre>
<pre id="l940"><span class="adr">E1A4</span>	CD D9 DF        	<span id="code940">CALL	RDERROR	</span><span class="cmt">;yes, print message.</span></pre>
<pre id="l941"><span class="adr">E1A7</span>	CD 66 E0        <span class="l" id="label941">TYPE5</span>	<span id="code941">CALL	RESETDR	</span><span class="cmt">;and reset proper drive</span></pre>
<pre id="l942"><span class="adr">E1AA</span>	C3 09 DE        	<span id="code942">JMP	SYNERR	</span><span class="cmt">;now print file name with problem.</span></pre>
<pre id="l943"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l944"><span class="adr"></span>	                <span class="cmt">;**************************************************************</span></pre>
<pre id="l945"><span class="adr"></span>	                <span class="cmt">;*</span></pre>
<pre id="l946"><span class="adr"></span>	                <span class="cmt">;*            S A V E   C O M M A N D</span></pre>
<pre id="l947"><span class="adr"></span>	                <span class="cmt">;*</span></pre>
<pre id="l948"><span class="adr"></span>	                <span class="cmt">;**************************************************************</span></pre>
<pre id="l949"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l950"><span class="adr">E1AD</span>	CD F8 DF        <span class="l" id="label950">SAVE</span>	<span id="code950">CALL	DECODE	</span><span class="cmt">;get numeric number that follows SAVE.</span></pre>
<pre id="l951"><span class="adr">E1B0</span>	F5              	<span id="code951">PUSH	PSW	</span><span class="cmt">;save number of pages to write.</span></pre>
<pre id="l952"><span class="adr">E1B1</span>	CD 5E DE        	<span id="code952">CALL	CONVFST	</span><span class="cmt">;convert file name.</span></pre>
<pre id="l953"><span class="adr">E1B4</span>	C2 09 DE        	<span id="code953">JNZ	SYNERR	</span><span class="cmt">;wild cards not allowed.</span></pre>
<pre id="l954"><span class="adr">E1B7</span>	CD 54 E0        	<span id="code954">CALL	DSELECT	</span><span class="cmt">;select specified drive.</span></pre>
<pre id="l955"><span class="adr">E1BA</span>	11 CD E3        	<span id="code955">LXI	D,FCB	</span><span class="cmt">;now delete this file.</span></pre>
<pre id="l956"><span class="adr">E1BD</span>	D5              	<span id="code956">PUSH	D</span></pre>
<pre id="l957"><span class="adr">E1BE</span>	CD EF DC        	<span id="code957">CALL	DELETE</span></pre>
<pre id="l958"><span class="adr">E1C1</span>	D1              	<span id="code958">POP	D</span></pre>
<pre id="l959"><span class="adr">E1C2</span>	CD 09 DD        	<span id="code959">CALL	CREATE	</span><span class="cmt">;and create it again.</span></pre>
<pre id="l960"><span class="adr">E1C5</span>	CA FB E1        	<span id="code960">JZ	SAVE3	</span><span class="cmt">;can't create?</span></pre>
<pre id="l961"><span class="adr">E1C8</span>	AF              	<span id="code961">XRA	A	</span><span class="cmt">;clear record number byte.</span></pre>
<pre id="l962"><span class="adr">E1C9</span>	32 ED E3        	<span id="code962">STA	FCB+32</span></pre>
<pre id="l963"><span class="adr">E1CC</span>	F1              	<span id="code963">POP	PSW	</span><span class="cmt">;convert pages to sectors.</span></pre>
<pre id="l964"><span class="adr">E1CD</span>	6F              	<span id="code964">MOV	L,A</span></pre>
<pre id="l965"><span class="adr">E1CE</span>	26 00           	<span id="code965">MVI	H,0</span></pre>
<pre id="l966"><span class="adr">E1D0</span>	29              	<span id="code966">DAD	H	</span><span class="cmt">;(HL)=number of sectors to write.</span></pre>
<pre id="l967"><span class="adr">E1D1</span>	11 00 01        	<span id="code967">LXI	D,TBASE	</span><span class="cmt">;and we start from here.</span></pre>
<pre id="l968"><span class="adr">E1D4</span>	7C              <span class="l" id="label968">SAVE1</span>	<span id="code968">MOV	A,H	</span><span class="cmt">;done yet?</span></pre>
<pre id="l969"><span class="adr">E1D5</span>	B5              	<span id="code969">ORA	L</span></pre>
<pre id="l970"><span class="adr">E1D6</span>	CA F1 E1        	<span id="code970">JZ	SAVE2</span></pre>
<pre id="l971"><span class="adr">E1D9</span>	2B              	<span id="code971">DCX	H	</span><span class="cmt">;nope, count this and compute the start</span></pre>
<pre id="l972"><span class="adr">E1DA</span>	E5              	<span id="code972">PUSH	H	</span><span class="cmt">;of the next 128 byte sector.</span></pre>
<pre id="l973"><span class="adr">E1DB</span>	21 80 00        	<span id="code973">LXI	H,128</span></pre>
<pre id="l974"><span class="adr">E1DE</span>	19              	<span id="code974">DAD	D</span></pre>
<pre id="l975"><span class="adr">E1DF</span>	E5              	<span id="code975">PUSH	H	</span><span class="cmt">;save it and set the transfer address.</span></pre>
<pre id="l976"><span class="adr">E1E0</span>	CD D8 DD        	<span id="code976">CALL	DMASET</span></pre>
<pre id="l977"><span class="adr">E1E3</span>	11 CD E3        	<span id="code977">LXI	D,FCB	</span><span class="cmt">;write out this sector now.</span></pre>
<pre id="l978"><span class="adr">E1E6</span>	CD 04 DD        	<span id="code978">CALL	WRTREC</span></pre>
<pre id="l979"><span class="adr">E1E9</span>	D1              	<span id="code979">POP	D	</span><span class="cmt">;reset (DE) to the start of the last sector.</span></pre>
<pre id="l980"><span class="adr">E1EA</span>	E1              	<span id="code980">POP	H	</span><span class="cmt">;restore sector count.</span></pre>
<pre id="l981"><span class="adr">E1EB</span>	C2 FB E1        	<span id="code981">JNZ	SAVE3	</span><span class="cmt">;write error?</span></pre>
<pre id="l982"><span class="adr">E1EE</span>	C3 D4 E1        	<span id="code982">JMP	SAVE1</span></pre>
<pre id="l983"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l984"><span class="adr"></span>	                <span class="cmt">;   Get here after writing all of the file.</span></pre>
<pre id="l985"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l986"><span class="adr">E1F1</span>	11 CD E3        <span class="l" id="label986">SAVE2</span>	<span id="code986">LXI	D,FCB	</span><span class="cmt">;now close the file.</span></pre>
<pre id="l987"><span class="adr">E1F4</span>	CD DA DC        	<span id="code987">CALL	CLOSE</span></pre>
<pre id="l988"><span class="adr">E1F7</span>	3C              	<span id="code988">INR	A	</span><span class="cmt">;did it close ok?</span></pre>
<pre id="l989"><span class="adr">E1F8</span>	C2 01 E2        	<span id="code989">JNZ	SAVE4</span></pre>
<pre id="l990"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l991"><span class="adr"></span>	                <span class="cmt">;   Print out error message (no space).</span></pre>
<pre id="l992"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l993"><span class="adr">E1FB</span>	01 07 E2        <span class="l" id="label993">SAVE3</span>	<span id="code993">LXI	B,NOSPACE</span></pre>
<pre id="l994"><span class="adr">E1FE</span>	CD A7 DC        	<span id="code994">CALL	PLINE</span></pre>
<pre id="l995"><span class="adr">E201</span>	CD D5 DD        <span class="l" id="label995">SAVE4</span>	<span id="code995">CALL	STDDMA	</span><span class="cmt">;reset the standard dma address.</span></pre>
<pre id="l996"><span class="adr">E204</span>	C3 86 E3        	<span id="code996">JMP	GETBACK</span></pre>
<pre id="l997"><span class="adr">E207</span>	4E 6F 20 73     <span class="l" id="label997">NOSPACE</span>	<span id="code997">DB	'No space',0</span><br/>	.&nbsp;.&nbsp;.&nbsp;<br/>E20F	00 <br/></pre>
<pre id="l998"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l999"><span class="adr"></span>	                <span class="cmt">;**************************************************************</span></pre>
<pre id="l1000"><span class="adr"></span>	                <span class="cmt">;*</span></pre>
<pre id="l1001"><span class="adr"></span>	                <span class="cmt">;*           R E N A M E   C O M M A N D</span></pre>
<pre id="l1002"><span class="adr"></span>	                <span class="cmt">;*</span></pre>
<pre id="l1003"><span class="adr"></span>	                <span class="cmt">;**************************************************************</span></pre>
<pre id="l1004"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1005"><span class="adr">E210</span>	CD 5E DE        <span class="l" id="label1005">RENAME</span>	<span id="code1005">CALL	CONVFST	</span><span class="cmt">;convert first file name.</span></pre>
<pre id="l1006"><span class="adr">E213</span>	C2 09 DE        	<span id="code1006">JNZ	SYNERR	</span><span class="cmt">;wild cards not allowed.</span></pre>
<pre id="l1007"><span class="adr">E216</span>	3A F0 E3        	<span id="code1007">LDA	CHGDRV	</span><span class="cmt">;remember any change in drives specified.</span></pre>
<pre id="l1008"><span class="adr">E219</span>	F5              	<span id="code1008">PUSH	PSW</span></pre>
<pre id="l1009"><span class="adr">E21A</span>	CD 54 E0        	<span id="code1009">CALL	DSELECT	</span><span class="cmt">;and select this drive.</span></pre>
<pre id="l1010"><span class="adr">E21D</span>	CD E9 DC        	<span id="code1010">CALL	SRCHFCB	</span><span class="cmt">;is this file present?</span></pre>
<pre id="l1011"><span class="adr">E220</span>	C2 79 E2        	<span id="code1011">JNZ	RENAME6	</span><span class="cmt">;yes, print error message.</span></pre>
<pre id="l1012"><span class="adr">E223</span>	21 CD E3        	<span id="code1012">LXI	H,FCB	</span><span class="cmt">;yes, move this name into second slot.</span></pre>
<pre id="l1013"><span class="adr">E226</span>	11 DD E3        	<span id="code1013">LXI	D,FCB+16</span></pre>
<pre id="l1014"><span class="adr">E229</span>	06 10           	<span id="code1014">MVI	B,16</span></pre>
<pre id="l1015"><span class="adr">E22B</span>	CD 42 E0        	<span id="code1015">CALL	HL2DE</span></pre>
<pre id="l1016"><span class="adr">E22E</span>	2A 88 DC        	<span id="code1016">LHLD	INPOINT	</span><span class="cmt">;get input pointer.</span></pre>
<pre id="l1017"><span class="adr">E231</span>	EB              	<span id="code1017">XCHG</span></pre>
<pre id="l1018"><span class="adr">E232</span>	CD 4F DE        	<span id="code1018">CALL	NONBLANK</span><span class="cmt">;get next non blank character.</span></pre>
<pre id="l1019"><span class="adr">E235</span>	FE 3D           	<span id="code1019">CPI	'='	</span><span class="cmt">;only allow an '=' or '_' seperator.</span></pre>
<pre id="l1020"><span class="adr">E237</span>	CA 3F E2        	<span id="code1020">JZ	RENAME1</span></pre>
<pre id="l1021"><span class="adr">E23A</span>	FE 5F           	<span id="code1021">CPI	'_'</span></pre>
<pre id="l1022"><span class="adr">E23C</span>	C2 73 E2        	<span id="code1022">JNZ	RENAME5</span></pre>
<pre id="l1023"><span class="adr">E23F</span>	EB              <span class="l" id="label1023">RENAME1</span>	<span id="code1023">XCHG</span></pre>
<pre id="l1024"><span class="adr">E240</span>	23              	<span id="code1024">INX	H	</span><span class="cmt">;ok, skip seperator.</span></pre>
<pre id="l1025"><span class="adr">E241</span>	22 88 DC        	<span id="code1025">SHLD	INPOINT	</span><span class="cmt">;save input line pointer.</span></pre>
<pre id="l1026"><span class="adr">E244</span>	CD 5E DE        	<span id="code1026">CALL	CONVFST	</span><span class="cmt">;convert this second file name now.</span></pre>
<pre id="l1027"><span class="adr">E247</span>	C2 73 E2        	<span id="code1027">JNZ	RENAME5	</span><span class="cmt">;again, no wild cards.</span></pre>
<pre id="l1028"><span class="adr">E24A</span>	F1              	<span id="code1028">POP	PSW	</span><span class="cmt">;if a drive was specified, then it</span></pre>
<pre id="l1029"><span class="adr">E24B</span>	47              	<span id="code1029">MOV	B,A	</span><span class="cmt">;must be the same as before.</span></pre>
<pre id="l1030"><span class="adr">E24C</span>	21 F0 E3        	<span id="code1030">LXI	H,CHGDRV</span></pre>
<pre id="l1031"><span class="adr">E24F</span>	7E              	<span id="code1031">MOV	A,M</span></pre>
<pre id="l1032"><span class="adr">E250</span>	B7              	<span id="code1032">ORA	A</span></pre>
<pre id="l1033"><span class="adr">E251</span>	CA 59 E2        	<span id="code1033">JZ	RENAME2</span></pre>
<pre id="l1034"><span class="adr">E254</span>	B8              	<span id="code1034">CMP	B</span></pre>
<pre id="l1035"><span class="adr">E255</span>	70              	<span id="code1035">MOV	M,B</span></pre>
<pre id="l1036"><span class="adr">E256</span>	C2 73 E2        	<span id="code1036">JNZ	RENAME5	</span><span class="cmt">;they were different, error.</span></pre>
<pre id="l1037"><span class="adr">E259</span>	70              <span class="l" id="label1037">RENAME2</span>	<span id="code1037">MOV	M,B</span><span class="cmt">;	reset as per the first file specification.</span></pre>
<pre id="l1038"><span class="adr">E25A</span>	AF              	<span id="code1038">XRA	A</span></pre>
<pre id="l1039"><span class="adr">E25B</span>	32 CD E3        	<span id="code1039">STA	FCB	</span><span class="cmt">;clear the drive byte of the fcb.</span></pre>
<pre id="l1040"><span class="adr">E25E</span>	CD E9 DC        <span class="l" id="label1040">RENAME3</span>	<span id="code1040">CALL	SRCHFCB	</span><span class="cmt">;and go look for second file.</span></pre>
<pre id="l1041"><span class="adr">E261</span>	CA 6D E2        	<span id="code1041">JZ	RENAME4	</span><span class="cmt">;doesn't exist?</span></pre>
<pre id="l1042"><span class="adr">E264</span>	11 CD E3        	<span id="code1042">LXI	D,FCB</span></pre>
<pre id="l1043"><span class="adr">E267</span>	CD 0E DD        	<span id="code1043">CALL	RENAM	</span><span class="cmt">;ok, rename the file.</span></pre>
<pre id="l1044"><span class="adr">E26A</span>	C3 86 E3        	<span id="code1044">JMP	GETBACK</span></pre>
<pre id="l1045"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1046"><span class="adr"></span>	                <span class="cmt">;   Process rename errors here.</span></pre>
<pre id="l1047"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1048"><span class="adr">E26D</span>	CD EA DF        <span class="l" id="label1048">RENAME4</span>	<span id="code1048">CALL	NONE	</span><span class="cmt">;file not there.</span></pre>
<pre id="l1049"><span class="adr">E270</span>	C3 86 E3        	<span id="code1049">JMP	GETBACK</span></pre>
<pre id="l1050"><span class="adr">E273</span>	CD 66 E0        <span class="l" id="label1050">RENAME5</span>	<span id="code1050">CALL	RESETDR	</span><span class="cmt">;bad command format.</span></pre>
<pre id="l1051"><span class="adr">E276</span>	C3 09 DE        	<span id="code1051">JMP	SYNERR</span></pre>
<pre id="l1052"><span class="adr">E279</span>	01 82 E2        <span class="l" id="label1052">RENAME6</span>	<span id="code1052">LXI	B,EXISTS</span><span class="cmt">;destination file already exists.</span></pre>
<pre id="l1053"><span class="adr">E27C</span>	CD A7 DC        	<span id="code1053">CALL	PLINE</span></pre>
<pre id="l1054"><span class="adr">E27F</span>	C3 86 E3        	<span id="code1054">JMP	GETBACK</span></pre>
<pre id="l1055"><span class="adr">E282</span>	46 69 6C 65     <span class="l" id="label1055">EXISTS</span>	<span id="code1055">DB	'File exists',0</span><br/>	.&nbsp;.&nbsp;.&nbsp;<br/>E28A	73 74 73 00 <br/></pre>
<pre id="l1056"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1057"><span class="adr"></span>	                <span class="cmt">;**************************************************************</span></pre>
<pre id="l1058"><span class="adr"></span>	                <span class="cmt">;*</span></pre>
<pre id="l1059"><span class="adr"></span>	                <span class="cmt">;*             U S E R   C O M M A N D</span></pre>
<pre id="l1060"><span class="adr"></span>	                <span class="cmt">;*</span></pre>
<pre id="l1061"><span class="adr"></span>	                <span class="cmt">;**************************************************************</span></pre>
<pre id="l1062"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1063"><span class="adr">E28E</span>	CD F8 DF        <span class="l" id="label1063">USER</span>	<span id="code1063">CALL	DECODE	</span><span class="cmt">;get numeric value following command.</span></pre>
<pre id="l1064"><span class="adr">E291</span>	FE 10           	<span id="code1064">CPI	16	</span><span class="cmt">;legal user number?</span></pre>
<pre id="l1065"><span class="adr">E293</span>	D2 09 DE        	<span id="code1065">JNC	SYNERR</span></pre>
<pre id="l1066"><span class="adr">E296</span>	5F              	<span id="code1066">MOV	E,A	</span><span class="cmt">;yes but is there anything else?</span></pre>
<pre id="l1067"><span class="adr">E297</span>	3A CE E3        	<span id="code1067">LDA	FCB+1</span></pre>
<pre id="l1068"><span class="adr">E29A</span>	FE 20           	<span id="code1068">CPI	' '</span></pre>
<pre id="l1069"><span class="adr">E29C</span>	CA 09 DE        	<span id="code1069">JZ	SYNERR	</span><span class="cmt">;yes, that is not allowed.</span></pre>
<pre id="l1070"><span class="adr">E29F</span>	CD 15 DD        	<span id="code1070">CALL	GETSETUC</span><span class="cmt">;ok, set user code.</span></pre>
<pre id="l1071"><span class="adr">E2A2</span>	C3 89 E3        	<span id="code1071">JMP	GETBACK1</span></pre>
<pre id="l1072"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1073"><span class="adr"></span>	                <span class="cmt">;**************************************************************</span></pre>
<pre id="l1074"><span class="adr"></span>	                <span class="cmt">;*</span></pre>
<pre id="l1075"><span class="adr"></span>	                <span class="cmt">;*        T R A N S I A N T   P R O G R A M   C O M M A N D</span></pre>
<pre id="l1076"><span class="adr"></span>	                <span class="cmt">;*</span></pre>
<pre id="l1077"><span class="adr"></span>	                <span class="cmt">;**************************************************************</span></pre>
<pre id="l1078"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1079"><span class="adr">E2A5</span>	CD F5 DD        <span class="l" id="label1079">UNKNOWN</span>	<span id="code1079">CALL	VERIFY	</span><span class="cmt">;check for valid system (why?).</span></pre>
<pre id="l1080"><span class="adr">E2A8</span>	3A CE E3        	<span id="code1080">LDA	FCB+1	</span><span class="cmt">;anything to execute?</span></pre>
<pre id="l1081"><span class="adr">E2AB</span>	FE 20           	<span id="code1081">CPI	' '</span></pre>
<pre id="l1082"><span class="adr">E2AD</span>	C2 C4 E2        	<span id="code1082">JNZ	UNKWN1</span></pre>
<pre id="l1083"><span class="adr">E2B0</span>	3A F0 E3        	<span id="code1083">LDA	CHGDRV	</span><span class="cmt">;nope, only a drive change?</span></pre>
<pre id="l1084"><span class="adr">E2B3</span>	B7              	<span id="code1084">ORA	A</span></pre>
<pre id="l1085"><span class="adr">E2B4</span>	CA 89 E3        	<span id="code1085">JZ	GETBACK1</span><span class="cmt">;neither???</span></pre>
<pre id="l1086"><span class="adr">E2B7</span>	3D              	<span id="code1086">DCR	A</span></pre>
<pre id="l1087"><span class="adr">E2B8</span>	32 EF E3        	<span id="code1087">STA	CDRIVE	</span><span class="cmt">;ok, store new drive.</span></pre>
<pre id="l1088"><span class="adr">E2BB</span>	CD 29 DD        	<span id="code1088">CALL	MOVECD	</span><span class="cmt">;set (TDRIVE) also.</span></pre>
<pre id="l1089"><span class="adr">E2BE</span>	CD BD DC        	<span id="code1089">CALL	DSKSEL	</span><span class="cmt">;and select this drive.</span></pre>
<pre id="l1090"><span class="adr">E2C1</span>	C3 89 E3        	<span id="code1090">JMP	GETBACK1</span><span class="cmt">;then return.</span></pre>
<pre id="l1091"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1092"><span class="adr"></span>	                <span class="cmt">;   Here a file name was typed. Prepare to execute it.</span></pre>
<pre id="l1093"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1094"><span class="adr">E2C4</span>	11 D6 E3        <span class="l" id="label1094">UNKWN1</span>	<span id="code1094">LXI	D,FCB+9	</span><span class="cmt">;an extension specified?</span></pre>
<pre id="l1095"><span class="adr">E2C7</span>	1A              	<span id="code1095">LDAX	D</span></pre>
<pre id="l1096"><span class="adr">E2C8</span>	FE 20           	<span id="code1096">CPI	' '</span></pre>
<pre id="l1097"><span class="adr">E2CA</span>	C2 09 DE        	<span id="code1097">JNZ	SYNERR	</span><span class="cmt">;yes, not allowed.</span></pre>
<pre id="l1098"><span class="adr">E2CD</span>	D5              <span class="l" id="label1098">UNKWN2</span>	<span id="code1098">PUSH	D</span></pre>
<pre id="l1099"><span class="adr">E2CE</span>	CD 54 E0        	<span id="code1099">CALL	DSELECT	</span><span class="cmt">;select specified drive.</span></pre>
<pre id="l1100"><span class="adr">E2D1</span>	D1              	<span id="code1100">POP	D</span></pre>
<pre id="l1101"><span class="adr">E2D2</span>	21 83 E3        	<span id="code1101">LXI	H,COMFILE	</span><span class="cmt">;set the extension to 'COM'.</span></pre>
<pre id="l1102"><span class="adr">E2D5</span>	CD 40 E0        	<span id="code1102">CALL	MOVE3</span></pre>
<pre id="l1103"><span class="adr">E2D8</span>	CD D0 DC        	<span id="code1103">CALL	OPENFCB	</span><span class="cmt">;and open this file.</span></pre>
<pre id="l1104"><span class="adr">E2DB</span>	CA 6B E3        	<span id="code1104">JZ	UNKWN9	</span><span class="cmt">;not present?</span></pre>
<pre id="l1105"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1106"><span class="adr"></span>	                <span class="cmt">;   Load in the program.</span></pre>
<pre id="l1107"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1108"><span class="adr">E2DE</span>	21 00 01        	<span id="code1108">LXI	H,TBASE	</span><span class="cmt">;store the program starting here.</span></pre>
<pre id="l1109"><span class="adr">E2E1</span>	E5              <span class="l" id="label1109">UNKWN3</span>	<span id="code1109">PUSH	H</span></pre>
<pre id="l1110"><span class="adr">E2E2</span>	EB              	<span id="code1110">XCHG</span></pre>
<pre id="l1111"><span class="adr">E2E3</span>	CD D8 DD        	<span id="code1111">CALL	DMASET	</span><span class="cmt">;set transfer address.</span></pre>
<pre id="l1112"><span class="adr">E2E6</span>	11 CD E3        	<span id="code1112">LXI	D,FCB	</span><span class="cmt">;and read the next record.</span></pre>
<pre id="l1113"><span class="adr">E2E9</span>	CD F9 DC        	<span id="code1113">CALL	RDREC</span></pre>
<pre id="l1114"><span class="adr">E2EC</span>	C2 01 E3        	<span id="code1114">JNZ	UNKWN4	</span><span class="cmt">;end of file or read error?</span></pre>
<pre id="l1115"><span class="adr">E2EF</span>	E1              	<span id="code1115">POP	H	</span><span class="cmt">;nope, bump pointer for next sector.</span></pre>
<pre id="l1116"><span class="adr">E2F0</span>	11 80 00        	<span id="code1116">LXI	D,128</span></pre>
<pre id="l1117"><span class="adr">E2F3</span>	19              	<span id="code1117">DAD	D</span></pre>
<pre id="l1118"><span class="adr">E2F4</span>	11 00 DC        	<span id="code1118">LXI	D,CBASE	</span><span class="cmt">;enough room for the whole file?</span></pre>
<pre id="l1119"><span class="adr">E2F7</span>	7D              	<span id="code1119">MOV	A,L</span></pre>
<pre id="l1120"><span class="adr">E2F8</span>	93              	<span id="code1120">SUB	E</span></pre>
<pre id="l1121"><span class="adr">E2F9</span>	7C              	<span id="code1121">MOV	A,H</span></pre>
<pre id="l1122"><span class="adr">E2FA</span>	9A              	<span id="code1122">SBB	D</span></pre>
<pre id="l1123"><span class="adr">E2FB</span>	D2 71 E3        	<span id="code1123">JNC	UNKWN0	</span><span class="cmt">;no, it can't fit.</span></pre>
<pre id="l1124"><span class="adr">E2FE</span>	C3 E1 E2        	<span id="code1124">JMP	UNKWN3</span></pre>
<pre id="l1125"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1126"><span class="adr"></span>	                <span class="cmt">;   Get here after finished reading.</span></pre>
<pre id="l1127"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1128"><span class="adr">E301</span>	E1              <span class="l" id="label1128">UNKWN4</span>	<span id="code1128">POP	H</span></pre>
<pre id="l1129"><span class="adr">E302</span>	3D              	<span id="code1129">DCR	A	</span><span class="cmt">;normal end of file?</span></pre>
<pre id="l1130"><span class="adr">E303</span>	C2 71 E3        	<span id="code1130">JNZ	UNKWN0</span></pre>
<pre id="l1131"><span class="adr">E306</span>	CD 66 E0        	<span id="code1131">CALL	RESETDR	</span><span class="cmt">;yes, reset previous drive.</span></pre>
<pre id="l1132"><span class="adr">E309</span>	CD 5E DE        	<span id="code1132">CALL	CONVFST	</span><span class="cmt">;convert the first file name that follows</span></pre>
<pre id="l1133"><span class="adr">E30C</span>	21 F0 E3        	<span id="code1133">LXI	H,CHGDRV</span><span class="cmt">;command name.</span></pre>
<pre id="l1134"><span class="adr">E30F</span>	E5              	<span id="code1134">PUSH	H</span></pre>
<pre id="l1135"><span class="adr">E310</span>	7E              	<span id="code1135">MOV	A,M	</span><span class="cmt">;set drive code in default fcb.</span></pre>
<pre id="l1136"><span class="adr">E311</span>	32 CD E3        	<span id="code1136">STA	FCB</span></pre>
<pre id="l1137"><span class="adr">E314</span>	3E 10           	<span id="code1137">MVI	A,16	</span><span class="cmt">;put second name 16 bytes later.</span></pre>
<pre id="l1138"><span class="adr">E316</span>	CD 60 DE        	<span id="code1138">CALL	CONVERT	</span><span class="cmt">;convert second file name.</span></pre>
<pre id="l1139"><span class="adr">E319</span>	E1              	<span id="code1139">POP	H</span></pre>
<pre id="l1140"><span class="adr">E31A</span>	7E              	<span id="code1140">MOV	A,M	</span><span class="cmt">;and set the drive for this second file.</span></pre>
<pre id="l1141"><span class="adr">E31B</span>	32 DD E3        	<span id="code1141">STA	FCB+16</span></pre>
<pre id="l1142"><span class="adr">E31E</span>	AF              	<span id="code1142">XRA	A	</span><span class="cmt">;clear record byte in fcb.</span></pre>
<pre id="l1143"><span class="adr">E31F</span>	32 ED E3        	<span id="code1143">STA	FCB+32</span></pre>
<pre id="l1144"><span class="adr">E322</span>	11 5C 00        	<span id="code1144">LXI	D,TFCB	</span><span class="cmt">;move it into place at(005Ch).</span></pre>
<pre id="l1145"><span class="adr">E325</span>	21 CD E3        	<span id="code1145">LXI	H,FCB</span></pre>
<pre id="l1146"><span class="adr">E328</span>	06 21           	<span id="code1146">MVI	B,33</span></pre>
<pre id="l1147"><span class="adr">E32A</span>	CD 42 E0        	<span id="code1147">CALL	HL2DE</span></pre>
<pre id="l1148"><span class="adr">E32D</span>	21 08 DC        	<span id="code1148">LXI	H,INBUFF+2</span><span class="cmt">;now move the remainder of the input</span></pre>
<pre id="l1149"><span class="adr">E330</span>	7E              <span class="l" id="label1149">UNKWN5</span>	<span id="code1149">MOV	A,M	</span><span class="cmt">;line down to (0080h). Look for a non blank.</span></pre>
<pre id="l1150"><span class="adr">E331</span>	B7              	<span id="code1150">ORA	A	</span><span class="cmt">;or a null.</span></pre>
<pre id="l1151"><span class="adr">E332</span>	CA 3E E3        	<span id="code1151">JZ	UNKWN6</span></pre>
<pre id="l1152"><span class="adr">E335</span>	FE 20           	<span id="code1152">CPI	' '</span></pre>
<pre id="l1153"><span class="adr">E337</span>	CA 3E E3        	<span id="code1153">JZ	UNKWN6</span></pre>
<pre id="l1154"><span class="adr">E33A</span>	23              	<span id="code1154">INX	H</span></pre>
<pre id="l1155"><span class="adr">E33B</span>	C3 30 E3        	<span id="code1155">JMP	UNKWN5</span></pre>
<pre id="l1156"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1157"><span class="adr"></span>	                <span class="cmt">;   Do the line move now. It ends in a null byte.</span></pre>
<pre id="l1158"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1159"><span class="adr">E33E</span>	06 00           <span class="l" id="label1159">UNKWN6</span>	<span id="code1159">MVI	B,0	</span><span class="cmt">;keep a character count.</span></pre>
<pre id="l1160"><span class="adr">E340</span>	11 81 00        	<span id="code1160">LXI	D,TBUFF+1</span><span class="cmt">;data gets put here.</span></pre>
<pre id="l1161"><span class="adr">E343</span>	7E              <span class="l" id="label1161">UNKWN7</span>	<span id="code1161">MOV	A,M	</span><span class="cmt">;move it now.</span></pre>
<pre id="l1162"><span class="adr">E344</span>	12              	<span id="code1162">STAX	D</span></pre>
<pre id="l1163"><span class="adr">E345</span>	B7              	<span id="code1163">ORA	A</span></pre>
<pre id="l1164"><span class="adr">E346</span>	CA 4F E3        	<span id="code1164">JZ	UNKWN8</span></pre>
<pre id="l1165"><span class="adr">E349</span>	04              	<span id="code1165">INR	B</span></pre>
<pre id="l1166"><span class="adr">E34A</span>	23              	<span id="code1166">INX	H</span></pre>
<pre id="l1167"><span class="adr">E34B</span>	13              	<span id="code1167">INX	D</span></pre>
<pre id="l1168"><span class="adr">E34C</span>	C3 43 E3        	<span id="code1168">JMP	UNKWN7</span></pre>
<pre id="l1169"><span class="adr">E34F</span>	78              <span class="l" id="label1169">UNKWN8</span>	<span id="code1169">MOV	A,B	</span><span class="cmt">;now store the character count.</span></pre>
<pre id="l1170"><span class="adr">E350</span>	32 80 00        	<span id="code1170">STA	TBUFF</span></pre>
<pre id="l1171"><span class="adr">E353</span>	CD 98 DC        	<span id="code1171">CALL	CRLF	</span><span class="cmt">;clean up the screen.</span></pre>
<pre id="l1172"><span class="adr">E356</span>	CD D5 DD        	<span id="code1172">CALL	STDDMA	</span><span class="cmt">;set standard transfer address.</span></pre>
<pre id="l1173"><span class="adr">E359</span>	CD 1A DD        	<span id="code1173">CALL	SETCDRV	</span><span class="cmt">;reset current drive.</span></pre>
<pre id="l1174"><span class="adr">E35C</span>	CD 00 01        	<span id="code1174">CALL	TBASE	</span><span class="cmt">;and execute the program.</span></pre>
<pre id="l1175"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1176"><span class="adr"></span>	                <span class="cmt">;   Transiant programs return here (or reboot).</span></pre>
<pre id="l1177"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1178"><span class="adr">E35F</span>	31 AB E3        	<span id="code1178">LXI	SP,BATCH	</span><span class="cmt">;set stack first off.</span></pre>
<pre id="l1179"><span class="adr">E362</span>	CD 29 DD        	<span id="code1179">CALL	MOVECD	</span><span class="cmt">;move current drive into place (TDRIVE).</span></pre>
<pre id="l1180"><span class="adr">E365</span>	CD BD DC        	<span id="code1180">CALL	DSKSEL	</span><span class="cmt">;and reselect it.</span></pre>
<pre id="l1181"><span class="adr">E368</span>	C3 82 DF        	<span id="code1181">JMP	CMMND1	</span><span class="cmt">;back to comand mode.</span></pre>
<pre id="l1182"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1183"><span class="adr"></span>	                <span class="cmt">;   Get here if some error occured.</span></pre>
<pre id="l1184"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1185"><span class="adr">E36B</span>	CD 66 E0        <span class="l" id="label1185">UNKWN9</span>	<span id="code1185">CALL	RESETDR	</span><span class="cmt">;inproper format.</span></pre>
<pre id="l1186"><span class="adr">E36E</span>	C3 09 DE        	<span id="code1186">JMP	SYNERR</span></pre>
<pre id="l1187"><span class="adr">E371</span>	01 7A E3        <span class="l" id="label1187">UNKWN0</span>	<span id="code1187">LXI	B,BADLOAD</span><span class="cmt">;read error or won't fit.</span></pre>
<pre id="l1188"><span class="adr">E374</span>	CD A7 DC        	<span id="code1188">CALL	PLINE</span></pre>
<pre id="l1189"><span class="adr">E377</span>	C3 86 E3        	<span id="code1189">JMP	GETBACK</span></pre>
<pre id="l1190"><span class="adr">E37A</span>	42 61 64 20     <span class="l" id="label1190">BADLOAD</span>	<span id="code1190">DB	'Bad load',0</span><br/>	.&nbsp;.&nbsp;.&nbsp;<br/>E382	00 <br/></pre>
<pre id="l1191"><span class="adr">E383</span>	43 4F 4D        <span class="l" id="label1191">COMFILE</span>	<span id="code1191">DB	'COM'	</span><span class="cmt">;command file extension.</span></pre>
<pre id="l1192"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1193"><span class="adr"></span>	                <span class="cmt">;   Get here to return to command level. We will reset the</span></pre>
<pre id="l1194"><span class="adr"></span>	                <span class="cmt">; previous active drive and then either return to command</span></pre>
<pre id="l1195"><span class="adr"></span>	                <span class="cmt">; level directly or print error message and then return.</span></pre>
<pre id="l1196"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1197"><span class="adr">E386</span>	CD 66 E0        <span class="l" id="label1197">GETBACK</span>	<span id="code1197">CALL	RESETDR	</span><span class="cmt">;reset previous drive.</span></pre>
<pre id="l1198"><span class="adr">E389</span>	CD 5E DE        <span class="l" id="label1198">GETBACK1</span><span id="code1198">:CALL	CONVFST	</span><span class="cmt">;convert first name in (FCB).</span></pre>
<pre id="l1199"><span class="adr">E38C</span>	3A CE E3        	<span id="code1199">LDA	FCB+1	</span><span class="cmt">;if this was just a drive change request,</span></pre>
<pre id="l1200"><span class="adr">E38F</span>	D6 20           	<span id="code1200">SUI	' '	</span><span class="cmt">;make sure it was valid.</span></pre>
<pre id="l1201"><span class="adr">E391</span>	21 F0 E3        	<span id="code1201">LXI	H,CHGDRV</span></pre>
<pre id="l1202"><span class="adr">E394</span>	B6              	<span id="code1202">ORA	M</span></pre>
<pre id="l1203"><span class="adr">E395</span>	C2 09 DE        	<span id="code1203">JNZ	SYNERR</span></pre>
<pre id="l1204"><span class="adr">E398</span>	C3 82 DF        	<span id="code1204">JMP	CMMND1	</span><span class="cmt">;ok, return to command level.</span></pre>
<pre id="l1205"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1206"><span class="adr"></span>	                <span class="cmt">;   ccp stack area.</span></pre>
<pre id="l1207"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1208"><span class="adr">E39B</span>	00 00 00 00     	<span id="code1208">DB	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0</span><br/>	.&nbsp;.&nbsp;.&nbsp;<br/>E3A7	00 00 00 00 <br/></pre>
<pre id="l1209"><span class="adr"></span>	                <span class="l" id="label1209">CCPSTACK</span><span id="code1209">:EQU	$	</span><span class="cmt">;end of ccp stack area.</span></pre>
<pre id="l1210"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1211"><span class="adr"></span>	                <span class="cmt">;   Batch (or SUBMIT) processing information storage.</span></pre>
<pre id="l1212"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1213"><span class="adr">E3AB</span>	00              <span class="l" id="label1213">BATCH</span>	<span id="code1213">DB	0	</span><span class="cmt">;batch mode flag (0=not active).</span></pre>
<pre id="l1214"><span class="adr">E3AC</span>	00 24 24 24     <span class="l" id="label1214">BATCHFCB</span><span id="code1214">:DB	0,'$$$     SUB',0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0</span><br/>	.&nbsp;.&nbsp;.&nbsp;<br/>E3CC	00 <br/></pre>
<pre id="l1215"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1216"><span class="adr"></span>	                <span class="cmt">;   File control block setup by the CCP.</span></pre>
<pre id="l1217"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1218"><span class="adr">E3CD</span>	00 20 20 20     <span class="l" id="label1218">FCB</span>	<span id="code1218">DB	0,'           ',0,0,0,0,0,'           ',0,0,0,0,0</span><br/>	.&nbsp;.&nbsp;.&nbsp;<br/>E3ED	00 <br/></pre>
<pre id="l1219"><span class="adr">E3EE</span>	00              <span class="l" id="label1219">RTNCODE</span>	<span id="code1219">DB	0	</span><span class="cmt">;status returned from bdos call.</span></pre>
<pre id="l1220"><span class="adr">E3EF</span>	00              <span class="l" id="label1220">CDRIVE</span>	<span id="code1220">DB	0	</span><span class="cmt">;currently active drive.</span></pre>
<pre id="l1221"><span class="adr">E3F0</span>	00              <span class="l" id="label1221">CHGDRV</span>	<span id="code1221">DB	0	</span><span class="cmt">;change in drives flag (0=no change).</span></pre>
<pre id="l1222"><span class="adr">E3F1</span>	00 00           <span class="l" id="label1222">NBYTES</span>	<span id="code1222">DW	0	</span><span class="cmt">;byte counter used by TYPE.</span></pre>
<pre id="l1223"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1224"><span class="adr"></span>	                <span class="cmt">;   Room for expansion?</span></pre>
<pre id="l1225"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1226"><span class="adr">E3F3</span>	00 00 00 00     	<span id="code1226">DB	0,0,0,0,0,0,0,0,0,0,0,0,0</span><br/>	.&nbsp;.&nbsp;.&nbsp;<br/>E3FF	00 <br/></pre>
<pre id="l1227"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1228"><span class="adr"></span>	                <span class="cmt">;   Note that the following six bytes must match those at</span></pre>
<pre id="l1229"><span class="adr"></span>	                <span class="cmt">; (PATTRN1) or cp/m will HALT. Why?</span></pre>
<pre id="l1230"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1231"><span class="adr">E400</span>	00 16 00 00     <span class="l" id="label1231">PATTRN2</span>	<span id="code1231">DB	0,22,0,0,0,0</span><span class="cmt">;(* serial number bytes *).</span><br/>	.&nbsp;.&nbsp;.&nbsp;<br/>E404	00 00 <br/></pre>
<pre id="l1232"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1233"><span class="adr"></span>	                <span class="cmt">;**************************************************************</span></pre>
<pre id="l1234"><span class="adr"></span>	                <span class="cmt">;*</span></pre>
<pre id="l1235"><span class="adr"></span>	                <span class="cmt">;*                    B D O S   E N T R Y</span></pre>
<pre id="l1236"><span class="adr"></span>	                <span class="cmt">;*</span></pre>
<pre id="l1237"><span class="adr"></span>	                <span class="cmt">;**************************************************************</span></pre>
<pre id="l1238"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1239"><span class="adr">E406</span>	C3 11 E4        <span class="l" id="label1239">FBASE</span>	<span id="code1239">JMP	FBASE1</span></pre>
<pre id="l1240"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1241"><span class="adr"></span>	                <span class="cmt">;   Bdos error table.</span></pre>
<pre id="l1242"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1243"><span class="adr">E409</span>	99 E4           <span class="l" id="label1243">BADSCTR</span>	<span id="code1243">DW	ERROR1	</span><span class="cmt">;bad sector on read or write.</span></pre>
<pre id="l1244"><span class="adr">E40B</span>	A5 E4           <span class="l" id="label1244">BADSLCT</span>	<span id="code1244">DW	ERROR2	</span><span class="cmt">;bad disk select.</span></pre>
<pre id="l1245"><span class="adr">E40D</span>	AB E4           <span class="l" id="label1245">RODISK</span>	<span id="code1245">DW	ERROR3	</span><span class="cmt">;disk is read only.</span></pre>
<pre id="l1246"><span class="adr">E40F</span>	B1 E4           <span class="l" id="label1246">ROFILE</span>	<span id="code1246">DW	ERROR4	</span><span class="cmt">;file is read only.</span></pre>
<pre id="l1247"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1248"><span class="adr"></span>	                <span class="cmt">;   Entry into bdos. (DE) or (E) are the parameters passed. The</span></pre>
<pre id="l1249"><span class="adr"></span>	                <span class="cmt">; function number desired is in register (C).</span></pre>
<pre id="l1250"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1251"><span class="adr">E411</span>	EB              <span class="l" id="label1251">FBASE1</span>	<span id="code1251">XCHG		</span><span class="cmt">;save the (DE) parameters.</span></pre>
<pre id="l1252"><span class="adr">E412</span>	22 43 E7        	<span id="code1252">SHLD	PARAMS</span></pre>
<pre id="l1253"><span class="adr">E415</span>	EB              	<span id="code1253">XCHG</span></pre>
<pre id="l1254"><span class="adr">E416</span>	7B              	<span id="code1254">MOV	A,E	</span><span class="cmt">;and save register (E) in particular.</span></pre>
<pre id="l1255"><span class="adr">E417</span>	32 D6 F1        	<span id="code1255">STA	EPARAM</span></pre>
<pre id="l1256"><span class="adr">E41A</span>	21 00 00        	<span id="code1256">LXI	H,0</span></pre>
<pre id="l1257"><span class="adr">E41D</span>	22 45 E7        	<span id="code1257">SHLD	STATUS	</span><span class="cmt">;clear return status.</span></pre>
<pre id="l1258"><span class="adr">E420</span>	39              	<span id="code1258">DAD	SP</span></pre>
<pre id="l1259"><span class="adr">E421</span>	22 0F E7        	<span id="code1259">SHLD	USRSTACK</span><span class="cmt">;save users stack pointer.</span></pre>
<pre id="l1260"><span class="adr">E424</span>	31 41 E7        	<span id="code1260">LXI	SP,STKAREA</span><span class="cmt">;and set our own.</span></pre>
<pre id="l1261"><span class="adr">E427</span>	AF              	<span id="code1261">XRA	A	</span><span class="cmt">;clear auto select storage space.</span></pre>
<pre id="l1262"><span class="adr">E428</span>	32 E0 F1        	<span id="code1262">STA	AUTOFLAG</span></pre>
<pre id="l1263"><span class="adr">E42B</span>	32 DE F1        	<span id="code1263">STA	AUTO</span></pre>
<pre id="l1264"><span class="adr">E42E</span>	21 74 F1        	<span id="code1264">LXI	H,GOBACK</span><span class="cmt">;set return address.</span></pre>
<pre id="l1265"><span class="adr">E431</span>	E5              	<span id="code1265">PUSH	H</span></pre>
<pre id="l1266"><span class="adr">E432</span>	79              	<span id="code1266">MOV	A,C	</span><span class="cmt">;get function number.</span></pre>
<pre id="l1267"><span class="adr">E433</span>	FE 29           	<span id="code1267">CPI	NFUNCTS	</span><span class="cmt">;valid function number?</span></pre>
<pre id="l1268"><span class="adr">E435</span>	D0              	<span id="code1268">RNC</span></pre>
<pre id="l1269"><span class="adr">E436</span>	4B              	<span id="code1269">MOV	C,E	</span><span class="cmt">;keep single register function here.</span></pre>
<pre id="l1270"><span class="adr">E437</span>	21 47 E4        	<span id="code1270">LXI	H,FUNCTNS</span><span class="cmt">;now look thru the function table.</span></pre>
<pre id="l1271"><span class="adr">E43A</span>	5F              	<span id="code1271">MOV	E,A</span></pre>
<pre id="l1272"><span class="adr">E43B</span>	16 00           	<span id="code1272">MVI	D,0	</span><span class="cmt">;(DE)=function number.</span></pre>
<pre id="l1273"><span class="adr">E43D</span>	19              	<span id="code1273">DAD	D</span></pre>
<pre id="l1274"><span class="adr">E43E</span>	19              	<span id="code1274">DAD	D	</span><span class="cmt">;(HL)=(start of table)+2*(function number).</span></pre>
<pre id="l1275"><span class="adr">E43F</span>	5E              	<span id="code1275">MOV	E,M</span></pre>
<pre id="l1276"><span class="adr">E440</span>	23              	<span id="code1276">INX	H</span></pre>
<pre id="l1277"><span class="adr">E441</span>	56              	<span id="code1277">MOV	D,M	</span><span class="cmt">;now (DE)=address for this function.</span></pre>
<pre id="l1278"><span class="adr">E442</span>	2A 43 E7        	<span id="code1278">LHLD	PARAMS	</span><span class="cmt">;retrieve parameters.</span></pre>
<pre id="l1279"><span class="adr">E445</span>	EB              	<span id="code1279">XCHG		</span><span class="cmt">;now (DE) has the original parameters.</span></pre>
<pre id="l1280"><span class="adr">E446</span>	E9              	<span id="code1280">PCHL		</span><span class="cmt">;execute desired function.</span></pre>
<pre id="l1281"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1282"><span class="adr"></span>	                <span class="cmt">;   BDOS function jump table.</span></pre>
<pre id="l1283"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1284"><span class="adr"></span>	                <span class="l" id="label1284">NFUNCTS</span>	<span id="code1284">EQU	41	</span><span class="cmt">;number of functions in followin table.</span></pre>
<pre id="l1285"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1286"><span class="adr">E447</span>	03 F2 C8 E6     <span class="l" id="label1286">FUNCTNS</span>	<span id="code1286">DW	WBOOT,GETCON,OUTCON,GETRDR,PUNCH,LIST,DIRCIO,GETIOB</span><br/>	.&nbsp;.&nbsp;.&nbsp;<br/>E453	D4 E6 ED E6 <br/></pre>
<pre id="l1287"><span class="adr">E457</span>	F3 E6 F8 E6     	<span id="code1287">DW	SETIOB,PRTSTR,RDBUFF,GETCSTS,GETVER,RSTDSK,SETDSK,OPENFIL</span><br/>	.&nbsp;.&nbsp;.&nbsp;<br/>E463	45 F0 9C F0 <br/></pre>
<pre id="l1288"><span class="adr">E467</span>	A5 F0 AB F0     	<span id="code1288">DW	CLOSEFIL,GETFST,GETNXT,DELFILE,READSEQ,WRTSEQ,FCREATE</span><br/>	.&nbsp;.&nbsp;.&nbsp;<br/>E473	EC F0 <br/></pre>
<pre id="l1289"><span class="adr">E475</span>	F5 F0 FE F0     	<span id="code1289">DW	RENFILE,GETLOG,GETCRNT,PUTDMA,GETALOC,WRTPRTD,GETROV,SETATTR</span><br/>	.&nbsp;.&nbsp;.&nbsp;<br/>E481	17 F1 1D F1 <br/></pre>
<pre id="l1290"><span class="adr">E485</span>	26 F1 2D F1     	<span id="code1290">DW	GETPARM,GETUSER,RDRANDOM,WTRANDOM,FILESIZE,SETRAN,LOGOFF,RTN</span><br/>	.&nbsp;.&nbsp;.&nbsp;<br/>E491	53 F1 04 E7 <br/></pre>
<pre id="l1291"><span class="adr">E495</span>	04 E7 9B F1     	<span id="code1291">DW	RTN,WTSPECL</span></pre>
<pre id="l1292"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1293"><span class="adr"></span>	                <span class="cmt">;   Bdos error message section.</span></pre>
<pre id="l1294"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1295"><span class="adr">E499</span>	21 CA E4        <span class="l" id="label1295">ERROR1</span>	<span id="code1295">LXI	H,BADSEC	</span><span class="cmt">;bad sector message.</span></pre>
<pre id="l1296"><span class="adr">E49C</span>	CD E5 E4        	<span id="code1296">CALL	PRTERR	</span><span class="cmt">;print it and get a 1 char responce.</span></pre>
<pre id="l1297"><span class="adr">E49F</span>	FE 03           	<span id="code1297">CPI	CNTRLC	</span><span class="cmt">;re-boot request (control-c)?</span></pre>
<pre id="l1298"><span class="adr">E4A1</span>	CA 00 00        	<span id="code1298">JZ	0	</span><span class="cmt">;yes.</span></pre>
<pre id="l1299"><span class="adr">E4A4</span>	C9              	<span id="code1299">RET		</span><span class="cmt">;no, return to retry i/o function.</span></pre>
<pre id="l1300"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1301"><span class="adr">E4A5</span>	21 D5 E4        <span class="l" id="label1301">ERROR2</span>	<span id="code1301">LXI	H,BADSEL	</span><span class="cmt">;bad drive selected.</span></pre>
<pre id="l1302"><span class="adr">E4A8</span>	C3 B4 E4        	<span id="code1302">JMP	ERROR5</span></pre>
<pre id="l1303"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1304"><span class="adr">E4AB</span>	21 E1 E4        <span class="l" id="label1304">ERROR3</span>	<span id="code1304">LXI	H,DISKRO	</span><span class="cmt">;disk is read only.</span></pre>
<pre id="l1305"><span class="adr">E4AE</span>	C3 B4 E4        	<span id="code1305">JMP	ERROR5</span></pre>
<pre id="l1306"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1307"><span class="adr">E4B1</span>	21 DC E4        <span class="l" id="label1307">ERROR4</span>	<span id="code1307">LXI	H,FILERO	</span><span class="cmt">;file is read only.</span></pre>
<pre id="l1308"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1309"><span class="adr">E4B4</span>	CD E5 E4        <span class="l" id="label1309">ERROR5</span>	<span id="code1309">CALL	PRTERR</span></pre>
<pre id="l1310"><span class="adr">E4B7</span>	C3 00 00        	<span id="code1310">JMP	0	</span><span class="cmt">;always reboot on these errors.</span></pre>
<pre id="l1311"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1312"><span class="adr">E4BA</span>	42 64 6F 73     <span class="l" id="label1312">BDOSERR</span>	<span id="code1312">DB	'Bdos Err On '</span><br/>	.&nbsp;.&nbsp;.&nbsp;<br/>E4C2	20 4F 6E 20 <br/></pre>
<pre id="l1313"><span class="adr">E4C6</span>	20 3A 20 24     <span class="l" id="label1313">BDOSDRV</span>	<span id="code1313">DB	' : $'</span></pre>
<pre id="l1314"><span class="adr">E4CA</span>	42 61 64 20     <span class="l" id="label1314">BADSEC</span>	<span id="code1314">DB	'Bad Sector$'</span><br/>	.&nbsp;.&nbsp;.&nbsp;<br/>E4D2	6F 72 24 <br/></pre>
<pre id="l1315"><span class="adr">E4D5</span>	53 65 6C 65     <span class="l" id="label1315">BADSEL</span>	<span id="code1315">DB	'Select$'</span><br/>	.&nbsp;.&nbsp;.&nbsp;<br/>E4D9	63 74 24 <br/></pre>
<pre id="l1316"><span class="adr">E4DC</span>	46 69 6C 65     <span class="l" id="label1316">FILERO</span>	<span id="code1316">DB	'File '</span><br/>	.&nbsp;.&nbsp;.&nbsp;<br/>E4E0	20 <br/></pre>
<pre id="l1317"><span class="adr">E4E1</span>	52 2F 4F 24     <span class="l" id="label1317">DISKRO</span>	<span id="code1317">DB	'R/O$'</span></pre>
<pre id="l1318"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1319"><span class="adr"></span>	                <span class="cmt">;   Print bdos error message.</span></pre>
<pre id="l1320"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1321"><span class="adr">E4E5</span>	E5              <span class="l" id="label1321">PRTERR</span>	<span id="code1321">PUSH	H	</span><span class="cmt">;save second message pointer.</span></pre>
<pre id="l1322"><span class="adr">E4E6</span>	CD C9 E5        	<span id="code1322">CALL	OUTCRLF	</span><span class="cmt">;send (cr)(lf).</span></pre>
<pre id="l1323"><span class="adr">E4E9</span>	3A 42 E7        	<span id="code1323">LDA	ACTIVE	</span><span class="cmt">;get active drive.</span></pre>
<pre id="l1324"><span class="adr">E4EC</span>	C6 41           	<span id="code1324">ADI	'A'	</span><span class="cmt">;make ascii.</span></pre>
<pre id="l1325"><span class="adr">E4EE</span>	32 C6 E4        	<span id="code1325">STA	BDOSDRV	</span><span class="cmt">;and put in message.</span></pre>
<pre id="l1326"><span class="adr">E4F1</span>	01 BA E4        	<span id="code1326">LXI	B,BDOSERR</span><span class="cmt">;and print it.</span></pre>
<pre id="l1327"><span class="adr">E4F4</span>	CD D3 E5        	<span id="code1327">CALL	PRTMESG</span></pre>
<pre id="l1328"><span class="adr">E4F7</span>	C1              	<span id="code1328">POP	B	</span><span class="cmt">;print second message line now.</span></pre>
<pre id="l1329"><span class="adr">E4F8</span>	CD D3 E5        	<span id="code1329">CALL	PRTMESG</span></pre>
<pre id="l1330"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1331"><span class="adr"></span>	                <span class="cmt">;   Get an input character. We will check our 1 character</span></pre>
<pre id="l1332"><span class="adr"></span>	                <span class="cmt">; buffer first. This may be set by the console status routine.</span></pre>
<pre id="l1333"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1334"><span class="adr">E4FB</span>	21 0E E7        <span class="l" id="label1334">GETCHAR</span>	<span id="code1334">LXI	H,CHARBUF</span><span class="cmt">;check character buffer.</span></pre>
<pre id="l1335"><span class="adr">E4FE</span>	7E              	<span id="code1335">MOV	A,M	</span><span class="cmt">;anything present already?</span></pre>
<pre id="l1336"><span class="adr">E4FF</span>	36 00           	<span id="code1336">MVI	M,0	</span><span class="cmt">;...either case clear it.</span></pre>
<pre id="l1337"><span class="adr">E501</span>	B7              	<span id="code1337">ORA	A</span></pre>
<pre id="l1338"><span class="adr">E502</span>	C0              	<span id="code1338">RNZ		</span><span class="cmt">;yes, use it.</span></pre>
<pre id="l1339"><span class="adr">E503</span>	C3 09 F2        	<span id="code1339">JMP	CONIN	</span><span class="cmt">;nope, go get a character responce.</span></pre>
<pre id="l1340"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1341"><span class="adr"></span>	                <span class="cmt">;   Input and echo a character.</span></pre>
<pre id="l1342"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1343"><span class="adr">E506</span>	CD FB E4        <span class="l" id="label1343">GETECHO</span>	<span id="code1343">CALL	GETCHAR	</span><span class="cmt">;input a character.</span></pre>
<pre id="l1344"><span class="adr">E509</span>	CD 14 E5        	<span id="code1344">CALL	CHKCHAR	</span><span class="cmt">;carriage control?</span></pre>
<pre id="l1345"><span class="adr">E50C</span>	D8              	<span id="code1345">RC		</span><span class="cmt">;no, a regular control char so don't echo.</span></pre>
<pre id="l1346"><span class="adr">E50D</span>	F5              	<span id="code1346">PUSH	PSW	</span><span class="cmt">;ok, save character now.</span></pre>
<pre id="l1347"><span class="adr">E50E</span>	4F              	<span id="code1347">MOV	C,A</span></pre>
<pre id="l1348"><span class="adr">E50F</span>	CD 90 E5        	<span id="code1348">CALL	OUTCON	</span><span class="cmt">;and echo it.</span></pre>
<pre id="l1349"><span class="adr">E512</span>	F1              	<span id="code1349">POP	PSW	</span><span class="cmt">;get character and return.</span></pre>
<pre id="l1350"><span class="adr">E513</span>	C9              	<span id="code1350">RET</span></pre>
<pre id="l1351"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1352"><span class="adr"></span>	                <span class="cmt">;   Check character in (A). Set the zero flag on a carriage</span></pre>
<pre id="l1353"><span class="adr"></span>	                <span class="cmt">; control character and the carry flag on any other control</span></pre>
<pre id="l1354"><span class="adr"></span>	                <span class="cmt">; character.</span></pre>
<pre id="l1355"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1356"><span class="adr">E514</span>	FE 0D           <span class="l" id="label1356">CHKCHAR</span>	<span id="code1356">CPI	CR	</span><span class="cmt">;check for carriage return, line feed, backspace,</span></pre>
<pre id="l1357"><span class="adr">E516</span>	C8              	<span id="code1357">RZ		</span><span class="cmt">;or a tab.</span></pre>
<pre id="l1358"><span class="adr">E517</span>	FE 0A           	<span id="code1358">CPI	LF</span></pre>
<pre id="l1359"><span class="adr">E519</span>	C8              	<span id="code1359">RZ</span></pre>
<pre id="l1360"><span class="adr">E51A</span>	FE 09           	<span id="code1360">CPI	TAB</span></pre>
<pre id="l1361"><span class="adr">E51C</span>	C8              	<span id="code1361">RZ</span></pre>
<pre id="l1362"><span class="adr">E51D</span>	FE 08           	<span id="code1362">CPI	BS</span></pre>
<pre id="l1363"><span class="adr">E51F</span>	C8              	<span id="code1363">RZ</span></pre>
<pre id="l1364"><span class="adr">E520</span>	FE 20           	<span id="code1364">CPI	' '	</span><span class="cmt">;other control char? Set carry flag.</span></pre>
<pre id="l1365"><span class="adr">E522</span>	C9              	<span id="code1365">RET</span></pre>
<pre id="l1366"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1367"><span class="adr"></span>	                <span class="cmt">;   Check the console during output. Halt on a control-s, then</span></pre>
<pre id="l1368"><span class="adr"></span>	                <span class="cmt">; reboot on a control-c. If anything else is ready, clear the</span></pre>
<pre id="l1369"><span class="adr"></span>	                <span class="cmt">; zero flag and return (the calling routine may want to do</span></pre>
<pre id="l1370"><span class="adr"></span>	                <span class="cmt">; something).</span></pre>
<pre id="l1371"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1372"><span class="adr">E523</span>	3A 0E E7        <span class="l" id="label1372">CKCONSOL</span><span id="code1372">:LDA	CHARBUF	</span><span class="cmt">;check buffer.</span></pre>
<pre id="l1373"><span class="adr">E526</span>	B7              	<span id="code1373">ORA	A	</span><span class="cmt">;if anything, just return without checking.</span></pre>
<pre id="l1374"><span class="adr">E527</span>	C2 45 E5        	<span id="code1374">JNZ	CKCON2</span></pre>
<pre id="l1375"><span class="adr">E52A</span>	CD 06 F2        	<span id="code1375">CALL	CONST	</span><span class="cmt">;nothing in buffer. Check console.</span></pre>
<pre id="l1376"><span class="adr">E52D</span>	E6 01           	<span id="code1376">ANI	01H	</span><span class="cmt">;look at bit 0.</span></pre>
<pre id="l1377"><span class="adr">E52F</span>	C8              	<span id="code1377">RZ		</span><span class="cmt">;return if nothing.</span></pre>
<pre id="l1378"><span class="adr">E530</span>	CD 09 F2        	<span id="code1378">CALL	CONIN	</span><span class="cmt">;ok, get it.</span></pre>
<pre id="l1379"><span class="adr">E533</span>	FE 13           	<span id="code1379">CPI	CNTRLS	</span><span class="cmt">;if not control-s, return with zero cleared.</span></pre>
<pre id="l1380"><span class="adr">E535</span>	C2 42 E5        	<span id="code1380">JNZ	CKCON1</span></pre>
<pre id="l1381"><span class="adr">E538</span>	CD 09 F2        	<span id="code1381">CALL	CONIN	</span><span class="cmt">;halt processing until another char</span></pre>
<pre id="l1382"><span class="adr">E53B</span>	FE 03           	<span id="code1382">CPI	CNTRLC	</span><span class="cmt">;is typed. Control-c?</span></pre>
<pre id="l1383"><span class="adr">E53D</span>	CA 00 00        	<span id="code1383">JZ	0	</span><span class="cmt">;yes, reboot now.</span></pre>
<pre id="l1384"><span class="adr">E540</span>	AF              	<span id="code1384">XRA	A	</span><span class="cmt">;no, just pretend nothing was ever ready.</span></pre>
<pre id="l1385"><span class="adr">E541</span>	C9              	<span id="code1385">RET</span></pre>
<pre id="l1386"><span class="adr">E542</span>	32 0E E7        <span class="l" id="label1386">CKCON1</span>	<span id="code1386">STA	CHARBUF	</span><span class="cmt">;save character in buffer for later processing.</span></pre>
<pre id="l1387"><span class="adr">E545</span>	3E 01           <span class="l" id="label1387">CKCON2</span>	<span id="code1387">MVI	A,1	</span><span class="cmt">;set (A) to non zero to mean something is ready.</span></pre>
<pre id="l1388"><span class="adr">E547</span>	C9              	<span id="code1388">RET</span></pre>
<pre id="l1389"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1390"><span class="adr"></span>	                <span class="cmt">;   Output (C) to the screen. If the printer flip-flop flag</span></pre>
<pre id="l1391"><span class="adr"></span>	                <span class="cmt">; is set, we will send character to printer also. The console</span></pre>
<pre id="l1392"><span class="adr"></span>	                <span class="cmt">; will be checked in the process.</span></pre>
<pre id="l1393"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1394"><span class="adr">E548</span>	3A 0A E7        <span class="l" id="label1394">OUTCHAR</span>	<span id="code1394">LDA	OUTFLAG	</span><span class="cmt">;check output flag.</span></pre>
<pre id="l1395"><span class="adr">E54B</span>	B7              	<span id="code1395">ORA	A	</span><span class="cmt">;anything and we won't generate output.</span></pre>
<pre id="l1396"><span class="adr">E54C</span>	C2 62 E5        	<span id="code1396">JNZ	OUTCHR1</span></pre>
<pre id="l1397"><span class="adr">E54F</span>	C5              	<span id="code1397">PUSH	B</span></pre>
<pre id="l1398"><span class="adr">E550</span>	CD 23 E5        	<span id="code1398">CALL	CKCONSOL</span><span class="cmt">;check console (we don't care whats there).</span></pre>
<pre id="l1399"><span class="adr">E553</span>	C1              	<span id="code1399">POP	B</span></pre>
<pre id="l1400"><span class="adr">E554</span>	C5              	<span id="code1400">PUSH	B</span></pre>
<pre id="l1401"><span class="adr">E555</span>	CD 0C F2        	<span id="code1401">CALL	CONOUT	</span><span class="cmt">;output (C) to the screen.</span></pre>
<pre id="l1402"><span class="adr">E558</span>	C1              	<span id="code1402">POP	B</span></pre>
<pre id="l1403"><span class="adr">E559</span>	C5              	<span id="code1403">PUSH	B</span></pre>
<pre id="l1404"><span class="adr">E55A</span>	3A 0D E7        	<span id="code1404">LDA	PRTFLAG	</span><span class="cmt">;check printer flip-flop flag.</span></pre>
<pre id="l1405"><span class="adr">E55D</span>	B7              	<span id="code1405">ORA	A</span></pre>
<pre id="l1406"><span class="adr">E55E</span>	C4 0F F2        	<span id="code1406">CNZ	LIST	</span><span class="cmt">;print it also if non-zero.</span></pre>
<pre id="l1407"><span class="adr">E561</span>	C1              	<span id="code1407">POP	B</span></pre>
<pre id="l1408"><span class="adr">E562</span>	79              <span class="l" id="label1408">OUTCHR1</span>	<span id="code1408">MOV	A,C	</span><span class="cmt">;update cursors position.</span></pre>
<pre id="l1409"><span class="adr">E563</span>	21 0C E7        	<span id="code1409">LXI	H,CURPOS</span></pre>
<pre id="l1410"><span class="adr">E566</span>	FE 7F           	<span id="code1410">CPI	DEL	</span><span class="cmt">;rubouts don't do anything here.</span></pre>
<pre id="l1411"><span class="adr">E568</span>	C8              	<span id="code1411">RZ</span></pre>
<pre id="l1412"><span class="adr">E569</span>	34              	<span id="code1412">INR	M	</span><span class="cmt">;bump line pointer.</span></pre>
<pre id="l1413"><span class="adr">E56A</span>	FE 20           	<span id="code1413">CPI	' '	</span><span class="cmt">;and return if a normal character.</span></pre>
<pre id="l1414"><span class="adr">E56C</span>	D0              	<span id="code1414">RNC</span></pre>
<pre id="l1415"><span class="adr">E56D</span>	35              	<span id="code1415">DCR	M	</span><span class="cmt">;restore and check for the start of the line.</span></pre>
<pre id="l1416"><span class="adr">E56E</span>	7E              	<span id="code1416">MOV	A,M</span></pre>
<pre id="l1417"><span class="adr">E56F</span>	B7              	<span id="code1417">ORA	A</span></pre>
<pre id="l1418"><span class="adr">E570</span>	C8              	<span id="code1418">RZ		</span><span class="cmt">;ingnore control characters at the start of the line.</span></pre>
<pre id="l1419"><span class="adr">E571</span>	79              	<span id="code1419">MOV	A,C</span></pre>
<pre id="l1420"><span class="adr">E572</span>	FE 08           	<span id="code1420">CPI	BS	</span><span class="cmt">;is it a backspace?</span></pre>
<pre id="l1421"><span class="adr">E574</span>	C2 79 E5        	<span id="code1421">JNZ	OUTCHR2</span></pre>
<pre id="l1422"><span class="adr">E577</span>	35              	<span id="code1422">DCR	M	</span><span class="cmt">;yes, backup pointer.</span></pre>
<pre id="l1423"><span class="adr">E578</span>	C9              	<span id="code1423">RET</span></pre>
<pre id="l1424"><span class="adr">E579</span>	FE 0A           <span class="l" id="label1424">OUTCHR2</span>	<span id="code1424">CPI	LF	</span><span class="cmt">;is it a line feed?</span></pre>
<pre id="l1425"><span class="adr">E57B</span>	C0              	<span id="code1425">RNZ		</span><span class="cmt">;ignore anything else.</span></pre>
<pre id="l1426"><span class="adr">E57C</span>	36 00           	<span id="code1426">MVI	M,0	</span><span class="cmt">;reset pointer to start of line.</span></pre>
<pre id="l1427"><span class="adr">E57E</span>	C9              	<span id="code1427">RET</span></pre>
<pre id="l1428"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1429"><span class="adr"></span>	                <span class="cmt">;   Output (A) to the screen. If it is a control character</span></pre>
<pre id="l1430"><span class="adr"></span>	                <span class="cmt">; (other than carriage control), use ^x format.</span></pre>
<pre id="l1431"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1432"><span class="adr">E57F</span>	79              <span class="l" id="label1432">SHOWIT</span>	<span id="code1432">MOV	A,C</span></pre>
<pre id="l1433"><span class="adr">E580</span>	CD 14 E5        	<span id="code1433">CALL	CHKCHAR	</span><span class="cmt">;check character.</span></pre>
<pre id="l1434"><span class="adr">E583</span>	D2 90 E5        	<span id="code1434">JNC	OUTCON	</span><span class="cmt">;not a control, use normal output.</span></pre>
<pre id="l1435"><span class="adr">E586</span>	F5              	<span id="code1435">PUSH	PSW</span></pre>
<pre id="l1436"><span class="adr">E587</span>	0E 5E           	<span id="code1436">MVI	C,'^'	</span><span class="cmt">;for a control character, preceed it with '^'.</span></pre>
<pre id="l1437"><span class="adr">E589</span>	CD 48 E5        	<span id="code1437">CALL	OUTCHAR</span></pre>
<pre id="l1438"><span class="adr">E58C</span>	F1              	<span id="code1438">POP	PSW</span></pre>
<pre id="l1439"><span class="adr">E58D</span>	F6 40           	<span id="code1439">ORI	'@'	</span><span class="cmt">;and then use the letter equivelant.</span></pre>
<pre id="l1440"><span class="adr">E58F</span>	4F              	<span id="code1440">MOV	C,A</span></pre>
<pre id="l1441"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1442"><span class="adr"></span>	                <span class="cmt">;   Function to output (C) to the console device and expand tabs</span></pre>
<pre id="l1443"><span class="adr"></span>	                <span class="cmt">; if necessary.</span></pre>
<pre id="l1444"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1445"><span class="adr">E590</span>	79              <span class="l" id="label1445">OUTCON</span>	<span id="code1445">MOV	A,C</span></pre>
<pre id="l1446"><span class="adr">E591</span>	FE 09           	<span id="code1446">CPI	TAB	</span><span class="cmt">;is it a tab?</span></pre>
<pre id="l1447"><span class="adr">E593</span>	C2 48 E5        	<span id="code1447">JNZ	OUTCHAR	</span><span class="cmt">;use regular output.</span></pre>
<pre id="l1448"><span class="adr">E596</span>	0E 20           <span class="l" id="label1448">OUTCON1</span>	<span id="code1448">MVI	C,' '	</span><span class="cmt">;yes it is, use spaces instead.</span></pre>
<pre id="l1449"><span class="adr">E598</span>	CD 48 E5        	<span id="code1449">CALL	OUTCHAR</span></pre>
<pre id="l1450"><span class="adr">E59B</span>	3A 0C E7        	<span id="code1450">LDA	CURPOS	</span><span class="cmt">;go until the cursor is at a multiple of 8</span></pre>
<pre id="l1451"><span class="adr"></span>	                <span id="code1451"></span></pre>
<pre id="l1452"><span class="adr">E59E</span>	E6 07           	<span id="code1452">ANI	07H	</span><span class="cmt">;position.</span></pre>
<pre id="l1453"><span class="adr">E5A0</span>	C2 96 E5        	<span id="code1453">JNZ	OUTCON1</span></pre>
<pre id="l1454"><span class="adr">E5A3</span>	C9              	<span id="code1454">RET</span></pre>
<pre id="l1455"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1456"><span class="adr"></span>	                <span class="cmt">;   Echo a backspace character. Erase the prevoius character</span></pre>
<pre id="l1457"><span class="adr"></span>	                <span class="cmt">; on the screen.</span></pre>
<pre id="l1458"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1459"><span class="adr">E5A4</span>	CD AC E5        <span class="l" id="label1459">BACKUP</span>	<span id="code1459">CALL	BACKUP1	</span><span class="cmt">;backup the screen 1 place.</span></pre>
<pre id="l1460"><span class="adr">E5A7</span>	0E 20           	<span id="code1460">MVI	C,' '	</span><span class="cmt">;then blank that character.</span></pre>
<pre id="l1461"><span class="adr">E5A9</span>	CD 0C F2        	<span id="code1461">CALL	CONOUT</span></pre>
<pre id="l1462"><span class="adr">E5AC</span>	0E 08           <span class="l" id="label1462">BACKUP1</span>	<span id="code1462">MVI	C,BS	</span><span class="cmt">;then back space once more.</span></pre>
<pre id="l1463"><span class="adr">E5AE</span>	C3 0C F2        	<span id="code1463">JMP	CONOUT</span></pre>
<pre id="l1464"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1465"><span class="adr"></span>	                <span class="cmt">;   Signal a deleted line. Print a '#' at the end and start</span></pre>
<pre id="l1466"><span class="adr"></span>	                <span class="cmt">; over.</span></pre>
<pre id="l1467"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1468"><span class="adr">E5B1</span>	0E 23           <span class="l" id="label1468">NEWLINE</span>	<span id="code1468">MVI	C,'#'</span></pre>
<pre id="l1469"><span class="adr">E5B3</span>	CD 48 E5        	<span id="code1469">CALL	OUTCHAR	</span><span class="cmt">;print this.</span></pre>
<pre id="l1470"><span class="adr">E5B6</span>	CD C9 E5        	<span id="code1470">CALL	OUTCRLF	</span><span class="cmt">;start new line.</span></pre>
<pre id="l1471"><span class="adr">E5B9</span>	3A 0C E7        <span class="l" id="label1471">NEWLN1</span>	<span id="code1471">LDA	CURPOS	</span><span class="cmt">;move the cursor to the starting position.</span></pre>
<pre id="l1472"><span class="adr">E5BC</span>	21 0B E7        	<span id="code1472">LXI	H,STARTING</span></pre>
<pre id="l1473"><span class="adr">E5BF</span>	BE              	<span id="code1473">CMP	M</span></pre>
<pre id="l1474"><span class="adr">E5C0</span>	D0              	<span id="code1474">RNC		</span><span class="cmt">;there yet?</span></pre>
<pre id="l1475"><span class="adr">E5C1</span>	0E 20           	<span id="code1475">MVI	C,' '</span></pre>
<pre id="l1476"><span class="adr">E5C3</span>	CD 48 E5        	<span id="code1476">CALL	OUTCHAR	</span><span class="cmt">;nope, keep going.</span></pre>
<pre id="l1477"><span class="adr">E5C6</span>	C3 B9 E5        	<span id="code1477">JMP	NEWLN1</span></pre>
<pre id="l1478"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1479"><span class="adr"></span>	                <span class="cmt">;   Output a (cr) (lf) to the console device (screen).</span></pre>
<pre id="l1480"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1481"><span class="adr">E5C9</span>	0E 0D           <span class="l" id="label1481">OUTCRLF</span>	<span id="code1481">MVI	C,CR</span></pre>
<pre id="l1482"><span class="adr">E5CB</span>	CD 48 E5        	<span id="code1482">CALL	OUTCHAR</span></pre>
<pre id="l1483"><span class="adr">E5CE</span>	0E 0A           	<span id="code1483">MVI	C,LF</span></pre>
<pre id="l1484"><span class="adr">E5D0</span>	C3 48 E5        	<span id="code1484">JMP	OUTCHAR</span></pre>
<pre id="l1485"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1486"><span class="adr"></span>	                <span class="cmt">;   Print message pointed to by (BC). It will end with a '$'.</span></pre>
<pre id="l1487"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1488"><span class="adr">E5D3</span>	0A              <span class="l" id="label1488">PRTMESG</span>	<span id="code1488">LDAX	B	</span><span class="cmt">;check for terminating character.</span></pre>
<pre id="l1489"><span class="adr">E5D4</span>	FE 24           	<span id="code1489">CPI	'$'</span></pre>
<pre id="l1490"><span class="adr">E5D6</span>	C8              	<span id="code1490">RZ</span></pre>
<pre id="l1491"><span class="adr">E5D7</span>	03              	<span id="code1491">INX	B</span></pre>
<pre id="l1492"><span class="adr">E5D8</span>	C5              	<span id="code1492">PUSH	B	</span><span class="cmt">;otherwise, bump pointer and print it.</span></pre>
<pre id="l1493"><span class="adr">E5D9</span>	4F              	<span id="code1493">MOV	C,A</span></pre>
<pre id="l1494"><span class="adr">E5DA</span>	CD 90 E5        	<span id="code1494">CALL	OUTCON</span></pre>
<pre id="l1495"><span class="adr">E5DD</span>	C1              	<span id="code1495">POP	B</span></pre>
<pre id="l1496"><span class="adr">E5DE</span>	C3 D3 E5        	<span id="code1496">JMP	PRTMESG</span></pre>
<pre id="l1497"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1498"><span class="adr"></span>	                <span class="cmt">;   Function to execute a buffered read.</span></pre>
<pre id="l1499"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1500"><span class="adr">E5E1</span>	3A 0C E7        <span class="l" id="label1500">RDBUFF</span>	<span id="code1500">LDA	CURPOS	</span><span class="cmt">;use present location as starting one.</span></pre>
<pre id="l1501"><span class="adr">E5E4</span>	32 0B E7        	<span id="code1501">STA	STARTING</span></pre>
<pre id="l1502"><span class="adr">E5E7</span>	2A 43 E7        	<span id="code1502">LHLD	PARAMS	</span><span class="cmt">;get the maximum buffer space.</span></pre>
<pre id="l1503"><span class="adr">E5EA</span>	4E              	<span id="code1503">MOV	C,M</span></pre>
<pre id="l1504"><span class="adr">E5EB</span>	23              	<span id="code1504">INX	H	</span><span class="cmt">;point to first available space.</span></pre>
<pre id="l1505"><span class="adr">E5EC</span>	E5              	<span id="code1505">PUSH	H	</span><span class="cmt">;and save.</span></pre>
<pre id="l1506"><span class="adr">E5ED</span>	06 00           	<span id="code1506">MVI	B,0	</span><span class="cmt">;keep a character count.</span></pre>
<pre id="l1507"><span class="adr">E5EF</span>	C5              <span class="l" id="label1507">RDBUF1</span>	<span id="code1507">PUSH	B</span></pre>
<pre id="l1508"><span class="adr">E5F0</span>	E5              	<span id="code1508">PUSH	H</span></pre>
<pre id="l1509"><span class="adr">E5F1</span>	CD FB E4        <span class="l" id="label1509">RDBUF2</span>	<span id="code1509">CALL	GETCHAR	</span><span class="cmt">;get the next input character.</span></pre>
<pre id="l1510"><span class="adr">E5F4</span>	E6 7F           	<span id="code1510">ANI	7FH	</span><span class="cmt">;strip bit 7.</span></pre>
<pre id="l1511"><span class="adr">E5F6</span>	E1              	<span id="code1511">POP	H	</span><span class="cmt">;reset registers.</span></pre>
<pre id="l1512"><span class="adr">E5F7</span>	C1              	<span id="code1512">POP	B</span></pre>
<pre id="l1513"><span class="adr">E5F8</span>	FE 0D           	<span id="code1513">CPI	CR	</span><span class="cmt">;en of the line?</span></pre>
<pre id="l1514"><span class="adr">E5FA</span>	CA C1 E6        	<span id="code1514">JZ	RDBUF17</span></pre>
<pre id="l1515"><span class="adr">E5FD</span>	FE 0A           	<span id="code1515">CPI	LF</span></pre>
<pre id="l1516"><span class="adr">E5FF</span>	CA C1 E6        	<span id="code1516">JZ	RDBUF17</span></pre>
<pre id="l1517"><span class="adr">E602</span>	FE 08           	<span id="code1517">CPI	BS	</span><span class="cmt">;how about a backspace?</span></pre>
<pre id="l1518"><span class="adr">E604</span>	C2 16 E6        	<span id="code1518">JNZ	RDBUF3</span></pre>
<pre id="l1519"><span class="adr">E607</span>	78              	<span id="code1519">MOV	A,B	</span><span class="cmt">;yes, but ignore at the beginning of the line.</span></pre>
<pre id="l1520"><span class="adr">E608</span>	B7              	<span id="code1520">ORA	A</span></pre>
<pre id="l1521"><span class="adr">E609</span>	CA EF E5        	<span id="code1521">JZ	RDBUF1</span></pre>
<pre id="l1522"><span class="adr">E60C</span>	05              	<span id="code1522">DCR	B	</span><span class="cmt">;ok, update counter.</span></pre>
<pre id="l1523"><span class="adr">E60D</span>	3A 0C E7        	<span id="code1523">LDA	CURPOS	</span><span class="cmt">;if we backspace to the start of the line,</span></pre>
<pre id="l1524"><span class="adr">E610</span>	32 0A E7        	<span id="code1524">STA	OUTFLAG	</span><span class="cmt">;treat as a cancel (control-x).</span></pre>
<pre id="l1525"><span class="adr">E613</span>	C3 70 E6        	<span id="code1525">JMP	RDBUF10</span></pre>
<pre id="l1526"><span class="adr">E616</span>	FE 7F           <span class="l" id="label1526">RDBUF3</span>	<span id="code1526">CPI	DEL	</span><span class="cmt">;user typed a rubout?</span></pre>
<pre id="l1527"><span class="adr">E618</span>	C2 26 E6        	<span id="code1527">JNZ	RDBUF4</span></pre>
<pre id="l1528"><span class="adr">E61B</span>	78              	<span id="code1528">MOV	A,B	</span><span class="cmt">;ignore at the start of the line.</span></pre>
<pre id="l1529"><span class="adr">E61C</span>	B7              	<span id="code1529">ORA	A</span></pre>
<pre id="l1530"><span class="adr">E61D</span>	CA EF E5        	<span id="code1530">JZ	RDBUF1</span></pre>
<pre id="l1531"><span class="adr">E620</span>	7E              	<span id="code1531">MOV	A,M	</span><span class="cmt">;ok, echo the prevoius character.</span></pre>
<pre id="l1532"><span class="adr">E621</span>	05              	<span id="code1532">DCR	B	</span><span class="cmt">;and reset pointers (counters).</span></pre>
<pre id="l1533"><span class="adr">E622</span>	2B              	<span id="code1533">DCX	H</span></pre>
<pre id="l1534"><span class="adr">E623</span>	C3 A9 E6        	<span id="code1534">JMP	RDBUF15</span></pre>
<pre id="l1535"><span class="adr">E626</span>	FE 05           <span class="l" id="label1535">RDBUF4</span>	<span id="code1535">CPI	CNTRLE	</span><span class="cmt">;physical end of line?</span></pre>
<pre id="l1536"><span class="adr">E628</span>	C2 37 E6        	<span id="code1536">JNZ	RDBUF5</span></pre>
<pre id="l1537"><span class="adr">E62B</span>	C5              	<span id="code1537">PUSH	B	</span><span class="cmt">;yes, do it.</span></pre>
<pre id="l1538"><span class="adr">E62C</span>	E5              	<span id="code1538">PUSH	H</span></pre>
<pre id="l1539"><span class="adr">E62D</span>	CD C9 E5        	<span id="code1539">CALL	OUTCRLF</span></pre>
<pre id="l1540"><span class="adr">E630</span>	AF              	<span id="code1540">XRA	A	</span><span class="cmt">;and update starting position.</span></pre>
<pre id="l1541"><span class="adr">E631</span>	32 0B E7        	<span id="code1541">STA	STARTING</span></pre>
<pre id="l1542"><span class="adr">E634</span>	C3 F1 E5        	<span id="code1542">JMP	RDBUF2</span></pre>
<pre id="l1543"><span class="adr">E637</span>	FE 10           <span class="l" id="label1543">RDBUF5</span>	<span id="code1543">CPI	CNTRLP	</span><span class="cmt">;control-p?</span></pre>
<pre id="l1544"><span class="adr">E639</span>	C2 48 E6        	<span id="code1544">JNZ	RDBUF6</span></pre>
<pre id="l1545"><span class="adr">E63C</span>	E5              	<span id="code1545">PUSH	H	</span><span class="cmt">;yes, flip the print flag filp-flop byte.</span></pre>
<pre id="l1546"><span class="adr">E63D</span>	21 0D E7        	<span id="code1546">LXI	H,PRTFLAG</span></pre>
<pre id="l1547"><span class="adr">E640</span>	3E 01           	<span id="code1547">MVI	A,1	</span><span class="cmt">;PRTFLAG=1-PRTFLAG</span></pre>
<pre id="l1548"><span class="adr">E642</span>	96              	<span id="code1548">SUB	M</span></pre>
<pre id="l1549"><span class="adr">E643</span>	77              	<span id="code1549">MOV	M,A</span></pre>
<pre id="l1550"><span class="adr">E644</span>	E1              	<span id="code1550">POP	H</span></pre>
<pre id="l1551"><span class="adr">E645</span>	C3 EF E5        	<span id="code1551">JMP	RDBUF1</span></pre>
<pre id="l1552"><span class="adr">E648</span>	FE 18           <span class="l" id="label1552">RDBUF6</span>	<span id="code1552">CPI	CNTRLX	</span><span class="cmt">;control-x (cancel)?</span></pre>
<pre id="l1553"><span class="adr">E64A</span>	C2 5F E6        	<span id="code1553">JNZ	RDBUF8</span></pre>
<pre id="l1554"><span class="adr">E64D</span>	E1              	<span id="code1554">POP	H</span></pre>
<pre id="l1555"><span class="adr">E64E</span>	3A 0B E7        <span class="l" id="label1555">RDBUF7</span>	<span id="code1555">LDA	STARTING</span><span class="cmt">;yes, backup the cursor to here.</span></pre>
<pre id="l1556"><span class="adr">E651</span>	21 0C E7        	<span id="code1556">LXI	H,CURPOS</span></pre>
<pre id="l1557"><span class="adr">E654</span>	BE              	<span id="code1557">CMP	M</span></pre>
<pre id="l1558"><span class="adr">E655</span>	D2 E1 E5        	<span id="code1558">JNC	RDBUFF	</span><span class="cmt">;done yet?</span></pre>
<pre id="l1559"><span class="adr">E658</span>	35              	<span id="code1559">DCR	M	</span><span class="cmt">;no, decrement pointer and output back up one space.</span></pre>
<pre id="l1560"><span class="adr">E659</span>	CD A4 E5        	<span id="code1560">CALL	BACKUP</span></pre>
<pre id="l1561"><span class="adr">E65C</span>	C3 4E E6        	<span id="code1561">JMP	RDBUF7</span></pre>
<pre id="l1562"><span class="adr">E65F</span>	FE 15           <span class="l" id="label1562">RDBUF8</span>	<span id="code1562">CPI	CNTRLU	</span><span class="cmt">;cntrol-u (cancel line)?</span></pre>
<pre id="l1563"><span class="adr">E661</span>	C2 6B E6        	<span id="code1563">JNZ	RDBUF9</span></pre>
<pre id="l1564"><span class="adr">E664</span>	CD B1 E5        	<span id="code1564">CALL	NEWLINE	</span><span class="cmt">;start a new line.</span></pre>
<pre id="l1565"><span class="adr">E667</span>	E1              	<span id="code1565">POP	H</span></pre>
<pre id="l1566"><span class="adr">E668</span>	C3 E1 E5        	<span id="code1566">JMP	RDBUFF</span></pre>
<pre id="l1567"><span class="adr">E66B</span>	FE 12           <span class="l" id="label1567">RDBUF9</span>	<span id="code1567">CPI	CNTRLR	</span><span class="cmt">;control-r?</span></pre>
<pre id="l1568"><span class="adr">E66D</span>	C2 A6 E6        	<span id="code1568">JNZ	RDBUF14</span></pre>
<pre id="l1569"><span class="adr">E670</span>	C5              <span class="l" id="label1569">RDBUF10</span>	<span id="code1569">PUSH	B	</span><span class="cmt">;yes, start a new line and retype the old one.</span></pre>
<pre id="l1570"><span class="adr">E671</span>	CD B1 E5        	<span id="code1570">CALL	NEWLINE</span></pre>
<pre id="l1571"><span class="adr">E674</span>	C1              	<span id="code1571">POP	B</span></pre>
<pre id="l1572"><span class="adr">E675</span>	E1              	<span id="code1572">POP	H</span></pre>
<pre id="l1573"><span class="adr">E676</span>	E5              	<span id="code1573">PUSH	H</span></pre>
<pre id="l1574"><span class="adr">E677</span>	C5              	<span id="code1574">PUSH	B</span></pre>
<pre id="l1575"><span class="adr">E678</span>	78              <span class="l" id="label1575">RDBUF11</span>	<span id="code1575">MOV	A,B	</span><span class="cmt">;done whole line yet?</span></pre>
<pre id="l1576"><span class="adr">E679</span>	B7              	<span id="code1576">ORA	A</span></pre>
<pre id="l1577"><span class="adr">E67A</span>	CA 8A E6        	<span id="code1577">JZ	RDBUF12</span></pre>
<pre id="l1578"><span class="adr">E67D</span>	23              	<span id="code1578">INX	H	</span><span class="cmt">;nope, get next character.</span></pre>
<pre id="l1579"><span class="adr">E67E</span>	4E              	<span id="code1579">MOV	C,M</span></pre>
<pre id="l1580"><span class="adr">E67F</span>	05              	<span id="code1580">DCR	B	</span><span class="cmt">;count it.</span></pre>
<pre id="l1581"><span class="adr">E680</span>	C5              	<span id="code1581">PUSH	B</span></pre>
<pre id="l1582"><span class="adr">E681</span>	E5              	<span id="code1582">PUSH	H</span></pre>
<pre id="l1583"><span class="adr">E682</span>	CD 7F E5        	<span id="code1583">CALL	SHOWIT	</span><span class="cmt">;and display it.</span></pre>
<pre id="l1584"><span class="adr">E685</span>	E1              	<span id="code1584">POP	H</span></pre>
<pre id="l1585"><span class="adr">E686</span>	C1              	<span id="code1585">POP	B</span></pre>
<pre id="l1586"><span class="adr">E687</span>	C3 78 E6        	<span id="code1586">JMP	RDBUF11</span></pre>
<pre id="l1587"><span class="adr">E68A</span>	E5              <span class="l" id="label1587">RDBUF12</span>	<span id="code1587">PUSH	H	</span><span class="cmt">;done with line. If we were displaying</span></pre>
<pre id="l1588"><span class="adr">E68B</span>	3A 0A E7        	<span id="code1588">LDA	OUTFLAG	</span><span class="cmt">;then update cursor position.</span></pre>
<pre id="l1589"><span class="adr">E68E</span>	B7              	<span id="code1589">ORA	A</span></pre>
<pre id="l1590"><span class="adr">E68F</span>	CA F1 E5        	<span id="code1590">JZ	RDBUF2</span></pre>
<pre id="l1591"><span class="adr">E692</span>	21 0C E7        	<span id="code1591">LXI	H,CURPOS</span><span class="cmt">;because this line is shorter, we must</span></pre>
<pre id="l1592"><span class="adr">E695</span>	96              	<span id="code1592">SUB	M	</span><span class="cmt">;back up the cursor (not the screen however)</span></pre>
<pre id="l1593"><span class="adr">E696</span>	32 0A E7        	<span id="code1593">STA	OUTFLAG	</span><span class="cmt">;some number of positions.</span></pre>
<pre id="l1594"><span class="adr">E699</span>	CD A4 E5        <span class="l" id="label1594">RDBUF13</span>	<span id="code1594">CALL	BACKUP	</span><span class="cmt">;note that as long as (OUTFLAG) is non</span></pre>
<pre id="l1595"><span class="adr">E69C</span>	21 0A E7        	<span id="code1595">LXI	H,OUTFLAG</span><span class="cmt">;zero, the screen will not be changed.</span></pre>
<pre id="l1596"><span class="adr">E69F</span>	35              	<span id="code1596">DCR	M</span></pre>
<pre id="l1597"><span class="adr">E6A0</span>	C2 99 E6        	<span id="code1597">JNZ	RDBUF13</span></pre>
<pre id="l1598"><span class="adr">E6A3</span>	C3 F1 E5        	<span id="code1598">JMP	RDBUF2	</span><span class="cmt">;now just get the next character.</span></pre>
<pre id="l1599"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1600"><span class="adr"></span>	                <span class="cmt">;   Just a normal character, put this in our buffer and echo.</span></pre>
<pre id="l1601"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1602"><span class="adr">E6A6</span>	23              <span class="l" id="label1602">RDBUF14</span>	<span id="code1602">INX	H</span></pre>
<pre id="l1603"><span class="adr">E6A7</span>	77              	<span id="code1603">MOV	M,A	</span><span class="cmt">;store character.</span></pre>
<pre id="l1604"><span class="adr">E6A8</span>	04              	<span id="code1604">INR	B	</span><span class="cmt">;and count it.</span></pre>
<pre id="l1605"><span class="adr">E6A9</span>	C5              <span class="l" id="label1605">RDBUF15</span>	<span id="code1605">PUSH	B</span></pre>
<pre id="l1606"><span class="adr">E6AA</span>	E5              	<span id="code1606">PUSH	H</span></pre>
<pre id="l1607"><span class="adr">E6AB</span>	4F              	<span id="code1607">MOV	C,A	</span><span class="cmt">;echo it now.</span></pre>
<pre id="l1608"><span class="adr">E6AC</span>	CD 7F E5        	<span id="code1608">CALL	SHOWIT</span></pre>
<pre id="l1609"><span class="adr">E6AF</span>	E1              	<span id="code1609">POP	H</span></pre>
<pre id="l1610"><span class="adr">E6B0</span>	C1              	<span id="code1610">POP	B</span></pre>
<pre id="l1611"><span class="adr">E6B1</span>	7E              	<span id="code1611">MOV	A,M	</span><span class="cmt">;was it an abort request?</span></pre>
<pre id="l1612"><span class="adr">E6B2</span>	FE 03           	<span id="code1612">CPI	CNTRLC	</span><span class="cmt">;control-c abort?</span></pre>
<pre id="l1613"><span class="adr">E6B4</span>	78              	<span id="code1613">MOV	A,B</span></pre>
<pre id="l1614"><span class="adr">E6B5</span>	C2 BD E6        	<span id="code1614">JNZ	RDBUF16</span></pre>
<pre id="l1615"><span class="adr">E6B8</span>	FE 01           	<span id="code1615">CPI	1	</span><span class="cmt">;only if at start of line.</span></pre>
<pre id="l1616"><span class="adr">E6BA</span>	CA 00 00        	<span id="code1616">JZ	0</span></pre>
<pre id="l1617"><span class="adr">E6BD</span>	B9              <span class="l" id="label1617">RDBUF16</span>	<span id="code1617">CMP	C	</span><span class="cmt">;nope, have we filled the buffer?</span></pre>
<pre id="l1618"><span class="adr">E6BE</span>	DA EF E5        	<span id="code1618">JC	RDBUF1</span></pre>
<pre id="l1619"><span class="adr">E6C1</span>	E1              <span class="l" id="label1619">RDBUF17</span>	<span id="code1619">POP	H	</span><span class="cmt">;yes end the line and return.</span></pre>
<pre id="l1620"><span class="adr">E6C2</span>	70              	<span id="code1620">MOV	M,B</span></pre>
<pre id="l1621"><span class="adr">E6C3</span>	0E 0D           	<span id="code1621">MVI	C,CR</span></pre>
<pre id="l1622"><span class="adr">E6C5</span>	C3 48 E5        	<span id="code1622">JMP	OUTCHAR	</span><span class="cmt">;output (cr) and return.</span></pre>
<pre id="l1623"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1624"><span class="adr"></span>	                <span class="cmt">;   Function to get a character from the console device.</span></pre>
<pre id="l1625"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1626"><span class="adr">E6C8</span>	CD 06 E5        <span class="l" id="label1626">GETCON</span>	<span id="code1626">CALL	GETECHO	</span><span class="cmt">;get and echo.</span></pre>
<pre id="l1627"><span class="adr">E6CB</span>	C3 01 E7        	<span id="code1627">JMP	SETSTAT	</span><span class="cmt">;save status and return.</span></pre>
<pre id="l1628"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1629"><span class="adr"></span>	                <span class="cmt">;   Function to get a character from the tape reader device.</span></pre>
<pre id="l1630"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1631"><span class="adr">E6CE</span>	CD 15 F2        <span class="l" id="label1631">GETRDR</span>	<span id="code1631">CALL	READER	</span><span class="cmt">;get a character from reader, set status and return.</span></pre>
<pre id="l1632"><span class="adr">E6D1</span>	C3 01 E7        	<span id="code1632">JMP	SETSTAT</span></pre>
<pre id="l1633"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1634"><span class="adr"></span>	                <span class="cmt">;  Function to perform direct console i/o. If (C) contains (FF)</span></pre>
<pre id="l1635"><span class="adr"></span>	                <span class="cmt">; then this is an input request. If (C) contains (FE) then</span></pre>
<pre id="l1636"><span class="adr"></span>	                <span class="cmt">; this is a status request. Otherwise we are to output (C).</span></pre>
<pre id="l1637"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1638"><span class="adr">E6D4</span>	79              <span class="l" id="label1638">DIRCIO</span>	<span id="code1638">MOV	A,C	</span><span class="cmt">;test for (FF).</span></pre>
<pre id="l1639"><span class="adr">E6D5</span>	3C              	<span id="code1639">INR	A</span></pre>
<pre id="l1640"><span class="adr">E6D6</span>	CA E0 E6        	<span id="code1640">JZ	DIRC1</span></pre>
<pre id="l1641"><span class="adr">E6D9</span>	3C              	<span id="code1641">INR	A	</span><span class="cmt">;test for (FE).</span></pre>
<pre id="l1642"><span class="adr">E6DA</span>	CA 06 F2        	<span id="code1642">JZ	CONST</span></pre>
<pre id="l1643"><span class="adr">E6DD</span>	C3 0C F2        	<span id="code1643">JMP	CONOUT	</span><span class="cmt">;just output (C).</span></pre>
<pre id="l1644"><span class="adr">E6E0</span>	CD 06 F2        <span class="l" id="label1644">DIRC1</span>	<span id="code1644">CALL	CONST	</span><span class="cmt">;this is an input request.</span></pre>
<pre id="l1645"><span class="adr">E6E3</span>	B7              	<span id="code1645">ORA	A</span></pre>
<pre id="l1646"><span class="adr">E6E4</span>	CA 91 F1        	<span id="code1646">JZ	GOBACK1	</span><span class="cmt">;not ready? Just return (directly).</span></pre>
<pre id="l1647"><span class="adr">E6E7</span>	CD 09 F2        	<span id="code1647">CALL	CONIN	</span><span class="cmt">;yes, get character.</span></pre>
<pre id="l1648"><span class="adr">E6EA</span>	C3 01 E7        	<span id="code1648">JMP	SETSTAT	</span><span class="cmt">;set status and return.</span></pre>
<pre id="l1649"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1650"><span class="adr"></span>	                <span class="cmt">;   Function to return the i/o byte.</span></pre>
<pre id="l1651"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1652"><span class="adr">E6ED</span>	3A 03 00        <span class="l" id="label1652">GETIOB</span>	<span id="code1652">LDA	IOBYTE</span></pre>
<pre id="l1653"><span class="adr">E6F0</span>	C3 01 E7        	<span id="code1653">JMP	SETSTAT</span></pre>
<pre id="l1654"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1655"><span class="adr"></span>	                <span class="cmt">;   Function to set the i/o byte.</span></pre>
<pre id="l1656"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1657"><span class="adr">E6F3</span>	21 03 00        <span class="l" id="label1657">SETIOB</span>	<span id="code1657">LXI	H,IOBYTE</span></pre>
<pre id="l1658"><span class="adr">E6F6</span>	71              	<span id="code1658">MOV	M,C</span></pre>
<pre id="l1659"><span class="adr">E6F7</span>	C9              	<span id="code1659">RET</span></pre>
<pre id="l1660"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1661"><span class="adr"></span>	                <span class="cmt">;   Function to print the character string pointed to by (DE)</span></pre>
<pre id="l1662"><span class="adr"></span>	                <span class="cmt">; on the console device. The string ends with a '$'.</span></pre>
<pre id="l1663"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1664"><span class="adr">E6F8</span>	EB              <span class="l" id="label1664">PRTSTR</span>	<span id="code1664">XCHG</span></pre>
<pre id="l1665"><span class="adr">E6F9</span>	4D              	<span id="code1665">MOV	C,L</span></pre>
<pre id="l1666"><span class="adr">E6FA</span>	44              	<span id="code1666">MOV	B,H	</span><span class="cmt">;now (BC) points to it.</span></pre>
<pre id="l1667"><span class="adr">E6FB</span>	C3 D3 E5        	<span id="code1667">JMP	PRTMESG</span></pre>
<pre id="l1668"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1669"><span class="adr"></span>	                <span class="cmt">;   Function to interigate the console device.</span></pre>
<pre id="l1670"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1671"><span class="adr">E6FE</span>	CD 23 E5        <span class="l" id="label1671">GETCSTS</span>	<span id="code1671">CALL	CKCONSOL</span></pre>
<pre id="l1672"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1673"><span class="adr"></span>	                <span class="cmt">;   Get here to set the status and return to the cleanup</span></pre>
<pre id="l1674"><span class="adr"></span>	                <span class="cmt">; section. Then back to the user.</span></pre>
<pre id="l1675"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1676"><span class="adr">E701</span>	32 45 E7        <span class="l" id="label1676">SETSTAT</span>	<span id="code1676">STA	STATUS</span></pre>
<pre id="l1677"><span class="adr">E704</span>	C9              <span class="l" id="label1677">RTN</span>	<span id="code1677">RET</span></pre>
<pre id="l1678"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1679"><span class="adr"></span>	                <span class="cmt">;   Set the status to 1 (read or write error code).</span></pre>
<pre id="l1680"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1681"><span class="adr">E705</span>	3E 01           <span class="l" id="label1681">IOERR1</span>	<span id="code1681">MVI	A,1</span></pre>
<pre id="l1682"><span class="adr">E707</span>	C3 01 E7        	<span id="code1682">JMP	SETSTAT</span></pre>
<pre id="l1683"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1684"><span class="adr">E70A</span>	00              <span class="l" id="label1684">OUTFLAG</span>	<span id="code1684">DB	0	</span><span class="cmt">;output flag (non zero means no output).</span></pre>
<pre id="l1685"><span class="adr">E70B</span>	02              <span class="l" id="label1685">STARTING</span><span id="code1685">:DB	2	</span><span class="cmt">;starting position for cursor.</span></pre>
<pre id="l1686"><span class="adr">E70C</span>	00              <span class="l" id="label1686">CURPOS</span>	<span id="code1686">DB	0	</span><span class="cmt">;cursor position (0=start of line).</span></pre>
<pre id="l1687"><span class="adr">E70D</span>	00              <span class="l" id="label1687">PRTFLAG</span>	<span id="code1687">DB	0	</span><span class="cmt">;printer flag (control-p toggle). List if non zero.</span></pre>
<pre id="l1688"><span class="adr">E70E</span>	00              <span class="l" id="label1688">CHARBUF</span>	<span id="code1688">DB	0	</span><span class="cmt">;single input character buffer.</span></pre>
<pre id="l1689"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1690"><span class="adr"></span>	                <span class="cmt">;   Stack area for BDOS calls.</span></pre>
<pre id="l1691"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1692"><span class="adr">E70F</span>	00 00           <span class="l" id="label1692">USRSTACK</span><span id="code1692">:DW	0	</span><span class="cmt">;save users stack pointer here.</span></pre>
<pre id="l1693"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1694"><span class="adr">E711</span>	00 00 00 00     	<span id="code1694">DB	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0</span><br/>	.&nbsp;.&nbsp;.&nbsp;<br/>E725	00 00 00 00 <br/></pre>
<pre id="l1695"><span class="adr">E729</span>	00 00 00 00     	<span id="code1695">DB	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0</span><br/>	.&nbsp;.&nbsp;.&nbsp;<br/>E73D	00 00 00 00 <br/></pre>
<pre id="l1696"><span class="adr"></span>	                <span class="l" id="label1696">STKAREA</span>	<span id="code1696">EQU	$	</span><span class="cmt">;end of stack area.</span></pre>
<pre id="l1697"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1698"><span class="adr">E741</span>	00              <span class="l" id="label1698">USERNO</span>	<span id="code1698">DB	0	</span><span class="cmt">;current user number.</span></pre>
<pre id="l1699"><span class="adr">E742</span>	00              <span class="l" id="label1699">ACTIVE</span>	<span id="code1699">DB	0	</span><span class="cmt">;currently active drive.</span></pre>
<pre id="l1700"><span class="adr">E743</span>	00 00           <span class="l" id="label1700">PARAMS</span>	<span id="code1700">DW	0	</span><span class="cmt">;save (DE) parameters here on entry.</span></pre>
<pre id="l1701"><span class="adr">E745</span>	00 00           <span class="l" id="label1701">STATUS</span>	<span id="code1701">DW	0	</span><span class="cmt">;status returned from bdos function.</span></pre>
<pre id="l1702"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1703"><span class="adr"></span>	                <span class="cmt">;   Select error occured, jump to error routine.</span></pre>
<pre id="l1704"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1705"><span class="adr">E747</span>	21 0B E4        <span class="l" id="label1705">SLCTERR</span>	<span id="code1705">LXI	H,BADSLCT</span></pre>
<pre id="l1706"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1707"><span class="adr"></span>	                <span class="cmt">;   Jump to (HL) indirectly.</span></pre>
<pre id="l1708"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1709"><span class="adr">E74A</span>	5E              <span class="l" id="label1709">JUMPHL</span>	<span id="code1709">MOV	E,M</span></pre>
<pre id="l1710"><span class="adr">E74B</span>	23              	<span id="code1710">INX	H</span></pre>
<pre id="l1711"><span class="adr">E74C</span>	56              	<span id="code1711">MOV	D,M	</span><span class="cmt">;now (DE) contain the desired address.</span></pre>
<pre id="l1712"><span class="adr">E74D</span>	EB              	<span id="code1712">XCHG</span></pre>
<pre id="l1713"><span class="adr">E74E</span>	E9              	<span id="code1713">PCHL</span></pre>
<pre id="l1714"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1715"><span class="adr"></span>	                <span class="cmt">;   Block move. (DE) to (HL), (C) bytes total.</span></pre>
<pre id="l1716"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1717"><span class="adr">E74F</span>	0C              <span class="l" id="label1717">DE2HL</span>	<span id="code1717">INR	C	</span><span class="cmt">;is count down to zero?</span></pre>
<pre id="l1718"><span class="adr">E750</span>	0D              <span class="l" id="label1718">DE2HL1</span>	<span id="code1718">DCR	C</span></pre>
<pre id="l1719"><span class="adr">E751</span>	C8              	<span id="code1719">RZ		</span><span class="cmt">;yes, we are done.</span></pre>
<pre id="l1720"><span class="adr">E752</span>	1A              	<span id="code1720">LDAX	D	</span><span class="cmt">;no, move one more byte.</span></pre>
<pre id="l1721"><span class="adr">E753</span>	77              	<span id="code1721">MOV	M,A</span></pre>
<pre id="l1722"><span class="adr">E754</span>	13              	<span id="code1722">INX	D</span></pre>
<pre id="l1723"><span class="adr">E755</span>	23              	<span id="code1723">INX	H</span></pre>
<pre id="l1724"><span class="adr">E756</span>	C3 50 E7        	<span id="code1724">JMP	DE2HL1	</span><span class="cmt">;and repeat.</span></pre>
<pre id="l1725"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1726"><span class="adr"></span>	                <span class="cmt">;   Select the desired drive.</span></pre>
<pre id="l1727"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1728"><span class="adr">E759</span>	3A 42 E7        <span class="l" id="label1728">SELECT</span>	<span id="code1728">LDA	ACTIVE	</span><span class="cmt">;get active disk.</span></pre>
<pre id="l1729"><span class="adr">E75C</span>	4F              	<span id="code1729">MOV	C,A</span></pre>
<pre id="l1730"><span class="adr">E75D</span>	CD 1B F2        	<span id="code1730">CALL	SELDSK	</span><span class="cmt">;select it.</span></pre>
<pre id="l1731"><span class="adr">E760</span>	7C              	<span id="code1731">MOV	A,H	</span><span class="cmt">;valid drive?</span></pre>
<pre id="l1732"><span class="adr">E761</span>	B5              	<span id="code1732">ORA	L	</span><span class="cmt">;valid drive?</span></pre>
<pre id="l1733"><span class="adr">E762</span>	C8              	<span id="code1733">RZ		</span><span class="cmt">;return if not.</span></pre>
<pre id="l1734"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1735"><span class="adr"></span>	                <span class="cmt">;   Here, the BIOS returned the address of the parameter block</span></pre>
<pre id="l1736"><span class="adr"></span>	                <span class="cmt">; in (HL). We will extract the necessary pointers and save them.</span></pre>
<pre id="l1737"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1738"><span class="adr">E763</span>	5E              	<span id="code1738">MOV	E,M	</span><span class="cmt">;yes, get address of translation table into (DE).</span></pre>
<pre id="l1739"><span class="adr">E764</span>	23              	<span id="code1739">INX	H</span></pre>
<pre id="l1740"><span class="adr">E765</span>	56              	<span id="code1740">MOV	D,M</span></pre>
<pre id="l1741"><span class="adr">E766</span>	23              	<span id="code1741">INX	H</span></pre>
<pre id="l1742"><span class="adr">E767</span>	22 B3 F1        	<span id="code1742">SHLD	SCRATCH1	</span><span class="cmt">;save pointers to scratch areas.</span></pre>
<pre id="l1743"><span class="adr">E76A</span>	23              	<span id="code1743">INX	H</span></pre>
<pre id="l1744"><span class="adr">E76B</span>	23              	<span id="code1744">INX	H</span></pre>
<pre id="l1745"><span class="adr">E76C</span>	22 B5 F1        	<span id="code1745">SHLD	SCRATCH2	</span><span class="cmt">;ditto.</span></pre>
<pre id="l1746"><span class="adr">E76F</span>	23              	<span id="code1746">INX	H</span></pre>
<pre id="l1747"><span class="adr">E770</span>	23              	<span id="code1747">INX	H</span></pre>
<pre id="l1748"><span class="adr">E771</span>	22 B7 F1        	<span id="code1748">SHLD	SCRATCH3	</span><span class="cmt">;ditto.</span></pre>
<pre id="l1749"><span class="adr">E774</span>	23              	<span id="code1749">INX	H</span></pre>
<pre id="l1750"><span class="adr">E775</span>	23              	<span id="code1750">INX	H</span></pre>
<pre id="l1751"><span class="adr">E776</span>	EB              	<span id="code1751">XCHG		</span><span class="cmt">;now save the translation table address.</span></pre>
<pre id="l1752"><span class="adr">E777</span>	22 D0 F1        	<span id="code1752">SHLD	XLATE</span></pre>
<pre id="l1753"><span class="adr">E77A</span>	21 B9 F1        	<span id="code1753">LXI	H,DIRBUF	</span><span class="cmt">;put the next 8 bytes here.</span></pre>
<pre id="l1754"><span class="adr">E77D</span>	0E 08           	<span id="code1754">MVI	C,8	</span><span class="cmt">;they consist of the directory buffer</span></pre>
<pre id="l1755"><span class="adr">E77F</span>	CD 4F E7        	<span id="code1755">CALL	DE2HL	</span><span class="cmt">;pointer, parameter block pointer,</span></pre>
<pre id="l1756"><span class="adr">E782</span>	2A BB F1        	<span id="code1756">LHLD	DISKPB	</span><span class="cmt">;check and allocation vectors.</span></pre>
<pre id="l1757"><span class="adr">E785</span>	EB              	<span id="code1757">XCHG</span></pre>
<pre id="l1758"><span class="adr">E786</span>	21 C1 F1        	<span id="code1758">LXI	H,SECTORS	</span><span class="cmt">;move parameter block into our ram.</span></pre>
<pre id="l1759"><span class="adr">E789</span>	0E 0F           	<span id="code1759">MVI	C,15	</span><span class="cmt">;it is 15 bytes long.</span></pre>
<pre id="l1760"><span class="adr">E78B</span>	CD 4F E7        	<span id="code1760">CALL	DE2HL</span></pre>
<pre id="l1761"><span class="adr">E78E</span>	2A C6 F1        	<span id="code1761">LHLD	DSKSIZE	</span><span class="cmt">;check disk size.</span></pre>
<pre id="l1762"><span class="adr">E791</span>	7C              	<span id="code1762">MOV	A,H	</span><span class="cmt">;more than 256 blocks on this?</span></pre>
<pre id="l1763"><span class="adr">E792</span>	21 DD F1        	<span id="code1763">LXI	H,BIGDISK</span></pre>
<pre id="l1764"><span class="adr">E795</span>	36 FF           	<span id="code1764">MVI	M,0FFH	</span><span class="cmt">;set to samll.</span></pre>
<pre id="l1765"><span class="adr">E797</span>	B7              	<span id="code1765">ORA	A</span></pre>
<pre id="l1766"><span class="adr">E798</span>	CA 9D E7        	<span id="code1766">JZ	SELECT1</span></pre>
<pre id="l1767"><span class="adr">E79B</span>	36 00           	<span id="code1767">MVI	M,0	</span><span class="cmt">;wrong, set to large.</span></pre>
<pre id="l1768"><span class="adr">E79D</span>	3E FF           <span class="l" id="label1768">SELECT1</span>	<span id="code1768">MVI	A,0FFH	</span><span class="cmt">;clear the zero flag.</span></pre>
<pre id="l1769"><span class="adr">E79F</span>	B7              	<span id="code1769">ORA	A</span></pre>
<pre id="l1770"><span class="adr">E7A0</span>	C9              	<span id="code1770">RET</span></pre>
<pre id="l1771"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1772"><span class="adr"></span>	                <span class="cmt">;   Routine to home the disk track head and clear pointers.</span></pre>
<pre id="l1773"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1774"><span class="adr">E7A1</span>	CD 18 F2        <span class="l" id="label1774">HOMEDRV</span>	<span id="code1774">CALL	HOME	</span><span class="cmt">;home the head.</span></pre>
<pre id="l1775"><span class="adr">E7A4</span>	AF              	<span id="code1775">XRA	A</span></pre>
<pre id="l1776"><span class="adr">E7A5</span>	2A B5 F1        	<span id="code1776">LHLD	SCRATCH2</span><span class="cmt">;set our track pointer also.</span></pre>
<pre id="l1777"><span class="adr">E7A8</span>	77              	<span id="code1777">MOV	M,A</span></pre>
<pre id="l1778"><span class="adr">E7A9</span>	23              	<span id="code1778">INX	H</span></pre>
<pre id="l1779"><span class="adr">E7AA</span>	77              	<span id="code1779">MOV	M,A</span></pre>
<pre id="l1780"><span class="adr">E7AB</span>	2A B7 F1        	<span id="code1780">LHLD	SCRATCH3</span><span class="cmt">;and our sector pointer.</span></pre>
<pre id="l1781"><span class="adr">E7AE</span>	77              	<span id="code1781">MOV	M,A</span></pre>
<pre id="l1782"><span class="adr">E7AF</span>	23              	<span id="code1782">INX	H</span></pre>
<pre id="l1783"><span class="adr">E7B0</span>	77              	<span id="code1783">MOV	M,A</span></pre>
<pre id="l1784"><span class="adr">E7B1</span>	C9              	<span id="code1784">RET</span></pre>
<pre id="l1785"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1786"><span class="adr"></span>	                <span class="cmt">;   Do the actual disk read and check the error return status.</span></pre>
<pre id="l1787"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1788"><span class="adr">E7B2</span>	CD 27 F2        <span class="l" id="label1788">DOREAD</span>	<span id="code1788">CALL	READ</span></pre>
<pre id="l1789"><span class="adr">E7B5</span>	C3 BB E7        	<span id="code1789">JMP	IORET</span></pre>
<pre id="l1790"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1791"><span class="adr"></span>	                <span class="cmt">;   Do the actual disk write and handle any bios error.</span></pre>
<pre id="l1792"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1793"><span class="adr">E7B8</span>	CD 2A F2        <span class="l" id="label1793">DOWRITE</span>	<span id="code1793">CALL	WRITE</span></pre>
<pre id="l1794"><span class="adr">E7BB</span>	B7              <span class="l" id="label1794">IORET</span>	<span id="code1794">ORA	A</span></pre>
<pre id="l1795"><span class="adr">E7BC</span>	C8              	<span id="code1795">RZ		</span><span class="cmt">;return unless an error occured.</span></pre>
<pre id="l1796"><span class="adr">E7BD</span>	21 09 E4        	<span id="code1796">LXI	H,BADSCTR</span><span class="cmt">;bad read/write on this sector.</span></pre>
<pre id="l1797"><span class="adr">E7C0</span>	C3 4A E7        	<span id="code1797">JMP	JUMPHL</span></pre>
<pre id="l1798"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1799"><span class="adr"></span>	                <span class="cmt">;   Routine to select the track and sector that the desired</span></pre>
<pre id="l1800"><span class="adr"></span>	                <span class="cmt">; block number falls in.</span></pre>
<pre id="l1801"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1802"><span class="adr">E7C3</span>	2A EA F1        <span class="l" id="label1802">TRKSEC</span>	<span id="code1802">LHLD	FILEPOS	</span><span class="cmt">;get position of last accessed file</span></pre>
<pre id="l1803"><span class="adr">E7C6</span>	0E 02           	<span id="code1803">MVI	C,2	</span><span class="cmt">;in directory and compute sector #.</span></pre>
<pre id="l1804"><span class="adr">E7C8</span>	CD EA E8        	<span id="code1804">CALL	SHIFTR	</span><span class="cmt">;sector #=file-position/4.</span></pre>
<pre id="l1805"><span class="adr">E7CB</span>	22 E5 F1        	<span id="code1805">SHLD	BLKNMBR	</span><span class="cmt">;save this as the block number of interest.</span></pre>
<pre id="l1806"><span class="adr">E7CE</span>	22 EC F1        	<span id="code1806">SHLD	CKSUMTBL</span><span class="cmt">;what's it doing here too?</span></pre>
<pre id="l1807"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1808"><span class="adr"></span>	                <span class="cmt">;   if the sector number has already been set (BLKNMBR), enter</span></pre>
<pre id="l1809"><span class="adr"></span>	                <span class="cmt">; at this point.</span></pre>
<pre id="l1810"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1811"><span class="adr">E7D1</span>	21 E5 F1        <span class="l" id="label1811">TRKSEC1</span>	<span id="code1811">LXI	H,BLKNMBR</span></pre>
<pre id="l1812"><span class="adr">E7D4</span>	4E              	<span id="code1812">MOV	C,M	</span><span class="cmt">;move sector number into (BC).</span></pre>
<pre id="l1813"><span class="adr">E7D5</span>	23              	<span id="code1813">INX	H</span></pre>
<pre id="l1814"><span class="adr">E7D6</span>	46              	<span id="code1814">MOV	B,M</span></pre>
<pre id="l1815"><span class="adr">E7D7</span>	2A B7 F1        	<span id="code1815">LHLD	SCRATCH3</span><span class="cmt">;get current sector number and</span></pre>
<pre id="l1816"><span class="adr">E7DA</span>	5E              	<span id="code1816">MOV	E,M	</span><span class="cmt">;move this into (DE).</span></pre>
<pre id="l1817"><span class="adr">E7DB</span>	23              	<span id="code1817">INX	H</span></pre>
<pre id="l1818"><span class="adr">E7DC</span>	56              	<span id="code1818">MOV	D,M</span></pre>
<pre id="l1819"><span class="adr">E7DD</span>	2A B5 F1        	<span id="code1819">LHLD	SCRATCH2</span><span class="cmt">;get current track number.</span></pre>
<pre id="l1820"><span class="adr">E7E0</span>	7E              	<span id="code1820">MOV	A,M	</span><span class="cmt">;and this into (HL).</span></pre>
<pre id="l1821"><span class="adr">E7E1</span>	23              	<span id="code1821">INX	H</span></pre>
<pre id="l1822"><span class="adr">E7E2</span>	66              	<span id="code1822">MOV	H,M</span></pre>
<pre id="l1823"><span class="adr">E7E3</span>	6F              	<span id="code1823">MOV	L,A</span></pre>
<pre id="l1824"><span class="adr">E7E4</span>	79              <span class="l" id="label1824">TRKSEC2</span>	<span id="code1824">MOV	A,C	</span><span class="cmt">;is desired sector before current one?</span></pre>
<pre id="l1825"><span class="adr">E7E5</span>	93              	<span id="code1825">SUB	E</span></pre>
<pre id="l1826"><span class="adr">E7E6</span>	78              	<span id="code1826">MOV	A,B</span></pre>
<pre id="l1827"><span class="adr">E7E7</span>	9A              	<span id="code1827">SBB	D</span></pre>
<pre id="l1828"><span class="adr">E7E8</span>	D2 FA E7        	<span id="code1828">JNC	TRKSEC3</span></pre>
<pre id="l1829"><span class="adr">E7EB</span>	E5              	<span id="code1829">PUSH	H	</span><span class="cmt">;yes, decrement sectors by one track.</span></pre>
<pre id="l1830"><span class="adr">E7EC</span>	2A C1 F1        	<span id="code1830">LHLD	SECTORS	</span><span class="cmt">;get sectors per track.</span></pre>
<pre id="l1831"><span class="adr">E7EF</span>	7B              	<span id="code1831">MOV	A,E</span></pre>
<pre id="l1832"><span class="adr">E7F0</span>	95              	<span id="code1832">SUB	L</span></pre>
<pre id="l1833"><span class="adr">E7F1</span>	5F              	<span id="code1833">MOV	E,A</span></pre>
<pre id="l1834"><span class="adr">E7F2</span>	7A              	<span id="code1834">MOV	A,D</span></pre>
<pre id="l1835"><span class="adr">E7F3</span>	9C              	<span id="code1835">SBB	H</span></pre>
<pre id="l1836"><span class="adr">E7F4</span>	57              	<span id="code1836">MOV	D,A	</span><span class="cmt">;now we have backed up one full track.</span></pre>
<pre id="l1837"><span class="adr">E7F5</span>	E1              	<span id="code1837">POP	H</span></pre>
<pre id="l1838"><span class="adr">E7F6</span>	2B              	<span id="code1838">DCX	H	</span><span class="cmt">;adjust track counter.</span></pre>
<pre id="l1839"><span class="adr">E7F7</span>	C3 E4 E7        	<span id="code1839">JMP	TRKSEC2</span></pre>
<pre id="l1840"><span class="adr">E7FA</span>	E5              <span class="l" id="label1840">TRKSEC3</span>	<span id="code1840">PUSH	H	</span><span class="cmt">;desired sector is after current one.</span></pre>
<pre id="l1841"><span class="adr">E7FB</span>	2A C1 F1        	<span id="code1841">LHLD	SECTORS	</span><span class="cmt">;get sectors per track.</span></pre>
<pre id="l1842"><span class="adr">E7FE</span>	19              	<span id="code1842">DAD	D	</span><span class="cmt">;bump sector pointer to next track.</span></pre>
<pre id="l1843"><span class="adr">E7FF</span>	DA 0F E8        	<span id="code1843">JC	TRKSEC4</span></pre>
<pre id="l1844"><span class="adr">E802</span>	79              	<span id="code1844">MOV	A,C	</span><span class="cmt">;is desired sector now before current one?</span></pre>
<pre id="l1845"><span class="adr">E803</span>	95              	<span id="code1845">SUB	L</span></pre>
<pre id="l1846"><span class="adr">E804</span>	78              	<span id="code1846">MOV	A,B</span></pre>
<pre id="l1847"><span class="adr">E805</span>	9C              	<span id="code1847">SBB	H</span></pre>
<pre id="l1848"><span class="adr">E806</span>	DA 0F E8        	<span id="code1848">JC	TRKSEC4</span></pre>
<pre id="l1849"><span class="adr">E809</span>	EB              	<span id="code1849">XCHG		</span><span class="cmt">;not yes, increment track counter</span></pre>
<pre id="l1850"><span class="adr">E80A</span>	E1              	<span id="code1850">POP	H	</span><span class="cmt">;and continue until it is.</span></pre>
<pre id="l1851"><span class="adr">E80B</span>	23              	<span id="code1851">INX	H</span></pre>
<pre id="l1852"><span class="adr">E80C</span>	C3 FA E7        	<span id="code1852">JMP	TRKSEC3</span></pre>
<pre id="l1853"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1854"><span class="adr"></span>	                <span class="cmt">;   here we have determined the track number that contains the</span></pre>
<pre id="l1855"><span class="adr"></span>	                <span class="cmt">; desired sector.</span></pre>
<pre id="l1856"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1857"><span class="adr">E80F</span>	E1              <span class="l" id="label1857">TRKSEC4</span>	<span id="code1857">POP	H	</span><span class="cmt">;get track number (HL).</span></pre>
<pre id="l1858"><span class="adr">E810</span>	C5              	<span id="code1858">PUSH	B</span></pre>
<pre id="l1859"><span class="adr">E811</span>	D5              	<span id="code1859">PUSH	D</span></pre>
<pre id="l1860"><span class="adr">E812</span>	E5              	<span id="code1860">PUSH	H</span></pre>
<pre id="l1861"><span class="adr">E813</span>	EB              	<span id="code1861">XCHG</span></pre>
<pre id="l1862"><span class="adr">E814</span>	2A CE F1        	<span id="code1862">LHLD	OFFSET	</span><span class="cmt">;adjust for first track offset.</span></pre>
<pre id="l1863"><span class="adr">E817</span>	19              	<span id="code1863">DAD	D</span></pre>
<pre id="l1864"><span class="adr">E818</span>	44              	<span id="code1864">MOV	B,H</span></pre>
<pre id="l1865"><span class="adr">E819</span>	4D              	<span id="code1865">MOV	C,L</span></pre>
<pre id="l1866"><span class="adr">E81A</span>	CD 1E F2        	<span id="code1866">CALL	SETTRK	</span><span class="cmt">;select this track.</span></pre>
<pre id="l1867"><span class="adr">E81D</span>	D1              	<span id="code1867">POP	D	</span><span class="cmt">;reset current track pointer.</span></pre>
<pre id="l1868"><span class="adr">E81E</span>	2A B5 F1        	<span id="code1868">LHLD	SCRATCH2</span></pre>
<pre id="l1869"><span class="adr">E821</span>	73              	<span id="code1869">MOV	M,E</span></pre>
<pre id="l1870"><span class="adr">E822</span>	23              	<span id="code1870">INX	H</span></pre>
<pre id="l1871"><span class="adr">E823</span>	72              	<span id="code1871">MOV	M,D</span></pre>
<pre id="l1872"><span class="adr">E824</span>	D1              	<span id="code1872">POP	D</span></pre>
<pre id="l1873"><span class="adr">E825</span>	2A B7 F1        	<span id="code1873">LHLD	SCRATCH3</span><span class="cmt">;reset the first sector on this track.</span></pre>
<pre id="l1874"><span class="adr">E828</span>	73              	<span id="code1874">MOV	M,E</span></pre>
<pre id="l1875"><span class="adr">E829</span>	23              	<span id="code1875">INX	H</span></pre>
<pre id="l1876"><span class="adr">E82A</span>	72              	<span id="code1876">MOV	M,D</span></pre>
<pre id="l1877"><span class="adr">E82B</span>	C1              	<span id="code1877">POP	B</span></pre>
<pre id="l1878"><span class="adr">E82C</span>	79              	<span id="code1878">MOV	A,C	</span><span class="cmt">;now subtract the desired one.</span></pre>
<pre id="l1879"><span class="adr">E82D</span>	93              	<span id="code1879">SUB	E	</span><span class="cmt">;to make it relative (1-# sectors/track).</span></pre>
<pre id="l1880"><span class="adr">E82E</span>	4F              	<span id="code1880">MOV	C,A</span></pre>
<pre id="l1881"><span class="adr">E82F</span>	78              	<span id="code1881">MOV	A,B</span></pre>
<pre id="l1882"><span class="adr">E830</span>	9A              	<span id="code1882">SBB	D</span></pre>
<pre id="l1883"><span class="adr">E831</span>	47              	<span id="code1883">MOV	B,A</span></pre>
<pre id="l1884"><span class="adr">E832</span>	2A D0 F1        	<span id="code1884">LHLD	XLATE	</span><span class="cmt">;translate this sector according to this table.</span></pre>
<pre id="l1885"><span class="adr">E835</span>	EB              	<span id="code1885">XCHG</span></pre>
<pre id="l1886"><span class="adr">E836</span>	CD 30 F2        	<span id="code1886">CALL	SECTRN	</span><span class="cmt">;let the bios translate it.</span></pre>
<pre id="l1887"><span class="adr">E839</span>	4D              	<span id="code1887">MOV	C,L</span></pre>
<pre id="l1888"><span class="adr">E83A</span>	44              	<span id="code1888">MOV	B,H</span></pre>
<pre id="l1889"><span class="adr">E83B</span>	C3 21 F2        	<span id="code1889">JMP	SETSEC	</span><span class="cmt">;and select it.</span></pre>
<pre id="l1890"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1891"><span class="adr"></span>	                <span class="cmt">;   Compute block number from record number (SAVNREC) and</span></pre>
<pre id="l1892"><span class="adr"></span>	                <span class="cmt">; extent number (SAVEXT).</span></pre>
<pre id="l1893"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1894"><span class="adr">E83E</span>	21 C3 F1        <span class="l" id="label1894">GETBLOCK</span><span id="code1894">:LXI	H,BLKSHFT</span><span class="cmt">;get logical to physical conversion.</span></pre>
<pre id="l1895"><span class="adr">E841</span>	4E              	<span id="code1895">MOV	C,M	</span><span class="cmt">;note that this is base 2 log of ratio.</span></pre>
<pre id="l1896"><span class="adr">E842</span>	3A E3 F1        	<span id="code1896">LDA	SAVNREC	</span><span class="cmt">;get record number.</span></pre>
<pre id="l1897"><span class="adr">E845</span>	B7              <span class="l" id="label1897">GETBLK1</span>	<span id="code1897">ORA	A	</span><span class="cmt">;compute (A)=(A)/2^BLKSHFT.</span></pre>
<pre id="l1898"><span class="adr">E846</span>	1F              	<span id="code1898">RAR</span></pre>
<pre id="l1899"><span class="adr">E847</span>	0D              	<span id="code1899">DCR	C</span></pre>
<pre id="l1900"><span class="adr">E848</span>	C2 45 E8        	<span id="code1900">JNZ	GETBLK1</span></pre>
<pre id="l1901"><span class="adr">E84B</span>	47              	<span id="code1901">MOV	B,A	</span><span class="cmt">;save result in (B).</span></pre>
<pre id="l1902"><span class="adr">E84C</span>	3E 08           	<span id="code1902">MVI	A,8</span></pre>
<pre id="l1903"><span class="adr">E84E</span>	96              	<span id="code1903">SUB	M</span></pre>
<pre id="l1904"><span class="adr">E84F</span>	4F              	<span id="code1904">MOV	C,A	</span><span class="cmt">;compute (C)=8-BLKSHFT.</span></pre>
<pre id="l1905"><span class="adr">E850</span>	3A E2 F1        	<span id="code1905">LDA	SAVEXT</span></pre>
<pre id="l1906"><span class="adr">E853</span>	0D              <span class="l" id="label1906">GETBLK2</span>	<span id="code1906">DCR	C	</span><span class="cmt">;compute (A)=SAVEXT*2^(8-BLKSHFT).</span></pre>
<pre id="l1907"><span class="adr">E854</span>	CA 5C E8        	<span id="code1907">JZ	GETBLK3</span></pre>
<pre id="l1908"><span class="adr">E857</span>	B7              	<span id="code1908">ORA	A</span></pre>
<pre id="l1909"><span class="adr">E858</span>	17              	<span id="code1909">RAL</span></pre>
<pre id="l1910"><span class="adr">E859</span>	C3 53 E8        	<span id="code1910">JMP	GETBLK2</span></pre>
<pre id="l1911"><span class="adr">E85C</span>	80              <span class="l" id="label1911">GETBLK3</span>	<span id="code1911">ADD	B</span></pre>
<pre id="l1912"><span class="adr">E85D</span>	C9              	<span id="code1912">RET</span></pre>
<pre id="l1913"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1914"><span class="adr"></span>	                <span class="cmt">;   Routine to extract the (BC) block byte from the fcb pointed</span></pre>
<pre id="l1915"><span class="adr"></span>	                <span class="cmt">; to by (PARAMS). If this is a big-disk, then these are 16 bit</span></pre>
<pre id="l1916"><span class="adr"></span>	                <span class="cmt">; block numbers, else they are 8 bit numbers.</span></pre>
<pre id="l1917"><span class="adr"></span>	                <span class="cmt">; Number is returned in (HL).</span></pre>
<pre id="l1918"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1919"><span class="adr">E85E</span>	2A 43 E7        <span class="l" id="label1919">EXTBLK</span>	<span id="code1919">LHLD	PARAMS	</span><span class="cmt">;get fcb address.</span></pre>
<pre id="l1920"><span class="adr">E861</span>	11 10 00        	<span id="code1920">LXI	D,16	</span><span class="cmt">;block numbers start 16 bytes into fcb.</span></pre>
<pre id="l1921"><span class="adr">E864</span>	19              	<span id="code1921">DAD	D</span></pre>
<pre id="l1922"><span class="adr">E865</span>	09              	<span id="code1922">DAD	B</span></pre>
<pre id="l1923"><span class="adr">E866</span>	3A DD F1        	<span id="code1923">LDA	BIGDISK	</span><span class="cmt">;are we using a big-disk?</span></pre>
<pre id="l1924"><span class="adr">E869</span>	B7              	<span id="code1924">ORA	A</span></pre>
<pre id="l1925"><span class="adr">E86A</span>	CA 71 E8        	<span id="code1925">JZ	EXTBLK1</span></pre>
<pre id="l1926"><span class="adr">E86D</span>	6E              	<span id="code1926">MOV	L,M	</span><span class="cmt">;no, extract an 8 bit number from the fcb.</span></pre>
<pre id="l1927"><span class="adr">E86E</span>	26 00           	<span id="code1927">MVI	H,0</span></pre>
<pre id="l1928"><span class="adr">E870</span>	C9              	<span id="code1928">RET</span></pre>
<pre id="l1929"><span class="adr">E871</span>	09              <span class="l" id="label1929">EXTBLK1</span>	<span id="code1929">DAD	B	</span><span class="cmt">;yes, extract a 16 bit number.</span></pre>
<pre id="l1930"><span class="adr">E872</span>	5E              	<span id="code1930">MOV	E,M</span></pre>
<pre id="l1931"><span class="adr">E873</span>	23              	<span id="code1931">INX	H</span></pre>
<pre id="l1932"><span class="adr">E874</span>	56              	<span id="code1932">MOV	D,M</span></pre>
<pre id="l1933"><span class="adr">E875</span>	EB              	<span id="code1933">XCHG		</span><span class="cmt">;return in (HL).</span></pre>
<pre id="l1934"><span class="adr">E876</span>	C9              	<span id="code1934">RET</span></pre>
<pre id="l1935"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1936"><span class="adr"></span>	                <span class="cmt">;   Compute block number.</span></pre>
<pre id="l1937"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1938"><span class="adr">E877</span>	CD 3E E8        <span class="l" id="label1938">COMBLK</span>	<span id="code1938">CALL	GETBLOCK</span></pre>
<pre id="l1939"><span class="adr">E87A</span>	4F              	<span id="code1939">MOV	C,A</span></pre>
<pre id="l1940"><span class="adr">E87B</span>	06 00           	<span id="code1940">MVI	B,0</span></pre>
<pre id="l1941"><span class="adr">E87D</span>	CD 5E E8        	<span id="code1941">CALL	EXTBLK</span></pre>
<pre id="l1942"><span class="adr">E880</span>	22 E5 F1        	<span id="code1942">SHLD	BLKNMBR</span></pre>
<pre id="l1943"><span class="adr">E883</span>	C9              	<span id="code1943">RET</span></pre>
<pre id="l1944"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1945"><span class="adr"></span>	                <span class="cmt">;   Check for a zero block number (unused).</span></pre>
<pre id="l1946"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1947"><span class="adr">E884</span>	2A E5 F1        <span class="l" id="label1947">CHKBLK</span>	<span id="code1947">LHLD	BLKNMBR</span></pre>
<pre id="l1948"><span class="adr">E887</span>	7D              	<span id="code1948">MOV	A,L	</span><span class="cmt">;is it zero?</span></pre>
<pre id="l1949"><span class="adr">E888</span>	B4              	<span id="code1949">ORA	H</span></pre>
<pre id="l1950"><span class="adr">E889</span>	C9              	<span id="code1950">RET</span></pre>
<pre id="l1951"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1952"><span class="adr"></span>	                <span class="cmt">;   Adjust physical block (BLKNMBR) and convert to logical</span></pre>
<pre id="l1953"><span class="adr"></span>	                <span class="cmt">; sector (LOGSECT). This is the starting sector of this block.</span></pre>
<pre id="l1954"><span class="adr"></span>	                <span class="cmt">; The actual sector of interest is then added to this and the</span></pre>
<pre id="l1955"><span class="adr"></span>	                <span class="cmt">; resulting sector number is stored back in (BLKNMBR). This</span></pre>
<pre id="l1956"><span class="adr"></span>	                <span class="cmt">; will still have to be adjusted for the track number.</span></pre>
<pre id="l1957"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1958"><span class="adr">E88A</span>	3A C3 F1        <span class="l" id="label1958">LOGICAL</span>	<span id="code1958">LDA	BLKSHFT	</span><span class="cmt">;get log2(physical/logical sectors).</span></pre>
<pre id="l1959"><span class="adr">E88D</span>	2A E5 F1        	<span id="code1959">LHLD	BLKNMBR	</span><span class="cmt">;get physical sector desired.</span></pre>
<pre id="l1960"><span class="adr">E890</span>	29              <span class="l" id="label1960">LOGICL1</span>	<span id="code1960">DAD	H	</span><span class="cmt">;compute logical sector number.</span></pre>
<pre id="l1961"><span class="adr">E891</span>	3D              	<span id="code1961">DCR	A	</span><span class="cmt">;note logical sectors are 128 bytes long.</span></pre>
<pre id="l1962"><span class="adr">E892</span>	C2 90 E8        	<span id="code1962">JNZ	LOGICL1</span></pre>
<pre id="l1963"><span class="adr">E895</span>	22 E7 F1        	<span id="code1963">SHLD	LOGSECT	</span><span class="cmt">;save logical sector.</span></pre>
<pre id="l1964"><span class="adr">E898</span>	3A C4 F1        	<span id="code1964">LDA	BLKMASK	</span><span class="cmt">;get block mask.</span></pre>
<pre id="l1965"><span class="adr">E89B</span>	4F              	<span id="code1965">MOV	C,A</span></pre>
<pre id="l1966"><span class="adr">E89C</span>	3A E3 F1        	<span id="code1966">LDA	SAVNREC	</span><span class="cmt">;get next sector to access.</span></pre>
<pre id="l1967"><span class="adr">E89F</span>	A1              	<span id="code1967">ANA	C	</span><span class="cmt">;extract the relative position within physical block.</span></pre>
<pre id="l1968"><span class="adr">E8A0</span>	B5              	<span id="code1968">ORA	L	</span><span class="cmt">;and add it too logical sector.</span></pre>
<pre id="l1969"><span class="adr">E8A1</span>	6F              	<span id="code1969">MOV	L,A</span></pre>
<pre id="l1970"><span class="adr">E8A2</span>	22 E5 F1        	<span id="code1970">SHLD	BLKNMBR	</span><span class="cmt">;and store.</span></pre>
<pre id="l1971"><span class="adr">E8A5</span>	C9              	<span id="code1971">RET</span></pre>
<pre id="l1972"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1973"><span class="adr"></span>	                <span class="cmt">;   Set (HL) to point to extent byte in fcb.</span></pre>
<pre id="l1974"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1975"><span class="adr">E8A6</span>	2A 43 E7        <span class="l" id="label1975">SETEXT</span>	<span id="code1975">LHLD	PARAMS</span></pre>
<pre id="l1976"><span class="adr">E8A9</span>	11 0C 00        	<span id="code1976">LXI	D,12	</span><span class="cmt">;it is the twelth byte.</span></pre>
<pre id="l1977"><span class="adr">E8AC</span>	19              	<span id="code1977">DAD	D</span></pre>
<pre id="l1978"><span class="adr">E8AD</span>	C9              	<span id="code1978">RET</span></pre>
<pre id="l1979"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1980"><span class="adr"></span>	                <span class="cmt">;   Set (HL) to point to record count byte in fcb and (DE) to</span></pre>
<pre id="l1981"><span class="adr"></span>	                <span class="cmt">; next record number byte.</span></pre>
<pre id="l1982"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1983"><span class="adr">E8AE</span>	2A 43 E7        <span class="l" id="label1983">SETHLDE</span>	<span id="code1983">LHLD	PARAMS</span></pre>
<pre id="l1984"><span class="adr">E8B1</span>	11 0F 00        	<span id="code1984">LXI	D,15	</span><span class="cmt">;record count byte (#15).</span></pre>
<pre id="l1985"><span class="adr">E8B4</span>	19              	<span id="code1985">DAD	D</span></pre>
<pre id="l1986"><span class="adr">E8B5</span>	EB              	<span id="code1986">XCHG</span></pre>
<pre id="l1987"><span class="adr">E8B6</span>	21 11 00        	<span id="code1987">LXI	H,17	</span><span class="cmt">;next record number (#32).</span></pre>
<pre id="l1988"><span class="adr">E8B9</span>	19              	<span id="code1988">DAD	D</span></pre>
<pre id="l1989"><span class="adr">E8BA</span>	C9              	<span id="code1989">RET</span></pre>
<pre id="l1990"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1991"><span class="adr"></span>	                <span class="cmt">;   Save current file data from fcb.</span></pre>
<pre id="l1992"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l1993"><span class="adr">E8BB</span>	CD AE E8        <span class="l" id="label1993">STRDATA</span>	<span id="code1993">CALL	SETHLDE</span></pre>
<pre id="l1994"><span class="adr">E8BE</span>	7E              	<span id="code1994">MOV	A,M	</span><span class="cmt">;get and store record count byte.</span></pre>
<pre id="l1995"><span class="adr">E8BF</span>	32 E3 F1        	<span id="code1995">STA	SAVNREC</span></pre>
<pre id="l1996"><span class="adr">E8C2</span>	EB              	<span id="code1996">XCHG</span></pre>
<pre id="l1997"><span class="adr">E8C3</span>	7E              	<span id="code1997">MOV	A,M	</span><span class="cmt">;get and store next record number byte.</span></pre>
<pre id="l1998"><span class="adr">E8C4</span>	32 E1 F1        	<span id="code1998">STA	SAVNXT</span></pre>
<pre id="l1999"><span class="adr">E8C7</span>	CD A6 E8        	<span id="code1999">CALL	SETEXT	</span><span class="cmt">;point to extent byte.</span></pre>
<pre id="l2000"><span class="adr">E8CA</span>	3A C5 F1        	<span id="code2000">LDA	EXTMASK	</span><span class="cmt">;get extent mask.</span></pre>
<pre id="l2001"><span class="adr">E8CD</span>	A6              	<span id="code2001">ANA	M</span></pre>
<pre id="l2002"><span class="adr">E8CE</span>	32 E2 F1        	<span id="code2002">STA	SAVEXT	</span><span class="cmt">;and save extent here.</span></pre>
<pre id="l2003"><span class="adr">E8D1</span>	C9              	<span id="code2003">RET</span></pre>
<pre id="l2004"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2005"><span class="adr"></span>	                <span class="cmt">;   Set the next record to access. If (MODE) is set to 2, then</span></pre>
<pre id="l2006"><span class="adr"></span>	                <span class="cmt">; the last record byte (SAVNREC) has the correct number to access.</span></pre>
<pre id="l2007"><span class="adr"></span>	                <span class="cmt">; For sequential access, (MODE) will be equal to 1.</span></pre>
<pre id="l2008"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2009"><span class="adr">E8D2</span>	CD AE E8        <span class="l" id="label2009">SETNREC</span>	<span id="code2009">CALL	SETHLDE</span></pre>
<pre id="l2010"><span class="adr">E8D5</span>	3A D5 F1        	<span id="code2010">LDA	MODE	</span><span class="cmt">;get sequential flag (=1).</span></pre>
<pre id="l2011"><span class="adr">E8D8</span>	FE 02           	<span id="code2011">CPI	2	</span><span class="cmt">;a 2 indicates that no adder is needed.</span></pre>
<pre id="l2012"><span class="adr">E8DA</span>	C2 DE E8        	<span id="code2012">JNZ	STNREC1</span></pre>
<pre id="l2013"><span class="adr">E8DD</span>	AF              	<span id="code2013">XRA	A	</span><span class="cmt">;clear adder (random access?).</span></pre>
<pre id="l2014"><span class="adr">E8DE</span>	4F              <span class="l" id="label2014">STNREC1</span>	<span id="code2014">MOV	C,A</span></pre>
<pre id="l2015"><span class="adr">E8DF</span>	3A E3 F1        	<span id="code2015">LDA	SAVNREC	</span><span class="cmt">;get last record number.</span></pre>
<pre id="l2016"><span class="adr">E8E2</span>	81              	<span id="code2016">ADD	C	</span><span class="cmt">;increment record count.</span></pre>
<pre id="l2017"><span class="adr">E8E3</span>	77              	<span id="code2017">MOV	M,A	</span><span class="cmt">;and set fcb's next record byte.</span></pre>
<pre id="l2018"><span class="adr">E8E4</span>	EB              	<span id="code2018">XCHG</span></pre>
<pre id="l2019"><span class="adr">E8E5</span>	3A E1 F1        	<span id="code2019">LDA	SAVNXT	</span><span class="cmt">;get next record byte from storage.</span></pre>
<pre id="l2020"><span class="adr">E8E8</span>	77              	<span id="code2020">MOV	M,A	</span><span class="cmt">;and put this into fcb as number of records used.</span></pre>
<pre id="l2021"><span class="adr">E8E9</span>	C9              	<span id="code2021">RET</span></pre>
<pre id="l2022"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2023"><span class="adr"></span>	                <span class="cmt">;   Shift (HL) right (C) bits.</span></pre>
<pre id="l2024"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2025"><span class="adr">E8EA</span>	0C              <span class="l" id="label2025">SHIFTR</span>	<span id="code2025">INR	C</span></pre>
<pre id="l2026"><span class="adr">E8EB</span>	0D              <span class="l" id="label2026">SHIFTR1</span>	<span id="code2026">DCR	C</span></pre>
<pre id="l2027"><span class="adr">E8EC</span>	C8              	<span id="code2027">RZ</span></pre>
<pre id="l2028"><span class="adr">E8ED</span>	7C              	<span id="code2028">MOV	A,H</span></pre>
<pre id="l2029"><span class="adr">E8EE</span>	B7              	<span id="code2029">ORA	A</span></pre>
<pre id="l2030"><span class="adr">E8EF</span>	1F              	<span id="code2030">RAR</span></pre>
<pre id="l2031"><span class="adr">E8F0</span>	67              	<span id="code2031">MOV	H,A</span></pre>
<pre id="l2032"><span class="adr">E8F1</span>	7D              	<span id="code2032">MOV	A,L</span></pre>
<pre id="l2033"><span class="adr">E8F2</span>	1F              	<span id="code2033">RAR</span></pre>
<pre id="l2034"><span class="adr">E8F3</span>	6F              	<span id="code2034">MOV	L,A</span></pre>
<pre id="l2035"><span class="adr">E8F4</span>	C3 EB E8        	<span id="code2035">JMP	SHIFTR1</span></pre>
<pre id="l2036"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2037"><span class="adr"></span>	                <span class="cmt">;   Compute the check-sum for the directory buffer. Return</span></pre>
<pre id="l2038"><span class="adr"></span>	                <span class="cmt">; integer sum in (A).</span></pre>
<pre id="l2039"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2040"><span class="adr">E8F7</span>	0E 80           <span class="l" id="label2040">CHECKSUM</span><span id="code2040">:MVI	C,128	</span><span class="cmt">;length of buffer.</span></pre>
<pre id="l2041"><span class="adr">E8F9</span>	2A B9 F1        	<span id="code2041">LHLD	DIRBUF	</span><span class="cmt">;get its location.</span></pre>
<pre id="l2042"><span class="adr">E8FC</span>	AF              	<span id="code2042">XRA	A	</span><span class="cmt">;clear summation byte.</span></pre>
<pre id="l2043"><span class="adr">E8FD</span>	86              <span class="l" id="label2043">CHKSUM1</span>	<span id="code2043">ADD	M	</span><span class="cmt">;and compute sum ignoring carries.</span></pre>
<pre id="l2044"><span class="adr">E8FE</span>	23              	<span id="code2044">INX	H</span></pre>
<pre id="l2045"><span class="adr">E8FF</span>	0D              	<span id="code2045">DCR	C</span></pre>
<pre id="l2046"><span class="adr">E900</span>	C2 FD E8        	<span id="code2046">JNZ	CHKSUM1</span></pre>
<pre id="l2047"><span class="adr">E903</span>	C9              	<span id="code2047">RET</span></pre>
<pre id="l2048"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2049"><span class="adr"></span>	                <span class="cmt">;   Shift (HL) left (C) bits.</span></pre>
<pre id="l2050"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2051"><span class="adr">E904</span>	0C              <span class="l" id="label2051">SHIFTL</span>	<span id="code2051">INR	C</span></pre>
<pre id="l2052"><span class="adr">E905</span>	0D              <span class="l" id="label2052">SHIFTL1</span>	<span id="code2052">DCR	C</span></pre>
<pre id="l2053"><span class="adr">E906</span>	C8              	<span id="code2053">RZ</span></pre>
<pre id="l2054"><span class="adr">E907</span>	29              	<span id="code2054">DAD	H	</span><span class="cmt">;shift left 1 bit.</span></pre>
<pre id="l2055"><span class="adr">E908</span>	C3 05 E9        	<span id="code2055">JMP	SHIFTL1</span></pre>
<pre id="l2056"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2057"><span class="adr"></span>	                <span class="cmt">;   Routine to set a bit in a 16 bit value contained in (BC).</span></pre>
<pre id="l2058"><span class="adr"></span>	                <span class="cmt">; The bit set depends on the current drive selection.</span></pre>
<pre id="l2059"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2060"><span class="adr">E90B</span>	C5              <span class="l" id="label2060">SETBIT</span>	<span id="code2060">PUSH	B	</span><span class="cmt">;save 16 bit word.</span></pre>
<pre id="l2061"><span class="adr">E90C</span>	3A 42 E7        	<span id="code2061">LDA	ACTIVE	</span><span class="cmt">;get active drive.</span></pre>
<pre id="l2062"><span class="adr">E90F</span>	4F              	<span id="code2062">MOV	C,A</span></pre>
<pre id="l2063"><span class="adr">E910</span>	21 01 00        	<span id="code2063">LXI	H,1</span></pre>
<pre id="l2064"><span class="adr">E913</span>	CD 04 E9        	<span id="code2064">CALL	SHIFTL	</span><span class="cmt">;shift bit 0 into place.</span></pre>
<pre id="l2065"><span class="adr">E916</span>	C1              	<span id="code2065">POP	B	</span><span class="cmt">;now 'or' this with the original word.</span></pre>
<pre id="l2066"><span class="adr">E917</span>	79              	<span id="code2066">MOV	A,C</span></pre>
<pre id="l2067"><span class="adr">E918</span>	B5              	<span id="code2067">ORA	L</span></pre>
<pre id="l2068"><span class="adr">E919</span>	6F              	<span id="code2068">MOV	L,A	</span><span class="cmt">;low byte done, do high byte.</span></pre>
<pre id="l2069"><span class="adr">E91A</span>	78              	<span id="code2069">MOV	A,B</span></pre>
<pre id="l2070"><span class="adr">E91B</span>	B4              	<span id="code2070">ORA	H</span></pre>
<pre id="l2071"><span class="adr">E91C</span>	67              	<span id="code2071">MOV	H,A</span></pre>
<pre id="l2072"><span class="adr">E91D</span>	C9              	<span id="code2072">RET</span></pre>
<pre id="l2073"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2074"><span class="adr"></span>	                <span class="cmt">;   Extract the write protect status bit for the current drive.</span></pre>
<pre id="l2075"><span class="adr"></span>	                <span class="cmt">; The result is returned in (A), bit 0.</span></pre>
<pre id="l2076"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2077"><span class="adr">E91E</span>	2A AD F1        <span class="l" id="label2077">GETWPRT</span>	<span id="code2077">LHLD	WRTPRT	</span><span class="cmt">;get status bytes.</span></pre>
<pre id="l2078"><span class="adr">E921</span>	3A 42 E7        	<span id="code2078">LDA	ACTIVE	</span><span class="cmt">;which drive is current?</span></pre>
<pre id="l2079"><span class="adr">E924</span>	4F              	<span id="code2079">MOV	C,A</span></pre>
<pre id="l2080"><span class="adr">E925</span>	CD EA E8        	<span id="code2080">CALL	SHIFTR	</span><span class="cmt">;shift status such that bit 0 is the</span></pre>
<pre id="l2081"><span class="adr">E928</span>	7D              	<span id="code2081">MOV	A,L	</span><span class="cmt">;one of interest for this drive.</span></pre>
<pre id="l2082"><span class="adr">E929</span>	E6 01           	<span id="code2082">ANI	01H	</span><span class="cmt">;and isolate it.</span></pre>
<pre id="l2083"><span class="adr">E92B</span>	C9              	<span id="code2083">RET</span></pre>
<pre id="l2084"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2085"><span class="adr"></span>	                <span class="cmt">;   Function to write protect the current disk.</span></pre>
<pre id="l2086"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2087"><span class="adr">E92C</span>	21 AD F1        <span class="l" id="label2087">WRTPRTD</span>	<span id="code2087">LXI	H,WRTPRT</span><span class="cmt">;point to status word.</span></pre>
<pre id="l2088"><span class="adr">E92F</span>	4E              	<span id="code2088">MOV	C,M	</span><span class="cmt">;set (BC) equal to the status.</span></pre>
<pre id="l2089"><span class="adr">E930</span>	23              	<span id="code2089">INX	H</span></pre>
<pre id="l2090"><span class="adr">E931</span>	46              	<span id="code2090">MOV	B,M</span></pre>
<pre id="l2091"><span class="adr">E932</span>	CD 0B E9        	<span id="code2091">CALL	SETBIT	</span><span class="cmt">;and set this bit according to current drive.</span></pre>
<pre id="l2092"><span class="adr">E935</span>	22 AD F1        	<span id="code2092">SHLD	WRTPRT	</span><span class="cmt">;then save.</span></pre>
<pre id="l2093"><span class="adr">E938</span>	2A C8 F1        	<span id="code2093">LHLD	DIRSIZE	</span><span class="cmt">;now save directory size limit.</span></pre>
<pre id="l2094"><span class="adr">E93B</span>	23              	<span id="code2094">INX	H	</span><span class="cmt">;remember the last one.</span></pre>
<pre id="l2095"><span class="adr">E93C</span>	EB              	<span id="code2095">XCHG</span></pre>
<pre id="l2096"><span class="adr">E93D</span>	2A B3 F1        	<span id="code2096">LHLD	SCRATCH1</span><span class="cmt">;and store it here.</span></pre>
<pre id="l2097"><span class="adr">E940</span>	73              	<span id="code2097">MOV	M,E	</span><span class="cmt">;put low byte.</span></pre>
<pre id="l2098"><span class="adr">E941</span>	23              	<span id="code2098">INX	H</span></pre>
<pre id="l2099"><span class="adr">E942</span>	72              	<span id="code2099">MOV	M,D	</span><span class="cmt">;then high byte.</span></pre>
<pre id="l2100"><span class="adr">E943</span>	C9              	<span id="code2100">RET</span></pre>
<pre id="l2101"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2102"><span class="adr"></span>	                <span class="cmt">;   Check for a read only file.</span></pre>
<pre id="l2103"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2104"><span class="adr">E944</span>	CD 5E E9        <span class="l" id="label2104">CHKROFL</span>	<span id="code2104">CALL	FCB2HL	</span><span class="cmt">;set (HL) to file entry in directory buffer.</span></pre>
<pre id="l2105"><span class="adr">E947</span>	11 09 00        <span class="l" id="label2105">CKROF1</span>	<span id="code2105">LXI	D,9	</span><span class="cmt">;look at bit 7 of the ninth byte.</span></pre>
<pre id="l2106"><span class="adr">E94A</span>	19              	<span id="code2106">DAD	D</span></pre>
<pre id="l2107"><span class="adr">E94B</span>	7E              	<span id="code2107">MOV	A,M</span></pre>
<pre id="l2108"><span class="adr">E94C</span>	17              	<span id="code2108">RAL</span></pre>
<pre id="l2109"><span class="adr">E94D</span>	D0              	<span id="code2109">RNC		</span><span class="cmt">;return if ok.</span></pre>
<pre id="l2110"><span class="adr">E94E</span>	21 0F E4        	<span id="code2110">LXI	H,ROFILE</span><span class="cmt">;else, print error message and terminate.</span></pre>
<pre id="l2111"><span class="adr">E951</span>	C3 4A E7        	<span id="code2111">JMP	JUMPHL</span></pre>
<pre id="l2112"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2113"><span class="adr"></span>	                <span class="cmt">;   Check the write protect status of the active disk.</span></pre>
<pre id="l2114"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2115"><span class="adr">E954</span>	CD 1E E9        <span class="l" id="label2115">CHKWPRT</span>	<span id="code2115">CALL	GETWPRT</span></pre>
<pre id="l2116"><span class="adr">E957</span>	C8              	<span id="code2116">RZ		</span><span class="cmt">;return if ok.</span></pre>
<pre id="l2117"><span class="adr">E958</span>	21 0D E4        	<span id="code2117">LXI	H,RODISK</span><span class="cmt">;else print message and terminate.</span></pre>
<pre id="l2118"><span class="adr">E95B</span>	C3 4A E7        	<span id="code2118">JMP	JUMPHL</span></pre>
<pre id="l2119"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2120"><span class="adr"></span>	                <span class="cmt">;   Routine to set (HL) pointing to the proper entry in the</span></pre>
<pre id="l2121"><span class="adr"></span>	                <span class="cmt">; directory buffer.</span></pre>
<pre id="l2122"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2123"><span class="adr">E95E</span>	2A B9 F1        <span class="l" id="label2123">FCB2HL</span>	<span id="code2123">LHLD	DIRBUF	</span><span class="cmt">;get address of buffer.</span></pre>
<pre id="l2124"><span class="adr">E961</span>	3A E9 F1        	<span id="code2124">LDA	FCBPOS	</span><span class="cmt">;relative position of file.</span></pre>
<pre id="l2125"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2126"><span class="adr"></span>	                <span class="cmt">;   Routine to add (A) to (HL).</span></pre>
<pre id="l2127"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2128"><span class="adr">E964</span>	85              <span class="l" id="label2128">ADDA2HL</span>	<span id="code2128">ADD	L</span></pre>
<pre id="l2129"><span class="adr">E965</span>	6F              	<span id="code2129">MOV	L,A</span></pre>
<pre id="l2130"><span class="adr">E966</span>	D0              	<span id="code2130">RNC</span></pre>
<pre id="l2131"><span class="adr">E967</span>	24              	<span id="code2131">INR	H	</span><span class="cmt">;take care of any carry.</span></pre>
<pre id="l2132"><span class="adr">E968</span>	C9              	<span id="code2132">RET</span></pre>
<pre id="l2133"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2134"><span class="adr"></span>	                <span class="cmt">;   Routine to get the 's2' byte from the fcb supplied in</span></pre>
<pre id="l2135"><span class="adr"></span>	                <span class="cmt">; the initial parameter specification.</span></pre>
<pre id="l2136"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2137"><span class="adr">E969</span>	2A 43 E7        <span class="l" id="label2137">GETS2</span>	<span id="code2137">LHLD	PARAMS	</span><span class="cmt">;get address of fcb.</span></pre>
<pre id="l2138"><span class="adr">E96C</span>	11 0E 00        	<span id="code2138">LXI	D,14	</span><span class="cmt">;relative position of 's2'.</span></pre>
<pre id="l2139"><span class="adr">E96F</span>	19              	<span id="code2139">DAD	D</span></pre>
<pre id="l2140"><span class="adr">E970</span>	7E              	<span id="code2140">MOV	A,M	</span><span class="cmt">;extract this byte.</span></pre>
<pre id="l2141"><span class="adr">E971</span>	C9              	<span id="code2141">RET</span></pre>
<pre id="l2142"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2143"><span class="adr"></span>	                <span class="cmt">;   Clear the 's2' byte in the fcb.</span></pre>
<pre id="l2144"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2145"><span class="adr">E972</span>	CD 69 E9        <span class="l" id="label2145">CLEARS2</span>	<span id="code2145">CALL	GETS2	</span><span class="cmt">;this sets (HL) pointing to it.</span></pre>
<pre id="l2146"><span class="adr">E975</span>	36 00           	<span id="code2146">MVI	M,0	</span><span class="cmt">;now clear it.</span></pre>
<pre id="l2147"><span class="adr">E977</span>	C9              	<span id="code2147">RET</span></pre>
<pre id="l2148"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2149"><span class="adr"></span>	                <span class="cmt">;   Set bit 7 in the 's2' byte of the fcb.</span></pre>
<pre id="l2150"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2151"><span class="adr">E978</span>	CD 69 E9        <span class="l" id="label2151">SETS2B7</span>	<span id="code2151">CALL	GETS2	</span><span class="cmt">;get the byte.</span></pre>
<pre id="l2152"><span class="adr">E97B</span>	F6 80           	<span id="code2152">ORI	80H	</span><span class="cmt">;and set bit 7.</span></pre>
<pre id="l2153"><span class="adr">E97D</span>	77              	<span id="code2153">MOV	M,A	</span><span class="cmt">;then store.</span></pre>
<pre id="l2154"><span class="adr">E97E</span>	C9              	<span id="code2154">RET</span></pre>
<pre id="l2155"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2156"><span class="adr"></span>	                <span class="cmt">;   Compare (FILEPOS) with (SCRATCH1) and set flags based on</span></pre>
<pre id="l2157"><span class="adr"></span>	                <span class="cmt">; the difference. This checks to see if there are more file</span></pre>
<pre id="l2158"><span class="adr"></span>	                <span class="cmt">; names in the directory. We are at (FILEPOS) and there are</span></pre>
<pre id="l2159"><span class="adr"></span>	                <span class="cmt">; (SCRATCH1) of them to check.</span></pre>
<pre id="l2160"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2161"><span class="adr">E97F</span>	2A EA F1        <span class="l" id="label2161">MOREFLS</span>	<span id="code2161">LHLD	FILEPOS	</span><span class="cmt">;we are here.</span></pre>
<pre id="l2162"><span class="adr">E982</span>	EB              	<span id="code2162">XCHG</span></pre>
<pre id="l2163"><span class="adr">E983</span>	2A B3 F1        	<span id="code2163">LHLD	SCRATCH1</span><span class="cmt">;and don't go past here.</span></pre>
<pre id="l2164"><span class="adr">E986</span>	7B              	<span id="code2164">MOV	A,E	</span><span class="cmt">;compute difference but don't keep.</span></pre>
<pre id="l2165"><span class="adr">E987</span>	96              	<span id="code2165">SUB	M</span></pre>
<pre id="l2166"><span class="adr">E988</span>	23              	<span id="code2166">INX	H</span></pre>
<pre id="l2167"><span class="adr">E989</span>	7A              	<span id="code2167">MOV	A,D</span></pre>
<pre id="l2168"><span class="adr">E98A</span>	9E              	<span id="code2168">SBB	M	</span><span class="cmt">;set carry if no more names.</span></pre>
<pre id="l2169"><span class="adr">E98B</span>	C9              	<span id="code2169">RET</span></pre>
<pre id="l2170"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2171"><span class="adr"></span>	                <span class="cmt">;   Call this routine to prevent (SCRATCH1) from being greater</span></pre>
<pre id="l2172"><span class="adr"></span>	                <span class="cmt">; than (FILEPOS).</span></pre>
<pre id="l2173"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2174"><span class="adr">E98C</span>	CD 7F E9        <span class="l" id="label2174">CHKNMBR</span>	<span id="code2174">CALL	MOREFLS	</span><span class="cmt">;SCRATCH1 too big?</span></pre>
<pre id="l2175"><span class="adr">E98F</span>	D8              	<span id="code2175">RC</span></pre>
<pre id="l2176"><span class="adr">E990</span>	13              	<span id="code2176">INX	D	</span><span class="cmt">;yes, reset it to (FILEPOS).</span></pre>
<pre id="l2177"><span class="adr">E991</span>	72              	<span id="code2177">MOV	M,D</span></pre>
<pre id="l2178"><span class="adr">E992</span>	2B              	<span id="code2178">DCX	H</span></pre>
<pre id="l2179"><span class="adr">E993</span>	73              	<span id="code2179">MOV	M,E</span></pre>
<pre id="l2180"><span class="adr">E994</span>	C9              	<span id="code2180">RET</span></pre>
<pre id="l2181"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2182"><span class="adr"></span>	                <span class="cmt">;   Compute (HL)=(DE)-(HL)</span></pre>
<pre id="l2183"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2184"><span class="adr">E995</span>	7B              <span class="l" id="label2184">SUBHL</span>	<span id="code2184">MOV	A,E	</span><span class="cmt">;compute difference.</span></pre>
<pre id="l2185"><span class="adr">E996</span>	95              	<span id="code2185">SUB	L</span></pre>
<pre id="l2186"><span class="adr">E997</span>	6F              	<span id="code2186">MOV	L,A	</span><span class="cmt">;store low byte.</span></pre>
<pre id="l2187"><span class="adr">E998</span>	7A              	<span id="code2187">MOV	A,D</span></pre>
<pre id="l2188"><span class="adr">E999</span>	9C              	<span id="code2188">SBB	H</span></pre>
<pre id="l2189"><span class="adr">E99A</span>	67              	<span id="code2189">MOV	H,A	</span><span class="cmt">;and then high byte.</span></pre>
<pre id="l2190"><span class="adr">E99B</span>	C9              	<span id="code2190">RET</span></pre>
<pre id="l2191"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2192"><span class="adr"></span>	                <span class="cmt">;   Set the directory checksum byte.</span></pre>
<pre id="l2193"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2194"><span class="adr">E99C</span>	0E FF           <span class="l" id="label2194">SETDIR</span>	<span id="code2194">MVI	C,0FFH</span></pre>
<pre id="l2195"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2196"><span class="adr"></span>	                <span class="cmt">;   Routine to set or compare the directory checksum byte. If</span></pre>
<pre id="l2197"><span class="adr"></span>	                <span class="cmt">; (C)=0ffh, then this will set the checksum byte. Else the byte</span></pre>
<pre id="l2198"><span class="adr"></span>	                <span class="cmt">; will be checked. If the check fails (the disk has been changed),</span></pre>
<pre id="l2199"><span class="adr"></span>	                <span class="cmt">; then this disk will be write protected.</span></pre>
<pre id="l2200"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2201"><span class="adr">E99E</span>	2A EC F1        <span class="l" id="label2201">CHECKDIR</span><span id="code2201">:LHLD	CKSUMTBL</span></pre>
<pre id="l2202"><span class="adr">E9A1</span>	EB              	<span id="code2202">XCHG</span></pre>
<pre id="l2203"><span class="adr">E9A2</span>	2A CC F1        	<span id="code2203">LHLD	ALLOC1</span></pre>
<pre id="l2204"><span class="adr">E9A5</span>	CD 95 E9        	<span id="code2204">CALL	SUBHL</span></pre>
<pre id="l2205"><span class="adr">E9A8</span>	D0              	<span id="code2205">RNC		</span><span class="cmt">;ok if (CKSUMTBL) > (ALLOC1), so return.</span></pre>
<pre id="l2206"><span class="adr">E9A9</span>	C5              	<span id="code2206">PUSH	B</span></pre>
<pre id="l2207"><span class="adr">E9AA</span>	CD F7 E8        	<span id="code2207">CALL	CHECKSUM</span><span class="cmt">;else compute checksum.</span></pre>
<pre id="l2208"><span class="adr">E9AD</span>	2A BD F1        	<span id="code2208">LHLD	CHKVECT	</span><span class="cmt">;get address of checksum table.</span></pre>
<pre id="l2209"><span class="adr">E9B0</span>	EB              	<span id="code2209">XCHG</span></pre>
<pre id="l2210"><span class="adr">E9B1</span>	2A EC F1        	<span id="code2210">LHLD	CKSUMTBL</span></pre>
<pre id="l2211"><span class="adr">E9B4</span>	19              	<span id="code2211">DAD	D	</span><span class="cmt">;set (HL) to point to byte for this drive.</span></pre>
<pre id="l2212"><span class="adr">E9B5</span>	C1              	<span id="code2212">POP	B</span></pre>
<pre id="l2213"><span class="adr">E9B6</span>	0C              	<span id="code2213">INR	C	</span><span class="cmt">;set or check ?</span></pre>
<pre id="l2214"><span class="adr">E9B7</span>	CA C4 E9        	<span id="code2214">JZ	CHKDIR1</span></pre>
<pre id="l2215"><span class="adr">E9BA</span>	BE              	<span id="code2215">CMP	M	</span><span class="cmt">;check them.</span></pre>
<pre id="l2216"><span class="adr">E9BB</span>	C8              	<span id="code2216">RZ		</span><span class="cmt">;return if they are the same.</span></pre>
<pre id="l2217"><span class="adr">E9BC</span>	CD 7F E9        	<span id="code2217">CALL	MOREFLS	</span><span class="cmt">;not the same, do we care?</span></pre>
<pre id="l2218"><span class="adr">E9BF</span>	D0              	<span id="code2218">RNC</span></pre>
<pre id="l2219"><span class="adr">E9C0</span>	CD 2C E9        	<span id="code2219">CALL	WRTPRTD	</span><span class="cmt">;yes, mark this as write protected.</span></pre>
<pre id="l2220"><span class="adr">E9C3</span>	C9              	<span id="code2220">RET</span></pre>
<pre id="l2221"><span class="adr">E9C4</span>	77              <span class="l" id="label2221">CHKDIR1</span>	<span id="code2221">MOV	M,A	</span><span class="cmt">;just set the byte.</span></pre>
<pre id="l2222"><span class="adr">E9C5</span>	C9              	<span id="code2222">RET</span></pre>
<pre id="l2223"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2224"><span class="adr"></span>	                <span class="cmt">;   Do a write to the directory of the current disk.</span></pre>
<pre id="l2225"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2226"><span class="adr">E9C6</span>	CD 9C E9        <span class="l" id="label2226">DIRWRITE</span><span id="code2226">:CALL	SETDIR	</span><span class="cmt">;set checksum byte.</span></pre>
<pre id="l2227"><span class="adr">E9C9</span>	CD E0 E9        	<span id="code2227">CALL	DIRDMA	</span><span class="cmt">;set directory dma address.</span></pre>
<pre id="l2228"><span class="adr">E9CC</span>	0E 01           	<span id="code2228">MVI	C,1	</span><span class="cmt">;tell the bios to actually write.</span></pre>
<pre id="l2229"><span class="adr">E9CE</span>	CD B8 E7        	<span id="code2229">CALL	DOWRITE	</span><span class="cmt">;then do the write.</span></pre>
<pre id="l2230"><span class="adr">E9D1</span>	C3 DA E9        	<span id="code2230">JMP	DEFDMA</span></pre>
<pre id="l2231"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2232"><span class="adr"></span>	                <span class="cmt">;   Read from the directory.</span></pre>
<pre id="l2233"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2234"><span class="adr">E9D4</span>	CD E0 E9        <span class="l" id="label2234">DIRREAD</span>	<span id="code2234">CALL	DIRDMA	</span><span class="cmt">;set the directory dma address.</span></pre>
<pre id="l2235"><span class="adr">E9D7</span>	CD B2 E7        	<span id="code2235">CALL	DOREAD	</span><span class="cmt">;and read it.</span></pre>
<pre id="l2236"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2237"><span class="adr"></span>	                <span class="cmt">;   Routine to set the dma address to the users choice.</span></pre>
<pre id="l2238"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2239"><span class="adr">E9DA</span>	21 B1 F1        <span class="l" id="label2239">DEFDMA</span>	<span id="code2239">LXI	H,USERDMA</span><span class="cmt">;reset the default dma address and return.</span></pre>
<pre id="l2240"><span class="adr">E9DD</span>	C3 E3 E9        	<span id="code2240">JMP	DIRDMA1</span></pre>
<pre id="l2241"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2242"><span class="adr"></span>	                <span class="cmt">;   Routine to set the dma address for directory work.</span></pre>
<pre id="l2243"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2244"><span class="adr">E9E0</span>	21 B9 F1        <span class="l" id="label2244">DIRDMA</span>	<span id="code2244">LXI	H,DIRBUF</span></pre>
<pre id="l2245"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2246"><span class="adr"></span>	                <span class="cmt">;   Set the dma address. On entry, (HL) points to</span></pre>
<pre id="l2247"><span class="adr"></span>	                <span class="cmt">; word containing the desired dma address.</span></pre>
<pre id="l2248"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2249"><span class="adr">E9E3</span>	4E              <span class="l" id="label2249">DIRDMA1</span>	<span id="code2249">MOV	C,M</span></pre>
<pre id="l2250"><span class="adr">E9E4</span>	23              	<span id="code2250">INX	H</span></pre>
<pre id="l2251"><span class="adr">E9E5</span>	46              	<span id="code2251">MOV	B,M	</span><span class="cmt">;setup (BC) and go to the bios to set it.</span></pre>
<pre id="l2252"><span class="adr">E9E6</span>	C3 24 F2        	<span id="code2252">JMP	SETDMA</span></pre>
<pre id="l2253"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2254"><span class="adr"></span>	                <span class="cmt">;   Move the directory buffer into user's dma space.</span></pre>
<pre id="l2255"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2256"><span class="adr">E9E9</span>	2A B9 F1        <span class="l" id="label2256">MOVEDIR</span>	<span id="code2256">LHLD	DIRBUF	</span><span class="cmt">;buffer is located here, and</span></pre>
<pre id="l2257"><span class="adr">E9EC</span>	EB              	<span id="code2257">XCHG</span></pre>
<pre id="l2258"><span class="adr">E9ED</span>	2A B1 F1        	<span id="code2258">LHLD	USERDMA</span><span class="cmt">; put it here.</span></pre>
<pre id="l2259"><span class="adr">E9F0</span>	0E 80           	<span id="code2259">MVI	C,128	</span><span class="cmt">;this is its length.</span></pre>
<pre id="l2260"><span class="adr">E9F2</span>	C3 4F E7        	<span id="code2260">JMP	DE2HL	</span><span class="cmt">;move it now and return.</span></pre>
<pre id="l2261"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2262"><span class="adr"></span>	                <span class="cmt">;   Check (FILEPOS) and set the zero flag if it equals 0ffffh.</span></pre>
<pre id="l2263"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2264"><span class="adr">E9F5</span>	21 EA F1        <span class="l" id="label2264">CKFILPOS</span><span id="code2264">:LXI	H,FILEPOS</span></pre>
<pre id="l2265"><span class="adr">E9F8</span>	7E              	<span id="code2265">MOV	A,M</span></pre>
<pre id="l2266"><span class="adr">E9F9</span>	23              	<span id="code2266">INX	H</span></pre>
<pre id="l2267"><span class="adr">E9FA</span>	BE              	<span id="code2267">CMP	M	</span><span class="cmt">;are both bytes the same?</span></pre>
<pre id="l2268"><span class="adr">E9FB</span>	C0              	<span id="code2268">RNZ</span></pre>
<pre id="l2269"><span class="adr">E9FC</span>	3C              	<span id="code2269">INR	A	</span><span class="cmt">;yes, but are they each 0ffh?</span></pre>
<pre id="l2270"><span class="adr">E9FD</span>	C9              	<span id="code2270">RET</span></pre>
<pre id="l2271"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2272"><span class="adr"></span>	                <span class="cmt">;   Set location (FILEPOS) to 0ffffh.</span></pre>
<pre id="l2273"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2274"><span class="adr">E9FE</span>	21 FF FF        <span class="l" id="label2274">STFILPOS</span><span id="code2274">:LXI	H,0FFFFH</span></pre>
<pre id="l2275"><span class="adr">EA01</span>	22 EA F1        	<span id="code2275">SHLD	FILEPOS</span></pre>
<pre id="l2276"><span class="adr">EA04</span>	C9              	<span id="code2276">RET</span></pre>
<pre id="l2277"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2278"><span class="adr"></span>	                <span class="cmt">;   Move on to the next file position within the current</span></pre>
<pre id="l2279"><span class="adr"></span>	                <span class="cmt">; directory buffer. If no more exist, set pointer to 0ffffh</span></pre>
<pre id="l2280"><span class="adr"></span>	                <span class="cmt">; and the calling routine will check for this. Enter with (C)</span></pre>
<pre id="l2281"><span class="adr"></span>	                <span class="cmt">; equal to 0ffh to cause the checksum byte to be set, else we</span></pre>
<pre id="l2282"><span class="adr"></span>	                <span class="cmt">; will check this disk and set write protect if checksums are</span></pre>
<pre id="l2283"><span class="adr"></span>	                <span class="cmt">; not the same (applies only if another directory sector must</span></pre>
<pre id="l2284"><span class="adr"></span>	                <span class="cmt">; be read).</span></pre>
<pre id="l2285"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2286"><span class="adr">EA05</span>	2A C8 F1        <span class="l" id="label2286">NXENTRY</span>	<span id="code2286">LHLD	DIRSIZE	</span><span class="cmt">;get directory entry size limit.</span></pre>
<pre id="l2287"><span class="adr">EA08</span>	EB              	<span id="code2287">XCHG</span></pre>
<pre id="l2288"><span class="adr">EA09</span>	2A EA F1        	<span id="code2288">LHLD	FILEPOS	</span><span class="cmt">;get current count.</span></pre>
<pre id="l2289"><span class="adr">EA0C</span>	23              	<span id="code2289">INX	H	</span><span class="cmt">;go on to the next one.</span></pre>
<pre id="l2290"><span class="adr">EA0D</span>	22 EA F1        	<span id="code2290">SHLD	FILEPOS</span></pre>
<pre id="l2291"><span class="adr">EA10</span>	CD 95 E9        	<span id="code2291">CALL	SUBHL	</span><span class="cmt">;(HL)=(DIRSIZE)-(FILEPOS)</span></pre>
<pre id="l2292"><span class="adr">EA13</span>	D2 19 EA        	<span id="code2292">JNC	NXENT1	</span><span class="cmt">;is there more room left?</span></pre>
<pre id="l2293"><span class="adr">EA16</span>	C3 FE E9        	<span id="code2293">JMP	STFILPOS</span><span class="cmt">;no. Set this flag and return.</span></pre>
<pre id="l2294"><span class="adr">EA19</span>	3A EA F1        <span class="l" id="label2294">NXENT1</span>	<span id="code2294">LDA	FILEPOS	</span><span class="cmt">;get file position within directory.</span></pre>
<pre id="l2295"><span class="adr">EA1C</span>	E6 03           	<span id="code2295">ANI	03H	</span><span class="cmt">;only look within this sector (only 4 entries fit).</span></pre>
<pre id="l2296"><span class="adr">EA1E</span>	06 05           	<span id="code2296">MVI	B,5	</span><span class="cmt">;convert to relative position (32 bytes each).</span></pre>
<pre id="l2297"><span class="adr">EA20</span>	87              <span class="l" id="label2297">NXENT2</span>	<span id="code2297">ADD	A	</span><span class="cmt">;note that this is not efficient code.</span></pre>
<pre id="l2298"><span class="adr">EA21</span>	05              	<span id="code2298">DCR	B	</span><span class="cmt">;5 'ADD A's would be better.</span></pre>
<pre id="l2299"><span class="adr">EA22</span>	C2 20 EA        	<span id="code2299">JNZ	NXENT2</span></pre>
<pre id="l2300"><span class="adr">EA25</span>	32 E9 F1        	<span id="code2300">STA	FCBPOS	</span><span class="cmt">;save it as position of fcb.</span></pre>
<pre id="l2301"><span class="adr">EA28</span>	B7              	<span id="code2301">ORA	A</span></pre>
<pre id="l2302"><span class="adr">EA29</span>	C0              	<span id="code2302">RNZ		</span><span class="cmt">;return if we are within buffer.</span></pre>
<pre id="l2303"><span class="adr">EA2A</span>	C5              	<span id="code2303">PUSH	B</span></pre>
<pre id="l2304"><span class="adr">EA2B</span>	CD C3 E7        	<span id="code2304">CALL	TRKSEC	</span><span class="cmt">;we need the next directory sector.</span></pre>
<pre id="l2305"><span class="adr">EA2E</span>	CD D4 E9        	<span id="code2305">CALL	DIRREAD</span></pre>
<pre id="l2306"><span class="adr">EA31</span>	C1              	<span id="code2306">POP	B</span></pre>
<pre id="l2307"><span class="adr">EA32</span>	C3 9E E9        	<span id="code2307">JMP	CHECKDIR</span></pre>
<pre id="l2308"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2309"><span class="adr"></span>	                <span class="cmt">;   Routine to to get a bit from the disk space allocation</span></pre>
<pre id="l2310"><span class="adr"></span>	                <span class="cmt">; map. It is returned in (A), bit position 0. On entry to here,</span></pre>
<pre id="l2311"><span class="adr"></span>	                <span class="cmt">; set (BC) to the block number on the disk to check.</span></pre>
<pre id="l2312"><span class="adr"></span>	                <span class="cmt">; On return, (D) will contain the original bit position for</span></pre>
<pre id="l2313"><span class="adr"></span>	                <span class="cmt">; this block number and (HL) will point to the address for it.</span></pre>
<pre id="l2314"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2315"><span class="adr">EA35</span>	79              <span class="l" id="label2315">CKBITMAP</span><span id="code2315">:MOV	A,C	</span><span class="cmt">;determine bit number of interest.</span></pre>
<pre id="l2316"><span class="adr">EA36</span>	E6 07           	<span id="code2316">ANI	07H	</span><span class="cmt">;compute (D)=(E)=(C and 7)+1.</span></pre>
<pre id="l2317"><span class="adr">EA38</span>	3C              	<span id="code2317">INR	A</span></pre>
<pre id="l2318"><span class="adr">EA39</span>	5F              	<span id="code2318">MOV	E,A	</span><span class="cmt">;save particular bit number.</span></pre>
<pre id="l2319"><span class="adr">EA3A</span>	57              	<span id="code2319">MOV	D,A</span></pre>
<pre id="l2320"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2321"><span class="adr"></span>	                <span class="cmt">;   compute (BC)=(BC)/8.</span></pre>
<pre id="l2322"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2323"><span class="adr">EA3B</span>	79              	<span id="code2323">MOV	A,C</span></pre>
<pre id="l2324"><span class="adr">EA3C</span>	0F              	<span id="code2324">RRC		</span><span class="cmt">;now shift right 3 bits.</span></pre>
<pre id="l2325"><span class="adr">EA3D</span>	0F              	<span id="code2325">RRC</span></pre>
<pre id="l2326"><span class="adr">EA3E</span>	0F              	<span id="code2326">RRC</span></pre>
<pre id="l2327"><span class="adr">EA3F</span>	E6 1F           	<span id="code2327">ANI	1FH	</span><span class="cmt">;and clear bits 7,6,5.</span></pre>
<pre id="l2328"><span class="adr">EA41</span>	4F              	<span id="code2328">MOV	C,A</span></pre>
<pre id="l2329"><span class="adr">EA42</span>	78              	<span id="code2329">MOV	A,B</span></pre>
<pre id="l2330"><span class="adr">EA43</span>	87              	<span id="code2330">ADD	A	</span><span class="cmt">;now shift (B) into bits 7,6,5.</span></pre>
<pre id="l2331"><span class="adr">EA44</span>	87              	<span id="code2331">ADD	A</span></pre>
<pre id="l2332"><span class="adr">EA45</span>	87              	<span id="code2332">ADD	A</span></pre>
<pre id="l2333"><span class="adr">EA46</span>	87              	<span id="code2333">ADD	A</span></pre>
<pre id="l2334"><span class="adr">EA47</span>	87              	<span id="code2334">ADD	A</span></pre>
<pre id="l2335"><span class="adr">EA48</span>	B1              	<span id="code2335">ORA	C	</span><span class="cmt">;and add in (C).</span></pre>
<pre id="l2336"><span class="adr">EA49</span>	4F              	<span id="code2336">MOV	C,A	</span><span class="cmt">;ok, (C) ha been completed.</span></pre>
<pre id="l2337"><span class="adr">EA4A</span>	78              	<span id="code2337">MOV	A,B	</span><span class="cmt">;is there a better way of doing this?</span></pre>
<pre id="l2338"><span class="adr">EA4B</span>	0F              	<span id="code2338">RRC</span></pre>
<pre id="l2339"><span class="adr">EA4C</span>	0F              	<span id="code2339">RRC</span></pre>
<pre id="l2340"><span class="adr">EA4D</span>	0F              	<span id="code2340">RRC</span></pre>
<pre id="l2341"><span class="adr">EA4E</span>	E6 1F           	<span id="code2341">ANI	1FH</span></pre>
<pre id="l2342"><span class="adr">EA50</span>	47              	<span id="code2342">MOV	B,A	</span><span class="cmt">;and now (B) is completed.</span></pre>
<pre id="l2343"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2344"><span class="adr"></span>	                <span class="cmt">;   use this as an offset into the disk space allocation</span></pre>
<pre id="l2345"><span class="adr"></span>	                <span class="cmt">; table.</span></pre>
<pre id="l2346"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2347"><span class="adr">EA51</span>	2A BF F1        	<span id="code2347">LHLD	ALOCVECT</span></pre>
<pre id="l2348"><span class="adr">EA54</span>	09              	<span id="code2348">DAD	B</span></pre>
<pre id="l2349"><span class="adr">EA55</span>	7E              	<span id="code2349">MOV	A,M	</span><span class="cmt">;now get correct byte.</span></pre>
<pre id="l2350"><span class="adr">EA56</span>	07              <span class="l" id="label2350">CKBMAP1</span>	<span id="code2350">RLC		</span><span class="cmt">;get correct bit into position 0.</span></pre>
<pre id="l2351"><span class="adr">EA57</span>	1D              	<span id="code2351">DCR	E</span></pre>
<pre id="l2352"><span class="adr">EA58</span>	C2 56 EA        	<span id="code2352">JNZ	CKBMAP1</span></pre>
<pre id="l2353"><span class="adr">EA5B</span>	C9              	<span id="code2353">RET</span></pre>
<pre id="l2354"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2355"><span class="adr"></span>	                <span class="cmt">;   Set or clear the bit map such that block number (BC) will be marked</span></pre>
<pre id="l2356"><span class="adr"></span>	                <span class="cmt">; as used. On entry, if (E)=0 then this bit will be cleared, if it equals</span></pre>
<pre id="l2357"><span class="adr"></span>	                <span class="cmt">; 1 then it will be set (don't use anyother values).</span></pre>
<pre id="l2358"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2359"><span class="adr">EA5C</span>	D5              <span class="l" id="label2359">STBITMAP</span><span id="code2359">:PUSH	D</span></pre>
<pre id="l2360"><span class="adr">EA5D</span>	CD 35 EA        	<span id="code2360">CALL	CKBITMAP</span><span class="cmt">;get the byte of interest.</span></pre>
<pre id="l2361"><span class="adr">EA60</span>	E6 FE           	<span id="code2361">ANI	0FEH	</span><span class="cmt">;clear the affected bit.</span></pre>
<pre id="l2362"><span class="adr">EA62</span>	C1              	<span id="code2362">POP	B</span></pre>
<pre id="l2363"><span class="adr">EA63</span>	B1              	<span id="code2363">ORA	C	</span><span class="cmt">;and now set it acording to (C).</span></pre>
<pre id="l2364"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2365"><span class="adr"></span>	                <span class="cmt">;  entry to restore the original bit position and then store</span></pre>
<pre id="l2366"><span class="adr"></span>	                <span class="cmt">; in table. (A) contains the value, (D) contains the bit</span></pre>
<pre id="l2367"><span class="adr"></span>	                <span class="cmt">; position (1-8), and (HL) points to the address within the</span></pre>
<pre id="l2368"><span class="adr"></span>	                <span class="cmt">; space allocation table for this byte.</span></pre>
<pre id="l2369"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2370"><span class="adr">EA64</span>	0F              <span class="l" id="label2370">STBMAP1</span>	<span id="code2370">RRC		</span><span class="cmt">;restore original bit position.</span></pre>
<pre id="l2371"><span class="adr">EA65</span>	15              	<span id="code2371">DCR	D</span></pre>
<pre id="l2372"><span class="adr">EA66</span>	C2 64 EA        	<span id="code2372">JNZ	STBMAP1</span></pre>
<pre id="l2373"><span class="adr">EA69</span>	77              	<span id="code2373">MOV	M,A	</span><span class="cmt">;and stor byte in table.</span></pre>
<pre id="l2374"><span class="adr">EA6A</span>	C9              	<span id="code2374">RET</span></pre>
<pre id="l2375"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2376"><span class="adr"></span>	                <span class="cmt">;   Set/clear space used bits in allocation map for this file.</span></pre>
<pre id="l2377"><span class="adr"></span>	                <span class="cmt">; On entry, (C)=1 to set the map and (C)=0 to clear it.</span></pre>
<pre id="l2378"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2379"><span class="adr">EA6B</span>	CD 5E E9        <span class="l" id="label2379">SETFILE</span>	<span id="code2379">CALL	FCB2HL	</span><span class="cmt">;get address of fcb</span></pre>
<pre id="l2380"><span class="adr">EA6E</span>	11 10 00        	<span id="code2380">LXI	D,16</span></pre>
<pre id="l2381"><span class="adr">EA71</span>	19              	<span id="code2381">DAD	D	</span><span class="cmt">;get to block number bytes.</span></pre>
<pre id="l2382"><span class="adr">EA72</span>	C5              	<span id="code2382">PUSH	B</span></pre>
<pre id="l2383"><span class="adr">EA73</span>	0E 11           	<span id="code2383">MVI	C,17	</span><span class="cmt">;check all 17 bytes (max) of table.</span></pre>
<pre id="l2384"><span class="adr">EA75</span>	D1              <span class="l" id="label2384">SETFL1</span>	<span id="code2384">POP	D</span></pre>
<pre id="l2385"><span class="adr">EA76</span>	0D              	<span id="code2385">DCR	C	</span><span class="cmt">;done all bytes yet?</span></pre>
<pre id="l2386"><span class="adr">EA77</span>	C8              	<span id="code2386">RZ</span></pre>
<pre id="l2387"><span class="adr">EA78</span>	D5              	<span id="code2387">PUSH	D</span></pre>
<pre id="l2388"><span class="adr">EA79</span>	3A DD F1        	<span id="code2388">LDA	BIGDISK	</span><span class="cmt">;check disk size for 16 bit block numbers.</span></pre>
<pre id="l2389"><span class="adr">EA7C</span>	B7              	<span id="code2389">ORA	A</span></pre>
<pre id="l2390"><span class="adr">EA7D</span>	CA 88 EA        	<span id="code2390">JZ	SETFL2</span></pre>
<pre id="l2391"><span class="adr">EA80</span>	C5              	<span id="code2391">PUSH	B	</span><span class="cmt">;only 8 bit numbers. set (BC) to this one.</span></pre>
<pre id="l2392"><span class="adr">EA81</span>	E5              	<span id="code2392">PUSH	H</span></pre>
<pre id="l2393"><span class="adr">EA82</span>	4E              	<span id="code2393">MOV	C,M	</span><span class="cmt">;get low byte from table, always</span></pre>
<pre id="l2394"><span class="adr">EA83</span>	06 00           	<span id="code2394">MVI	B,0	</span><span class="cmt">;set high byte to zero.</span></pre>
<pre id="l2395"><span class="adr">EA85</span>	C3 8E EA        	<span id="code2395">JMP	SETFL3</span></pre>
<pre id="l2396"><span class="adr">EA88</span>	0D              <span class="l" id="label2396">SETFL2</span>	<span id="code2396">DCR	C	</span><span class="cmt">;for 16 bit block numbers, adjust counter.</span></pre>
<pre id="l2397"><span class="adr">EA89</span>	C5              	<span id="code2397">PUSH	B</span></pre>
<pre id="l2398"><span class="adr">EA8A</span>	4E              	<span id="code2398">MOV	C,M	</span><span class="cmt">;now get both the low and high bytes.</span></pre>
<pre id="l2399"><span class="adr">EA8B</span>	23              	<span id="code2399">INX	H</span></pre>
<pre id="l2400"><span class="adr">EA8C</span>	46              	<span id="code2400">MOV	B,M</span></pre>
<pre id="l2401"><span class="adr">EA8D</span>	E5              	<span id="code2401">PUSH	H</span></pre>
<pre id="l2402"><span class="adr">EA8E</span>	79              <span class="l" id="label2402">SETFL3</span>	<span id="code2402">MOV	A,C	</span><span class="cmt">;block used?</span></pre>
<pre id="l2403"><span class="adr">EA8F</span>	B0              	<span id="code2403">ORA	B</span></pre>
<pre id="l2404"><span class="adr">EA90</span>	CA 9D EA        	<span id="code2404">JZ	SETFL4</span></pre>
<pre id="l2405"><span class="adr">EA93</span>	2A C6 F1        	<span id="code2405">LHLD	DSKSIZE	</span><span class="cmt">;is this block number within the</span></pre>
<pre id="l2406"><span class="adr">EA96</span>	7D              	<span id="code2406">MOV	A,L	</span><span class="cmt">;space on the disk?</span></pre>
<pre id="l2407"><span class="adr">EA97</span>	91              	<span id="code2407">SUB	C</span></pre>
<pre id="l2408"><span class="adr">EA98</span>	7C              	<span id="code2408">MOV	A,H</span></pre>
<pre id="l2409"><span class="adr">EA99</span>	98              	<span id="code2409">SBB	B</span></pre>
<pre id="l2410"><span class="adr">EA9A</span>	D4 5C EA        	<span id="code2410">CNC	STBITMAP</span><span class="cmt">;yes, set the proper bit.</span></pre>
<pre id="l2411"><span class="adr">EA9D</span>	E1              <span class="l" id="label2411">SETFL4</span>	<span id="code2411">POP	H	</span><span class="cmt">;point to next block number in fcb.</span></pre>
<pre id="l2412"><span class="adr">EA9E</span>	23              	<span id="code2412">INX	H</span></pre>
<pre id="l2413"><span class="adr">EA9F</span>	C1              	<span id="code2413">POP	B</span></pre>
<pre id="l2414"><span class="adr">EAA0</span>	C3 75 EA        	<span id="code2414">JMP	SETFL1</span></pre>
<pre id="l2415"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2416"><span class="adr"></span>	                <span class="cmt">;   Construct the space used allocation bit map for the active</span></pre>
<pre id="l2417"><span class="adr"></span>	                <span class="cmt">; drive. If a file name starts with '$' and it is under the</span></pre>
<pre id="l2418"><span class="adr"></span>	                <span class="cmt">; current user number, then (STATUS) is set to minus 1. Otherwise</span></pre>
<pre id="l2419"><span class="adr"></span>	                <span class="cmt">; it is not set at all.</span></pre>
<pre id="l2420"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2421"><span class="adr">EAA3</span>	2A C6 F1        <span class="l" id="label2421">BITMAP</span>	<span id="code2421">LHLD	DSKSIZE	</span><span class="cmt">;compute size of allocation table.</span></pre>
<pre id="l2422"><span class="adr">EAA6</span>	0E 03           	<span id="code2422">MVI	C,3</span></pre>
<pre id="l2423"><span class="adr">EAA8</span>	CD EA E8        	<span id="code2423">CALL	SHIFTR	</span><span class="cmt">;(HL)=(HL)/8.</span></pre>
<pre id="l2424"><span class="adr">EAAB</span>	23              	<span id="code2424">INX	H	</span><span class="cmt">;at lease 1 byte.</span></pre>
<pre id="l2425"><span class="adr">EAAC</span>	44              	<span id="code2425">MOV	B,H</span></pre>
<pre id="l2426"><span class="adr">EAAD</span>	4D              	<span id="code2426">MOV	C,L	</span><span class="cmt">;set (BC) to the allocation table length.</span></pre>
<pre id="l2427"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2428"><span class="adr"></span>	                <span class="cmt">;   Initialize the bitmap for this drive. Right now, the first</span></pre>
<pre id="l2429"><span class="adr"></span>	                <span class="cmt">; two bytes are specified by the disk parameter block. However</span></pre>
<pre id="l2430"><span class="adr"></span>	                <span class="cmt">; a patch could be entered here if it were necessary to setup</span></pre>
<pre id="l2431"><span class="adr"></span>	                <span class="cmt">; this table in a special mannor. For example, the bios could</span></pre>
<pre id="l2432"><span class="adr"></span>	                <span class="cmt">; determine locations of 'bad blocks' and set them as already</span></pre>
<pre id="l2433"><span class="adr"></span>	                <span class="cmt">; 'used' in the map.</span></pre>
<pre id="l2434"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2435"><span class="adr">EAAE</span>	2A BF F1        	<span id="code2435">LHLD	ALOCVECT</span><span class="cmt">;now zero out the table now.</span></pre>
<pre id="l2436"><span class="adr">EAB1</span>	36 00           <span class="l" id="label2436">BITMAP1</span>	<span id="code2436">MVI	M,0</span></pre>
<pre id="l2437"><span class="adr">EAB3</span>	23              	<span id="code2437">INX	H</span></pre>
<pre id="l2438"><span class="adr">EAB4</span>	0B              	<span id="code2438">DCX	B</span></pre>
<pre id="l2439"><span class="adr">EAB5</span>	78              	<span id="code2439">MOV	A,B</span></pre>
<pre id="l2440"><span class="adr">EAB6</span>	B1              	<span id="code2440">ORA	C</span></pre>
<pre id="l2441"><span class="adr">EAB7</span>	C2 B1 EA        	<span id="code2441">JNZ	BITMAP1</span></pre>
<pre id="l2442"><span class="adr">EABA</span>	2A CA F1        	<span id="code2442">LHLD	ALLOC0	</span><span class="cmt">;get initial space used by directory.</span></pre>
<pre id="l2443"><span class="adr">EABD</span>	EB              	<span id="code2443">XCHG</span></pre>
<pre id="l2444"><span class="adr">EABE</span>	2A BF F1        	<span id="code2444">LHLD	ALOCVECT</span><span class="cmt">;and put this into map.</span></pre>
<pre id="l2445"><span class="adr">EAC1</span>	73              	<span id="code2445">MOV	M,E</span></pre>
<pre id="l2446"><span class="adr">EAC2</span>	23              	<span id="code2446">INX	H</span></pre>
<pre id="l2447"><span class="adr">EAC3</span>	72              	<span id="code2447">MOV	M,D</span></pre>
<pre id="l2448"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2449"><span class="adr"></span>	                <span class="cmt">;   End of initialization portion.</span></pre>
<pre id="l2450"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2451"><span class="adr">EAC4</span>	CD A1 E7        	<span id="code2451">CALL	HOMEDRV	</span><span class="cmt">;now home the drive.</span></pre>
<pre id="l2452"><span class="adr">EAC7</span>	2A B3 F1        	<span id="code2452">LHLD	SCRATCH1</span></pre>
<pre id="l2453"><span class="adr">EACA</span>	36 03           	<span id="code2453">MVI	M,3	</span><span class="cmt">;force next directory request to read</span></pre>
<pre id="l2454"><span class="adr">EACC</span>	23              	<span id="code2454">INX	H	</span><span class="cmt">;in a sector.</span></pre>
<pre id="l2455"><span class="adr">EACD</span>	36 00           	<span id="code2455">MVI	M,0</span></pre>
<pre id="l2456"><span class="adr">EACF</span>	CD FE E9        	<span id="code2456">CALL	STFILPOS</span><span class="cmt">;clear initial file position also.</span></pre>
<pre id="l2457"><span class="adr">EAD2</span>	0E FF           <span class="l" id="label2457">BITMAP2</span>	<span id="code2457">MVI	C,0FFH	</span><span class="cmt">;read next file name in directory</span></pre>
<pre id="l2458"><span class="adr">EAD4</span>	CD 05 EA        	<span id="code2458">CALL	NXENTRY	</span><span class="cmt">;and set checksum byte.</span></pre>
<pre id="l2459"><span class="adr">EAD7</span>	CD F5 E9        	<span id="code2459">CALL	CKFILPOS</span><span class="cmt">;is there another file?</span></pre>
<pre id="l2460"><span class="adr">EADA</span>	C8              	<span id="code2460">RZ</span></pre>
<pre id="l2461"><span class="adr">EADB</span>	CD 5E E9        	<span id="code2461">CALL	FCB2HL	</span><span class="cmt">;yes, get its address.</span></pre>
<pre id="l2462"><span class="adr">EADE</span>	3E E5           	<span id="code2462">MVI	A,0E5H</span></pre>
<pre id="l2463"><span class="adr">EAE0</span>	BE              	<span id="code2463">CMP	M	</span><span class="cmt">;empty file entry?</span></pre>
<pre id="l2464"><span class="adr">EAE1</span>	CA D2 EA        	<span id="code2464">JZ	BITMAP2</span></pre>
<pre id="l2465"><span class="adr">EAE4</span>	3A 41 E7        	<span id="code2465">LDA	USERNO	</span><span class="cmt">;no, correct user number?</span></pre>
<pre id="l2466"><span class="adr">EAE7</span>	BE              	<span id="code2466">CMP	M</span></pre>
<pre id="l2467"><span class="adr">EAE8</span>	C2 F6 EA        	<span id="code2467">JNZ	BITMAP3</span></pre>
<pre id="l2468"><span class="adr">EAEB</span>	23              	<span id="code2468">INX	H</span></pre>
<pre id="l2469"><span class="adr">EAEC</span>	7E              	<span id="code2469">MOV	A,M	</span><span class="cmt">;yes, does name start with a '$'?</span></pre>
<pre id="l2470"><span class="adr">EAED</span>	D6 24           	<span id="code2470">SUI	'$'</span></pre>
<pre id="l2471"><span class="adr">EAEF</span>	C2 F6 EA        	<span id="code2471">JNZ	BITMAP3</span></pre>
<pre id="l2472"><span class="adr">EAF2</span>	3D              	<span id="code2472">DCR	A	</span><span class="cmt">;yes, set atatus to minus one.</span></pre>
<pre id="l2473"><span class="adr">EAF3</span>	32 45 E7        	<span id="code2473">STA	STATUS</span></pre>
<pre id="l2474"><span class="adr">EAF6</span>	0E 01           <span class="l" id="label2474">BITMAP3</span>	<span id="code2474">MVI	C,1	</span><span class="cmt">;now set this file's space as used in bit map.</span></pre>
<pre id="l2475"><span class="adr">EAF8</span>	CD 6B EA        	<span id="code2475">CALL	SETFILE</span></pre>
<pre id="l2476"><span class="adr">EAFB</span>	CD 8C E9        	<span id="code2476">CALL	CHKNMBR	</span><span class="cmt">;keep (SCRATCH1) in bounds.</span></pre>
<pre id="l2477"><span class="adr">EAFE</span>	C3 D2 EA        	<span id="code2477">JMP	BITMAP2</span></pre>
<pre id="l2478"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2479"><span class="adr"></span>	                <span class="cmt">;   Set the status (STATUS) and return.</span></pre>
<pre id="l2480"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2481"><span class="adr">EB01</span>	3A D4 F1        <span class="l" id="label2481">STSTATUS</span><span id="code2481">:LDA	FNDSTAT</span></pre>
<pre id="l2482"><span class="adr">EB04</span>	C3 01 E7        	<span id="code2482">JMP	SETSTAT</span></pre>
<pre id="l2483"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2484"><span class="adr"></span>	                <span class="cmt">;   Check extents in (A) and (C). Set the zero flag if they</span></pre>
<pre id="l2485"><span class="adr"></span>	                <span class="cmt">; are the same. The number of 16k chunks of disk space that</span></pre>
<pre id="l2486"><span class="adr"></span>	                <span class="cmt">; the directory extent covers is expressad is (EXTMASK+1).</span></pre>
<pre id="l2487"><span class="adr"></span>	                <span class="cmt">; No registers are modified.</span></pre>
<pre id="l2488"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2489"><span class="adr">EB07</span>	C5              <span class="l" id="label2489">SAMEXT</span>	<span id="code2489">PUSH	B</span></pre>
<pre id="l2490"><span class="adr">EB08</span>	F5              	<span id="code2490">PUSH	PSW</span></pre>
<pre id="l2491"><span class="adr">EB09</span>	3A C5 F1        	<span id="code2491">LDA	EXTMASK	</span><span class="cmt">;get extent mask and use it to</span></pre>
<pre id="l2492"><span class="adr">EB0C</span>	2F              	<span id="code2492">CMA		</span><span class="cmt">;to compare both extent numbers.</span></pre>
<pre id="l2493"><span class="adr">EB0D</span>	47              	<span id="code2493">MOV	B,A	</span><span class="cmt">;save resulting mask here.</span></pre>
<pre id="l2494"><span class="adr">EB0E</span>	79              	<span id="code2494">MOV	A,C	</span><span class="cmt">;mask first extent and save in (C).</span></pre>
<pre id="l2495"><span class="adr">EB0F</span>	A0              	<span id="code2495">ANA	B</span></pre>
<pre id="l2496"><span class="adr">EB10</span>	4F              	<span id="code2496">MOV	C,A</span></pre>
<pre id="l2497"><span class="adr">EB11</span>	F1              	<span id="code2497">POP	PSW	</span><span class="cmt">;now mask second extent and compare</span></pre>
<pre id="l2498"><span class="adr">EB12</span>	A0              	<span id="code2498">ANA	B	</span><span class="cmt">;with the first one.</span></pre>
<pre id="l2499"><span class="adr">EB13</span>	91              	<span id="code2499">SUB	C</span></pre>
<pre id="l2500"><span class="adr">EB14</span>	E6 1F           	<span id="code2500">ANI	1FH	</span><span class="cmt">;(* only check buts 0-4 *)</span></pre>
<pre id="l2501"><span class="adr">EB16</span>	C1              	<span id="code2501">POP	B	</span><span class="cmt">;the zero flag is set if they are the same.</span></pre>
<pre id="l2502"><span class="adr">EB17</span>	C9              	<span id="code2502">RET		</span><span class="cmt">;restore (BC) and return.</span></pre>
<pre id="l2503"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2504"><span class="adr"></span>	                <span class="cmt">;   Search for the first occurence of a file name. On entry,</span></pre>
<pre id="l2505"><span class="adr"></span>	                <span class="cmt">; register (C) should contain the number of bytes of the fcb</span></pre>
<pre id="l2506"><span class="adr"></span>	                <span class="cmt">; that must match.</span></pre>
<pre id="l2507"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2508"><span class="adr">EB18</span>	3E FF           <span class="l" id="label2508">FINDFST</span>	<span id="code2508">MVI	A,0FFH</span></pre>
<pre id="l2509"><span class="adr">EB1A</span>	32 D4 F1        	<span id="code2509">STA	FNDSTAT</span></pre>
<pre id="l2510"><span class="adr">EB1D</span>	21 D8 F1        	<span id="code2510">LXI	H,COUNTER</span><span class="cmt">;save character count.</span></pre>
<pre id="l2511"><span class="adr">EB20</span>	71              	<span id="code2511">MOV	M,C</span></pre>
<pre id="l2512"><span class="adr">EB21</span>	2A 43 E7        	<span id="code2512">LHLD	PARAMS	</span><span class="cmt">;get filename to match.</span></pre>
<pre id="l2513"><span class="adr">EB24</span>	22 D9 F1        	<span id="code2513">SHLD	SAVEFCB	</span><span class="cmt">;and save.</span></pre>
<pre id="l2514"><span class="adr">EB27</span>	CD FE E9        	<span id="code2514">CALL	STFILPOS</span><span class="cmt">;clear initial file position (set to 0ffffh).</span></pre>
<pre id="l2515"><span class="adr">EB2A</span>	CD A1 E7        	<span id="code2515">CALL	HOMEDRV	</span><span class="cmt">;home the drive.</span></pre>
<pre id="l2516"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2517"><span class="adr"></span>	                <span class="cmt">;   Entry to locate the next occurence of a filename within the</span></pre>
<pre id="l2518"><span class="adr"></span>	                <span class="cmt">; directory. The disk is not expected to have been changed. If</span></pre>
<pre id="l2519"><span class="adr"></span>	                <span class="cmt">; it was, then it will be write protected.</span></pre>
<pre id="l2520"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2521"><span class="adr">EB2D</span>	0E 00           <span class="l" id="label2521">FINDNXT</span>	<span id="code2521">MVI	C,0	</span><span class="cmt">;write protect the disk if changed.</span></pre>
<pre id="l2522"><span class="adr">EB2F</span>	CD 05 EA        	<span id="code2522">CALL	NXENTRY	</span><span class="cmt">;get next filename entry in directory.</span></pre>
<pre id="l2523"><span class="adr">EB32</span>	CD F5 E9        	<span id="code2523">CALL	CKFILPOS</span><span class="cmt">;is file position = 0ffffh?</span></pre>
<pre id="l2524"><span class="adr">EB35</span>	CA 94 EB        	<span id="code2524">JZ	FNDNXT6	</span><span class="cmt">;yes, exit now then.</span></pre>
<pre id="l2525"><span class="adr">EB38</span>	2A D9 F1        	<span id="code2525">LHLD	SAVEFCB	</span><span class="cmt">;set (DE) pointing to filename to match.</span></pre>
<pre id="l2526"><span class="adr">EB3B</span>	EB              	<span id="code2526">XCHG</span></pre>
<pre id="l2527"><span class="adr">EB3C</span>	1A              	<span id="code2527">LDAX	D</span></pre>
<pre id="l2528"><span class="adr">EB3D</span>	FE E5           	<span id="code2528">CPI	0E5H	</span><span class="cmt">;empty directory entry?</span></pre>
<pre id="l2529"><span class="adr">EB3F</span>	CA 4A EB        	<span id="code2529">JZ	FNDNXT1	</span><span class="cmt">;(* are we trying to reserect erased entries? *)</span></pre>
<pre id="l2530"><span class="adr">EB42</span>	D5              	<span id="code2530">PUSH	D</span></pre>
<pre id="l2531"><span class="adr">EB43</span>	CD 7F E9        	<span id="code2531">CALL	MOREFLS	</span><span class="cmt">;more files in directory?</span></pre>
<pre id="l2532"><span class="adr">EB46</span>	D1              	<span id="code2532">POP	D</span></pre>
<pre id="l2533"><span class="adr">EB47</span>	D2 94 EB        	<span id="code2533">JNC	FNDNXT6	</span><span class="cmt">;no more. Exit now.</span></pre>
<pre id="l2534"><span class="adr">EB4A</span>	CD 5E E9        <span class="l" id="label2534">FNDNXT1</span>	<span id="code2534">CALL	FCB2HL	</span><span class="cmt">;get address of this fcb in directory.</span></pre>
<pre id="l2535"><span class="adr">EB4D</span>	3A D8 F1        	<span id="code2535">LDA	COUNTER	</span><span class="cmt">;get number of bytes (characters) to check.</span></pre>
<pre id="l2536"><span class="adr">EB50</span>	4F              	<span id="code2536">MOV	C,A</span></pre>
<pre id="l2537"><span class="adr">EB51</span>	06 00           	<span id="code2537">MVI	B,0	</span><span class="cmt">;initialize byte position counter.</span></pre>
<pre id="l2538"><span class="adr">EB53</span>	79              <span class="l" id="label2538">FNDNXT2</span>	<span id="code2538">MOV	A,C	</span><span class="cmt">;are we done with the compare?</span></pre>
<pre id="l2539"><span class="adr">EB54</span>	B7              	<span id="code2539">ORA	A</span></pre>
<pre id="l2540"><span class="adr">EB55</span>	CA 83 EB        	<span id="code2540">JZ	FNDNXT5</span></pre>
<pre id="l2541"><span class="adr">EB58</span>	1A              	<span id="code2541">LDAX	D	</span><span class="cmt">;no, check next byte.</span></pre>
<pre id="l2542"><span class="adr">EB59</span>	FE 3F           	<span id="code2542">CPI	'?'	</span><span class="cmt">;don't care about this character?</span></pre>
<pre id="l2543"><span class="adr">EB5B</span>	CA 7C EB        	<span id="code2543">JZ	FNDNXT4</span></pre>
<pre id="l2544"><span class="adr">EB5E</span>	78              	<span id="code2544">MOV	A,B	</span><span class="cmt">;get bytes position in fcb.</span></pre>
<pre id="l2545"><span class="adr">EB5F</span>	FE 0D           	<span id="code2545">CPI	13	</span><span class="cmt">;don't care about the thirteenth byte either.</span></pre>
<pre id="l2546"><span class="adr">EB61</span>	CA 7C EB        	<span id="code2546">JZ	FNDNXT4</span></pre>
<pre id="l2547"><span class="adr">EB64</span>	FE 0C           	<span id="code2547">CPI	12	</span><span class="cmt">;extent byte?</span></pre>
<pre id="l2548"><span class="adr">EB66</span>	1A              	<span id="code2548">LDAX	D</span></pre>
<pre id="l2549"><span class="adr">EB67</span>	CA 73 EB        	<span id="code2549">JZ	FNDNXT3</span></pre>
<pre id="l2550"><span class="adr">EB6A</span>	96              	<span id="code2550">SUB	M	</span><span class="cmt">;otherwise compare characters.</span></pre>
<pre id="l2551"><span class="adr">EB6B</span>	E6 7F           	<span id="code2551">ANI	7FH</span></pre>
<pre id="l2552"><span class="adr">EB6D</span>	C2 2D EB        	<span id="code2552">JNZ	FINDNXT	</span><span class="cmt">;not the same, check next entry.</span></pre>
<pre id="l2553"><span class="adr">EB70</span>	C3 7C EB        	<span id="code2553">JMP	FNDNXT4	</span><span class="cmt">;so far so good, keep checking.</span></pre>
<pre id="l2554"><span class="adr">EB73</span>	C5              <span class="l" id="label2554">FNDNXT3</span>	<span id="code2554">PUSH	B	</span><span class="cmt">;check the extent byte here.</span></pre>
<pre id="l2555"><span class="adr">EB74</span>	4E              	<span id="code2555">MOV	C,M</span></pre>
<pre id="l2556"><span class="adr">EB75</span>	CD 07 EB        	<span id="code2556">CALL	SAMEXT</span></pre>
<pre id="l2557"><span class="adr">EB78</span>	C1              	<span id="code2557">POP	B</span></pre>
<pre id="l2558"><span class="adr">EB79</span>	C2 2D EB        	<span id="code2558">JNZ	FINDNXT	</span><span class="cmt">;not the same, look some more.</span></pre>
<pre id="l2559"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2560"><span class="adr"></span>	                <span class="cmt">;   So far the names compare. Bump pointers to the next byte</span></pre>
<pre id="l2561"><span class="adr"></span>	                <span class="cmt">; and continue until all (C) characters have been checked.</span></pre>
<pre id="l2562"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2563"><span class="adr">EB7C</span>	13              <span class="l" id="label2563">FNDNXT4</span>	<span id="code2563">INX	D	</span><span class="cmt">;bump pointers.</span></pre>
<pre id="l2564"><span class="adr">EB7D</span>	23              	<span id="code2564">INX	H</span></pre>
<pre id="l2565"><span class="adr">EB7E</span>	04              	<span id="code2565">INR	B</span></pre>
<pre id="l2566"><span class="adr">EB7F</span>	0D              	<span id="code2566">DCR	C	</span><span class="cmt">;adjust character counter.</span></pre>
<pre id="l2567"><span class="adr">EB80</span>	C3 53 EB        	<span id="code2567">JMP	FNDNXT2</span></pre>
<pre id="l2568"><span class="adr">EB83</span>	3A EA F1        <span class="l" id="label2568">FNDNXT5</span>	<span id="code2568">LDA	FILEPOS	</span><span class="cmt">;return the position of this entry.</span></pre>
<pre id="l2569"><span class="adr">EB86</span>	E6 03           	<span id="code2569">ANI	03H</span></pre>
<pre id="l2570"><span class="adr">EB88</span>	32 45 E7        	<span id="code2570">STA	STATUS</span></pre>
<pre id="l2571"><span class="adr">EB8B</span>	21 D4 F1        	<span id="code2571">LXI	H,FNDSTAT</span></pre>
<pre id="l2572"><span class="adr">EB8E</span>	7E              	<span id="code2572">MOV	A,M</span></pre>
<pre id="l2573"><span class="adr">EB8F</span>	17              	<span id="code2573">RAL</span></pre>
<pre id="l2574"><span class="adr">EB90</span>	D0              	<span id="code2574">RNC</span></pre>
<pre id="l2575"><span class="adr">EB91</span>	AF              	<span id="code2575">XRA	A</span></pre>
<pre id="l2576"><span class="adr">EB92</span>	77              	<span id="code2576">MOV	M,A</span></pre>
<pre id="l2577"><span class="adr">EB93</span>	C9              	<span id="code2577">RET</span></pre>
<pre id="l2578"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2579"><span class="adr"></span>	                <span class="cmt">;   Filename was not found. Set appropriate status.</span></pre>
<pre id="l2580"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2581"><span class="adr">EB94</span>	CD FE E9        <span class="l" id="label2581">FNDNXT6</span>	<span id="code2581">CALL	STFILPOS</span><span class="cmt">;set (FILEPOS) to 0ffffh.</span></pre>
<pre id="l2582"><span class="adr">EB97</span>	3E FF           	<span id="code2582">MVI	A,0FFH	</span><span class="cmt">;say not located.</span></pre>
<pre id="l2583"><span class="adr">EB99</span>	C3 01 E7        	<span id="code2583">JMP	SETSTAT</span></pre>
<pre id="l2584"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2585"><span class="adr"></span>	                <span class="cmt">;   Erase files from the directory. Only the first byte of the</span></pre>
<pre id="l2586"><span class="adr"></span>	                <span class="cmt">; fcb will be affected. It is set to (E5).</span></pre>
<pre id="l2587"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2588"><span class="adr">EB9C</span>	CD 54 E9        <span class="l" id="label2588">ERAFILE</span>	<span id="code2588">CALL	CHKWPRT	</span><span class="cmt">;is disk write protected?</span></pre>
<pre id="l2589"><span class="adr">EB9F</span>	0E 0C           	<span id="code2589">MVI	C,12	</span><span class="cmt">;only compare file names.</span></pre>
<pre id="l2590"><span class="adr">EBA1</span>	CD 18 EB        	<span id="code2590">CALL	FINDFST	</span><span class="cmt">;get first file name.</span></pre>
<pre id="l2591"><span class="adr">EBA4</span>	CD F5 E9        <span class="l" id="label2591">ERAFIL1</span>	<span id="code2591">CALL	CKFILPOS</span><span class="cmt">;any found?</span></pre>
<pre id="l2592"><span class="adr">EBA7</span>	C8              	<span id="code2592">RZ		</span><span class="cmt">;nope, we must be done.</span></pre>
<pre id="l2593"><span class="adr">EBA8</span>	CD 44 E9        	<span id="code2593">CALL	CHKROFL	</span><span class="cmt">;is file read only?</span></pre>
<pre id="l2594"><span class="adr">EBAB</span>	CD 5E E9        	<span id="code2594">CALL	FCB2HL	</span><span class="cmt">;nope, get address of fcb and</span></pre>
<pre id="l2595"><span class="adr">EBAE</span>	36 E5           	<span id="code2595">MVI	M,0E5H	</span><span class="cmt">;set first byte to 'empty'.</span></pre>
<pre id="l2596"><span class="adr">EBB0</span>	0E 00           	<span id="code2596">MVI	C,0	</span><span class="cmt">;clear the space from the bit map.</span></pre>
<pre id="l2597"><span class="adr">EBB2</span>	CD 6B EA        	<span id="code2597">CALL	SETFILE</span></pre>
<pre id="l2598"><span class="adr">EBB5</span>	CD C6 E9        	<span id="code2598">CALL	DIRWRITE</span><span class="cmt">;now write the directory sector back out.</span></pre>
<pre id="l2599"><span class="adr">EBB8</span>	CD 2D EB        	<span id="code2599">CALL	FINDNXT	</span><span class="cmt">;find the next file name.</span></pre>
<pre id="l2600"><span class="adr">EBBB</span>	C3 A4 EB        	<span id="code2600">JMP	ERAFIL1	</span><span class="cmt">;and repeat process.</span></pre>
<pre id="l2601"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2602"><span class="adr"></span>	                <span class="cmt">;   Look through the space allocation map (bit map) for the</span></pre>
<pre id="l2603"><span class="adr"></span>	                <span class="cmt">; next available block. Start searching at block number (BC-1).</span></pre>
<pre id="l2604"><span class="adr"></span>	                <span class="cmt">; The search procedure is to look for an empty block that is</span></pre>
<pre id="l2605"><span class="adr"></span>	                <span class="cmt">; before the starting block. If not empty, look at a later</span></pre>
<pre id="l2606"><span class="adr"></span>	                <span class="cmt">; block number. In this way, we return the closest empty block</span></pre>
<pre id="l2607"><span class="adr"></span>	                <span class="cmt">; on either side of the 'target' block number. This will speed</span></pre>
<pre id="l2608"><span class="adr"></span>	                <span class="cmt">; access on random devices. For serial devices, this should be</span></pre>
<pre id="l2609"><span class="adr"></span>	                <span class="cmt">; changed to look in the forward direction first and then start</span></pre>
<pre id="l2610"><span class="adr"></span>	                <span class="cmt">; at the front and search some more.</span></pre>
<pre id="l2611"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2612"><span class="adr"></span>	                <span class="cmt">;   On return, (DE)= block number that is empty and (HL) =0</span></pre>
<pre id="l2613"><span class="adr"></span>	                <span class="cmt">; if no empry block was found.</span></pre>
<pre id="l2614"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2615"><span class="adr">EBBE</span>	50              <span class="l" id="label2615">FNDSPACE</span><span id="code2615">:MOV	D,B	</span><span class="cmt">;set (DE) as the block that is checked.</span></pre>
<pre id="l2616"><span class="adr">EBBF</span>	59              	<span id="code2616">MOV	E,C</span></pre>
<pre id="l2617"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2618"><span class="adr"></span>	                <span class="cmt">;   Look before target block. Registers (BC) are used as the lower</span></pre>
<pre id="l2619"><span class="adr"></span>	                <span class="cmt">; pointer and (DE) as the upper pointer.</span></pre>
<pre id="l2620"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2621"><span class="adr">EBC0</span>	79              <span class="l" id="label2621">FNDSPA1</span>	<span id="code2621">MOV	A,C	</span><span class="cmt">;is block 0 specified?</span></pre>
<pre id="l2622"><span class="adr">EBC1</span>	B0              	<span id="code2622">ORA	B</span></pre>
<pre id="l2623"><span class="adr">EBC2</span>	CA D1 EB        	<span id="code2623">JZ	FNDSPA2</span></pre>
<pre id="l2624"><span class="adr">EBC5</span>	0B              	<span id="code2624">DCX	B	</span><span class="cmt">;nope, check previous block.</span></pre>
<pre id="l2625"><span class="adr">EBC6</span>	D5              	<span id="code2625">PUSH	D</span></pre>
<pre id="l2626"><span class="adr">EBC7</span>	C5              	<span id="code2626">PUSH	B</span></pre>
<pre id="l2627"><span class="adr">EBC8</span>	CD 35 EA        	<span id="code2627">CALL	CKBITMAP</span></pre>
<pre id="l2628"><span class="adr">EBCB</span>	1F              	<span id="code2628">RAR		</span><span class="cmt">;is this block empty?</span></pre>
<pre id="l2629"><span class="adr">EBCC</span>	D2 EC EB        	<span id="code2629">JNC	FNDSPA3	</span><span class="cmt">;yes. use this.</span></pre>
<pre id="l2630"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2631"><span class="adr"></span>	                <span class="cmt">;   Note that the above logic gets the first block that it finds</span></pre>
<pre id="l2632"><span class="adr"></span>	                <span class="cmt">; that is empty. Thus a file could be written 'backward' making</span></pre>
<pre id="l2633"><span class="adr"></span>	                <span class="cmt">; it very slow to access. This could be changed to look for the</span></pre>
<pre id="l2634"><span class="adr"></span>	                <span class="cmt">; first empty block and then continue until the start of this</span></pre>
<pre id="l2635"><span class="adr"></span>	                <span class="cmt">; empty space is located and then used that starting block.</span></pre>
<pre id="l2636"><span class="adr"></span>	                <span class="cmt">; This should help speed up access to some files especially on</span></pre>
<pre id="l2637"><span class="adr"></span>	                <span class="cmt">; a well used disk with lots of fairly small 'holes'.</span></pre>
<pre id="l2638"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2639"><span class="adr">EBCF</span>	C1              	<span id="code2639">POP	B	</span><span class="cmt">;nope, check some more.</span></pre>
<pre id="l2640"><span class="adr">EBD0</span>	D1              	<span id="code2640">POP	D</span></pre>
<pre id="l2641"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2642"><span class="adr"></span>	                <span class="cmt">;   Now look after target block.</span></pre>
<pre id="l2643"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2644"><span class="adr">EBD1</span>	2A C6 F1        <span class="l" id="label2644">FNDSPA2</span>	<span id="code2644">LHLD	DSKSIZE	</span><span class="cmt">;is block (DE) within disk limits?</span></pre>
<pre id="l2645"><span class="adr">EBD4</span>	7B              	<span id="code2645">MOV	A,E</span></pre>
<pre id="l2646"><span class="adr">EBD5</span>	95              	<span id="code2646">SUB	L</span></pre>
<pre id="l2647"><span class="adr">EBD6</span>	7A              	<span id="code2647">MOV	A,D</span></pre>
<pre id="l2648"><span class="adr">EBD7</span>	9C              	<span id="code2648">SBB	H</span></pre>
<pre id="l2649"><span class="adr">EBD8</span>	D2 F4 EB        	<span id="code2649">JNC	FNDSPA4</span></pre>
<pre id="l2650"><span class="adr">EBDB</span>	13              	<span id="code2650">INX	D	</span><span class="cmt">;yes, move on to next one.</span></pre>
<pre id="l2651"><span class="adr">EBDC</span>	C5              	<span id="code2651">PUSH	B</span></pre>
<pre id="l2652"><span class="adr">EBDD</span>	D5              	<span id="code2652">PUSH	D</span></pre>
<pre id="l2653"><span class="adr">EBDE</span>	42              	<span id="code2653">MOV	B,D</span></pre>
<pre id="l2654"><span class="adr">EBDF</span>	4B              	<span id="code2654">MOV	C,E</span></pre>
<pre id="l2655"><span class="adr">EBE0</span>	CD 35 EA        	<span id="code2655">CALL	CKBITMAP</span><span class="cmt">;check it.</span></pre>
<pre id="l2656"><span class="adr">EBE3</span>	1F              	<span id="code2656">RAR		</span><span class="cmt">;empty?</span></pre>
<pre id="l2657"><span class="adr">EBE4</span>	D2 EC EB        	<span id="code2657">JNC	FNDSPA3</span></pre>
<pre id="l2658"><span class="adr">EBE7</span>	D1              	<span id="code2658">POP	D	</span><span class="cmt">;nope, continue searching.</span></pre>
<pre id="l2659"><span class="adr">EBE8</span>	C1              	<span id="code2659">POP	B</span></pre>
<pre id="l2660"><span class="adr">EBE9</span>	C3 C0 EB        	<span id="code2660">JMP	FNDSPA1</span></pre>
<pre id="l2661"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2662"><span class="adr"></span>	                <span class="cmt">;   Empty block found. Set it as used and return with (HL)</span></pre>
<pre id="l2663"><span class="adr"></span>	                <span class="cmt">; pointing to it (true?).</span></pre>
<pre id="l2664"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2665"><span class="adr">EBEC</span>	17              <span class="l" id="label2665">FNDSPA3</span>	<span id="code2665">RAL		</span><span class="cmt">;reset byte.</span></pre>
<pre id="l2666"><span class="adr">EBED</span>	3C              	<span id="code2666">INR	A	</span><span class="cmt">;and set bit 0.</span></pre>
<pre id="l2667"><span class="adr">EBEE</span>	CD 64 EA        	<span id="code2667">CALL	STBMAP1	</span><span class="cmt">;update bit map.</span></pre>
<pre id="l2668"><span class="adr">EBF1</span>	E1              	<span id="code2668">POP	H	</span><span class="cmt">;set return registers.</span></pre>
<pre id="l2669"><span class="adr">EBF2</span>	D1              	<span id="code2669">POP	D</span></pre>
<pre id="l2670"><span class="adr">EBF3</span>	C9              	<span id="code2670">RET</span></pre>
<pre id="l2671"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2672"><span class="adr"></span>	                <span class="cmt">;   Free block was not found. If (BC) is not zero, then we have</span></pre>
<pre id="l2673"><span class="adr"></span>	                <span class="cmt">; not checked all of the disk space.</span></pre>
<pre id="l2674"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2675"><span class="adr">EBF4</span>	79              <span class="l" id="label2675">FNDSPA4</span>	<span id="code2675">MOV	A,C</span></pre>
<pre id="l2676"><span class="adr">EBF5</span>	B0              	<span id="code2676">ORA	B</span></pre>
<pre id="l2677"><span class="adr">EBF6</span>	C2 C0 EB        	<span id="code2677">JNZ	FNDSPA1</span></pre>
<pre id="l2678"><span class="adr">EBF9</span>	21 00 00        	<span id="code2678">LXI	H,0	</span><span class="cmt">;set 'not found' status.</span></pre>
<pre id="l2679"><span class="adr">EBFC</span>	C9              	<span id="code2679">RET</span></pre>
<pre id="l2680"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2681"><span class="adr"></span>	                <span class="cmt">;   Move a complete fcb entry into the directory and write it.</span></pre>
<pre id="l2682"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2683"><span class="adr">EBFD</span>	0E 00           <span class="l" id="label2683">FCBSET</span>	<span id="code2683">MVI	C,0</span></pre>
<pre id="l2684"><span class="adr">EBFF</span>	1E 20           	<span id="code2684">MVI	E,32	</span><span class="cmt">;length of each entry.</span></pre>
<pre id="l2685"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2686"><span class="adr"></span>	                <span class="cmt">;   Move (E) bytes from the fcb pointed to by (PARAMS) into</span></pre>
<pre id="l2687"><span class="adr"></span>	                <span class="cmt">; fcb in directory starting at relative byte (C). This updated</span></pre>
<pre id="l2688"><span class="adr"></span>	                <span class="cmt">; directory buffer is then written to the disk.</span></pre>
<pre id="l2689"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2690"><span class="adr">EC01</span>	D5              <span class="l" id="label2690">UPDATE</span>	<span id="code2690">PUSH	D</span></pre>
<pre id="l2691"><span class="adr">EC02</span>	06 00           	<span id="code2691">MVI	B,0	</span><span class="cmt">;set (BC) to relative byte position.</span></pre>
<pre id="l2692"><span class="adr">EC04</span>	2A 43 E7        	<span id="code2692">LHLD	PARAMS	</span><span class="cmt">;get address of fcb.</span></pre>
<pre id="l2693"><span class="adr">EC07</span>	09              	<span id="code2693">DAD	B	</span><span class="cmt">;compute starting byte.</span></pre>
<pre id="l2694"><span class="adr">EC08</span>	EB              	<span id="code2694">XCHG</span></pre>
<pre id="l2695"><span class="adr">EC09</span>	CD 5E E9        	<span id="code2695">CALL	FCB2HL	</span><span class="cmt">;get address of fcb to update in directory.</span></pre>
<pre id="l2696"><span class="adr">EC0C</span>	C1              	<span id="code2696">POP	B	</span><span class="cmt">;set (C) to number of bytes to change.</span></pre>
<pre id="l2697"><span class="adr">EC0D</span>	CD 4F E7        	<span id="code2697">CALL	DE2HL</span></pre>
<pre id="l2698"><span class="adr">EC10</span>	CD C3 E7        <span class="l" id="label2698">UPDATE1</span>	<span id="code2698">CALL	TRKSEC	</span><span class="cmt">;determine the track and sector affected.</span></pre>
<pre id="l2699"><span class="adr">EC13</span>	C3 C6 E9        	<span id="code2699">JMP	DIRWRITE	</span><span class="cmt">;then write this sector out.</span></pre>
<pre id="l2700"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2701"><span class="adr"></span>	                <span class="cmt">;   Routine to change the name of all files on the disk with a</span></pre>
<pre id="l2702"><span class="adr"></span>	                <span class="cmt">; specified name. The fcb contains the current name as the</span></pre>
<pre id="l2703"><span class="adr"></span>	                <span class="cmt">; first 12 characters and the new name 16 bytes into the fcb.</span></pre>
<pre id="l2704"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2705"><span class="adr">EC16</span>	CD 54 E9        <span class="l" id="label2705">CHGNAMES</span><span id="code2705">:CALL	CHKWPRT	</span><span class="cmt">;check for a write protected disk.</span></pre>
<pre id="l2706"><span class="adr">EC19</span>	0E 0C           	<span id="code2706">MVI	C,12	</span><span class="cmt">;match first 12 bytes of fcb only.</span></pre>
<pre id="l2707"><span class="adr">EC1B</span>	CD 18 EB        	<span id="code2707">CALL	FINDFST	</span><span class="cmt">;get first name.</span></pre>
<pre id="l2708"><span class="adr">EC1E</span>	2A 43 E7        	<span id="code2708">LHLD	PARAMS	</span><span class="cmt">;get address of fcb.</span></pre>
<pre id="l2709"><span class="adr">EC21</span>	7E              	<span id="code2709">MOV	A,M	</span><span class="cmt">;get user number.</span></pre>
<pre id="l2710"><span class="adr">EC22</span>	11 10 00        	<span id="code2710">LXI	D,16	</span><span class="cmt">;move over to desired name.</span></pre>
<pre id="l2711"><span class="adr">EC25</span>	19              	<span id="code2711">DAD	D</span></pre>
<pre id="l2712"><span class="adr">EC26</span>	77              	<span id="code2712">MOV	M,A	</span><span class="cmt">;keep same user number.</span></pre>
<pre id="l2713"><span class="adr">EC27</span>	CD F5 E9        <span class="l" id="label2713">CHGNAM1</span>	<span id="code2713">CALL	CKFILPOS</span><span class="cmt">;any matching file found?</span></pre>
<pre id="l2714"><span class="adr">EC2A</span>	C8              	<span id="code2714">RZ		</span><span class="cmt">;no, we must be done.</span></pre>
<pre id="l2715"><span class="adr">EC2B</span>	CD 44 E9        	<span id="code2715">CALL	CHKROFL	</span><span class="cmt">;check for read only file.</span></pre>
<pre id="l2716"><span class="adr">EC2E</span>	0E 10           	<span id="code2716">MVI	C,16	</span><span class="cmt">;start 16 bytes into fcb.</span></pre>
<pre id="l2717"><span class="adr">EC30</span>	1E 0C           	<span id="code2717">MVI	E,12	</span><span class="cmt">;and update the first 12 bytes of directory.</span></pre>
<pre id="l2718"><span class="adr">EC32</span>	CD 01 EC        	<span id="code2718">CALL	UPDATE</span></pre>
<pre id="l2719"><span class="adr">EC35</span>	CD 2D EB        	<span id="code2719">CALL	FINDNXT	</span><span class="cmt">;get te next file name.</span></pre>
<pre id="l2720"><span class="adr">EC38</span>	C3 27 EC        	<span id="code2720">JMP	CHGNAM1	</span><span class="cmt">;and continue.</span></pre>
<pre id="l2721"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2722"><span class="adr"></span>	                <span class="cmt">;   Update a files attributes. The procedure is to search for</span></pre>
<pre id="l2723"><span class="adr"></span>	                <span class="cmt">; every file with the same name as shown in fcb (ignoring bit 7)</span></pre>
<pre id="l2724"><span class="adr"></span>	                <span class="cmt">; and then to update it (which includes bit 7). No other changes</span></pre>
<pre id="l2725"><span class="adr"></span>	                <span class="cmt">; are made.</span></pre>
<pre id="l2726"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2727"><span class="adr">EC3B</span>	0E 0C           <span class="l" id="label2727">SAVEATTR</span><span id="code2727">:MVI	C,12	</span><span class="cmt">;match first 12 bytes.</span></pre>
<pre id="l2728"><span class="adr">EC3D</span>	CD 18 EB        	<span id="code2728">CALL	FINDFST	</span><span class="cmt">;look for first filename.</span></pre>
<pre id="l2729"><span class="adr">EC40</span>	CD F5 E9        <span class="l" id="label2729">SAVATR1</span>	<span id="code2729">CALL	CKFILPOS</span><span class="cmt">;was one found?</span></pre>
<pre id="l2730"><span class="adr">EC43</span>	C8              	<span id="code2730">RZ		</span><span class="cmt">;nope, we must be done.</span></pre>
<pre id="l2731"><span class="adr">EC44</span>	0E 00           	<span id="code2731">MVI	C,0	</span><span class="cmt">;yes, update the first 12 bytes now.</span></pre>
<pre id="l2732"><span class="adr">EC46</span>	1E 0C           	<span id="code2732">MVI	E,12</span></pre>
<pre id="l2733"><span class="adr">EC48</span>	CD 01 EC        	<span id="code2733">CALL	UPDATE	</span><span class="cmt">;update filename and write directory.</span></pre>
<pre id="l2734"><span class="adr">EC4B</span>	CD 2D EB        	<span id="code2734">CALL	FINDNXT	</span><span class="cmt">;and get the next file.</span></pre>
<pre id="l2735"><span class="adr">EC4E</span>	C3 40 EC        	<span id="code2735">JMP	SAVATR1	</span><span class="cmt">;then continue until done.</span></pre>
<pre id="l2736"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2737"><span class="adr"></span>	                <span class="cmt">;  Open a file (name specified in fcb).</span></pre>
<pre id="l2738"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2739"><span class="adr">EC51</span>	0E 0F           <span class="l" id="label2739">OPENIT</span>	<span id="code2739">MVI	C,15	</span><span class="cmt">;compare the first 15 bytes.</span></pre>
<pre id="l2740"><span class="adr">EC53</span>	CD 18 EB        	<span id="code2740">CALL	FINDFST	</span><span class="cmt">;get the first one in directory.</span></pre>
<pre id="l2741"><span class="adr">EC56</span>	CD F5 E9        	<span id="code2741">CALL	CKFILPOS</span><span class="cmt">;any at all?</span></pre>
<pre id="l2742"><span class="adr">EC59</span>	C8              	<span id="code2742">RZ</span></pre>
<pre id="l2743"><span class="adr">EC5A</span>	CD A6 E8        <span class="l" id="label2743">OPENIT1</span>	<span id="code2743">CALL	SETEXT	</span><span class="cmt">;point to extent byte within users fcb.</span></pre>
<pre id="l2744"><span class="adr">EC5D</span>	7E              	<span id="code2744">MOV	A,M	</span><span class="cmt">;and get it.</span></pre>
<pre id="l2745"><span class="adr">EC5E</span>	F5              	<span id="code2745">PUSH	PSW	</span><span class="cmt">;save it and address.</span></pre>
<pre id="l2746"><span class="adr">EC5F</span>	E5              	<span id="code2746">PUSH	H</span></pre>
<pre id="l2747"><span class="adr">EC60</span>	CD 5E E9        	<span id="code2747">CALL	FCB2HL	</span><span class="cmt">;point to fcb in directory.</span></pre>
<pre id="l2748"><span class="adr">EC63</span>	EB              	<span id="code2748">XCHG</span></pre>
<pre id="l2749"><span class="adr">EC64</span>	2A 43 E7        	<span id="code2749">LHLD	PARAMS	</span><span class="cmt">;this is the users copy.</span></pre>
<pre id="l2750"><span class="adr">EC67</span>	0E 20           	<span id="code2750">MVI	C,32	</span><span class="cmt">;move it into users space.</span></pre>
<pre id="l2751"><span class="adr">EC69</span>	D5              	<span id="code2751">PUSH	D</span></pre>
<pre id="l2752"><span class="adr">EC6A</span>	CD 4F E7        	<span id="code2752">CALL	DE2HL</span></pre>
<pre id="l2753"><span class="adr">EC6D</span>	CD 78 E9        	<span id="code2753">CALL	SETS2B7	</span><span class="cmt">;set bit 7 in 's2' byte (unmodified).</span></pre>
<pre id="l2754"><span class="adr">EC70</span>	D1              	<span id="code2754">POP	D	</span><span class="cmt">;now get the extent byte from this fcb.</span></pre>
<pre id="l2755"><span class="adr">EC71</span>	21 0C 00        	<span id="code2755">LXI	H,12</span></pre>
<pre id="l2756"><span class="adr">EC74</span>	19              	<span id="code2756">DAD	D</span></pre>
<pre id="l2757"><span class="adr">EC75</span>	4E              	<span id="code2757">MOV	C,M	</span><span class="cmt">;into (C).</span></pre>
<pre id="l2758"><span class="adr">EC76</span>	21 0F 00        	<span id="code2758">LXI	H,15	</span><span class="cmt">;now get the record count byte into (B).</span></pre>
<pre id="l2759"><span class="adr">EC79</span>	19              	<span id="code2759">DAD	D</span></pre>
<pre id="l2760"><span class="adr">EC7A</span>	46              	<span id="code2760">MOV	B,M</span></pre>
<pre id="l2761"><span class="adr">EC7B</span>	E1              	<span id="code2761">POP	H	</span><span class="cmt">;keep the same extent as the user had originally.</span></pre>
<pre id="l2762"><span class="adr">EC7C</span>	F1              	<span id="code2762">POP	PSW</span></pre>
<pre id="l2763"><span class="adr">EC7D</span>	77              	<span id="code2763">MOV	M,A</span></pre>
<pre id="l2764"><span class="adr">EC7E</span>	79              	<span id="code2764">MOV	A,C	</span><span class="cmt">;is it the same as in the directory fcb?</span></pre>
<pre id="l2765"><span class="adr">EC7F</span>	BE              	<span id="code2765">CMP	M</span></pre>
<pre id="l2766"><span class="adr">EC80</span>	78              	<span id="code2766">MOV	A,B	</span><span class="cmt">;if yes, then use the same record count.</span></pre>
<pre id="l2767"><span class="adr">EC81</span>	CA 8B EC        	<span id="code2767">JZ	OPENIT2</span></pre>
<pre id="l2768"><span class="adr">EC84</span>	3E 00           	<span id="code2768">MVI	A,0	</span><span class="cmt">;if the user specified an extent greater than</span></pre>
<pre id="l2769"><span class="adr">EC86</span>	DA 8B EC        	<span id="code2769">JC	OPENIT2	</span><span class="cmt">;the one in the directory, then set record count to 0.</span></pre>
<pre id="l2770"><span class="adr">EC89</span>	3E 80           	<span id="code2770">MVI	A,128	</span><span class="cmt">;otherwise set to maximum.</span></pre>
<pre id="l2771"><span class="adr">EC8B</span>	2A 43 E7        <span class="l" id="label2771">OPENIT2</span>	<span id="code2771">LHLD	PARAMS	</span><span class="cmt">;set record count in users fcb to (A).</span></pre>
<pre id="l2772"><span class="adr">EC8E</span>	11 0F 00        	<span id="code2772">LXI	D,15</span></pre>
<pre id="l2773"><span class="adr">EC91</span>	19              	<span id="code2773">DAD	D	</span><span class="cmt">;compute relative position.</span></pre>
<pre id="l2774"><span class="adr">EC92</span>	77              	<span id="code2774">MOV	M,A	</span><span class="cmt">;and set the record count.</span></pre>
<pre id="l2775"><span class="adr">EC93</span>	C9              	<span id="code2775">RET</span></pre>
<pre id="l2776"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2777"><span class="adr"></span>	                <span class="cmt">;   Move two bytes from (DE) to (HL) if (and only if) (HL)</span></pre>
<pre id="l2778"><span class="adr"></span>	                <span class="cmt">; point to a zero value (16 bit).</span></pre>
<pre id="l2779"><span class="adr"></span>	                <span class="cmt">;   Return with zero flag set it (DE) was moved. Registers (DE)</span></pre>
<pre id="l2780"><span class="adr"></span>	                <span class="cmt">; and (HL) are not changed. However (A) is.</span></pre>
<pre id="l2781"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2782"><span class="adr">EC94</span>	7E              <span class="l" id="label2782">MOVEWORD</span><span id="code2782">:MOV	A,M	</span><span class="cmt">;check for a zero word.</span></pre>
<pre id="l2783"><span class="adr">EC95</span>	23              	<span id="code2783">INX	H</span></pre>
<pre id="l2784"><span class="adr">EC96</span>	B6              	<span id="code2784">ORA	M	</span><span class="cmt">;both bytes zero?</span></pre>
<pre id="l2785"><span class="adr">EC97</span>	2B              	<span id="code2785">DCX	H</span></pre>
<pre id="l2786"><span class="adr">EC98</span>	C0              	<span id="code2786">RNZ		</span><span class="cmt">;nope, just return.</span></pre>
<pre id="l2787"><span class="adr">EC99</span>	1A              	<span id="code2787">LDAX	D	</span><span class="cmt">;yes, move two bytes from (DE) into</span></pre>
<pre id="l2788"><span class="adr">EC9A</span>	77              	<span id="code2788">MOV	M,A	</span><span class="cmt">;this zero space.</span></pre>
<pre id="l2789"><span class="adr">EC9B</span>	13              	<span id="code2789">INX	D</span></pre>
<pre id="l2790"><span class="adr">EC9C</span>	23              	<span id="code2790">INX	H</span></pre>
<pre id="l2791"><span class="adr">EC9D</span>	1A              	<span id="code2791">LDAX	D</span></pre>
<pre id="l2792"><span class="adr">EC9E</span>	77              	<span id="code2792">MOV	M,A</span></pre>
<pre id="l2793"><span class="adr">EC9F</span>	1B              	<span id="code2793">DCX	D	</span><span class="cmt">;don't disturb these registers.</span></pre>
<pre id="l2794"><span class="adr">ECA0</span>	2B              	<span id="code2794">DCX	H</span></pre>
<pre id="l2795"><span class="adr">ECA1</span>	C9              	<span id="code2795">RET</span></pre>
<pre id="l2796"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2797"><span class="adr"></span>	                <span class="cmt">;   Get here to close a file specified by (fcb).</span></pre>
<pre id="l2798"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2799"><span class="adr">ECA2</span>	AF              <span class="l" id="label2799">CLOSEIT</span>	<span id="code2799">XRA	A	</span><span class="cmt">;clear status and file position bytes.</span></pre>
<pre id="l2800"><span class="adr">ECA3</span>	32 45 E7        	<span id="code2800">STA	STATUS</span></pre>
<pre id="l2801"><span class="adr">ECA6</span>	32 EA F1        	<span id="code2801">STA	FILEPOS</span></pre>
<pre id="l2802"><span class="adr">ECA9</span>	32 EB F1        	<span id="code2802">STA	FILEPOS+1</span></pre>
<pre id="l2803"><span class="adr">ECAC</span>	CD 1E E9        	<span id="code2803">CALL	GETWPRT	</span><span class="cmt">;get write protect bit for this drive.</span></pre>
<pre id="l2804"><span class="adr">ECAF</span>	C0              	<span id="code2804">RNZ		</span><span class="cmt">;just return if it is set.</span></pre>
<pre id="l2805"><span class="adr">ECB0</span>	CD 69 E9        	<span id="code2805">CALL	GETS2	</span><span class="cmt">;else get the 's2' byte.</span></pre>
<pre id="l2806"><span class="adr">ECB3</span>	E6 80           	<span id="code2806">ANI	80H	</span><span class="cmt">;and look at bit 7 (file unmodified?).</span></pre>
<pre id="l2807"><span class="adr">ECB5</span>	C0              	<span id="code2807">RNZ		</span><span class="cmt">;just return if set.</span></pre>
<pre id="l2808"><span class="adr">ECB6</span>	0E 0F           	<span id="code2808">MVI	C,15	</span><span class="cmt">;else look up this file in directory.</span></pre>
<pre id="l2809"><span class="adr">ECB8</span>	CD 18 EB        	<span id="code2809">CALL	FINDFST</span></pre>
<pre id="l2810"><span class="adr">ECBB</span>	CD F5 E9        	<span id="code2810">CALL	CKFILPOS</span><span class="cmt">;was it found?</span></pre>
<pre id="l2811"><span class="adr">ECBE</span>	C8              	<span id="code2811">RZ		</span><span class="cmt">;just return if not.</span></pre>
<pre id="l2812"><span class="adr">ECBF</span>	01 10 00        	<span id="code2812">LXI	B,16	</span><span class="cmt">;set (HL) pointing to records used section.</span></pre>
<pre id="l2813"><span class="adr">ECC2</span>	CD 5E E9        	<span id="code2813">CALL	FCB2HL</span></pre>
<pre id="l2814"><span class="adr">ECC5</span>	09              	<span id="code2814">DAD	B</span></pre>
<pre id="l2815"><span class="adr">ECC6</span>	EB              	<span id="code2815">XCHG</span></pre>
<pre id="l2816"><span class="adr">ECC7</span>	2A 43 E7        	<span id="code2816">LHLD	PARAMS	</span><span class="cmt">;do the same for users specified fcb.</span></pre>
<pre id="l2817"><span class="adr">ECCA</span>	09              	<span id="code2817">DAD	B</span></pre>
<pre id="l2818"><span class="adr">ECCB</span>	0E 10           	<span id="code2818">MVI	C,16	</span><span class="cmt">;this many bytes are present in this extent.</span></pre>
<pre id="l2819"><span class="adr">ECCD</span>	3A DD F1        <span class="l" id="label2819">CLOSEIT1</span><span id="code2819">:LDA	BIGDISK	</span><span class="cmt">;8 or 16 bit record numbers?</span></pre>
<pre id="l2820"><span class="adr">ECD0</span>	B7              	<span id="code2820">ORA	A</span></pre>
<pre id="l2821"><span class="adr">ECD1</span>	CA E8 EC        	<span id="code2821">JZ	CLOSEIT4</span></pre>
<pre id="l2822"><span class="adr">ECD4</span>	7E              	<span id="code2822">MOV	A,M	</span><span class="cmt">;just 8 bit. Get one from users fcb.</span></pre>
<pre id="l2823"><span class="adr">ECD5</span>	B7              	<span id="code2823">ORA	A</span></pre>
<pre id="l2824"><span class="adr">ECD6</span>	1A              	<span id="code2824">LDAX	D	</span><span class="cmt">;now get one from directory fcb.</span></pre>
<pre id="l2825"><span class="adr">ECD7</span>	C2 DB EC        	<span id="code2825">JNZ	CLOSEIT2</span></pre>
<pre id="l2826"><span class="adr">ECDA</span>	77              	<span id="code2826">MOV	M,A	</span><span class="cmt">;users byte was zero. Update from directory.</span></pre>
<pre id="l2827"><span class="adr">ECDB</span>	B7              <span class="l" id="label2827">CLOSEIT2</span><span id="code2827">:ORA	A</span></pre>
<pre id="l2828"><span class="adr">ECDC</span>	C2 E1 EC        	<span id="code2828">JNZ	CLOSEIT3</span></pre>
<pre id="l2829"><span class="adr">ECDF</span>	7E              	<span id="code2829">MOV	A,M	</span><span class="cmt">;directories byte was zero, update from users fcb.</span></pre>
<pre id="l2830"><span class="adr">ECE0</span>	12              	<span id="code2830">STAX	D</span></pre>
<pre id="l2831"><span class="adr">ECE1</span>	BE              <span class="l" id="label2831">CLOSEIT3</span><span id="code2831">:CMP	M	</span><span class="cmt">;if neither one of these bytes were zero,</span></pre>
<pre id="l2832"><span class="adr">ECE2</span>	C2 1F ED        	<span id="code2832">JNZ	CLOSEIT7	</span><span class="cmt">;then close error if they are not the same.</span></pre>
<pre id="l2833"><span class="adr">ECE5</span>	C3 FD EC        	<span id="code2833">JMP	CLOSEIT5	</span><span class="cmt">;ok so far, get to next byte in fcbs.</span></pre>
<pre id="l2834"><span class="adr">ECE8</span>	CD 94 EC        <span class="l" id="label2834">CLOSEIT4</span><span id="code2834">:CALL	MOVEWORD</span><span class="cmt">;update users fcb if it is zero.</span></pre>
<pre id="l2835"><span class="adr">ECEB</span>	EB              	<span id="code2835">XCHG</span></pre>
<pre id="l2836"><span class="adr">ECEC</span>	CD 94 EC        	<span id="code2836">CALL	MOVEWORD</span><span class="cmt">;update directories fcb if it is zero.</span></pre>
<pre id="l2837"><span class="adr">ECEF</span>	EB              	<span id="code2837">XCHG</span></pre>
<pre id="l2838"><span class="adr">ECF0</span>	1A              	<span id="code2838">LDAX	D	</span><span class="cmt">;if these two values are no different,</span></pre>
<pre id="l2839"><span class="adr">ECF1</span>	BE              	<span id="code2839">CMP	M	</span><span class="cmt">;then a close error occured.</span></pre>
<pre id="l2840"><span class="adr">ECF2</span>	C2 1F ED        	<span id="code2840">JNZ	CLOSEIT7</span></pre>
<pre id="l2841"><span class="adr">ECF5</span>	13              	<span id="code2841">INX	D	</span><span class="cmt">;check second byte.</span></pre>
<pre id="l2842"><span class="adr">ECF6</span>	23              	<span id="code2842">INX	H</span></pre>
<pre id="l2843"><span class="adr">ECF7</span>	1A              	<span id="code2843">LDAX	D</span></pre>
<pre id="l2844"><span class="adr">ECF8</span>	BE              	<span id="code2844">CMP	M</span></pre>
<pre id="l2845"><span class="adr">ECF9</span>	C2 1F ED        	<span id="code2845">JNZ	CLOSEIT7</span></pre>
<pre id="l2846"><span class="adr">ECFC</span>	0D              	<span id="code2846">DCR	C	</span><span class="cmt">;remember 16 bit values.</span></pre>
<pre id="l2847"><span class="adr">ECFD</span>	13              <span class="l" id="label2847">CLOSEIT5</span><span id="code2847">:INX	D	</span><span class="cmt">;bump to next item in table.</span></pre>
<pre id="l2848"><span class="adr">ECFE</span>	23              	<span id="code2848">INX	H</span></pre>
<pre id="l2849"><span class="adr">ECFF</span>	0D              	<span id="code2849">DCR	C	</span><span class="cmt">;there are 16 entries only.</span></pre>
<pre id="l2850"><span class="adr">ED00</span>	C2 CD EC        	<span id="code2850">JNZ	CLOSEIT1</span><span class="cmt">;continue if more to do.</span></pre>
<pre id="l2851"><span class="adr">ED03</span>	01 EC FF        	<span id="code2851">LXI	B,0FFECH</span><span class="cmt">;backup 20 places (extent byte).</span></pre>
<pre id="l2852"><span class="adr">ED06</span>	09              	<span id="code2852">DAD	B</span></pre>
<pre id="l2853"><span class="adr">ED07</span>	EB              	<span id="code2853">XCHG</span></pre>
<pre id="l2854"><span class="adr">ED08</span>	09              	<span id="code2854">DAD	B</span></pre>
<pre id="l2855"><span class="adr">ED09</span>	1A              	<span id="code2855">LDAX	D</span></pre>
<pre id="l2856"><span class="adr">ED0A</span>	BE              	<span id="code2856">CMP	M	</span><span class="cmt">;directory's extent already greater than the</span></pre>
<pre id="l2857"><span class="adr">ED0B</span>	DA 17 ED        	<span id="code2857">JC	CLOSEIT6	</span><span class="cmt">;users extent?</span></pre>
<pre id="l2858"><span class="adr">ED0E</span>	77              	<span id="code2858">MOV	M,A	</span><span class="cmt">;no, update directory extent.</span></pre>
<pre id="l2859"><span class="adr">ED0F</span>	01 03 00        	<span id="code2859">LXI	B,3	</span><span class="cmt">;and update the record count byte in</span></pre>
<pre id="l2860"><span class="adr">ED12</span>	09              	<span id="code2860">DAD	B	</span><span class="cmt">;directories fcb.</span></pre>
<pre id="l2861"><span class="adr">ED13</span>	EB              	<span id="code2861">XCHG</span></pre>
<pre id="l2862"><span class="adr">ED14</span>	09              	<span id="code2862">DAD	B</span></pre>
<pre id="l2863"><span class="adr">ED15</span>	7E              	<span id="code2863">MOV	A,M	</span><span class="cmt">;get from user.</span></pre>
<pre id="l2864"><span class="adr">ED16</span>	12              	<span id="code2864">STAX	D	</span><span class="cmt">;and put in directory.</span></pre>
<pre id="l2865"><span class="adr">ED17</span>	3E FF           <span class="l" id="label2865">CLOSEIT6</span><span id="code2865">:MVI	A,0FFH	</span><span class="cmt">;set 'was open and is now closed' byte.</span></pre>
<pre id="l2866"><span class="adr">ED19</span>	32 D2 F1        	<span id="code2866">STA	CLOSEFLG</span></pre>
<pre id="l2867"><span class="adr">ED1C</span>	C3 10 EC        	<span id="code2867">JMP	UPDATE1	</span><span class="cmt">;update the directory now.</span></pre>
<pre id="l2868"><span class="adr">ED1F</span>	21 45 E7        <span class="l" id="label2868">CLOSEIT7</span><span id="code2868">:LXI	H,STATUS</span><span class="cmt">;set return status and then return.</span></pre>
<pre id="l2869"><span class="adr">ED22</span>	35              	<span id="code2869">DCR	M</span></pre>
<pre id="l2870"><span class="adr">ED23</span>	C9              	<span id="code2870">RET</span></pre>
<pre id="l2871"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2872"><span class="adr"></span>	                <span class="cmt">;   Routine to get the next empty space in the directory. It</span></pre>
<pre id="l2873"><span class="adr"></span>	                <span class="cmt">; will then be cleared for use.</span></pre>
<pre id="l2874"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2875"><span class="adr">ED24</span>	CD 54 E9        <span class="l" id="label2875">GETEMPTY</span><span id="code2875">:CALL	CHKWPRT	</span><span class="cmt">;make sure disk is not write protected.</span></pre>
<pre id="l2876"><span class="adr">ED27</span>	2A 43 E7        	<span id="code2876">LHLD	PARAMS	</span><span class="cmt">;save current parameters (fcb).</span></pre>
<pre id="l2877"><span class="adr">ED2A</span>	E5              	<span id="code2877">PUSH	H</span></pre>
<pre id="l2878"><span class="adr">ED2B</span>	21 AC F1        	<span id="code2878">LXI	H,EMPTYFCB</span><span class="cmt">;use special one for empty space.</span></pre>
<pre id="l2879"><span class="adr">ED2E</span>	22 43 E7        	<span id="code2879">SHLD	PARAMS</span></pre>
<pre id="l2880"><span class="adr">ED31</span>	0E 01           	<span id="code2880">MVI	C,1	</span><span class="cmt">;search for first empty spot in directory.</span></pre>
<pre id="l2881"><span class="adr">ED33</span>	CD 18 EB        	<span id="code2881">CALL	FINDFST	</span><span class="cmt">;(* only check first byte *)</span></pre>
<pre id="l2882"><span class="adr">ED36</span>	CD F5 E9        	<span id="code2882">CALL	CKFILPOS</span><span class="cmt">;none?</span></pre>
<pre id="l2883"><span class="adr">ED39</span>	E1              	<span id="code2883">POP	H</span></pre>
<pre id="l2884"><span class="adr">ED3A</span>	22 43 E7        	<span id="code2884">SHLD	PARAMS	</span><span class="cmt">;restore original fcb address.</span></pre>
<pre id="l2885"><span class="adr">ED3D</span>	C8              	<span id="code2885">RZ		</span><span class="cmt">;return if no more space.</span></pre>
<pre id="l2886"><span class="adr">ED3E</span>	EB              	<span id="code2886">XCHG</span></pre>
<pre id="l2887"><span class="adr">ED3F</span>	21 0F 00        	<span id="code2887">LXI	H,15	</span><span class="cmt">;point to number of records for this file.</span></pre>
<pre id="l2888"><span class="adr">ED42</span>	19              	<span id="code2888">DAD	D</span></pre>
<pre id="l2889"><span class="adr">ED43</span>	0E 11           	<span id="code2889">MVI	C,17	</span><span class="cmt">;and clear all of this space.</span></pre>
<pre id="l2890"><span class="adr">ED45</span>	AF              	<span id="code2890">XRA	A</span></pre>
<pre id="l2891"><span class="adr">ED46</span>	77              <span class="l" id="label2891">GETMT1</span>	<span id="code2891">MOV	M,A</span></pre>
<pre id="l2892"><span class="adr">ED47</span>	23              	<span id="code2892">INX	H</span></pre>
<pre id="l2893"><span class="adr">ED48</span>	0D              	<span id="code2893">DCR	C</span></pre>
<pre id="l2894"><span class="adr">ED49</span>	C2 46 ED        	<span id="code2894">JNZ	GETMT1</span></pre>
<pre id="l2895"><span class="adr">ED4C</span>	21 0D 00        	<span id="code2895">LXI	H,13	</span><span class="cmt">;clear the 's1' byte also.</span></pre>
<pre id="l2896"><span class="adr">ED4F</span>	19              	<span id="code2896">DAD	D</span></pre>
<pre id="l2897"><span class="adr">ED50</span>	77              	<span id="code2897">MOV	M,A</span></pre>
<pre id="l2898"><span class="adr">ED51</span>	CD 8C E9        	<span id="code2898">CALL	CHKNMBR	</span><span class="cmt">;keep (SCRATCH1) within bounds.</span></pre>
<pre id="l2899"><span class="adr">ED54</span>	CD FD EB        	<span id="code2899">CALL	FCBSET	</span><span class="cmt">;write out this fcb entry to directory.</span></pre>
<pre id="l2900"><span class="adr">ED57</span>	C3 78 E9        	<span id="code2900">JMP	SETS2B7	</span><span class="cmt">;set 's2' byte bit 7 (unmodified at present).</span></pre>
<pre id="l2901"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2902"><span class="adr"></span>	                <span class="cmt">;   Routine to close the current extent and open the next one</span></pre>
<pre id="l2903"><span class="adr"></span>	                <span class="cmt">; for reading.</span></pre>
<pre id="l2904"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2905"><span class="adr">ED5A</span>	AF              <span class="l" id="label2905">GETNEXT</span>	<span id="code2905">XRA	A</span></pre>
<pre id="l2906"><span class="adr">ED5B</span>	32 D2 F1        	<span id="code2906">STA	CLOSEFLG</span><span class="cmt">;clear close flag.</span></pre>
<pre id="l2907"><span class="adr">ED5E</span>	CD A2 EC        	<span id="code2907">CALL	CLOSEIT	</span><span class="cmt">;close this extent.</span></pre>
<pre id="l2908"><span class="adr">ED61</span>	CD F5 E9        	<span id="code2908">CALL	CKFILPOS</span></pre>
<pre id="l2909"><span class="adr">ED64</span>	C8              	<span id="code2909">RZ		</span><span class="cmt">;not there???</span></pre>
<pre id="l2910"><span class="adr">ED65</span>	2A 43 E7        	<span id="code2910">LHLD	PARAMS	</span><span class="cmt">;get extent byte.</span></pre>
<pre id="l2911"><span class="adr">ED68</span>	01 0C 00        	<span id="code2911">LXI	B,12</span></pre>
<pre id="l2912"><span class="adr">ED6B</span>	09              	<span id="code2912">DAD	B</span></pre>
<pre id="l2913"><span class="adr">ED6C</span>	7E              	<span id="code2913">MOV	A,M	</span><span class="cmt">;and increment it.</span></pre>
<pre id="l2914"><span class="adr">ED6D</span>	3C              	<span id="code2914">INR	A</span></pre>
<pre id="l2915"><span class="adr">ED6E</span>	E6 1F           	<span id="code2915">ANI	1FH	</span><span class="cmt">;keep within range 0-31.</span></pre>
<pre id="l2916"><span class="adr">ED70</span>	77              	<span id="code2916">MOV	M,A</span></pre>
<pre id="l2917"><span class="adr">ED71</span>	CA 83 ED        	<span id="code2917">JZ	GTNEXT1	</span><span class="cmt">;overflow?</span></pre>
<pre id="l2918"><span class="adr">ED74</span>	47              	<span id="code2918">MOV	B,A	</span><span class="cmt">;mask extent byte.</span></pre>
<pre id="l2919"><span class="adr">ED75</span>	3A C5 F1        	<span id="code2919">LDA	EXTMASK</span></pre>
<pre id="l2920"><span class="adr">ED78</span>	A0              	<span id="code2920">ANA	B</span></pre>
<pre id="l2921"><span class="adr">ED79</span>	21 D2 F1        	<span id="code2921">LXI	H,CLOSEFLG</span><span class="cmt">;check close flag (0ffh is ok).</span></pre>
<pre id="l2922"><span class="adr">ED7C</span>	A6              	<span id="code2922">ANA	M</span></pre>
<pre id="l2923"><span class="adr">ED7D</span>	CA 8E ED        	<span id="code2923">JZ	GTNEXT2	</span><span class="cmt">;if zero, we must read in next extent.</span></pre>
<pre id="l2924"><span class="adr">ED80</span>	C3 AC ED        	<span id="code2924">JMP	GTNEXT3	</span><span class="cmt">;else, it is already in memory.</span></pre>
<pre id="l2925"><span class="adr">ED83</span>	01 02 00        <span class="l" id="label2925">GTNEXT1</span>	<span id="code2925">LXI	B,2	</span><span class="cmt">;Point to the 's2' byte.</span></pre>
<pre id="l2926"><span class="adr">ED86</span>	09              	<span id="code2926">DAD	B</span></pre>
<pre id="l2927"><span class="adr">ED87</span>	34              	<span id="code2927">INR	M	</span><span class="cmt">;and bump it.</span></pre>
<pre id="l2928"><span class="adr">ED88</span>	7E              	<span id="code2928">MOV	A,M	</span><span class="cmt">;too many extents?</span></pre>
<pre id="l2929"><span class="adr">ED89</span>	E6 0F           	<span id="code2929">ANI	0FH</span></pre>
<pre id="l2930"><span class="adr">ED8B</span>	CA B6 ED        	<span id="code2930">JZ	GTNEXT5	</span><span class="cmt">;yes, set error code.</span></pre>
<pre id="l2931"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2932"><span class="adr"></span>	                <span class="cmt">;   Get here to open the next extent.</span></pre>
<pre id="l2933"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2934"><span class="adr">ED8E</span>	0E 0F           <span class="l" id="label2934">GTNEXT2</span>	<span id="code2934">MVI	C,15	</span><span class="cmt">;set to check first 15 bytes of fcb.</span></pre>
<pre id="l2935"><span class="adr">ED90</span>	CD 18 EB        	<span id="code2935">CALL	FINDFST	</span><span class="cmt">;find the first one.</span></pre>
<pre id="l2936"><span class="adr">ED93</span>	CD F5 E9        	<span id="code2936">CALL	CKFILPOS</span><span class="cmt">;none available?</span></pre>
<pre id="l2937"><span class="adr">ED96</span>	C2 AC ED        	<span id="code2937">JNZ	GTNEXT3</span></pre>
<pre id="l2938"><span class="adr">ED99</span>	3A D3 F1        	<span id="code2938">LDA	RDWRTFLG</span><span class="cmt">;no extent present. Can we open an empty one?</span></pre>
<pre id="l2939"><span class="adr">ED9C</span>	3C              	<span id="code2939">INR	A	</span><span class="cmt">;0ffh means reading (so not possible).</span></pre>
<pre id="l2940"><span class="adr">ED9D</span>	CA B6 ED        	<span id="code2940">JZ	GTNEXT5	</span><span class="cmt">;or an error.</span></pre>
<pre id="l2941"><span class="adr">EDA0</span>	CD 24 ED        	<span id="code2941">CALL	GETEMPTY</span><span class="cmt">;we are writing, get an empty entry.</span></pre>
<pre id="l2942"><span class="adr">EDA3</span>	CD F5 E9        	<span id="code2942">CALL	CKFILPOS</span><span class="cmt">;none?</span></pre>
<pre id="l2943"><span class="adr">EDA6</span>	CA B6 ED        	<span id="code2943">JZ	GTNEXT5	</span><span class="cmt">;error if true.</span></pre>
<pre id="l2944"><span class="adr">EDA9</span>	C3 AF ED        	<span id="code2944">JMP	GTNEXT4	</span><span class="cmt">;else we are almost done.</span></pre>
<pre id="l2945"><span class="adr">EDAC</span>	CD 5A EC        <span class="l" id="label2945">GTNEXT3</span>	<span id="code2945">CALL	OPENIT1	</span><span class="cmt">;open this extent.</span></pre>
<pre id="l2946"><span class="adr">EDAF</span>	CD BB E8        <span class="l" id="label2946">GTNEXT4</span>	<span id="code2946">CALL	STRDATA	</span><span class="cmt">;move in updated data (rec #, extent #, etc.)</span></pre>
<pre id="l2947"><span class="adr">EDB2</span>	AF              	<span id="code2947">XRA	A	</span><span class="cmt">;clear status and return.</span></pre>
<pre id="l2948"><span class="adr">EDB3</span>	C3 01 E7        	<span id="code2948">JMP	SETSTAT</span></pre>
<pre id="l2949"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2950"><span class="adr"></span>	                <span class="cmt">;   Error in extending the file. Too many extents were needed</span></pre>
<pre id="l2951"><span class="adr"></span>	                <span class="cmt">; or not enough space on the disk.</span></pre>
<pre id="l2952"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2953"><span class="adr">EDB6</span>	CD 05 E7        <span class="l" id="label2953">GTNEXT5</span>	<span id="code2953">CALL	IOERR1	</span><span class="cmt">;set error code, clear bit 7 of 's2'</span></pre>
<pre id="l2954"><span class="adr">EDB9</span>	C3 78 E9        	<span id="code2954">JMP	SETS2B7	</span><span class="cmt">;so this is not written on a close.</span></pre>
<pre id="l2955"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2956"><span class="adr"></span>	                <span class="cmt">;   Read a sequential file.</span></pre>
<pre id="l2957"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2958"><span class="adr">EDBC</span>	3E 01           <span class="l" id="label2958">RDSEQ</span>	<span id="code2958">MVI	A,1	</span><span class="cmt">;set sequential access mode.</span></pre>
<pre id="l2959"><span class="adr">EDBE</span>	32 D5 F1        	<span id="code2959">STA	MODE</span></pre>
<pre id="l2960"><span class="adr">EDC1</span>	3E FF           <span class="l" id="label2960">RDSEQ1</span>	<span id="code2960">MVI	A,0FFH	</span><span class="cmt">;don't allow reading unwritten space.</span></pre>
<pre id="l2961"><span class="adr">EDC3</span>	32 D3 F1        	<span id="code2961">STA	RDWRTFLG</span></pre>
<pre id="l2962"><span class="adr">EDC6</span>	CD BB E8        	<span id="code2962">CALL	STRDATA	</span><span class="cmt">;put rec# and ext# into fcb.</span></pre>
<pre id="l2963"><span class="adr">EDC9</span>	3A E3 F1        	<span id="code2963">LDA	SAVNREC	</span><span class="cmt">;get next record to read.</span></pre>
<pre id="l2964"><span class="adr">EDCC</span>	21 E1 F1        	<span id="code2964">LXI	H,SAVNXT</span><span class="cmt">;get number of records in extent.</span></pre>
<pre id="l2965"><span class="adr">EDCF</span>	BE              	<span id="code2965">CMP	M	</span><span class="cmt">;within this extent?</span></pre>
<pre id="l2966"><span class="adr">EDD0</span>	DA E6 ED        	<span id="code2966">JC	RDSEQ2</span></pre>
<pre id="l2967"><span class="adr">EDD3</span>	FE 80           	<span id="code2967">CPI	128	</span><span class="cmt">;no. Is this extent fully used?</span></pre>
<pre id="l2968"><span class="adr">EDD5</span>	C2 FB ED        	<span id="code2968">JNZ	RDSEQ3	</span><span class="cmt">;no. End-of-file.</span></pre>
<pre id="l2969"><span class="adr">EDD8</span>	CD 5A ED        	<span id="code2969">CALL	GETNEXT	</span><span class="cmt">;yes, open the next one.</span></pre>
<pre id="l2970"><span class="adr">EDDB</span>	AF              	<span id="code2970">XRA	A	</span><span class="cmt">;reset next record to read.</span></pre>
<pre id="l2971"><span class="adr">EDDC</span>	32 E3 F1        	<span id="code2971">STA	SAVNREC</span></pre>
<pre id="l2972"><span class="adr">EDDF</span>	3A 45 E7        	<span id="code2972">LDA	STATUS	</span><span class="cmt">;check on open, successful?</span></pre>
<pre id="l2973"><span class="adr">EDE2</span>	B7              	<span id="code2973">ORA	A</span></pre>
<pre id="l2974"><span class="adr">EDE3</span>	C2 FB ED        	<span id="code2974">JNZ	RDSEQ3	</span><span class="cmt">;no, error.</span></pre>
<pre id="l2975"><span class="adr">EDE6</span>	CD 77 E8        <span class="l" id="label2975">RDSEQ2</span>	<span id="code2975">CALL	COMBLK	</span><span class="cmt">;ok. compute block number to read.</span></pre>
<pre id="l2976"><span class="adr">EDE9</span>	CD 84 E8        	<span id="code2976">CALL	CHKBLK	</span><span class="cmt">;check it. Within bounds?</span></pre>
<pre id="l2977"><span class="adr">EDEC</span>	CA FB ED        	<span id="code2977">JZ	RDSEQ3	</span><span class="cmt">;no, error.</span></pre>
<pre id="l2978"><span class="adr">EDEF</span>	CD 8A E8        	<span id="code2978">CALL	LOGICAL	</span><span class="cmt">;convert (BLKNMBR) to logical sector (128 byte).</span></pre>
<pre id="l2979"><span class="adr">EDF2</span>	CD D1 E7        	<span id="code2979">CALL	TRKSEC1	</span><span class="cmt">;set the track and sector for this block #.</span></pre>
<pre id="l2980"><span class="adr">EDF5</span>	CD B2 E7        	<span id="code2980">CALL	DOREAD	</span><span class="cmt">;and read it.</span></pre>
<pre id="l2981"><span class="adr">EDF8</span>	C3 D2 E8        	<span id="code2981">JMP	SETNREC	</span><span class="cmt">;and set the next record to be accessed.</span></pre>
<pre id="l2982"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2983"><span class="adr"></span>	                <span class="cmt">;   Read error occured. Set status and return.</span></pre>
<pre id="l2984"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2985"><span class="adr">EDFB</span>	C3 05 E7        <span class="l" id="label2985">RDSEQ3</span>	<span id="code2985">JMP	IOERR1</span></pre>
<pre id="l2986"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2987"><span class="adr"></span>	                <span class="cmt">;   Write the next sequential record.</span></pre>
<pre id="l2988"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l2989"><span class="adr">EDFE</span>	3E 01           <span class="l" id="label2989">WTSEQ</span>	<span id="code2989">MVI	A,1	</span><span class="cmt">;set sequential access mode.</span></pre>
<pre id="l2990"><span class="adr">EE00</span>	32 D5 F1        	<span id="code2990">STA	MODE</span></pre>
<pre id="l2991"><span class="adr">EE03</span>	3E 00           <span class="l" id="label2991">WTSEQ1</span>	<span id="code2991">MVI	A,0	</span><span class="cmt">;allow an addition empty extent to be opened.</span></pre>
<pre id="l2992"><span class="adr">EE05</span>	32 D3 F1        	<span id="code2992">STA	RDWRTFLG</span></pre>
<pre id="l2993"><span class="adr">EE08</span>	CD 54 E9        	<span id="code2993">CALL	CHKWPRT	</span><span class="cmt">;check write protect status.</span></pre>
<pre id="l2994"><span class="adr">EE0B</span>	2A 43 E7        	<span id="code2994">LHLD	PARAMS</span></pre>
<pre id="l2995"><span class="adr">EE0E</span>	CD 47 E9        	<span id="code2995">CALL	CKROF1	</span><span class="cmt">;check for read only file, (HL) already set to fcb.</span></pre>
<pre id="l2996"><span class="adr">EE11</span>	CD BB E8        	<span id="code2996">CALL	STRDATA	</span><span class="cmt">;put updated data into fcb.</span></pre>
<pre id="l2997"><span class="adr">EE14</span>	3A E3 F1        	<span id="code2997">LDA	SAVNREC	</span><span class="cmt">;get record number to write.</span></pre>
<pre id="l2998"><span class="adr">EE17</span>	FE 80           	<span id="code2998">CPI	128	</span><span class="cmt">;within range?</span></pre>
<pre id="l2999"><span class="adr">EE19</span>	D2 05 E7        	<span id="code2999">JNC	IOERR1	</span><span class="cmt">;no, error(?).</span></pre>
<pre id="l3000"><span class="adr">EE1C</span>	CD 77 E8        	<span id="code3000">CALL	COMBLK	</span><span class="cmt">;compute block number.</span></pre>
<pre id="l3001"><span class="adr">EE1F</span>	CD 84 E8        	<span id="code3001">CALL	CHKBLK	</span><span class="cmt">;check number.</span></pre>
<pre id="l3002"><span class="adr">EE22</span>	0E 00           	<span id="code3002">MVI	C,0	</span><span class="cmt">;is there one to write to?</span></pre>
<pre id="l3003"><span class="adr">EE24</span>	C2 6E EE        	<span id="code3003">JNZ	WTSEQ6	</span><span class="cmt">;yes, go do it.</span></pre>
<pre id="l3004"><span class="adr">EE27</span>	CD 3E E8        	<span id="code3004">CALL	GETBLOCK</span><span class="cmt">;get next block number within fcb to use.</span></pre>
<pre id="l3005"><span class="adr">EE2A</span>	32 D7 F1        	<span id="code3005">STA	RELBLOCK</span><span class="cmt">;and save.</span></pre>
<pre id="l3006"><span class="adr">EE2D</span>	01 00 00        	<span id="code3006">LXI	B,0	</span><span class="cmt">;start looking for space from the start</span></pre>
<pre id="l3007"><span class="adr">EE30</span>	B7              	<span id="code3007">ORA	A	</span><span class="cmt">;if none allocated as yet.</span></pre>
<pre id="l3008"><span class="adr">EE31</span>	CA 3B EE        	<span id="code3008">JZ	WTSEQ2</span></pre>
<pre id="l3009"><span class="adr">EE34</span>	4F              	<span id="code3009">MOV	C,A	</span><span class="cmt">;extract previous block number from fcb</span></pre>
<pre id="l3010"><span class="adr">EE35</span>	0B              	<span id="code3010">DCX	B	</span><span class="cmt">;so we can be closest to it.</span></pre>
<pre id="l3011"><span class="adr">EE36</span>	CD 5E E8        	<span id="code3011">CALL	EXTBLK</span></pre>
<pre id="l3012"><span class="adr">EE39</span>	44              	<span id="code3012">MOV	B,H</span></pre>
<pre id="l3013"><span class="adr">EE3A</span>	4D              	<span id="code3013">MOV	C,L</span></pre>
<pre id="l3014"><span class="adr">EE3B</span>	CD BE EB        <span class="l" id="label3014">WTSEQ2</span>	<span id="code3014">CALL	FNDSPACE</span><span class="cmt">;find the next empty block nearest number (BC).</span></pre>
<pre id="l3015"><span class="adr">EE3E</span>	7D              	<span id="code3015">MOV	A,L	</span><span class="cmt">;check for a zero number.</span></pre>
<pre id="l3016"><span class="adr">EE3F</span>	B4              	<span id="code3016">ORA	H</span></pre>
<pre id="l3017"><span class="adr">EE40</span>	C2 48 EE        	<span id="code3017">JNZ	WTSEQ3</span></pre>
<pre id="l3018"><span class="adr">EE43</span>	3E 02           	<span id="code3018">MVI	A,2	</span><span class="cmt">;no more space?</span></pre>
<pre id="l3019"><span class="adr">EE45</span>	C3 01 E7        	<span id="code3019">JMP	SETSTAT</span></pre>
<pre id="l3020"><span class="adr">EE48</span>	22 E5 F1        <span class="l" id="label3020">WTSEQ3</span>	<span id="code3020">SHLD	BLKNMBR	</span><span class="cmt">;save block number to access.</span></pre>
<pre id="l3021"><span class="adr">EE4B</span>	EB              	<span id="code3021">XCHG		</span><span class="cmt">;put block number into (DE).</span></pre>
<pre id="l3022"><span class="adr">EE4C</span>	2A 43 E7        	<span id="code3022">LHLD	PARAMS	</span><span class="cmt">;now we must update the fcb for this</span></pre>
<pre id="l3023"><span class="adr">EE4F</span>	01 10 00        	<span id="code3023">LXI	B,16	</span><span class="cmt">;newly allocated block.</span></pre>
<pre id="l3024"><span class="adr">EE52</span>	09              	<span id="code3024">DAD	B</span></pre>
<pre id="l3025"><span class="adr">EE53</span>	3A DD F1        	<span id="code3025">LDA	BIGDISK	</span><span class="cmt">;8 or 16 bit block numbers?</span></pre>
<pre id="l3026"><span class="adr">EE56</span>	B7              	<span id="code3026">ORA	A</span></pre>
<pre id="l3027"><span class="adr">EE57</span>	3A D7 F1        	<span id="code3027">LDA	RELBLOCK	</span><span class="cmt">;(* update this entry *)</span></pre>
<pre id="l3028"><span class="adr">EE5A</span>	CA 64 EE        	<span id="code3028">JZ	WTSEQ4	</span><span class="cmt">;zero means 16 bit ones.</span></pre>
<pre id="l3029"><span class="adr">EE5D</span>	CD 64 E9        	<span id="code3029">CALL	ADDA2HL	</span><span class="cmt">;(HL)=(HL)+(A)</span></pre>
<pre id="l3030"><span class="adr">EE60</span>	73              	<span id="code3030">MOV	M,E	</span><span class="cmt">;store new block number.</span></pre>
<pre id="l3031"><span class="adr">EE61</span>	C3 6C EE        	<span id="code3031">JMP	WTSEQ5</span></pre>
<pre id="l3032"><span class="adr">EE64</span>	4F              <span class="l" id="label3032">WTSEQ4</span>	<span id="code3032">MOV	C,A	</span><span class="cmt">;compute spot in this 16 bit table.</span></pre>
<pre id="l3033"><span class="adr">EE65</span>	06 00           	<span id="code3033">MVI	B,0</span></pre>
<pre id="l3034"><span class="adr">EE67</span>	09              	<span id="code3034">DAD	B</span></pre>
<pre id="l3035"><span class="adr">EE68</span>	09              	<span id="code3035">DAD	B</span></pre>
<pre id="l3036"><span class="adr">EE69</span>	73              	<span id="code3036">MOV	M,E	</span><span class="cmt">;stuff block number (DE) there.</span></pre>
<pre id="l3037"><span class="adr">EE6A</span>	23              	<span id="code3037">INX	H</span></pre>
<pre id="l3038"><span class="adr">EE6B</span>	72              	<span id="code3038">MOV	M,D</span></pre>
<pre id="l3039"><span class="adr">EE6C</span>	0E 02           <span class="l" id="label3039">WTSEQ5</span>	<span id="code3039">MVI	C,2	</span><span class="cmt">;set (C) to indicate writing to un-used disk space.</span></pre>
<pre id="l3040"><span class="adr">EE6E</span>	3A 45 E7        <span class="l" id="label3040">WTSEQ6</span>	<span id="code3040">LDA	STATUS	</span><span class="cmt">;are we ok so far?</span></pre>
<pre id="l3041"><span class="adr">EE71</span>	B7              	<span id="code3041">ORA	A</span></pre>
<pre id="l3042"><span class="adr">EE72</span>	C0              	<span id="code3042">RNZ</span></pre>
<pre id="l3043"><span class="adr">EE73</span>	C5              	<span id="code3043">PUSH	B	</span><span class="cmt">;yes, save write flag for bios (register C).</span></pre>
<pre id="l3044"><span class="adr">EE74</span>	CD 8A E8        	<span id="code3044">CALL	LOGICAL	</span><span class="cmt">;convert (BLKNMBR) over to loical sectors.</span></pre>
<pre id="l3045"><span class="adr">EE77</span>	3A D5 F1        	<span id="code3045">LDA	MODE	</span><span class="cmt">;get access mode flag (1=sequential,</span></pre>
<pre id="l3046"><span class="adr">EE7A</span>	3D              	<span id="code3046">DCR	A	</span><span class="cmt">;0=random, 2=special?).</span></pre>
<pre id="l3047"><span class="adr">EE7B</span>	3D              	<span id="code3047">DCR	A</span></pre>
<pre id="l3048"><span class="adr">EE7C</span>	C2 BB EE        	<span id="code3048">JNZ	WTSEQ9</span></pre>
<pre id="l3049"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3050"><span class="adr"></span>	                <span class="cmt">;   Special random i/o from function #40. Maybe for M/PM, but the</span></pre>
<pre id="l3051"><span class="adr"></span>	                <span class="cmt">; current block, if it has not been written to, will be zeroed</span></pre>
<pre id="l3052"><span class="adr"></span>	                <span class="cmt">; out and then written (reason?).</span></pre>
<pre id="l3053"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3054"><span class="adr">EE7F</span>	C1              	<span id="code3054">POP	B</span></pre>
<pre id="l3055"><span class="adr">EE80</span>	C5              	<span id="code3055">PUSH	B</span></pre>
<pre id="l3056"><span class="adr">EE81</span>	79              	<span id="code3056">MOV	A,C	</span><span class="cmt">;get write status flag (2=writing unused space).</span></pre>
<pre id="l3057"><span class="adr">EE82</span>	3D              	<span id="code3057">DCR	A</span></pre>
<pre id="l3058"><span class="adr">EE83</span>	3D              	<span id="code3058">DCR	A</span></pre>
<pre id="l3059"><span class="adr">EE84</span>	C2 BB EE        	<span id="code3059">JNZ	WTSEQ9</span></pre>
<pre id="l3060"><span class="adr">EE87</span>	E5              	<span id="code3060">PUSH	H</span></pre>
<pre id="l3061"><span class="adr">EE88</span>	2A B9 F1        	<span id="code3061">LHLD	DIRBUF	</span><span class="cmt">;zero out the directory buffer.</span></pre>
<pre id="l3062"><span class="adr">EE8B</span>	57              	<span id="code3062">MOV	D,A	</span><span class="cmt">;note that (A) is zero here.</span></pre>
<pre id="l3063"><span class="adr">EE8C</span>	77              <span class="l" id="label3063">WTSEQ7</span>	<span id="code3063">MOV	M,A</span></pre>
<pre id="l3064"><span class="adr">EE8D</span>	23              	<span id="code3064">INX	H</span></pre>
<pre id="l3065"><span class="adr">EE8E</span>	14              	<span id="code3065">INR	D	</span><span class="cmt">;do 128 bytes.</span></pre>
<pre id="l3066"><span class="adr">EE8F</span>	F2 8C EE        	<span id="code3066">JP	WTSEQ7</span></pre>
<pre id="l3067"><span class="adr">EE92</span>	CD E0 E9        	<span id="code3067">CALL	DIRDMA	</span><span class="cmt">;tell the bios the dma address for directory access.</span></pre>
<pre id="l3068"><span class="adr">EE95</span>	2A E7 F1        	<span id="code3068">LHLD	LOGSECT	</span><span class="cmt">;get sector that starts current block.</span></pre>
<pre id="l3069"><span class="adr">EE98</span>	0E 02           	<span id="code3069">MVI	C,2	</span><span class="cmt">;set 'writing to unused space' flag.</span></pre>
<pre id="l3070"><span class="adr">EE9A</span>	22 E5 F1        <span class="l" id="label3070">WTSEQ8</span>	<span id="code3070">SHLD	BLKNMBR	</span><span class="cmt">;save sector to write.</span></pre>
<pre id="l3071"><span class="adr">EE9D</span>	C5              	<span id="code3071">PUSH	B</span></pre>
<pre id="l3072"><span class="adr">EE9E</span>	CD D1 E7        	<span id="code3072">CALL	TRKSEC1	</span><span class="cmt">;determine its track and sector numbers.</span></pre>
<pre id="l3073"><span class="adr">EEA1</span>	C1              	<span id="code3073">POP	B</span></pre>
<pre id="l3074"><span class="adr">EEA2</span>	CD B8 E7        	<span id="code3074">CALL	DOWRITE	</span><span class="cmt">;now write out 128 bytes of zeros.</span></pre>
<pre id="l3075"><span class="adr">EEA5</span>	2A E5 F1        	<span id="code3075">LHLD	BLKNMBR	</span><span class="cmt">;get sector number.</span></pre>
<pre id="l3076"><span class="adr">EEA8</span>	0E 00           	<span id="code3076">MVI	C,0	</span><span class="cmt">;set normal write flag.</span></pre>
<pre id="l3077"><span class="adr">EEAA</span>	3A C4 F1        	<span id="code3077">LDA	BLKMASK	</span><span class="cmt">;determine if we have written the entire</span></pre>
<pre id="l3078"><span class="adr">EEAD</span>	47              	<span id="code3078">MOV	B,A	</span><span class="cmt">;physical block.</span></pre>
<pre id="l3079"><span class="adr">EEAE</span>	A5              	<span id="code3079">ANA	L</span></pre>
<pre id="l3080"><span class="adr">EEAF</span>	B8              	<span id="code3080">CMP	B</span></pre>
<pre id="l3081"><span class="adr">EEB0</span>	23              	<span id="code3081">INX	H	</span><span class="cmt">;prepare for the next one.</span></pre>
<pre id="l3082"><span class="adr">EEB1</span>	C2 9A EE        	<span id="code3082">JNZ	WTSEQ8	</span><span class="cmt">;continue until (BLKMASK+1) sectors written.</span></pre>
<pre id="l3083"><span class="adr">EEB4</span>	E1              	<span id="code3083">POP	H	</span><span class="cmt">;reset next sector number.</span></pre>
<pre id="l3084"><span class="adr">EEB5</span>	22 E5 F1        	<span id="code3084">SHLD	BLKNMBR</span></pre>
<pre id="l3085"><span class="adr">EEB8</span>	CD DA E9        	<span id="code3085">CALL	DEFDMA	</span><span class="cmt">;and reset dma address.</span></pre>
<pre id="l3086"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3087"><span class="adr"></span>	                <span class="cmt">;   Normal disk write. Set the desired track and sector then</span></pre>
<pre id="l3088"><span class="adr"></span>	                <span class="cmt">; do the actual write.</span></pre>
<pre id="l3089"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3090"><span class="adr">EEBB</span>	CD D1 E7        <span class="l" id="label3090">WTSEQ9</span>	<span id="code3090">CALL	TRKSEC1	</span><span class="cmt">;determine track and sector for this write.</span></pre>
<pre id="l3091"><span class="adr">EEBE</span>	C1              	<span id="code3091">POP	B	</span><span class="cmt">;get write status flag.</span></pre>
<pre id="l3092"><span class="adr">EEBF</span>	C5              	<span id="code3092">PUSH	B</span></pre>
<pre id="l3093"><span class="adr">EEC0</span>	CD B8 E7        	<span id="code3093">CALL	DOWRITE	</span><span class="cmt">;and write this out.</span></pre>
<pre id="l3094"><span class="adr">EEC3</span>	C1              	<span id="code3094">POP	B</span></pre>
<pre id="l3095"><span class="adr">EEC4</span>	3A E3 F1        	<span id="code3095">LDA	SAVNREC	</span><span class="cmt">;get number of records in file.</span></pre>
<pre id="l3096"><span class="adr">EEC7</span>	21 E1 F1        	<span id="code3096">LXI	H,SAVNXT</span><span class="cmt">;get last record written.</span></pre>
<pre id="l3097"><span class="adr">EECA</span>	BE              	<span id="code3097">CMP	M</span></pre>
<pre id="l3098"><span class="adr">EECB</span>	DA D2 EE        	<span id="code3098">JC	WTSEQ10</span></pre>
<pre id="l3099"><span class="adr">EECE</span>	77              	<span id="code3099">MOV	M,A	</span><span class="cmt">;we have to update record count.</span></pre>
<pre id="l3100"><span class="adr">EECF</span>	34              	<span id="code3100">INR	M</span></pre>
<pre id="l3101"><span class="adr">EED0</span>	0E 02           	<span id="code3101">MVI	C,2</span></pre>
<pre id="l3102"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3103"><span class="adr"></span>	                <span class="cmt">;*   This area has been patched to correct disk update problem</span></pre>
<pre id="l3104"><span class="adr"></span>	                <span class="cmt">;* when using blocking and de-blocking in the BIOS.</span></pre>
<pre id="l3105"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3106"><span class="adr">EED2</span>	00              <span class="l" id="label3106">WTSEQ10</span>	<span id="code3106">NOP		</span><span class="cmt">;was 'dcr c'</span></pre>
<pre id="l3107"><span class="adr">EED3</span>	00              	<span id="code3107">NOP		</span><span class="cmt">;was 'dcr c'</span></pre>
<pre id="l3108"><span class="adr">EED4</span>	21 00 00        	<span id="code3108">LXI	H,0	</span><span class="cmt">;was 'jnz wtseq99'</span></pre>
<pre id="l3109"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3110"><span class="adr"></span>	                <span class="cmt">; *   End of patch.</span></pre>
<pre id="l3111"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3112"><span class="adr">EED7</span>	F5              	<span id="code3112">PUSH	PSW</span></pre>
<pre id="l3113"><span class="adr">EED8</span>	CD 69 E9        	<span id="code3113">CALL	GETS2	</span><span class="cmt">;set 'extent written to' flag.</span></pre>
<pre id="l3114"><span class="adr">EEDB</span>	E6 7F           	<span id="code3114">ANI	7FH	</span><span class="cmt">;(* clear bit 7 *)</span></pre>
<pre id="l3115"><span class="adr">EEDD</span>	77              	<span id="code3115">MOV	M,A</span></pre>
<pre id="l3116"><span class="adr">EEDE</span>	F1              	<span id="code3116">POP	PSW	</span><span class="cmt">;get record count for this extent.</span></pre>
<pre id="l3117"><span class="adr">EEDF</span>	FE 7F           <span class="l" id="label3117">WTSEQ99</span>	<span id="code3117">CPI	127	</span><span class="cmt">;is it full?</span></pre>
<pre id="l3118"><span class="adr">EEE1</span>	C2 00 EF        	<span id="code3118">JNZ	WTSEQ12</span></pre>
<pre id="l3119"><span class="adr">EEE4</span>	3A D5 F1        	<span id="code3119">LDA	MODE	</span><span class="cmt">;yes, are we in sequential mode?</span></pre>
<pre id="l3120"><span class="adr">EEE7</span>	FE 01           	<span id="code3120">CPI	1</span></pre>
<pre id="l3121"><span class="adr">EEE9</span>	C2 00 EF        	<span id="code3121">JNZ	WTSEQ12</span></pre>
<pre id="l3122"><span class="adr">EEEC</span>	CD D2 E8        	<span id="code3122">CALL	SETNREC	</span><span class="cmt">;yes, set next record number.</span></pre>
<pre id="l3123"><span class="adr">EEEF</span>	CD 5A ED        	<span id="code3123">CALL	GETNEXT	</span><span class="cmt">;and get next empty space in directory.</span></pre>
<pre id="l3124"><span class="adr">EEF2</span>	21 45 E7        	<span id="code3124">LXI	H,STATUS</span><span class="cmt">;ok?</span></pre>
<pre id="l3125"><span class="adr">EEF5</span>	7E              	<span id="code3125">MOV	A,M</span></pre>
<pre id="l3126"><span class="adr">EEF6</span>	B7              	<span id="code3126">ORA	A</span></pre>
<pre id="l3127"><span class="adr">EEF7</span>	C2 FE EE        	<span id="code3127">JNZ	WTSEQ11</span></pre>
<pre id="l3128"><span class="adr">EEFA</span>	3D              	<span id="code3128">DCR	A	</span><span class="cmt">;yes, set record count to -1.</span></pre>
<pre id="l3129"><span class="adr">EEFB</span>	32 E3 F1        	<span id="code3129">STA	SAVNREC</span></pre>
<pre id="l3130"><span class="adr">EEFE</span>	36 00           <span class="l" id="label3130">WTSEQ11</span>	<span id="code3130">MVI	M,0	</span><span class="cmt">;clear status.</span></pre>
<pre id="l3131"><span class="adr">EF00</span>	C3 D2 E8        <span class="l" id="label3131">WTSEQ12</span>	<span id="code3131">JMP	SETNREC	</span><span class="cmt">;set next record to access.</span></pre>
<pre id="l3132"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3133"><span class="adr"></span>	                <span class="cmt">;   For random i/o, set the fcb for the desired record number</span></pre>
<pre id="l3134"><span class="adr"></span>	                <span class="cmt">; based on the 'r0,r1,r2' bytes. These bytes in the fcb are</span></pre>
<pre id="l3135"><span class="adr"></span>	                <span class="cmt">; used as follows:</span></pre>
<pre id="l3136"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3137"><span class="adr"></span>	                <span class="cmt">;       fcb+35            fcb+34            fcb+33</span></pre>
<pre id="l3138"><span class="adr"></span>	                <span class="cmt">;  |     'r-2'      |      'r-1'      |      'r-0'     |</span></pre>
<pre id="l3139"><span class="adr"></span>	                <span class="cmt">;  |7             0 | 7             0 | 7             0|</span></pre>
<pre id="l3140"><span class="adr"></span>	                <span class="cmt">;  |0 0 0 0 0 0 0 0 | 0 0 0 0 0 0 0 0 | 0 0 0 0 0 0 0 0|</span></pre>
<pre id="l3141"><span class="adr"></span>	                <span class="cmt">;  |    overflow   | | extra |  extent   |   record #  |</span></pre>
<pre id="l3142"><span class="adr"></span>	                <span class="cmt">;  | ______________| |_extent|__number___|_____________|</span></pre>
<pre id="l3143"><span class="adr"></span>	                <span class="cmt">;                     also 's2'</span></pre>
<pre id="l3144"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3145"><span class="adr"></span>	                <span class="cmt">;   On entry, register (C) contains 0ffh if this is a read</span></pre>
<pre id="l3146"><span class="adr"></span>	                <span class="cmt">; and thus we can not access unwritten disk space. Otherwise,</span></pre>
<pre id="l3147"><span class="adr"></span>	                <span class="cmt">; another extent will be opened (for writing) if required.</span></pre>
<pre id="l3148"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3149"><span class="adr">EF03</span>	AF              <span class="l" id="label3149">POSITION</span><span id="code3149">:XRA	A	</span><span class="cmt">;set random i/o flag.</span></pre>
<pre id="l3150"><span class="adr">EF04</span>	32 D5 F1        	<span id="code3150">STA	MODE</span></pre>
<pre id="l3151"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3152"><span class="adr"></span>	                <span class="cmt">;   Special entry (function #40). M/PM ?</span></pre>
<pre id="l3153"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3154"><span class="adr">EF07</span>	C5              <span class="l" id="label3154">POSITN1</span>	<span id="code3154">PUSH	B	</span><span class="cmt">;save read/write flag.</span></pre>
<pre id="l3155"><span class="adr">EF08</span>	2A 43 E7        	<span id="code3155">LHLD	PARAMS	</span><span class="cmt">;get address of fcb.</span></pre>
<pre id="l3156"><span class="adr">EF0B</span>	EB              	<span id="code3156">XCHG</span></pre>
<pre id="l3157"><span class="adr">EF0C</span>	21 21 00        	<span id="code3157">LXI	H,33	</span><span class="cmt">;now get byte 'r0'.</span></pre>
<pre id="l3158"><span class="adr">EF0F</span>	19              	<span id="code3158">DAD	D</span></pre>
<pre id="l3159"><span class="adr">EF10</span>	7E              	<span id="code3159">MOV	A,M</span></pre>
<pre id="l3160"><span class="adr">EF11</span>	E6 7F           	<span id="code3160">ANI	7FH	</span><span class="cmt">;keep bits 0-6 for the record number to access.</span></pre>
<pre id="l3161"><span class="adr">EF13</span>	F5              	<span id="code3161">PUSH	PSW</span></pre>
<pre id="l3162"><span class="adr">EF14</span>	7E              	<span id="code3162">MOV	A,M	</span><span class="cmt">;now get bit 7 of 'r0' and bits 0-3 of 'r1'.</span></pre>
<pre id="l3163"><span class="adr">EF15</span>	17              	<span id="code3163">RAL</span></pre>
<pre id="l3164"><span class="adr">EF16</span>	23              	<span id="code3164">INX	H</span></pre>
<pre id="l3165"><span class="adr">EF17</span>	7E              	<span id="code3165">MOV	A,M</span></pre>
<pre id="l3166"><span class="adr">EF18</span>	17              	<span id="code3166">RAL</span></pre>
<pre id="l3167"><span class="adr">EF19</span>	E6 1F           	<span id="code3167">ANI	1FH	</span><span class="cmt">;and save this in bits 0-4 of (C).</span></pre>
<pre id="l3168"><span class="adr">EF1B</span>	4F              	<span id="code3168">MOV	C,A	</span><span class="cmt">;this is the extent byte.</span></pre>
<pre id="l3169"><span class="adr">EF1C</span>	7E              	<span id="code3169">MOV	A,M	</span><span class="cmt">;now get the extra extent byte.</span></pre>
<pre id="l3170"><span class="adr">EF1D</span>	1F              	<span id="code3170">RAR</span></pre>
<pre id="l3171"><span class="adr">EF1E</span>	1F              	<span id="code3171">RAR</span></pre>
<pre id="l3172"><span class="adr">EF1F</span>	1F              	<span id="code3172">RAR</span></pre>
<pre id="l3173"><span class="adr">EF20</span>	1F              	<span id="code3173">RAR</span></pre>
<pre id="l3174"><span class="adr">EF21</span>	E6 0F           	<span id="code3174">ANI	0FH</span></pre>
<pre id="l3175"><span class="adr">EF23</span>	47              	<span id="code3175">MOV	B,A	</span><span class="cmt">;and save it in (B).</span></pre>
<pre id="l3176"><span class="adr">EF24</span>	F1              	<span id="code3176">POP	PSW	</span><span class="cmt">;get record number back to (A).</span></pre>
<pre id="l3177"><span class="adr">EF25</span>	23              	<span id="code3177">INX	H	</span><span class="cmt">;check overflow byte 'r2'.</span></pre>
<pre id="l3178"><span class="adr">EF26</span>	6E              	<span id="code3178">MOV	L,M</span></pre>
<pre id="l3179"><span class="adr">EF27</span>	2C              	<span id="code3179">INR	L</span></pre>
<pre id="l3180"><span class="adr">EF28</span>	2D              	<span id="code3180">DCR	L</span></pre>
<pre id="l3181"><span class="adr">EF29</span>	2E 06           	<span id="code3181">MVI	L,6	</span><span class="cmt">;prepare for error.</span></pre>
<pre id="l3182"><span class="adr">EF2B</span>	C2 8B EF        	<span id="code3182">JNZ	POSITN5	</span><span class="cmt">;out of disk space error.</span></pre>
<pre id="l3183"><span class="adr">EF2E</span>	21 20 00        	<span id="code3183">LXI	H,32	</span><span class="cmt">;store record number into fcb.</span></pre>
<pre id="l3184"><span class="adr">EF31</span>	19              	<span id="code3184">DAD	D</span></pre>
<pre id="l3185"><span class="adr">EF32</span>	77              	<span id="code3185">MOV	M,A</span></pre>
<pre id="l3186"><span class="adr">EF33</span>	21 0C 00        	<span id="code3186">LXI	H,12	</span><span class="cmt">;and now check the extent byte.</span></pre>
<pre id="l3187"><span class="adr">EF36</span>	19              	<span id="code3187">DAD	D</span></pre>
<pre id="l3188"><span class="adr">EF37</span>	79              	<span id="code3188">MOV	A,C</span></pre>
<pre id="l3189"><span class="adr">EF38</span>	96              	<span id="code3189">SUB	M	</span><span class="cmt">;same extent as before?</span></pre>
<pre id="l3190"><span class="adr">EF39</span>	C2 47 EF        	<span id="code3190">JNZ	POSITN2</span></pre>
<pre id="l3191"><span class="adr">EF3C</span>	21 0E 00        	<span id="code3191">LXI	H,14	</span><span class="cmt">;yes, check extra extent byte 's2' also.</span></pre>
<pre id="l3192"><span class="adr">EF3F</span>	19              	<span id="code3192">DAD	D</span></pre>
<pre id="l3193"><span class="adr">EF40</span>	78              	<span id="code3193">MOV	A,B</span></pre>
<pre id="l3194"><span class="adr">EF41</span>	96              	<span id="code3194">SUB	M</span></pre>
<pre id="l3195"><span class="adr">EF42</span>	E6 7F           	<span id="code3195">ANI	7FH</span></pre>
<pre id="l3196"><span class="adr">EF44</span>	CA 7F EF        	<span id="code3196">JZ	POSITN3</span><span class="cmt">;same, we are almost done then.</span></pre>
<pre id="l3197"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3198"><span class="adr"></span>	                <span class="cmt">;  Get here when another extent is required.</span></pre>
<pre id="l3199"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3200"><span class="adr">EF47</span>	C5              <span class="l" id="label3200">POSITN2</span>	<span id="code3200">PUSH	B</span></pre>
<pre id="l3201"><span class="adr">EF48</span>	D5              	<span id="code3201">PUSH	D</span></pre>
<pre id="l3202"><span class="adr">EF49</span>	CD A2 EC        	<span id="code3202">CALL	CLOSEIT	</span><span class="cmt">;close current extent.</span></pre>
<pre id="l3203"><span class="adr">EF4C</span>	D1              	<span id="code3203">POP	D</span></pre>
<pre id="l3204"><span class="adr">EF4D</span>	C1              	<span id="code3204">POP	B</span></pre>
<pre id="l3205"><span class="adr">EF4E</span>	2E 03           	<span id="code3205">MVI	L,3	</span><span class="cmt">;prepare for error.</span></pre>
<pre id="l3206"><span class="adr">EF50</span>	3A 45 E7        	<span id="code3206">LDA	STATUS</span></pre>
<pre id="l3207"><span class="adr">EF53</span>	3C              	<span id="code3207">INR	A</span></pre>
<pre id="l3208"><span class="adr">EF54</span>	CA 84 EF        	<span id="code3208">JZ	POSITN4	</span><span class="cmt">;close error.</span></pre>
<pre id="l3209"><span class="adr">EF57</span>	21 0C 00        	<span id="code3209">LXI	H,12	</span><span class="cmt">;put desired extent into fcb now.</span></pre>
<pre id="l3210"><span class="adr">EF5A</span>	19              	<span id="code3210">DAD	D</span></pre>
<pre id="l3211"><span class="adr">EF5B</span>	71              	<span id="code3211">MOV	M,C</span></pre>
<pre id="l3212"><span class="adr">EF5C</span>	21 0E 00        	<span id="code3212">LXI	H,14	</span><span class="cmt">;and store extra extent byte 's2'.</span></pre>
<pre id="l3213"><span class="adr">EF5F</span>	19              	<span id="code3213">DAD	D</span></pre>
<pre id="l3214"><span class="adr">EF60</span>	70              	<span id="code3214">MOV	M,B</span></pre>
<pre id="l3215"><span class="adr">EF61</span>	CD 51 EC        	<span id="code3215">CALL	OPENIT	</span><span class="cmt">;try and get this extent.</span></pre>
<pre id="l3216"><span class="adr">EF64</span>	3A 45 E7        	<span id="code3216">LDA	STATUS	</span><span class="cmt">;was it there?</span></pre>
<pre id="l3217"><span class="adr">EF67</span>	3C              	<span id="code3217">INR	A</span></pre>
<pre id="l3218"><span class="adr">EF68</span>	C2 7F EF        	<span id="code3218">JNZ	POSITN3</span></pre>
<pre id="l3219"><span class="adr">EF6B</span>	C1              	<span id="code3219">POP	B	</span><span class="cmt">;no. can we create a new one (writing?).</span></pre>
<pre id="l3220"><span class="adr">EF6C</span>	C5              	<span id="code3220">PUSH	B</span></pre>
<pre id="l3221"><span class="adr">EF6D</span>	2E 04           	<span id="code3221">MVI	L,4	</span><span class="cmt">;prepare for error.</span></pre>
<pre id="l3222"><span class="adr">EF6F</span>	0C              	<span id="code3222">INR	C</span></pre>
<pre id="l3223"><span class="adr">EF70</span>	CA 84 EF        	<span id="code3223">JZ	POSITN4	</span><span class="cmt">;nope, reading unwritten space error.</span></pre>
<pre id="l3224"><span class="adr">EF73</span>	CD 24 ED        	<span id="code3224">CALL	GETEMPTY</span><span class="cmt">;yes we can, try to find space.</span></pre>
<pre id="l3225"><span class="adr">EF76</span>	2E 05           	<span id="code3225">MVI	L,5	</span><span class="cmt">;prepare for error.</span></pre>
<pre id="l3226"><span class="adr">EF78</span>	3A 45 E7        	<span id="code3226">LDA	STATUS</span></pre>
<pre id="l3227"><span class="adr">EF7B</span>	3C              	<span id="code3227">INR	A</span></pre>
<pre id="l3228"><span class="adr">EF7C</span>	CA 84 EF        	<span id="code3228">JZ	POSITN4	</span><span class="cmt">;out of space?</span></pre>
<pre id="l3229"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3230"><span class="adr"></span>	                <span class="cmt">;   Normal return location. Clear error code and return.</span></pre>
<pre id="l3231"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3232"><span class="adr">EF7F</span>	C1              <span class="l" id="label3232">POSITN3</span>	<span id="code3232">POP	B	</span><span class="cmt">;restore stack.</span></pre>
<pre id="l3233"><span class="adr">EF80</span>	AF              	<span id="code3233">XRA	A	</span><span class="cmt">;and clear error code byte.</span></pre>
<pre id="l3234"><span class="adr">EF81</span>	C3 01 E7        	<span id="code3234">JMP	SETSTAT</span></pre>
<pre id="l3235"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3236"><span class="adr"></span>	                <span class="cmt">;   Error. Set the 's2' byte to indicate this (why?).</span></pre>
<pre id="l3237"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3238"><span class="adr">EF84</span>	E5              <span class="l" id="label3238">POSITN4</span>	<span id="code3238">PUSH	H</span></pre>
<pre id="l3239"><span class="adr">EF85</span>	CD 69 E9        	<span id="code3239">CALL	GETS2</span></pre>
<pre id="l3240"><span class="adr">EF88</span>	36 C0           	<span id="code3240">MVI	M,0C0H</span></pre>
<pre id="l3241"><span class="adr">EF8A</span>	E1              	<span id="code3241">POP	H</span></pre>
<pre id="l3242"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3243"><span class="adr"></span>	                <span class="cmt">;   Return with error code (presently in L).</span></pre>
<pre id="l3244"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3245"><span class="adr">EF8B</span>	C1              <span class="l" id="label3245">POSITN5</span>	<span id="code3245">POP	B</span></pre>
<pre id="l3246"><span class="adr">EF8C</span>	7D              	<span id="code3246">MOV	A,L	</span><span class="cmt">;get error code.</span></pre>
<pre id="l3247"><span class="adr">EF8D</span>	32 45 E7        	<span id="code3247">STA	STATUS</span></pre>
<pre id="l3248"><span class="adr">EF90</span>	C3 78 E9        	<span id="code3248">JMP	SETS2B7</span></pre>
<pre id="l3249"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3250"><span class="adr"></span>	                <span class="cmt">;   Read a random record.</span></pre>
<pre id="l3251"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3252"><span class="adr">EF93</span>	0E FF           <span class="l" id="label3252">READRAN</span>	<span id="code3252">MVI	C,0FFH	</span><span class="cmt">;set 'read' status.</span></pre>
<pre id="l3253"><span class="adr">EF95</span>	CD 03 EF        	<span id="code3253">CALL	POSITION</span><span class="cmt">;position the file to proper record.</span></pre>
<pre id="l3254"><span class="adr">EF98</span>	CC C1 ED        	<span id="code3254">CZ	RDSEQ1	</span><span class="cmt">;and read it as usual (if no errors).</span></pre>
<pre id="l3255"><span class="adr">EF9B</span>	C9              	<span id="code3255">RET</span></pre>
<pre id="l3256"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3257"><span class="adr"></span>	                <span class="cmt">;   Write to a random record.</span></pre>
<pre id="l3258"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3259"><span class="adr">EF9C</span>	0E 00           <span class="l" id="label3259">WRITERAN</span><span id="code3259">:MVI	C,0	</span><span class="cmt">;set 'writing' flag.</span></pre>
<pre id="l3260"><span class="adr">EF9E</span>	CD 03 EF        	<span id="code3260">CALL	POSITION</span><span class="cmt">;position the file to proper record.</span></pre>
<pre id="l3261"><span class="adr">EFA1</span>	CC 03 EE        	<span id="code3261">CZ	WTSEQ1	</span><span class="cmt">;and write as usual (if no errors).</span></pre>
<pre id="l3262"><span class="adr">EFA4</span>	C9              	<span id="code3262">RET</span></pre>
<pre id="l3263"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3264"><span class="adr"></span>	                <span class="cmt">;   Compute the random record number. Enter with (HL) pointing</span></pre>
<pre id="l3265"><span class="adr"></span>	                <span class="cmt">; to a fcb an (DE) contains a relative location of a record</span></pre>
<pre id="l3266"><span class="adr"></span>	                <span class="cmt">; number. On exit, (C) contains the 'r0' byte, (B) the 'r1'</span></pre>
<pre id="l3267"><span class="adr"></span>	                <span class="cmt">; byte, and (A) the 'r2' byte.</span></pre>
<pre id="l3268"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3269"><span class="adr"></span>	                <span class="cmt">;   On return, the zero flag is set if the record is within</span></pre>
<pre id="l3270"><span class="adr"></span>	                <span class="cmt">; bounds. Otherwise, an overflow occured.</span></pre>
<pre id="l3271"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3272"><span class="adr">EFA5</span>	EB              <span class="l" id="label3272">COMPRAND</span><span id="code3272">:XCHG		</span><span class="cmt">;save fcb pointer in (DE).</span></pre>
<pre id="l3273"><span class="adr">EFA6</span>	19              	<span id="code3273">DAD	D	</span><span class="cmt">;compute relative position of record #.</span></pre>
<pre id="l3274"><span class="adr">EFA7</span>	4E              	<span id="code3274">MOV	C,M	</span><span class="cmt">;get record number into (BC).</span></pre>
<pre id="l3275"><span class="adr">EFA8</span>	06 00           	<span id="code3275">MVI	B,0</span></pre>
<pre id="l3276"><span class="adr">EFAA</span>	21 0C 00        	<span id="code3276">LXI	H,12	</span><span class="cmt">;now get extent.</span></pre>
<pre id="l3277"><span class="adr">EFAD</span>	19              	<span id="code3277">DAD	D</span></pre>
<pre id="l3278"><span class="adr">EFAE</span>	7E              	<span id="code3278">MOV	A,M	</span><span class="cmt">;compute (BC)=(record #)+(extent)*128.</span></pre>
<pre id="l3279"><span class="adr">EFAF</span>	0F              	<span id="code3279">RRC		</span><span class="cmt">;move lower bit into bit 7.</span></pre>
<pre id="l3280"><span class="adr">EFB0</span>	E6 80           	<span id="code3280">ANI	80H	</span><span class="cmt">;and ignore all other bits.</span></pre>
<pre id="l3281"><span class="adr">EFB2</span>	81              	<span id="code3281">ADD	C	</span><span class="cmt">;add to our record number.</span></pre>
<pre id="l3282"><span class="adr">EFB3</span>	4F              	<span id="code3282">MOV	C,A</span></pre>
<pre id="l3283"><span class="adr">EFB4</span>	3E 00           	<span id="code3283">MVI	A,0	</span><span class="cmt">;take care of any carry.</span></pre>
<pre id="l3284"><span class="adr">EFB6</span>	88              	<span id="code3284">ADC	B</span></pre>
<pre id="l3285"><span class="adr">EFB7</span>	47              	<span id="code3285">MOV	B,A</span></pre>
<pre id="l3286"><span class="adr">EFB8</span>	7E              	<span id="code3286">MOV	A,M	</span><span class="cmt">;now get the upper bits of extent into</span></pre>
<pre id="l3287"><span class="adr">EFB9</span>	0F              	<span id="code3287">RRC		</span><span class="cmt">;bit positions 0-3.</span></pre>
<pre id="l3288"><span class="adr">EFBA</span>	E6 0F           	<span id="code3288">ANI	0FH	</span><span class="cmt">;and ignore all others.</span></pre>
<pre id="l3289"><span class="adr">EFBC</span>	80              	<span id="code3289">ADD	B	</span><span class="cmt">;add this in to 'r1' byte.</span></pre>
<pre id="l3290"><span class="adr">EFBD</span>	47              	<span id="code3290">MOV	B,A</span></pre>
<pre id="l3291"><span class="adr">EFBE</span>	21 0E 00        	<span id="code3291">LXI	H,14	</span><span class="cmt">;get the 's2' byte (extra extent).</span></pre>
<pre id="l3292"><span class="adr">EFC1</span>	19              	<span id="code3292">DAD	D</span></pre>
<pre id="l3293"><span class="adr">EFC2</span>	7E              	<span id="code3293">MOV	A,M</span></pre>
<pre id="l3294"><span class="adr">EFC3</span>	87              	<span id="code3294">ADD	A	</span><span class="cmt">;and shift it left 4 bits (bits 4-7).</span></pre>
<pre id="l3295"><span class="adr">EFC4</span>	87              	<span id="code3295">ADD	A</span></pre>
<pre id="l3296"><span class="adr">EFC5</span>	87              	<span id="code3296">ADD	A</span></pre>
<pre id="l3297"><span class="adr">EFC6</span>	87              	<span id="code3297">ADD	A</span></pre>
<pre id="l3298"><span class="adr">EFC7</span>	F5              	<span id="code3298">PUSH	PSW	</span><span class="cmt">;save carry flag (bit 0 of flag byte).</span></pre>
<pre id="l3299"><span class="adr">EFC8</span>	80              	<span id="code3299">ADD	B	</span><span class="cmt">;now add extra extent into 'r1'.</span></pre>
<pre id="l3300"><span class="adr">EFC9</span>	47              	<span id="code3300">MOV	B,A</span></pre>
<pre id="l3301"><span class="adr">EFCA</span>	F5              	<span id="code3301">PUSH	PSW	</span><span class="cmt">;and save carry (overflow byte 'r2').</span></pre>
<pre id="l3302"><span class="adr">EFCB</span>	E1              	<span id="code3302">POP	H	</span><span class="cmt">;bit 0 of (L) is the overflow indicator.</span></pre>
<pre id="l3303"><span class="adr">EFCC</span>	7D              	<span id="code3303">MOV	A,L</span></pre>
<pre id="l3304"><span class="adr">EFCD</span>	E1              	<span id="code3304">POP	H	</span><span class="cmt">;and same for first carry flag.</span></pre>
<pre id="l3305"><span class="adr">EFCE</span>	B5              	<span id="code3305">ORA	L	</span><span class="cmt">;either one of these set?</span></pre>
<pre id="l3306"><span class="adr">EFCF</span>	E6 01           	<span id="code3306">ANI	01H	</span><span class="cmt">;only check the carry flags.</span></pre>
<pre id="l3307"><span class="adr">EFD1</span>	C9              	<span id="code3307">RET</span></pre>
<pre id="l3308"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3309"><span class="adr"></span>	                <span class="cmt">;   Routine to setup the fcb (bytes 'r0', 'r1', 'r2') to</span></pre>
<pre id="l3310"><span class="adr"></span>	                <span class="cmt">; reflect the last record used for a random (or other) file.</span></pre>
<pre id="l3311"><span class="adr"></span>	                <span class="cmt">; This reads the directory and looks at all extents computing</span></pre>
<pre id="l3312"><span class="adr"></span>	                <span class="cmt">; the largerst record number for each and keeping the maximum</span></pre>
<pre id="l3313"><span class="adr"></span>	                <span class="cmt">; value only. Then 'r0', 'r1', and 'r2' will reflect this</span></pre>
<pre id="l3314"><span class="adr"></span>	                <span class="cmt">; maximum record number. This is used to compute the space used</span></pre>
<pre id="l3315"><span class="adr"></span>	                <span class="cmt">; by a random file.</span></pre>
<pre id="l3316"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3317"><span class="adr">EFD2</span>	0E 0C           <span class="l" id="label3317">RANSIZE</span>	<span id="code3317">MVI	C,12	</span><span class="cmt">;look thru directory for first entry with</span></pre>
<pre id="l3318"><span class="adr">EFD4</span>	CD 18 EB        	<span id="code3318">CALL	FINDFST	</span><span class="cmt">;this name.</span></pre>
<pre id="l3319"><span class="adr">EFD7</span>	2A 43 E7        	<span id="code3319">LHLD	PARAMS	</span><span class="cmt">;zero out the 'r0, r1, r2' bytes.</span></pre>
<pre id="l3320"><span class="adr">EFDA</span>	11 21 00        	<span id="code3320">LXI	D,33</span></pre>
<pre id="l3321"><span class="adr">EFDD</span>	19              	<span id="code3321">DAD	D</span></pre>
<pre id="l3322"><span class="adr">EFDE</span>	E5              	<span id="code3322">PUSH	H</span></pre>
<pre id="l3323"><span class="adr">EFDF</span>	72              	<span id="code3323">MOV	M,D	</span><span class="cmt">;note that (D)=0.</span></pre>
<pre id="l3324"><span class="adr">EFE0</span>	23              	<span id="code3324">INX	H</span></pre>
<pre id="l3325"><span class="adr">EFE1</span>	72              	<span id="code3325">MOV	M,D</span></pre>
<pre id="l3326"><span class="adr">EFE2</span>	23              	<span id="code3326">INX	H</span></pre>
<pre id="l3327"><span class="adr">EFE3</span>	72              	<span id="code3327">MOV	M,D</span></pre>
<pre id="l3328"><span class="adr">EFE4</span>	CD F5 E9        <span class="l" id="label3328">RANSIZ1</span>	<span id="code3328">CALL	CKFILPOS</span><span class="cmt">;is there an extent to process?</span></pre>
<pre id="l3329"><span class="adr">EFE7</span>	CA 0C F0        	<span id="code3329">JZ	RANSIZ3	</span><span class="cmt">;no, we are done.</span></pre>
<pre id="l3330"><span class="adr">EFEA</span>	CD 5E E9        	<span id="code3330">CALL	FCB2HL	</span><span class="cmt">;set (HL) pointing to proper fcb in dir.</span></pre>
<pre id="l3331"><span class="adr">EFED</span>	11 0F 00        	<span id="code3331">LXI	D,15	</span><span class="cmt">;point to last record in extent.</span></pre>
<pre id="l3332"><span class="adr">EFF0</span>	CD A5 EF        	<span id="code3332">CALL	COMPRAND</span><span class="cmt">;and compute random parameters.</span></pre>
<pre id="l3333"><span class="adr">EFF3</span>	E1              	<span id="code3333">POP	H</span></pre>
<pre id="l3334"><span class="adr">EFF4</span>	E5              	<span id="code3334">PUSH	H	</span><span class="cmt">;now check these values against those</span></pre>
<pre id="l3335"><span class="adr">EFF5</span>	5F              	<span id="code3335">MOV	E,A	</span><span class="cmt">;already in fcb.</span></pre>
<pre id="l3336"><span class="adr">EFF6</span>	79              	<span id="code3336">MOV	A,C	</span><span class="cmt">;the carry flag will be set if those</span></pre>
<pre id="l3337"><span class="adr">EFF7</span>	96              	<span id="code3337">SUB	M	</span><span class="cmt">;in the fcb represent a larger size than</span></pre>
<pre id="l3338"><span class="adr">EFF8</span>	23              	<span id="code3338">INX	H	</span><span class="cmt">;this extent does.</span></pre>
<pre id="l3339"><span class="adr">EFF9</span>	78              	<span id="code3339">MOV	A,B</span></pre>
<pre id="l3340"><span class="adr">EFFA</span>	9E              	<span id="code3340">SBB	M</span></pre>
<pre id="l3341"><span class="adr">EFFB</span>	23              	<span id="code3341">INX	H</span></pre>
<pre id="l3342"><span class="adr">EFFC</span>	7B              	<span id="code3342">MOV	A,E</span></pre>
<pre id="l3343"><span class="adr">EFFD</span>	9E              	<span id="code3343">SBB	M</span></pre>
<pre id="l3344"><span class="adr">EFFE</span>	DA 06 F0        	<span id="code3344">JC	RANSIZ2</span></pre>
<pre id="l3345"><span class="adr">F001</span>	73              	<span id="code3345">MOV	M,E	</span><span class="cmt">;we found a larger (in size) extent.</span></pre>
<pre id="l3346"><span class="adr">F002</span>	2B              	<span id="code3346">DCX	H	</span><span class="cmt">;stuff these values into fcb.</span></pre>
<pre id="l3347"><span class="adr">F003</span>	70              	<span id="code3347">MOV	M,B</span></pre>
<pre id="l3348"><span class="adr">F004</span>	2B              	<span id="code3348">DCX	H</span></pre>
<pre id="l3349"><span class="adr">F005</span>	71              	<span id="code3349">MOV	M,C</span></pre>
<pre id="l3350"><span class="adr">F006</span>	CD 2D EB        <span class="l" id="label3350">RANSIZ2</span>	<span id="code3350">CALL	FINDNXT	</span><span class="cmt">;now get the next extent.</span></pre>
<pre id="l3351"><span class="adr">F009</span>	C3 E4 EF        	<span id="code3351">JMP	RANSIZ1	</span><span class="cmt">;continue til all done.</span></pre>
<pre id="l3352"><span class="adr">F00C</span>	E1              <span class="l" id="label3352">RANSIZ3</span>	<span id="code3352">POP	H	</span><span class="cmt">;we are done, restore the stack and</span></pre>
<pre id="l3353"><span class="adr">F00D</span>	C9              	<span id="code3353">RET		</span><span class="cmt">;return.</span></pre>
<pre id="l3354"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3355"><span class="adr"></span>	                <span class="cmt">;   Function to return the random record position of a given</span></pre>
<pre id="l3356"><span class="adr"></span>	                <span class="cmt">; file which has been read in sequential mode up to now.</span></pre>
<pre id="l3357"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3358"><span class="adr">F00E</span>	2A 43 E7        <span class="l" id="label3358">SETRAN</span>	<span id="code3358">LHLD	PARAMS	</span><span class="cmt">;point to fcb.</span></pre>
<pre id="l3359"><span class="adr">F011</span>	11 20 00        	<span id="code3359">LXI	D,32	</span><span class="cmt">;and to last used record.</span></pre>
<pre id="l3360"><span class="adr">F014</span>	CD A5 EF        	<span id="code3360">CALL	COMPRAND</span><span class="cmt">;compute random position.</span></pre>
<pre id="l3361"><span class="adr">F017</span>	21 21 00        	<span id="code3361">LXI	H,33	</span><span class="cmt">;now stuff these values into fcb.</span></pre>
<pre id="l3362"><span class="adr">F01A</span>	19              	<span id="code3362">DAD	D</span></pre>
<pre id="l3363"><span class="adr">F01B</span>	71              	<span id="code3363">MOV	M,C	</span><span class="cmt">;move 'r0'.</span></pre>
<pre id="l3364"><span class="adr">F01C</span>	23              	<span id="code3364">INX	H</span></pre>
<pre id="l3365"><span class="adr">F01D</span>	70              	<span id="code3365">MOV	M,B	</span><span class="cmt">;and 'r1'.</span></pre>
<pre id="l3366"><span class="adr">F01E</span>	23              	<span id="code3366">INX	H</span></pre>
<pre id="l3367"><span class="adr">F01F</span>	77              	<span id="code3367">MOV	M,A	</span><span class="cmt">;and lastly 'r2'.</span></pre>
<pre id="l3368"><span class="adr">F020</span>	C9              	<span id="code3368">RET</span></pre>
<pre id="l3369"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3370"><span class="adr"></span>	                <span class="cmt">;   This routine select the drive specified in (ACTIVE) and</span></pre>
<pre id="l3371"><span class="adr"></span>	                <span class="cmt">; update the login vector and bitmap table if this drive was</span></pre>
<pre id="l3372"><span class="adr"></span>	                <span class="cmt">; not already active.</span></pre>
<pre id="l3373"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3374"><span class="adr">F021</span>	2A AF F1        <span class="l" id="label3374">LOGINDRV</span><span id="code3374">:LHLD	LOGIN	</span><span class="cmt">;get the login vector.</span></pre>
<pre id="l3375"><span class="adr">F024</span>	3A 42 E7        	<span id="code3375">LDA	ACTIVE	</span><span class="cmt">;get the default drive.</span></pre>
<pre id="l3376"><span class="adr">F027</span>	4F              	<span id="code3376">MOV	C,A</span></pre>
<pre id="l3377"><span class="adr">F028</span>	CD EA E8        	<span id="code3377">CALL	SHIFTR	</span><span class="cmt">;position active bit for this drive</span></pre>
<pre id="l3378"><span class="adr">F02B</span>	E5              	<span id="code3378">PUSH	H	</span><span class="cmt">;into bit 0.</span></pre>
<pre id="l3379"><span class="adr">F02C</span>	EB              	<span id="code3379">XCHG</span></pre>
<pre id="l3380"><span class="adr">F02D</span>	CD 59 E7        	<span id="code3380">CALL	SELECT	</span><span class="cmt">;select this drive.</span></pre>
<pre id="l3381"><span class="adr">F030</span>	E1              	<span id="code3381">POP	H</span></pre>
<pre id="l3382"><span class="adr">F031</span>	CC 47 E7        	<span id="code3382">CZ	SLCTERR	</span><span class="cmt">;valid drive?</span></pre>
<pre id="l3383"><span class="adr">F034</span>	7D              	<span id="code3383">MOV	A,L	</span><span class="cmt">;is this a newly activated drive?</span></pre>
<pre id="l3384"><span class="adr">F035</span>	1F              	<span id="code3384">RAR</span></pre>
<pre id="l3385"><span class="adr">F036</span>	D8              	<span id="code3385">RC</span></pre>
<pre id="l3386"><span class="adr">F037</span>	2A AF F1        	<span id="code3386">LHLD	LOGIN	</span><span class="cmt">;yes, update the login vector.</span></pre>
<pre id="l3387"><span class="adr">F03A</span>	4D              	<span id="code3387">MOV	C,L</span></pre>
<pre id="l3388"><span class="adr">F03B</span>	44              	<span id="code3388">MOV	B,H</span></pre>
<pre id="l3389"><span class="adr">F03C</span>	CD 0B E9        	<span id="code3389">CALL	SETBIT</span></pre>
<pre id="l3390"><span class="adr">F03F</span>	22 AF F1        	<span id="code3390">SHLD	LOGIN	</span><span class="cmt">;and save.</span></pre>
<pre id="l3391"><span class="adr">F042</span>	C3 A3 EA        	<span id="code3391">JMP	BITMAP	</span><span class="cmt">;now update the bitmap.</span></pre>
<pre id="l3392"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3393"><span class="adr"></span>	                <span class="cmt">;   Function to set the active disk number.</span></pre>
<pre id="l3394"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3395"><span class="adr">F045</span>	3A D6 F1        <span class="l" id="label3395">SETDSK</span>	<span id="code3395">LDA	EPARAM	</span><span class="cmt">;get parameter passed and see if this</span></pre>
<pre id="l3396"><span class="adr">F048</span>	21 42 E7        	<span id="code3396">LXI	H,ACTIVE</span><span class="cmt">;represents a change in drives.</span></pre>
<pre id="l3397"><span class="adr">F04B</span>	BE              	<span id="code3397">CMP	M</span></pre>
<pre id="l3398"><span class="adr">F04C</span>	C8              	<span id="code3398">RZ</span></pre>
<pre id="l3399"><span class="adr">F04D</span>	77              	<span id="code3399">MOV	M,A	</span><span class="cmt">;yes it does, log it in.</span></pre>
<pre id="l3400"><span class="adr">F04E</span>	C3 21 F0        	<span id="code3400">JMP	LOGINDRV</span></pre>
<pre id="l3401"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3402"><span class="adr"></span>	                <span class="cmt">;   This is the 'auto disk select' routine. The firsst byte</span></pre>
<pre id="l3403"><span class="adr"></span>	                <span class="cmt">; of the fcb is examined for a drive specification. If non</span></pre>
<pre id="l3404"><span class="adr"></span>	                <span class="cmt">; zero then the drive will be selected and loged in.</span></pre>
<pre id="l3405"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3406"><span class="adr">F051</span>	3E FF           <span class="l" id="label3406">AUTOSEL</span>	<span id="code3406">MVI	A,0FFH	</span><span class="cmt">;say 'auto-select activated'.</span></pre>
<pre id="l3407"><span class="adr">F053</span>	32 DE F1        	<span id="code3407">STA	AUTO</span></pre>
<pre id="l3408"><span class="adr">F056</span>	2A 43 E7        	<span id="code3408">LHLD	PARAMS	</span><span class="cmt">;get drive specified.</span></pre>
<pre id="l3409"><span class="adr">F059</span>	7E              	<span id="code3409">MOV	A,M</span></pre>
<pre id="l3410"><span class="adr">F05A</span>	E6 1F           	<span id="code3410">ANI	1FH	</span><span class="cmt">;look at lower 5 bits.</span></pre>
<pre id="l3411"><span class="adr">F05C</span>	3D              	<span id="code3411">DCR	A	</span><span class="cmt">;adjust for (1=A, 2=B) etc.</span></pre>
<pre id="l3412"><span class="adr">F05D</span>	32 D6 F1        	<span id="code3412">STA	EPARAM	</span><span class="cmt">;and save for the select routine.</span></pre>
<pre id="l3413"><span class="adr">F060</span>	FE 1E           	<span id="code3413">CPI	1EH	</span><span class="cmt">;check for 'no change' condition.</span></pre>
<pre id="l3414"><span class="adr">F062</span>	D2 75 F0        	<span id="code3414">JNC	AUTOSL1	</span><span class="cmt">;yes, don't change.</span></pre>
<pre id="l3415"><span class="adr">F065</span>	3A 42 E7        	<span id="code3415">LDA	ACTIVE	</span><span class="cmt">;we must change, save currently active</span></pre>
<pre id="l3416"><span class="adr">F068</span>	32 DF F1        	<span id="code3416">STA	OLDDRV	</span><span class="cmt">;drive.</span></pre>
<pre id="l3417"><span class="adr">F06B</span>	7E              	<span id="code3417">MOV	A,M	</span><span class="cmt">;and save first byte of fcb also.</span></pre>
<pre id="l3418"><span class="adr">F06C</span>	32 E0 F1        	<span id="code3418">STA	AUTOFLAG</span><span class="cmt">;this must be non-zero.</span></pre>
<pre id="l3419"><span class="adr">F06F</span>	E6 E0           	<span id="code3419">ANI	0E0H	</span><span class="cmt">;whats this for (bits 6,7 are used for</span></pre>
<pre id="l3420"><span class="adr">F071</span>	77              	<span id="code3420">MOV	M,A	</span><span class="cmt">;something)?</span></pre>
<pre id="l3421"><span class="adr">F072</span>	CD 45 F0        	<span id="code3421">CALL	SETDSK	</span><span class="cmt">;select and log in this drive.</span></pre>
<pre id="l3422"><span class="adr">F075</span>	3A 41 E7        <span class="l" id="label3422">AUTOSL1</span>	<span id="code3422">LDA	USERNO	</span><span class="cmt">;move user number into fcb.</span></pre>
<pre id="l3423"><span class="adr">F078</span>	2A 43 E7        	<span id="code3423">LHLD	PARAMS	</span><span class="cmt">;(* upper half of first byte *)</span></pre>
<pre id="l3424"><span class="adr">F07B</span>	B6              	<span id="code3424">ORA	M</span></pre>
<pre id="l3425"><span class="adr">F07C</span>	77              	<span id="code3425">MOV	M,A</span></pre>
<pre id="l3426"><span class="adr">F07D</span>	C9              	<span id="code3426">RET		</span><span class="cmt">;and return (all done).</span></pre>
<pre id="l3427"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3428"><span class="adr"></span>	                <span class="cmt">;   Function to return the current cp/m version number.</span></pre>
<pre id="l3429"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3430"><span class="adr">F07E</span>	3E 22           <span class="l" id="label3430">GETVER</span>	<span id="code3430">MVI	A,022h	</span><span class="cmt">;version 2.2</span></pre>
<pre id="l3431"><span class="adr">F080</span>	C3 01 E7        	<span id="code3431">JMP	SETSTAT</span></pre>
<pre id="l3432"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3433"><span class="adr"></span>	                <span class="cmt">;   Function to reset the disk system.</span></pre>
<pre id="l3434"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3435"><span class="adr">F083</span>	21 00 00        <span class="l" id="label3435">RSTDSK</span>	<span id="code3435">LXI	H,0	</span><span class="cmt">;clear write protect status and log</span></pre>
<pre id="l3436"><span class="adr">F086</span>	22 AD F1        	<span id="code3436">SHLD	WRTPRT	</span><span class="cmt">;in vector.</span></pre>
<pre id="l3437"><span class="adr">F089</span>	22 AF F1        	<span id="code3437">SHLD	LOGIN</span></pre>
<pre id="l3438"><span class="adr">F08C</span>	AF              	<span id="code3438">XRA	A	</span><span class="cmt">;select drive 'A'.</span></pre>
<pre id="l3439"><span class="adr">F08D</span>	32 42 E7        	<span id="code3439">STA	ACTIVE</span></pre>
<pre id="l3440"><span class="adr">F090</span>	21 80 00        	<span id="code3440">LXI	H,TBUFF	</span><span class="cmt">;setup default dma address.</span></pre>
<pre id="l3441"><span class="adr">F093</span>	22 B1 F1        	<span id="code3441">SHLD	USERDMA</span></pre>
<pre id="l3442"><span class="adr">F096</span>	CD DA E9        	<span id="code3442">CALL	DEFDMA</span></pre>
<pre id="l3443"><span class="adr">F099</span>	C3 21 F0        	<span id="code3443">JMP	LOGINDRV</span><span class="cmt">;now log in drive 'A'.</span></pre>
<pre id="l3444"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3445"><span class="adr"></span>	                <span class="cmt">;   Function to open a specified file.</span></pre>
<pre id="l3446"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3447"><span class="adr">F09C</span>	CD 72 E9        <span class="l" id="label3447">OPENFIL</span>	<span id="code3447">CALL	CLEARS2	</span><span class="cmt">;clear 's2' byte.</span></pre>
<pre id="l3448"><span class="adr">F09F</span>	CD 51 F0        	<span id="code3448">CALL	AUTOSEL	</span><span class="cmt">;select proper disk.</span></pre>
<pre id="l3449"><span class="adr">F0A2</span>	C3 51 EC        	<span id="code3449">JMP	OPENIT	</span><span class="cmt">;and open the file.</span></pre>
<pre id="l3450"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3451"><span class="adr"></span>	                <span class="cmt">;   Function to close a specified file.</span></pre>
<pre id="l3452"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3453"><span class="adr">F0A5</span>	CD 51 F0        <span class="l" id="label3453">CLOSEFIL</span><span id="code3453">:CALL	AUTOSEL	</span><span class="cmt">;select proper disk.</span></pre>
<pre id="l3454"><span class="adr">F0A8</span>	C3 A2 EC        	<span id="code3454">JMP	CLOSEIT	</span><span class="cmt">;and close the file.</span></pre>
<pre id="l3455"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3456"><span class="adr"></span>	                <span class="cmt">;   Function to return the first occurence of a specified file</span></pre>
<pre id="l3457"><span class="adr"></span>	                <span class="cmt">; name. If the first byte of the fcb is '?' then the name will</span></pre>
<pre id="l3458"><span class="adr"></span>	                <span class="cmt">; not be checked (get the first entry no matter what).</span></pre>
<pre id="l3459"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3460"><span class="adr">F0AB</span>	0E 00           <span class="l" id="label3460">GETFST</span>	<span id="code3460">MVI	C,0	</span><span class="cmt">;prepare for special search.</span></pre>
<pre id="l3461"><span class="adr">F0AD</span>	EB              	<span id="code3461">XCHG</span></pre>
<pre id="l3462"><span class="adr">F0AE</span>	7E              	<span id="code3462">MOV	A,M	</span><span class="cmt">;is first byte a '?'?</span></pre>
<pre id="l3463"><span class="adr">F0AF</span>	FE 3F           	<span id="code3463">CPI	'?'</span></pre>
<pre id="l3464"><span class="adr">F0B1</span>	CA C2 F0        	<span id="code3464">JZ	GETFST1	</span><span class="cmt">;yes, just get very first entry (zero length match).</span></pre>
<pre id="l3465"><span class="adr">F0B4</span>	CD A6 E8        	<span id="code3465">CALL	SETEXT	</span><span class="cmt">;get the extension byte from fcb.</span></pre>
<pre id="l3466"><span class="adr">F0B7</span>	7E              	<span id="code3466">MOV	A,M	</span><span class="cmt">;is it '?'? if yes, then we want</span></pre>
<pre id="l3467"><span class="adr">F0B8</span>	FE 3F           	<span id="code3467">CPI	'?'	</span><span class="cmt">;an entry with a specific 's2' byte.</span></pre>
<pre id="l3468"><span class="adr">F0BA</span>	C4 72 E9        	<span id="code3468">CNZ	CLEARS2	</span><span class="cmt">;otherwise, look for a zero 's2' byte.</span></pre>
<pre id="l3469"><span class="adr">F0BD</span>	CD 51 F0        	<span id="code3469">CALL	AUTOSEL	</span><span class="cmt">;select proper drive.</span></pre>
<pre id="l3470"><span class="adr">F0C0</span>	0E 0F           	<span id="code3470">MVI	C,15	</span><span class="cmt">;compare bytes 0-14 in fcb (12&13 excluded).</span></pre>
<pre id="l3471"><span class="adr">F0C2</span>	CD 18 EB        <span class="l" id="label3471">GETFST1</span>	<span id="code3471">CALL	FINDFST	</span><span class="cmt">;find an entry and then move it into</span></pre>
<pre id="l3472"><span class="adr">F0C5</span>	C3 E9 E9        	<span id="code3472">JMP	MOVEDIR	</span><span class="cmt">;the users dma space.</span></pre>
<pre id="l3473"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3474"><span class="adr"></span>	                <span class="cmt">;   Function to return the next occurence of a file name.</span></pre>
<pre id="l3475"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3476"><span class="adr">F0C8</span>	2A D9 F1        <span class="l" id="label3476">GETNXT</span>	<span id="code3476">LHLD	SAVEFCB	</span><span class="cmt">;restore pointers. note that no</span></pre>
<pre id="l3477"><span class="adr">F0CB</span>	22 43 E7        	<span id="code3477">SHLD	PARAMS	</span><span class="cmt">;other dbos calls are allowed.</span></pre>
<pre id="l3478"><span class="adr">F0CE</span>	CD 51 F0        	<span id="code3478">CALL	AUTOSEL	</span><span class="cmt">;no error will be returned, but the</span></pre>
<pre id="l3479"><span class="adr">F0D1</span>	CD 2D EB        	<span id="code3479">CALL	FINDNXT	</span><span class="cmt">;results will be wrong.</span></pre>
<pre id="l3480"><span class="adr">F0D4</span>	C3 E9 E9        	<span id="code3480">JMP	MOVEDIR</span></pre>
<pre id="l3481"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3482"><span class="adr"></span>	                <span class="cmt">;   Function to delete a file by name.</span></pre>
<pre id="l3483"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3484"><span class="adr">F0D7</span>	CD 51 F0        <span class="l" id="label3484">DELFILE</span>	<span id="code3484">CALL	AUTOSEL	</span><span class="cmt">;select proper drive.</span></pre>
<pre id="l3485"><span class="adr">F0DA</span>	CD 9C EB        	<span id="code3485">CALL	ERAFILE	</span><span class="cmt">;erase the file.</span></pre>
<pre id="l3486"><span class="adr">F0DD</span>	C3 01 EB        	<span id="code3486">JMP	STSTATUS</span><span class="cmt">;set status and return.</span></pre>
<pre id="l3487"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3488"><span class="adr"></span>	                <span class="cmt">;   Function to execute a sequential read of the specified</span></pre>
<pre id="l3489"><span class="adr"></span>	                <span class="cmt">; record number.</span></pre>
<pre id="l3490"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3491"><span class="adr">F0E0</span>	CD 51 F0        <span class="l" id="label3491">READSEQ</span>	<span id="code3491">CALL	AUTOSEL	</span><span class="cmt">;select proper drive then read.</span></pre>
<pre id="l3492"><span class="adr">F0E3</span>	C3 BC ED        	<span id="code3492">JMP	RDSEQ</span></pre>
<pre id="l3493"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3494"><span class="adr"></span>	                <span class="cmt">;   Function to write the net sequential record.</span></pre>
<pre id="l3495"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3496"><span class="adr">F0E6</span>	CD 51 F0        <span class="l" id="label3496">WRTSEQ</span>	<span id="code3496">CALL	AUTOSEL	</span><span class="cmt">;select proper drive then write.</span></pre>
<pre id="l3497"><span class="adr">F0E9</span>	C3 FE ED        	<span id="code3497">JMP	WTSEQ</span></pre>
<pre id="l3498"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3499"><span class="adr"></span>	                <span class="cmt">;   Create a file function.</span></pre>
<pre id="l3500"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3501"><span class="adr">F0EC</span>	CD 72 E9        <span class="l" id="label3501">FCREATE</span>	<span id="code3501">CALL	CLEARS2	</span><span class="cmt">;clear the 's2' byte on all creates.</span></pre>
<pre id="l3502"><span class="adr">F0EF</span>	CD 51 F0        	<span id="code3502">CALL	AUTOSEL	</span><span class="cmt">;select proper drive and get the next</span></pre>
<pre id="l3503"><span class="adr">F0F2</span>	C3 24 ED        	<span id="code3503">JMP	GETEMPTY</span><span class="cmt">;empty directory space.</span></pre>
<pre id="l3504"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3505"><span class="adr"></span>	                <span class="cmt">;   Function to rename a file.</span></pre>
<pre id="l3506"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3507"><span class="adr">F0F5</span>	CD 51 F0        <span class="l" id="label3507">RENFILE</span>	<span id="code3507">CALL	AUTOSEL	</span><span class="cmt">;select proper drive and then switch</span></pre>
<pre id="l3508"><span class="adr">F0F8</span>	CD 16 EC        	<span id="code3508">CALL	CHGNAMES</span><span class="cmt">;file names.</span></pre>
<pre id="l3509"><span class="adr">F0FB</span>	C3 01 EB        	<span id="code3509">JMP	STSTATUS</span></pre>
<pre id="l3510"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3511"><span class="adr"></span>	                <span class="cmt">;   Function to return the login vector.</span></pre>
<pre id="l3512"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3513"><span class="adr">F0FE</span>	2A AF F1        <span class="l" id="label3513">GETLOG</span>	<span id="code3513">LHLD	LOGIN</span></pre>
<pre id="l3514"><span class="adr">F101</span>	C3 29 F1        	<span id="code3514">JMP	GETPRM1</span></pre>
<pre id="l3515"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3516"><span class="adr"></span>	                <span class="cmt">;   Function to return the current disk assignment.</span></pre>
<pre id="l3517"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3518"><span class="adr">F104</span>	3A 42 E7        <span class="l" id="label3518">GETCRNT</span>	<span id="code3518">LDA	ACTIVE</span></pre>
<pre id="l3519"><span class="adr">F107</span>	C3 01 E7        	<span id="code3519">JMP	SETSTAT</span></pre>
<pre id="l3520"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3521"><span class="adr"></span>	                <span class="cmt">;   Function to set the dma address.</span></pre>
<pre id="l3522"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3523"><span class="adr">F10A</span>	EB              <span class="l" id="label3523">PUTDMA</span>	<span id="code3523">XCHG</span></pre>
<pre id="l3524"><span class="adr">F10B</span>	22 B1 F1        	<span id="code3524">SHLD	USERDMA	</span><span class="cmt">;save in our space and then get to</span></pre>
<pre id="l3525"><span class="adr">F10E</span>	C3 DA E9        	<span id="code3525">JMP	DEFDMA	</span><span class="cmt">;the bios with this also.</span></pre>
<pre id="l3526"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3527"><span class="adr"></span>	                <span class="cmt">;   Function to return the allocation vector.</span></pre>
<pre id="l3528"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3529"><span class="adr">F111</span>	2A BF F1        <span class="l" id="label3529">GETALOC</span>	<span id="code3529">LHLD	ALOCVECT</span></pre>
<pre id="l3530"><span class="adr">F114</span>	C3 29 F1        	<span id="code3530">JMP	GETPRM1</span></pre>
<pre id="l3531"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3532"><span class="adr"></span>	                <span class="cmt">;   Function to return the read-only status vector.</span></pre>
<pre id="l3533"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3534"><span class="adr">F117</span>	2A AD F1        <span class="l" id="label3534">GETROV</span>	<span id="code3534">LHLD	WRTPRT</span></pre>
<pre id="l3535"><span class="adr">F11A</span>	C3 29 F1        	<span id="code3535">JMP	GETPRM1</span></pre>
<pre id="l3536"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3537"><span class="adr"></span>	                <span class="cmt">;   Function to set the file attributes (read-only, system).</span></pre>
<pre id="l3538"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3539"><span class="adr">F11D</span>	CD 51 F0        <span class="l" id="label3539">SETATTR</span>	<span id="code3539">CALL	AUTOSEL	</span><span class="cmt">;select proper drive then save attributes.</span></pre>
<pre id="l3540"><span class="adr">F120</span>	CD 3B EC        	<span id="code3540">CALL	SAVEATTR</span></pre>
<pre id="l3541"><span class="adr">F123</span>	C3 01 EB        	<span id="code3541">JMP	STSTATUS</span></pre>
<pre id="l3542"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3543"><span class="adr"></span>	                <span class="cmt">;   Function to return the address of the disk parameter block</span></pre>
<pre id="l3544"><span class="adr"></span>	                <span class="cmt">; for the current drive.</span></pre>
<pre id="l3545"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3546"><span class="adr">F126</span>	2A BB F1        <span class="l" id="label3546">GETPARM</span>	<span id="code3546">LHLD	DISKPB</span></pre>
<pre id="l3547"><span class="adr">F129</span>	22 45 E7        <span class="l" id="label3547">GETPRM1</span>	<span id="code3547">SHLD	STATUS</span></pre>
<pre id="l3548"><span class="adr">F12C</span>	C9              	<span id="code3548">RET</span></pre>
<pre id="l3549"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3550"><span class="adr"></span>	                <span class="cmt">;   Function to get or set the user number. If (E) was (FF)</span></pre>
<pre id="l3551"><span class="adr"></span>	                <span class="cmt">; then this is a request to return the current user number.</span></pre>
<pre id="l3552"><span class="adr"></span>	                <span class="cmt">; Else set the user number from (E).</span></pre>
<pre id="l3553"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3554"><span class="adr">F12D</span>	3A D6 F1        <span class="l" id="label3554">GETUSER</span>	<span id="code3554">LDA	EPARAM	</span><span class="cmt">;get parameter.</span></pre>
<pre id="l3555"><span class="adr">F130</span>	FE FF           	<span id="code3555">CPI	0FFH	</span><span class="cmt">;get user number?</span></pre>
<pre id="l3556"><span class="adr">F132</span>	C2 3B F1        	<span id="code3556">JNZ	SETUSER</span></pre>
<pre id="l3557"><span class="adr">F135</span>	3A 41 E7        	<span id="code3557">LDA	USERNO	</span><span class="cmt">;yes, just do it.</span></pre>
<pre id="l3558"><span class="adr">F138</span>	C3 01 E7        	<span id="code3558">JMP	SETSTAT</span></pre>
<pre id="l3559"><span class="adr">F13B</span>	E6 1F           <span class="l" id="label3559">SETUSER</span>	<span id="code3559">ANI	1FH	</span><span class="cmt">;no, we should set it instead. keep low</span></pre>
<pre id="l3560"><span class="adr">F13D</span>	32 41 E7        	<span id="code3560">STA	USERNO	</span><span class="cmt">;bits (0-4) only.</span></pre>
<pre id="l3561"><span class="adr">F140</span>	C9              	<span id="code3561">RET</span></pre>
<pre id="l3562"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3563"><span class="adr"></span>	                <span class="cmt">;   Function to read a random record from a file.</span></pre>
<pre id="l3564"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3565"><span class="adr">F141</span>	CD 51 F0        <span class="l" id="label3565">RDRANDOM</span><span id="code3565">:CALL	AUTOSEL	</span><span class="cmt">;select proper drive and read.</span></pre>
<pre id="l3566"><span class="adr">F144</span>	C3 93 EF        	<span id="code3566">JMP	READRAN</span></pre>
<pre id="l3567"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3568"><span class="adr"></span>	                <span class="cmt">;   Function to compute the file size for random files.</span></pre>
<pre id="l3569"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3570"><span class="adr">F147</span>	CD 51 F0        <span class="l" id="label3570">WTRANDOM</span><span id="code3570">:CALL	AUTOSEL	</span><span class="cmt">;select proper drive and write.</span></pre>
<pre id="l3571"><span class="adr">F14A</span>	C3 9C EF        	<span id="code3571">JMP	WRITERAN</span></pre>
<pre id="l3572"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3573"><span class="adr"></span>	                <span class="cmt">;   Function to compute the size of a random file.</span></pre>
<pre id="l3574"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3575"><span class="adr">F14D</span>	CD 51 F0        <span class="l" id="label3575">FILESIZE</span><span id="code3575">:CALL	AUTOSEL	</span><span class="cmt">;select proper drive and check file length</span></pre>
<pre id="l3576"><span class="adr">F150</span>	C3 D2 EF        	<span id="code3576">JMP	RANSIZE</span></pre>
<pre id="l3577"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3578"><span class="adr"></span>	                <span class="cmt">;   Function #37. This allows a program to log off any drives.</span></pre>
<pre id="l3579"><span class="adr"></span>	                <span class="cmt">; On entry, set (DE) to contain a word with bits set for those</span></pre>
<pre id="l3580"><span class="adr"></span>	                <span class="cmt">; drives that are to be logged off. The log-in vector and the</span></pre>
<pre id="l3581"><span class="adr"></span>	                <span class="cmt">; write protect vector will be updated. This must be a M/PM</span></pre>
<pre id="l3582"><span class="adr"></span>	                <span class="cmt">; special function.</span></pre>
<pre id="l3583"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3584"><span class="adr">F153</span>	2A 43 E7        <span class="l" id="label3584">LOGOFF</span>	<span id="code3584">LHLD	PARAMS	</span><span class="cmt">;get drives to log off.</span></pre>
<pre id="l3585"><span class="adr">F156</span>	7D              	<span id="code3585">MOV	A,L	</span><span class="cmt">;for each bit that is set, we want</span></pre>
<pre id="l3586"><span class="adr">F157</span>	2F              	<span id="code3586">CMA		</span><span class="cmt">;to clear that bit in (LOGIN)</span></pre>
<pre id="l3587"><span class="adr">F158</span>	5F              	<span id="code3587">MOV	E,A	</span><span class="cmt">;and (WRTPRT).</span></pre>
<pre id="l3588"><span class="adr">F159</span>	7C              	<span id="code3588">MOV	A,H</span></pre>
<pre id="l3589"><span class="adr">F15A</span>	2F              	<span id="code3589">CMA</span></pre>
<pre id="l3590"><span class="adr">F15B</span>	2A AF F1        	<span id="code3590">LHLD	LOGIN	</span><span class="cmt">;reset the login vector.</span></pre>
<pre id="l3591"><span class="adr">F15E</span>	A4              	<span id="code3591">ANA	H</span></pre>
<pre id="l3592"><span class="adr">F15F</span>	57              	<span id="code3592">MOV	D,A</span></pre>
<pre id="l3593"><span class="adr">F160</span>	7D              	<span id="code3593">MOV	A,L</span></pre>
<pre id="l3594"><span class="adr">F161</span>	A3              	<span id="code3594">ANA	E</span></pre>
<pre id="l3595"><span class="adr">F162</span>	5F              	<span id="code3595">MOV	E,A</span></pre>
<pre id="l3596"><span class="adr">F163</span>	2A AD F1        	<span id="code3596">LHLD	WRTPRT</span></pre>
<pre id="l3597"><span class="adr">F166</span>	EB              	<span id="code3597">XCHG</span></pre>
<pre id="l3598"><span class="adr">F167</span>	22 AF F1        	<span id="code3598">SHLD	LOGIN	</span><span class="cmt">;and save.</span></pre>
<pre id="l3599"><span class="adr">F16A</span>	7D              	<span id="code3599">MOV	A,L	</span><span class="cmt">;now do the write protect vector.</span></pre>
<pre id="l3600"><span class="adr">F16B</span>	A3              	<span id="code3600">ANA	E</span></pre>
<pre id="l3601"><span class="adr">F16C</span>	6F              	<span id="code3601">MOV	L,A</span></pre>
<pre id="l3602"><span class="adr">F16D</span>	7C              	<span id="code3602">MOV	A,H</span></pre>
<pre id="l3603"><span class="adr">F16E</span>	A2              	<span id="code3603">ANA	D</span></pre>
<pre id="l3604"><span class="adr">F16F</span>	67              	<span id="code3604">MOV	H,A</span></pre>
<pre id="l3605"><span class="adr">F170</span>	22 AD F1        	<span id="code3605">SHLD	WRTPRT	</span><span class="cmt">;and save. all done.</span></pre>
<pre id="l3606"><span class="adr">F173</span>	C9              	<span id="code3606">RET</span></pre>
<pre id="l3607"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3608"><span class="adr"></span>	                <span class="cmt">;   Get here to return to the user.</span></pre>
<pre id="l3609"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3610"><span class="adr">F174</span>	3A DE F1        <span class="l" id="label3610">GOBACK</span>	<span id="code3610">LDA	AUTO	</span><span class="cmt">;was auto select activated?</span></pre>
<pre id="l3611"><span class="adr">F177</span>	B7              	<span id="code3611">ORA	A</span></pre>
<pre id="l3612"><span class="adr">F178</span>	CA 91 F1        	<span id="code3612">JZ	GOBACK1</span></pre>
<pre id="l3613"><span class="adr">F17B</span>	2A 43 E7        	<span id="code3613">LHLD	PARAMS	</span><span class="cmt">;yes, but was a change made?</span></pre>
<pre id="l3614"><span class="adr">F17E</span>	36 00           	<span id="code3614">MVI	M,0	</span><span class="cmt">;(* reset first byte of fcb *)</span></pre>
<pre id="l3615"><span class="adr">F180</span>	3A E0 F1        	<span id="code3615">LDA	AUTOFLAG</span></pre>
<pre id="l3616"><span class="adr">F183</span>	B7              	<span id="code3616">ORA	A</span></pre>
<pre id="l3617"><span class="adr">F184</span>	CA 91 F1        	<span id="code3617">JZ	GOBACK1</span></pre>
<pre id="l3618"><span class="adr">F187</span>	77              	<span id="code3618">MOV	M,A	</span><span class="cmt">;yes, reset first byte properly.</span></pre>
<pre id="l3619"><span class="adr">F188</span>	3A DF F1        	<span id="code3619">LDA	OLDDRV	</span><span class="cmt">;and get the old drive and select it.</span></pre>
<pre id="l3620"><span class="adr">F18B</span>	32 D6 F1        	<span id="code3620">STA	EPARAM</span></pre>
<pre id="l3621"><span class="adr">F18E</span>	CD 45 F0        	<span id="code3621">CALL	SETDSK</span></pre>
<pre id="l3622"><span class="adr">F191</span>	2A 0F E7        <span class="l" id="label3622">GOBACK1</span>	<span id="code3622">LHLD	USRSTACK</span><span class="cmt">;reset the users stack pointer.</span></pre>
<pre id="l3623"><span class="adr">F194</span>	F9              	<span id="code3623">SPHL</span></pre>
<pre id="l3624"><span class="adr">F195</span>	2A 45 E7        	<span id="code3624">LHLD	STATUS	</span><span class="cmt">;get return status.</span></pre>
<pre id="l3625"><span class="adr">F198</span>	7D              	<span id="code3625">MOV	A,L	</span><span class="cmt">;force version 1.4 compatability.</span></pre>
<pre id="l3626"><span class="adr">F199</span>	44              	<span id="code3626">MOV	B,H</span></pre>
<pre id="l3627"><span class="adr">F19A</span>	C9              	<span id="code3627">RET		</span><span class="cmt">;and go back to user.</span></pre>
<pre id="l3628"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3629"><span class="adr"></span>	                <span class="cmt">;   Function #40. This is a special entry to do random i/o.</span></pre>
<pre id="l3630"><span class="adr"></span>	                <span class="cmt">; For the case where we are writing to unused disk space, this</span></pre>
<pre id="l3631"><span class="adr"></span>	                <span class="cmt">; space will be zeroed out first. This must be a M/PM special</span></pre>
<pre id="l3632"><span class="adr"></span>	                <span class="cmt">; purpose function, because why would any normal program even</span></pre>
<pre id="l3633"><span class="adr"></span>	                <span class="cmt">; care about the previous contents of a sector about to be</span></pre>
<pre id="l3634"><span class="adr"></span>	                <span class="cmt">; written over.</span></pre>
<pre id="l3635"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3636"><span class="adr">F19B</span>	CD 51 F0        <span class="l" id="label3636">WTSPECL</span>	<span id="code3636">CALL	AUTOSEL	</span><span class="cmt">;select proper drive.</span></pre>
<pre id="l3637"><span class="adr">F19E</span>	3E 02           	<span id="code3637">MVI	A,2	</span><span class="cmt">;use special write mode.</span></pre>
<pre id="l3638"><span class="adr">F1A0</span>	32 D5 F1        	<span id="code3638">STA	MODE</span></pre>
<pre id="l3639"><span class="adr">F1A3</span>	0E 00           	<span id="code3639">MVI	C,0	</span><span class="cmt">;set write indicator.</span></pre>
<pre id="l3640"><span class="adr">F1A5</span>	CD 07 EF        	<span id="code3640">CALL	POSITN1	</span><span class="cmt">;position the file.</span></pre>
<pre id="l3641"><span class="adr">F1A8</span>	CC 03 EE        	<span id="code3641">CZ	WTSEQ1	</span><span class="cmt">;and write (if no errors).</span></pre>
<pre id="l3642"><span class="adr">F1AB</span>	C9              	<span id="code3642">RET</span></pre>
<pre id="l3643"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3644"><span class="adr"></span>	                <span class="cmt">;**************************************************************</span></pre>
<pre id="l3645"><span class="adr"></span>	                <span class="cmt">;*</span></pre>
<pre id="l3646"><span class="adr"></span>	                <span class="cmt">;*     BDOS data storage pool.</span></pre>
<pre id="l3647"><span class="adr"></span>	                <span class="cmt">;*</span></pre>
<pre id="l3648"><span class="adr"></span>	                <span class="cmt">;**************************************************************</span></pre>
<pre id="l3649"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3650"><span class="adr">F1AC</span>	E5              <span class="l" id="label3650">EMPTYFCB</span><span id="code3650">:DB	0E5H	</span><span class="cmt">;empty directory segment indicator.</span></pre>
<pre id="l3651"><span class="adr">F1AD</span>	00 00           <span class="l" id="label3651">WRTPRT</span>	<span id="code3651">DW	0	</span><span class="cmt">;write protect status for all 16 drives.</span></pre>
<pre id="l3652"><span class="adr">F1AF</span>	00 00           <span class="l" id="label3652">LOGIN</span>	<span id="code3652">DW	0	</span><span class="cmt">;drive active word (1 bit per drive).</span></pre>
<pre id="l3653"><span class="adr">F1B1</span>	80 00           <span class="l" id="label3653">USERDMA</span>	<span id="code3653">DW	080H	</span><span class="cmt">;user's dma address (defaults to 80h).</span></pre>
<pre id="l3654"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3655"><span class="adr"></span>	                <span class="cmt">;   Scratch areas from parameter block.</span></pre>
<pre id="l3656"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3657"><span class="adr">F1B3</span>	00 00           <span class="l" id="label3657">SCRATCH1</span><span id="code3657">:DW	0	</span><span class="cmt">;relative position within dir segment for file (0-3).</span></pre>
<pre id="l3658"><span class="adr">F1B5</span>	00 00           <span class="l" id="label3658">SCRATCH2</span><span id="code3658">:DW	0	</span><span class="cmt">;last selected track number.</span></pre>
<pre id="l3659"><span class="adr">F1B7</span>	00 00           <span class="l" id="label3659">SCRATCH3</span><span id="code3659">:DW	0	</span><span class="cmt">;last selected sector number.</span></pre>
<pre id="l3660"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3661"><span class="adr"></span>	                <span class="cmt">;   Disk storage areas from parameter block.</span></pre>
<pre id="l3662"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3663"><span class="adr">F1B9</span>	00 00           <span class="l" id="label3663">DIRBUF</span>	<span id="code3663">DW	0	</span><span class="cmt">;address of directory buffer to use.</span></pre>
<pre id="l3664"><span class="adr">F1BB</span>	00 00           <span class="l" id="label3664">DISKPB</span>	<span id="code3664">DW	0	</span><span class="cmt">;contains address of disk parameter block.</span></pre>
<pre id="l3665"><span class="adr">F1BD</span>	00 00           <span class="l" id="label3665">CHKVECT</span>	<span id="code3665">DW	0	</span><span class="cmt">;address of check vector.</span></pre>
<pre id="l3666"><span class="adr">F1BF</span>	00 00           <span class="l" id="label3666">ALOCVECT</span><span id="code3666">:DW	0	</span><span class="cmt">;address of allocation vector (bit map).</span></pre>
<pre id="l3667"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3668"><span class="adr"></span>	                <span class="cmt">;   Parameter block returned from the bios.</span></pre>
<pre id="l3669"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3670"><span class="adr">F1C1</span>	00 00           <span class="l" id="label3670">SECTORS</span>	<span id="code3670">DW	0	</span><span class="cmt">;sectors per track from bios.</span></pre>
<pre id="l3671"><span class="adr">F1C3</span>	00              <span class="l" id="label3671">BLKSHFT</span>	<span id="code3671">DB	0	</span><span class="cmt">;block shift.</span></pre>
<pre id="l3672"><span class="adr">F1C4</span>	00              <span class="l" id="label3672">BLKMASK</span>	<span id="code3672">DB	0	</span><span class="cmt">;block mask.</span></pre>
<pre id="l3673"><span class="adr">F1C5</span>	00              <span class="l" id="label3673">EXTMASK</span>	<span id="code3673">DB	0	</span><span class="cmt">;extent mask.</span></pre>
<pre id="l3674"><span class="adr">F1C6</span>	00 00           <span class="l" id="label3674">DSKSIZE</span>	<span id="code3674">DW	0	</span><span class="cmt">;disk size from bios (number of blocks-1).</span></pre>
<pre id="l3675"><span class="adr">F1C8</span>	00 00           <span class="l" id="label3675">DIRSIZE</span>	<span id="code3675">DW	0	</span><span class="cmt">;directory size.</span></pre>
<pre id="l3676"><span class="adr">F1CA</span>	00 00           <span class="l" id="label3676">ALLOC0</span>	<span id="code3676">DW	0	</span><span class="cmt">;storage for first bytes of bit map (dir space used).</span></pre>
<pre id="l3677"><span class="adr">F1CC</span>	00 00           <span class="l" id="label3677">ALLOC1</span>	<span id="code3677">DW	0</span></pre>
<pre id="l3678"><span class="adr">F1CE</span>	00 00           <span class="l" id="label3678">OFFSET</span>	<span id="code3678">DW	0	</span><span class="cmt">;first usable track number.</span></pre>
<pre id="l3679"><span class="adr">F1D0</span>	00 00           <span class="l" id="label3679">XLATE</span>	<span id="code3679">DW	0	</span><span class="cmt">;sector translation table address.</span></pre>
<pre id="l3680"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3681"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3682"><span class="adr">F1D2</span>	00              <span class="l" id="label3682">CLOSEFLG</span><span id="code3682">:DB	0	</span><span class="cmt">;close flag (=0ffh is extent written ok).</span></pre>
<pre id="l3683"><span class="adr">F1D3</span>	00              <span class="l" id="label3683">RDWRTFLG</span><span id="code3683">:DB	0	</span><span class="cmt">;read/write flag (0ffh=read, 0=write).</span></pre>
<pre id="l3684"><span class="adr">F1D4</span>	00              <span class="l" id="label3684">FNDSTAT</span>	<span id="code3684">DB	0	</span><span class="cmt">;filename found status (0=found first entry).</span></pre>
<pre id="l3685"><span class="adr">F1D5</span>	00              <span class="l" id="label3685">MODE</span>	<span id="code3685">DB	0	</span><span class="cmt">;I/o mode select (0=random, 1=sequential, 2=special random).</span></pre>
<pre id="l3686"><span class="adr">F1D6</span>	00              <span class="l" id="label3686">EPARAM</span>	<span id="code3686">DB	0	</span><span class="cmt">;storage for register (E) on entry to bdos.</span></pre>
<pre id="l3687"><span class="adr">F1D7</span>	00              <span class="l" id="label3687">RELBLOCK</span><span id="code3687">:DB	0	</span><span class="cmt">;relative position within fcb of block number written.</span></pre>
<pre id="l3688"><span class="adr">F1D8</span>	00              <span class="l" id="label3688">COUNTER</span>	<span id="code3688">DB	0	</span><span class="cmt">;byte counter for directory name searches.</span></pre>
<pre id="l3689"><span class="adr">F1D9</span>	00 00 00 00     <span class="l" id="label3689">SAVEFCB</span>	<span id="code3689">DW	0,0	</span><span class="cmt">;save space for address of fcb (for directory searches).</span></pre>
<pre id="l3690"><span class="adr">F1DD</span>	00              <span class="l" id="label3690">BIGDISK</span>	<span id="code3690">DB	0	</span><span class="cmt">;if =0 then disk is > 256 blocks long.</span></pre>
<pre id="l3691"><span class="adr">F1DE</span>	00              <span class="l" id="label3691">AUTO</span>	<span id="code3691">DB	0	</span><span class="cmt">;if non-zero, then auto select activated.</span></pre>
<pre id="l3692"><span class="adr">F1DF</span>	00              <span class="l" id="label3692">OLDDRV</span>	<span id="code3692">DB	0	</span><span class="cmt">;on auto select, storage for previous drive.</span></pre>
<pre id="l3693"><span class="adr">F1E0</span>	00              <span class="l" id="label3693">AUTOFLAG</span><span id="code3693">:DB	0	</span><span class="cmt">;if non-zero, then auto select changed drives.</span></pre>
<pre id="l3694"><span class="adr">F1E1</span>	00              <span class="l" id="label3694">SAVNXT</span>	<span id="code3694">DB	0	</span><span class="cmt">;storage for next record number to access.</span></pre>
<pre id="l3695"><span class="adr">F1E2</span>	00              <span class="l" id="label3695">SAVEXT</span>	<span id="code3695">DB	0	</span><span class="cmt">;storage for extent number of file.</span></pre>
<pre id="l3696"><span class="adr">F1E3</span>	00 00           <span class="l" id="label3696">SAVNREC</span>	<span id="code3696">DW	0	</span><span class="cmt">;storage for number of records in file.</span></pre>
<pre id="l3697"><span class="adr">F1E5</span>	00 00           <span class="l" id="label3697">BLKNMBR</span>	<span id="code3697">DW	0	</span><span class="cmt">;block number (physical sector) used within a file or logical sector.</span></pre>
<pre id="l3698"><span class="adr">F1E7</span>	00 00           <span class="l" id="label3698">LOGSECT</span>	<span id="code3698">DW	0	</span><span class="cmt">;starting logical (128 byte) sector of block (physical sector).</span></pre>
<pre id="l3699"><span class="adr">F1E9</span>	00              <span class="l" id="label3699">FCBPOS</span>	<span id="code3699">DB	0	</span><span class="cmt">;relative position within buffer for fcb of file of interest.</span></pre>
<pre id="l3700"><span class="adr">F1EA</span>	00 00           <span class="l" id="label3700">FILEPOS</span>	<span id="code3700">DW	0	</span><span class="cmt">;files position within directory (0 to max entries -1).</span></pre>
<pre id="l3701"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3702"><span class="adr"></span>	                <span class="cmt">;   Disk directory buffer checksum bytes. One for each of the</span></pre>
<pre id="l3703"><span class="adr"></span>	                <span class="cmt">; 16 possible drives.</span></pre>
<pre id="l3704"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3705"><span class="adr">F1EC</span>	00 00 00 00     <span class="l" id="label3705">CKSUMTBL</span><span id="code3705">:DB	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0</span><br/>	.&nbsp;.&nbsp;.&nbsp;<br/>F1F8	00 00 00 00 <br/></pre>
<pre id="l3706"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3707"><span class="adr"></span>	                <span class="cmt">;   Extra space ?</span></pre>
<pre id="l3708"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3709"><span class="adr">F1FC</span>	00 00 00 00     	<span id="code3709">DB	0,0,0,0</span></pre>
<pre id="l3710"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3711"><span class="adr"></span>	                <span class="cmt">;**************************************************************</span></pre>
<pre id="l3712"><span class="adr"></span>	                <span class="cmt">;*</span></pre>
<pre id="l3713"><span class="adr"></span>	                <span class="cmt">;*        B I O S   J U M P   T A B L E</span></pre>
<pre id="l3714"><span class="adr"></span>	                <span class="cmt">;*</span></pre>
<pre id="l3715"><span class="adr"></span>	                <span class="cmt">;**************************************************************</span></pre>
<pre id="l3716"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3717"><span class="adr">F200</span>	C3 00 00        <span class="l" id="label3717">BOOT</span>	<span id="code3717">JMP	0	</span><span class="cmt">;NOTE WE USE FAKE DESTINATIONS</span></pre>
<pre id="l3718"><span class="adr">F203</span>	C3 00 00        <span class="l" id="label3718">WBOOT</span>	<span id="code3718">JMP	0</span></pre>
<pre id="l3719"><span class="adr">F206</span>	C3 00 00        <span class="l" id="label3719">CONST</span>	<span id="code3719">JMP	0</span></pre>
<pre id="l3720"><span class="adr">F209</span>	C3 00 00        <span class="l" id="label3720">CONIN</span>	<span id="code3720">JMP	0</span></pre>
<pre id="l3721"><span class="adr">F20C</span>	C3 00 00        <span class="l" id="label3721">CONOUT</span>	<span id="code3721">JMP	0</span></pre>
<pre id="l3722"><span class="adr">F20F</span>	C3 00 00        <span class="l" id="label3722">LIST</span>	<span id="code3722">JMP	0</span></pre>
<pre id="l3723"><span class="adr">F212</span>	C3 00 00        <span class="l" id="label3723">PUNCH</span>	<span id="code3723">JMP	0</span></pre>
<pre id="l3724"><span class="adr">F215</span>	C3 00 00        <span class="l" id="label3724">READER</span>	<span id="code3724">JMP	0</span></pre>
<pre id="l3725"><span class="adr">F218</span>	C3 00 00        <span class="l" id="label3725">HOME</span>	<span id="code3725">JMP	0</span></pre>
<pre id="l3726"><span class="adr">F21B</span>	C3 00 00        <span class="l" id="label3726">SELDSK</span>	<span id="code3726">JMP	0</span></pre>
<pre id="l3727"><span class="adr">F21E</span>	C3 00 00        <span class="l" id="label3727">SETTRK</span>	<span id="code3727">JMP	0</span></pre>
<pre id="l3728"><span class="adr">F221</span>	C3 00 00        <span class="l" id="label3728">SETSEC</span>	<span id="code3728">JMP	0</span></pre>
<pre id="l3729"><span class="adr">F224</span>	C3 00 00        <span class="l" id="label3729">SETDMA</span>	<span id="code3729">JMP	0</span></pre>
<pre id="l3730"><span class="adr">F227</span>	C3 00 00        <span class="l" id="label3730">READ</span>	<span id="code3730">JMP	0</span></pre>
<pre id="l3731"><span class="adr">F22A</span>	C3 00 00        <span class="l" id="label3731">WRITE</span>	<span id="code3731">JMP	0</span></pre>
<pre id="l3732"><span class="adr">F22D</span>	C3 00 00        <span class="l" id="label3732">PRSTAT</span>	<span id="code3732">JMP	0</span></pre>
<pre id="l3733"><span class="adr">F230</span>	C3 00 00        <span class="l" id="label3733">SECTRN</span>	<span id="code3733">JMP	0</span></pre>
<pre id="l3734"><span class="adr"></span>	                <span class="cmt">;</span></pre>
<pre id="l3735"><span class="adr"></span>	                <span class="cmt">;*</span></pre>
<pre id="l3736"><span class="adr"></span>	                <span class="cmt">;******************   E N D   O F   C P / M   *****************</span></pre>
<pre id="l3737"><span class="adr"></span>	                <span class="cmt">;*</span></pre>
<pre id="l3738"><span class="adr"></span>	                <span id="code3738"></span></pre>
<pre id="l3739"><span class="adr"></span>	                </pre>
<pre>Labels:</pre><div class="hordiv"></div><pre class="labeltable"><span class='t1' onclick="return gotoLabel('active');">active                  E742</span><span class='t1' onclick="return gotoLabel('adda2hl');">adda2hl                 E964</span><span class='t1' onclick="return gotoLabel('addhl');">addhl                   DE59</span><span class='t2' onclick="return gotoLabel('alloc0');">alloc0                  F1CA</span><br/><span class='t1' onclick="return gotoLabel('alloc1');">alloc1                  F1CC</span><span class='t1' onclick="return gotoLabel('alocvect');">alocvect                F1BF</span><span class='t1' onclick="return gotoLabel('auto');">auto                    F1DE</span><span class='t2' onclick="return gotoLabel('autoflag');">autoflag                F1E0</span><br/><span class='t1' onclick="return gotoLabel('autosel');">autosel                 F051</span><span class='t1' onclick="return gotoLabel('autosl1');">autosl1                 F075</span><span class='t1' onclick="return gotoLabel('backup');">backup                  E5A4</span><span class='t2' onclick="return gotoLabel('backup1');">backup1                 E5AC</span><br/><span class='t1' onclick="return gotoLabel('badload');">badload                 E37A</span><span class='t1' onclick="return gotoLabel('badsctr');">badsctr                 E409</span><span class='t1' onclick="return gotoLabel('badsec');">badsec                  E4CA</span><span class='t2' onclick="return gotoLabel('badsel');">badsel                  E4D5</span><br/><span class='t1' onclick="return gotoLabel('badslct');">badslct                 E40B</span><span class='t1' onclick="return gotoLabel('batch');">batch                   E3AB</span><span class='t1' onclick="return gotoLabel('batchfcb');">batchfcb                E3AC</span><span class='t2' onclick="return gotoLabel('bdosdrv');">bdosdrv                 E4C6</span><br/><span class='t1' onclick="return gotoLabel('bdoserr');">bdoserr                 E4BA</span><span class='t1' onclick="return gotoLabel('bigdisk');">bigdisk                 F1DD</span><span class='t1' onclick="return gotoLabel('bitmap');">bitmap                  EAA3</span><span class='t2' onclick="return gotoLabel('bitmap1');">bitmap1                 EAB1</span><br/><span class='t1' onclick="return gotoLabel('bitmap2');">bitmap2                 EAD2</span><span class='t1' onclick="return gotoLabel('bitmap3');">bitmap3                 EAF6</span><span class='t1' onclick="return gotoLabel('blkmask');">blkmask                 F1C4</span><span class='t2' onclick="return gotoLabel('blknmbr');">blknmbr                 F1E5</span><br/><span class='t1' onclick="return gotoLabel('blkshft');">blkshft                 F1C3</span><span class='t1' onclick="return gotoLabel('boot');">boot                    F200</span><span class='t1' onclick="return gotoLabel('bs');">bs                      0008</span><span class='t2' onclick="return gotoLabel('cbase');">cbase                   DC00</span><br/><span class='t1' onclick="return gotoLabel('ccpstack');">ccpstack                E3AB</span><span class='t1' onclick="return gotoLabel('cdrive');">cdrive                  E3EF</span><span class='t1' onclick="return gotoLabel('charbuf');">charbuf                 E70E</span><span class='t2' onclick="return gotoLabel('check');">check                   DE30</span><br/><span class='t1' onclick="return gotoLabel('checkdir');">checkdir                E99E</span><span class='t1' onclick="return gotoLabel('checksum');">checksum                E8F7</span><span class='t1' onclick="return gotoLabel('chgdrv');">chgdrv                  E3F0</span><span class='t2' onclick="return gotoLabel('chgnam1');">chgnam1                 EC27</span><br/><span class='t1' onclick="return gotoLabel('chgnames');">chgnames                EC16</span><span class='t1' onclick="return gotoLabel('chkblk');">chkblk                  E884</span><span class='t1' onclick="return gotoLabel('chkchar');">chkchar                 E514</span><span class='t2' onclick="return gotoLabel('chkcon');">chkcon                  DDC2</span><br/><span class='t1' onclick="return gotoLabel('chkdir1');">chkdir1                 E9C4</span><span class='t1' onclick="return gotoLabel('chknmbr');">chknmbr                 E98C</span><span class='t1' onclick="return gotoLabel('chkrofl');">chkrofl                 E944</span><span class='t2' onclick="return gotoLabel('chksum1');">chksum1                 E8FD</span><br/><span class='t1' onclick="return gotoLabel('chkvect');">chkvect                 F1BD</span><span class='t1' onclick="return gotoLabel('chkwprt');">chkwprt                 E954</span><span class='t1' onclick="return gotoLabel('ckbitmap');">ckbitmap                EA35</span><span class='t2' onclick="return gotoLabel('ckbmap1');">ckbmap1                 EA56</span><br/><span class='t1' onclick="return gotoLabel('ckcon1');">ckcon1                  E542</span><span class='t1' onclick="return gotoLabel('ckcon2');">ckcon2                  E545</span><span class='t1' onclick="return gotoLabel('ckconsol');">ckconsol                E523</span><span class='t2' onclick="return gotoLabel('ckfilpos');">ckfilpos                E9F5</span><br/><span class='t1' onclick="return gotoLabel('ckrof1');">ckrof1                  E947</span><span class='t1' onclick="return gotoLabel('cksumtbl');">cksumtbl                F1EC</span><span class='t1' onclick="return gotoLabel('clearbuf');">clearbuf                DF58</span><span class='t2' onclick="return gotoLabel('clears2');">clears2                 E972</span><br/><span class='t1' onclick="return gotoLabel('close');">close                   DCDA</span><span class='t1' onclick="return gotoLabel('closefil');">closefil                F0A5</span><span class='t1' onclick="return gotoLabel('closeflg');">closeflg                F1D2</span><span class='t2' onclick="return gotoLabel('closeit');">closeit                 ECA2</span><br/><span class='t1' onclick="return gotoLabel('closeit1');">closeit1                ECCD</span><span class='t1' onclick="return gotoLabel('closeit2');">closeit2                ECDB</span><span class='t1' onclick="return gotoLabel('closeit3');">closeit3                ECE1</span><span class='t2' onclick="return gotoLabel('closeit4');">closeit4                ECE8</span><br/><span class='t1' onclick="return gotoLabel('closeit5');">closeit5                ECFD</span><span class='t1' onclick="return gotoLabel('closeit6');">closeit6                ED17</span><span class='t1' onclick="return gotoLabel('closeit7');">closeit7                ED1F</span><span class='t2' onclick="return gotoLabel('cmdadr');">cmdadr                  DFC1</span><br/><span class='t1' onclick="return gotoLabel('cmdtbl');">cmdtbl                  DF10</span><span class='t1' onclick="return gotoLabel('cmmnd1');">cmmnd1                  DF82</span><span class='t1' onclick="return gotoLabel('cmmnd2');">cmmnd2                  DF98</span><span class='t2' onclick="return gotoLabel('cntrlc');">cntrlc                  0003</span><br/><span class='t1' onclick="return gotoLabel('cntrle');">cntrle                  0005</span><span class='t1' onclick="return gotoLabel('cntrlp');">cntrlp                  0010</span><span class='t1' onclick="return gotoLabel('cntrlr');">cntrlr                  0012</span><span class='t2' onclick="return gotoLabel('cntrls');">cntrls                  0013</span><br/><span class='t1' onclick="return gotoLabel('cntrlu');">cntrlu                  0015</span><span class='t1' onclick="return gotoLabel('cntrlx');">cntrlx                  0018</span><span class='t1' onclick="return gotoLabel('cntrlz');">cntrlz                  001A</span><span class='t2' onclick="return gotoLabel('comblk');">comblk                  E877</span><br/><span class='t1' onclick="return gotoLabel('comfile');">comfile                 E383</span><span class='t1' onclick="return gotoLabel('command');">command                 DF5C</span><span class='t1' onclick="return gotoLabel('comprand');">comprand                EFA5</span><span class='t2' onclick="return gotoLabel('conin');">conin                   F209</span><br/><span class='t1' onclick="return gotoLabel('conout');">conout                  F20C</span><span class='t1' onclick="return gotoLabel('const');">const                   F206</span><span class='t1' onclick="return gotoLabel('convert');">convert                 DE60</span><span class='t2' onclick="return gotoLabel('convfst');">convfst                 DE5E</span><br/><span class='t1' onclick="return gotoLabel('convrt1');">convrt1                 DE89</span><span class='t1' onclick="return gotoLabel('convrt2');">convrt2                 DE90</span><span class='t1' onclick="return gotoLabel('convrt3');">convrt3                 DE96</span><span class='t2' onclick="return gotoLabel('convrt4');">convrt4                 DE98</span><br/><span class='t1' onclick="return gotoLabel('convrt5');">convrt5                 DEA9</span><span class='t1' onclick="return gotoLabel('convrt6');">convrt6                 DEAB</span><span class='t1' onclick="return gotoLabel('convrt7');">convrt7                 DEAF</span><span class='t2' onclick="return gotoLabel('convrt8');">convrt8                 DEB9</span><br/><span class='t1' onclick="return gotoLabel('counter');">counter                 F1D8</span><span class='t1' onclick="return gotoLabel('cr');">cr                      000D</span><span class='t1' onclick="return gotoLabel('create');">create                  DD09</span><span class='t2' onclick="return gotoLabel('crlf');">crlf                    DC98</span><br/><span class='t1' onclick="return gotoLabel('curpos');">curpos                  E70C</span><span class='t1' onclick="return gotoLabel('de2hl');">de2hl                   E74F</span><span class='t1' onclick="return gotoLabel('de2hl1');">de2hl1                  E750</span><span class='t2' onclick="return gotoLabel('decode');">decode                  DFF8</span><br/><span class='t1' onclick="return gotoLabel('decode1');">decode1                 E008</span><span class='t1' onclick="return gotoLabel('decode2');">decode2                 E02A</span><span class='t1' onclick="return gotoLabel('decode3');">decode3                 E033</span><span class='t2' onclick="return gotoLabel('decode4');">decode4                 E03A</span><br/><span class='t1' onclick="return gotoLabel('defdma');">defdma                  E9DA</span><span class='t1' onclick="return gotoLabel('del');">del                     007F</span><span class='t1' onclick="return gotoLabel('delbatch');">delbatch                DDDD</span><span class='t2' onclick="return gotoLabel('delete');">delete                  DCEF</span><br/><span class='t1' onclick="return gotoLabel('delfile');">delfile                 F0D7</span><span class='t1' onclick="return gotoLabel('dirbuf');">dirbuf                  F1B9</span><span class='t1' onclick="return gotoLabel('dirc1');">dirc1                   E6E0</span><span class='t2' onclick="return gotoLabel('dircio');">dircio                  E6D4</span><br/><span class='t1' onclick="return gotoLabel('dirdma');">dirdma                  E9E0</span><span class='t1' onclick="return gotoLabel('dirdma1');">dirdma1                 E9E3</span><span class='t1' onclick="return gotoLabel('direct');">direct                  E077</span><span class='t2' onclick="return gotoLabel('direct1');">direct1                 E088</span><br/><span class='t1' onclick="return gotoLabel('direct2');">direct2                 E08F</span><span class='t1' onclick="return gotoLabel('direct3');">direct3                 E098</span><span class='t1' onclick="return gotoLabel('direct4');">direct4                 E0CC</span><span class='t2' onclick="return gotoLabel('direct5');">direct5                 E0D4</span><br/><span class='t1' onclick="return gotoLabel('direct6');">direct6                 E0D9</span><span class='t1' onclick="return gotoLabel('direct7');">direct7                 E10E</span><span class='t1' onclick="return gotoLabel('direct8');">direct8                 E10F</span><span class='t2' onclick="return gotoLabel('direct9');">direct9                 E11B</span><br/><span class='t1' onclick="return gotoLabel('dirread');">dirread                 E9D4</span><span class='t1' onclick="return gotoLabel('dirsize');">dirsize                 F1C8</span><span class='t1' onclick="return gotoLabel('dirwrite');">dirwrite                E9C6</span><span class='t2' onclick="return gotoLabel('diskpb');">diskpb                  F1BB</span><br/><span class='t1' onclick="return gotoLabel('diskro');">diskro                  E4E1</span><span class='t1' onclick="return gotoLabel('dmaset');">dmaset                  DDD8</span><span class='t1' onclick="return gotoLabel('doread');">doread                  E7B2</span><span class='t2' onclick="return gotoLabel('dowrite');">dowrite                 E7B8</span><br/><span class='t1' onclick="return gotoLabel('drect63');">drect63                 E0F7</span><span class='t1' onclick="return gotoLabel('drect65');">drect65                 E0F9</span><span class='t1' onclick="return gotoLabel('dselect');">dselect                 E054</span><span class='t2' onclick="return gotoLabel('dsksel');">dsksel                  DCBD</span><br/><span class='t1' onclick="return gotoLabel('dsksize');">dsksize                 F1C6</span><span class='t1' onclick="return gotoLabel('emptyfcb');">emptyfcb                F1AC</span><span class='t1' onclick="return gotoLabel('entry');">entry                   0005</span><span class='t2' onclick="return gotoLabel('entry1');">entry1                  DCC3</span><br/><span class='t1' onclick="return gotoLabel('entry2');">entry2                  DCF4</span><span class='t1' onclick="return gotoLabel('eparam');">eparam                  F1D6</span><span class='t1' onclick="return gotoLabel('erafil1');">erafil1                 EBA4</span><span class='t2' onclick="return gotoLabel('erafile');">erafile                 EB9C</span><br/><span class='t1' onclick="return gotoLabel('erase');">erase                   E11F</span><span class='t1' onclick="return gotoLabel('erase1');">erase1                  E142</span><span class='t1' onclick="return gotoLabel('error1');">error1                  E499</span><span class='t2' onclick="return gotoLabel('error2');">error2                  E4A5</span><br/><span class='t1' onclick="return gotoLabel('error3');">error3                  E4AB</span><span class='t1' onclick="return gotoLabel('error4');">error4                  E4B1</span><span class='t1' onclick="return gotoLabel('error5');">error5                  E4B4</span><span class='t2' onclick="return gotoLabel('exists');">exists                  E282</span><br/><span class='t1' onclick="return gotoLabel('extblk');">extblk                  E85E</span><span class='t1' onclick="return gotoLabel('extblk1');">extblk1                 E871</span><span class='t1' onclick="return gotoLabel('extmask');">extmask                 F1C5</span><span class='t2' onclick="return gotoLabel('extract');">extract                 E04B</span><br/><span class='t1' onclick="return gotoLabel('fbase');">fbase                   E406</span><span class='t1' onclick="return gotoLabel('fbase1');">fbase1                  E411</span><span class='t1' onclick="return gotoLabel('fcb');">fcb                     E3CD</span><span class='t2' onclick="return gotoLabel('fcb2hl');">fcb2hl                  E95E</span><br/><span class='t1' onclick="return gotoLabel('fcbpos');">fcbpos                  F1E9</span><span class='t1' onclick="return gotoLabel('fcbset');">fcbset                  EBFD</span><span class='t1' onclick="return gotoLabel('fcreate');">fcreate                 F0EC</span><span class='t2' onclick="return gotoLabel('ff');">ff                      000C</span><br/><span class='t1' onclick="return gotoLabel('filepos');">filepos                 F1EA</span><span class='t1' onclick="return gotoLabel('filero');">filero                  E4DC</span><span class='t1' onclick="return gotoLabel('filesize');">filesize                F14D</span><span class='t2' onclick="return gotoLabel('findfst');">findfst                 EB18</span><br/><span class='t1' onclick="return gotoLabel('findnxt');">findnxt                 EB2D</span><span class='t1' onclick="return gotoLabel('fndnxt1');">fndnxt1                 EB4A</span><span class='t1' onclick="return gotoLabel('fndnxt2');">fndnxt2                 EB53</span><span class='t2' onclick="return gotoLabel('fndnxt3');">fndnxt3                 EB73</span><br/><span class='t1' onclick="return gotoLabel('fndnxt4');">fndnxt4                 EB7C</span><span class='t1' onclick="return gotoLabel('fndnxt5');">fndnxt5                 EB83</span><span class='t1' onclick="return gotoLabel('fndnxt6');">fndnxt6                 EB94</span><span class='t2' onclick="return gotoLabel('fndspa1');">fndspa1                 EBC0</span><br/><span class='t1' onclick="return gotoLabel('fndspa2');">fndspa2                 EBD1</span><span class='t1' onclick="return gotoLabel('fndspa3');">fndspa3                 EBEC</span><span class='t1' onclick="return gotoLabel('fndspa4');">fndspa4                 EBF4</span><span class='t2' onclick="return gotoLabel('fndspace');">fndspace                EBBE</span><br/><span class='t1' onclick="return gotoLabel('fndstat');">fndstat                 F1D4</span><span class='t1' onclick="return gotoLabel('functns');">functns                 E447</span><span class='t1' onclick="return gotoLabel('getaloc');">getaloc                 F111</span><span class='t2' onclick="return gotoLabel('getback');">getback                 E386</span><br/><span class='t1' onclick="return gotoLabel('getback1');">getback1                E389</span><span class='t1' onclick="return gotoLabel('getblk1');">getblk1                 E845</span><span class='t1' onclick="return gotoLabel('getblk2');">getblk2                 E853</span><span class='t2' onclick="return gotoLabel('getblk3');">getblk3                 E85C</span><br/><span class='t1' onclick="return gotoLabel('getblock');">getblock                E83E</span><span class='t1' onclick="return gotoLabel('getchar');">getchar                 E4FB</span><span class='t1' onclick="return gotoLabel('getcon');">getcon                  E6C8</span><span class='t2' onclick="return gotoLabel('getcrnt');">getcrnt                 F104</span><br/><span class='t1' onclick="return gotoLabel('getcsts');">getcsts                 E6FE</span><span class='t1' onclick="return gotoLabel('getdsk');">getdsk                  DDD0</span><span class='t1' onclick="return gotoLabel('getecho');">getecho                 E506</span><span class='t2' onclick="return gotoLabel('getempty');">getempty                ED24</span><br/><span class='t1' onclick="return gotoLabel('getext');">getext                  DEC0</span><span class='t1' onclick="return gotoLabel('getext1');">getext1                 DEC8</span><span class='t1' onclick="return gotoLabel('getext2');">getext2                 DED9</span><span class='t2' onclick="return gotoLabel('getext3');">getext3                 DEDB</span><br/><span class='t1' onclick="return gotoLabel('getext4');">getext4                 DEDF</span><span class='t1' onclick="return gotoLabel('getext5');">getext5                 DEE9</span><span class='t1' onclick="return gotoLabel('getext6');">getext6                 DEF0</span><span class='t2' onclick="return gotoLabel('getext7');">getext7                 DEF2</span><br/><span class='t1' onclick="return gotoLabel('getext8');">getext8                 DF01</span><span class='t1' onclick="return gotoLabel('getext9');">getext9                 DF09</span><span class='t1' onclick="return gotoLabel('getfst');">getfst                  F0AB</span><span class='t2' onclick="return gotoLabel('getfst1');">getfst1                 F0C2</span><br/><span class='t1' onclick="return gotoLabel('getinp');">getinp                  DD39</span><span class='t1' onclick="return gotoLabel('getinp1');">getinp1                 DD96</span><span class='t1' onclick="return gotoLabel('getinp2');">getinp2                 DDA7</span><span class='t2' onclick="return gotoLabel('getinp3');">getinp3                 DDAB</span><br/><span class='t1' onclick="return gotoLabel('getinp4');">getinp4                 DDBA</span><span class='t1' onclick="return gotoLabel('getiob');">getiob                  E6ED</span><span class='t1' onclick="return gotoLabel('getlog');">getlog                  F0FE</span><span class='t2' onclick="return gotoLabel('getmt1');">getmt1                  ED46</span><br/><span class='t1' onclick="return gotoLabel('getnext');">getnext                 ED5A</span><span class='t1' onclick="return gotoLabel('getnxt');">getnxt                  F0C8</span><span class='t1' onclick="return gotoLabel('getparm');">getparm                 F126</span><span class='t2' onclick="return gotoLabel('getprm1');">getprm1                 F129</span><br/><span class='t1' onclick="return gotoLabel('getrdr');">getrdr                  E6CE</span><span class='t1' onclick="return gotoLabel('getrov');">getrov                  F117</span><span class='t1' onclick="return gotoLabel('gets2');">gets2                   E969</span><span class='t2' onclick="return gotoLabel('getsetuc');">getsetuc                DD15</span><br/><span class='t1' onclick="return gotoLabel('getuser');">getuser                 F12D</span><span class='t1' onclick="return gotoLabel('getusr');">getusr                  DD13</span><span class='t1' onclick="return gotoLabel('getver');">getver                  F07E</span><span class='t2' onclick="return gotoLabel('getwprt');">getwprt                 E91E</span><br/><span class='t1' onclick="return gotoLabel('goback');">goback                  F174</span><span class='t1' onclick="return gotoLabel('goback1');">goback1                 F191</span><span class='t1' onclick="return gotoLabel('gtnext1');">gtnext1                 ED83</span><span class='t2' onclick="return gotoLabel('gtnext2');">gtnext2                 ED8E</span><br/><span class='t1' onclick="return gotoLabel('gtnext3');">gtnext3                 EDAC</span><span class='t1' onclick="return gotoLabel('gtnext4');">gtnext4                 EDAF</span><span class='t1' onclick="return gotoLabel('gtnext5');">gtnext5                 EDB6</span><span class='t2' onclick="return gotoLabel('halt');">halt                    DFCF</span><br/><span class='t1' onclick="return gotoLabel('hl2de');">hl2de                   E042</span><span class='t1' onclick="return gotoLabel('home');">home                    F218</span><span class='t1' onclick="return gotoLabel('homedrv');">homedrv                 E7A1</span><span class='t2' onclick="return gotoLabel('inbuff');">inbuff                  DC06</span><br/><span class='t1' onclick="return gotoLabel('inpoint');">inpoint                 DC88</span><span class='t1' onclick="return gotoLabel('iobyte');">iobyte                  0003</span><span class='t1' onclick="return gotoLabel('ioerr1');">ioerr1                  E705</span><span class='t2' onclick="return gotoLabel('ioret');">ioret                   E7BB</span><br/><span class='t1' onclick="return gotoLabel('jumphl');">jumphl                  E74A</span><span class='t1' onclick="return gotoLabel('lf');">lf                      000A</span><span class='t1' onclick="return gotoLabel('list');">list                    F20F</span><span class='t2' onclick="return gotoLabel('logical');">logical                 E88A</span><br/><span class='t1' onclick="return gotoLabel('logicl1');">logicl1                 E890</span><span class='t1' onclick="return gotoLabel('login');">login                   F1AF</span><span class='t1' onclick="return gotoLabel('logindrv');">logindrv                F021</span><span class='t2' onclick="return gotoLabel('logoff');">logoff                  F153</span><br/><span class='t1' onclick="return gotoLabel('logsect');">logsect                 F1E7</span><span class='t1' onclick="return gotoLabel('mem');">mem                     003E</span><span class='t1' onclick="return gotoLabel('mode');">mode                    F1D5</span><span class='t2' onclick="return gotoLabel('morefls');">morefls                 E97F</span><br/><span class='t1' onclick="return gotoLabel('move3');">move3                   E040</span><span class='t1' onclick="return gotoLabel('movecd');">movecd                  DD29</span><span class='t1' onclick="return gotoLabel('movedir');">movedir                 E9E9</span><span class='t2' onclick="return gotoLabel('moveword');">moveword                EC94</span><br/><span class='t1' onclick="return gotoLabel('namepnt');">namepnt                 DC8A</span><span class='t1' onclick="return gotoLabel('nbytes');">nbytes                  E3F1</span><span class='t1' onclick="return gotoLabel('newline');">newline                 E5B1</span><span class='t2' onclick="return gotoLabel('newln1');">newln1                  E5B9</span><br/><span class='t1' onclick="return gotoLabel('nfuncts');">nfuncts                 0029</span><span class='t1' onclick="return gotoLabel('nofile');">nofile                  DFF0</span><span class='t1' onclick="return gotoLabel('nonblank');">nonblank                DE4F</span><span class='t2' onclick="return gotoLabel('none');">none                    DFEA</span><br/><span class='t1' onclick="return gotoLabel('nospace');">nospace                 E207</span><span class='t1' onclick="return gotoLabel('numcmds');">numcmds                 0006</span><span class='t1' onclick="return gotoLabel('nxent1');">nxent1                  EA19</span><span class='t2' onclick="return gotoLabel('nxent2');">nxent2                  EA20</span><br/><span class='t1' onclick="return gotoLabel('nxentry');">nxentry                 EA05</span><span class='t1' onclick="return gotoLabel('offset');">offset                  F1CE</span><span class='t1' onclick="return gotoLabel('olddrv');">olddrv                  F1DF</span><span class='t2' onclick="return gotoLabel('open');">open                    DCCB</span><br/><span class='t1' onclick="return gotoLabel('openfcb');">openfcb                 DCD0</span><span class='t1' onclick="return gotoLabel('openfil');">openfil                 F09C</span><span class='t1' onclick="return gotoLabel('openit');">openit                  EC51</span><span class='t2' onclick="return gotoLabel('openit1');">openit1                 EC5A</span><br/><span class='t1' onclick="return gotoLabel('openit2');">openit2                 EC8B</span><span class='t1' onclick="return gotoLabel('outchar');">outchar                 E548</span><span class='t1' onclick="return gotoLabel('outchr1');">outchr1                 E562</span><span class='t2' onclick="return gotoLabel('outchr2');">outchr2                 E579</span><br/><span class='t1' onclick="return gotoLabel('outcon');">outcon                  E590</span><span class='t1' onclick="return gotoLabel('outcon1');">outcon1                 E596</span><span class='t1' onclick="return gotoLabel('outcrlf');">outcrlf                 E5C9</span><span class='t2' onclick="return gotoLabel('outflag');">outflag                 E70A</span><br/><span class='t1' onclick="return gotoLabel('params');">params                  E743</span><span class='t1' onclick="return gotoLabel('pattrn1');">pattrn1                 DF28</span><span class='t1' onclick="return gotoLabel('pattrn2');">pattrn2                 E400</span><span class='t2' onclick="return gotoLabel('pline');">pline                   DCA7</span><br/><span class='t1' onclick="return gotoLabel('pline2');">pline2                  DCAC</span><span class='t1' onclick="return gotoLabel('position');">position                EF03</span><span class='t1' onclick="return gotoLabel('positn1');">positn1                 EF07</span><span class='t2' onclick="return gotoLabel('positn2');">positn2                 EF47</span><br/><span class='t1' onclick="return gotoLabel('positn3');">positn3                 EF7F</span><span class='t1' onclick="return gotoLabel('positn4');">positn4                 EF84</span><span class='t1' onclick="return gotoLabel('positn5');">positn5                 EF8B</span><span class='t2' onclick="return gotoLabel('print');">print                   DC8C</span><br/><span class='t1' onclick="return gotoLabel('printb');">printb                  DC92</span><span class='t1' onclick="return gotoLabel('prstat');">prstat                  F22D</span><span class='t1' onclick="return gotoLabel('prterr');">prterr                  E4E5</span><span class='t2' onclick="return gotoLabel('prtflag');">prtflag                 E70D</span><br/><span class='t1' onclick="return gotoLabel('prtmesg');">prtmesg                 E5D3</span><span class='t1' onclick="return gotoLabel('prtstr');">prtstr                  E6F8</span><span class='t1' onclick="return gotoLabel('punch');">punch                   F212</span><span class='t2' onclick="return gotoLabel('putdma');">putdma                  F10A</span><br/><span class='t1' onclick="return gotoLabel('ransiz1');">ransiz1                 EFE4</span><span class='t1' onclick="return gotoLabel('ransiz2');">ransiz2                 F006</span><span class='t1' onclick="return gotoLabel('ransiz3');">ransiz3                 F00C</span><span class='t2' onclick="return gotoLabel('ransize');">ransize                 EFD2</span><br/><span class='t1' onclick="return gotoLabel('rdbuf1');">rdbuf1                  E5EF</span><span class='t1' onclick="return gotoLabel('rdbuf10');">rdbuf10                 E670</span><span class='t1' onclick="return gotoLabel('rdbuf11');">rdbuf11                 E678</span><span class='t2' onclick="return gotoLabel('rdbuf12');">rdbuf12                 E68A</span><br/><span class='t1' onclick="return gotoLabel('rdbuf13');">rdbuf13                 E699</span><span class='t1' onclick="return gotoLabel('rdbuf14');">rdbuf14                 E6A6</span><span class='t1' onclick="return gotoLabel('rdbuf15');">rdbuf15                 E6A9</span><span class='t2' onclick="return gotoLabel('rdbuf16');">rdbuf16                 E6BD</span><br/><span class='t1' onclick="return gotoLabel('rdbuf17');">rdbuf17                 E6C1</span><span class='t1' onclick="return gotoLabel('rdbuf2');">rdbuf2                  E5F1</span><span class='t1' onclick="return gotoLabel('rdbuf3');">rdbuf3                  E616</span><span class='t2' onclick="return gotoLabel('rdbuf4');">rdbuf4                  E626</span><br/><span class='t1' onclick="return gotoLabel('rdbuf5');">rdbuf5                  E637</span><span class='t1' onclick="return gotoLabel('rdbuf6');">rdbuf6                  E648</span><span class='t1' onclick="return gotoLabel('rdbuf7');">rdbuf7                  E64E</span><span class='t2' onclick="return gotoLabel('rdbuf8');">rdbuf8                  E65F</span><br/><span class='t1' onclick="return gotoLabel('rdbuf9');">rdbuf9                  E66B</span><span class='t1' onclick="return gotoLabel('rdbuff');">rdbuff                  E5E1</span><span class='t1' onclick="return gotoLabel('rderr');">rderr                   DFDF</span><span class='t2' onclick="return gotoLabel('rderror');">rderror                 DFD9</span><br/><span class='t1' onclick="return gotoLabel('rdrandom');">rdrandom                F141</span><span class='t1' onclick="return gotoLabel('rdrec');">rdrec                   DCF9</span><span class='t1' onclick="return gotoLabel('rdseq');">rdseq                   EDBC</span><span class='t2' onclick="return gotoLabel('rdseq1');">rdseq1                  EDC1</span><br/><span class='t1' onclick="return gotoLabel('rdseq2');">rdseq2                  EDE6</span><span class='t1' onclick="return gotoLabel('rdseq3');">rdseq3                  EDFB</span><span class='t1' onclick="return gotoLabel('rdwrtflg');">rdwrtflg                F1D3</span><span class='t2' onclick="return gotoLabel('read');">read                    F227</span><br/><span class='t1' onclick="return gotoLabel('reader');">reader                  F215</span><span class='t1' onclick="return gotoLabel('readfcb');">readfcb                 DCFE</span><span class='t1' onclick="return gotoLabel('readran');">readran                 EF93</span><span class='t2' onclick="return gotoLabel('readseq');">readseq                 F0E0</span><br/><span class='t1' onclick="return gotoLabel('relblock');">relblock                F1D7</span><span class='t1' onclick="return gotoLabel('renam');">renam                   DD0E</span><span class='t1' onclick="return gotoLabel('rename');">rename                  E210</span><span class='t2' onclick="return gotoLabel('rename1');">rename1                 E23F</span><br/><span class='t1' onclick="return gotoLabel('rename2');">rename2                 E259</span><span class='t1' onclick="return gotoLabel('rename3');">rename3                 E25E</span><span class='t1' onclick="return gotoLabel('rename4');">rename4                 E26D</span><span class='t2' onclick="return gotoLabel('rename5');">rename5                 E273</span><br/><span class='t1' onclick="return gotoLabel('rename6');">rename6                 E279</span><span class='t1' onclick="return gotoLabel('renfile');">renfile                 F0F5</span><span class='t1' onclick="return gotoLabel('resdsk');">resdsk                  DCB8</span><span class='t2' onclick="return gotoLabel('resetdr');">resetdr                 E066</span><br/><span class='t1' onclick="return gotoLabel('rodisk');">rodisk                  E40D</span><span class='t1' onclick="return gotoLabel('rofile');">rofile                  E40F</span><span class='t1' onclick="return gotoLabel('rstdsk');">rstdsk                  F083</span><span class='t2' onclick="return gotoLabel('rtn');">rtn                     E704</span><br/><span class='t1' onclick="return gotoLabel('rtncode');">rtncode                 E3EE</span><span class='t1' onclick="return gotoLabel('samext');">samext                  EB07</span><span class='t1' onclick="return gotoLabel('savatr1');">savatr1                 EC40</span><span class='t2' onclick="return gotoLabel('save');">save                    E1AD</span><br/><span class='t1' onclick="return gotoLabel('save1');">save1                   E1D4</span><span class='t1' onclick="return gotoLabel('save2');">save2                   E1F1</span><span class='t1' onclick="return gotoLabel('save3');">save3                   E1FB</span><span class='t2' onclick="return gotoLabel('save4');">save4                   E201</span><br/><span class='t1' onclick="return gotoLabel('saveattr');">saveattr                EC3B</span><span class='t1' onclick="return gotoLabel('savefcb');">savefcb                 F1D9</span><span class='t1' onclick="return gotoLabel('savext');">savext                  F1E2</span><span class='t2' onclick="return gotoLabel('savnrec');">savnrec                 F1E3</span><br/><span class='t1' onclick="return gotoLabel('savnxt');">savnxt                  F1E1</span><span class='t1' onclick="return gotoLabel('scratch1');">scratch1                F1B3</span><span class='t1' onclick="return gotoLabel('scratch2');">scratch2                F1B5</span><span class='t2' onclick="return gotoLabel('scratch3');">scratch3                F1B7</span><br/><span class='t1' onclick="return gotoLabel('search');">search                  DF2E</span><span class='t1' onclick="return gotoLabel('search1');">search1                 DF33</span><span class='t1' onclick="return gotoLabel('search2');">search2                 DF3C</span><span class='t2' onclick="return gotoLabel('search3');">search3                 DF4F</span><br/><span class='t1' onclick="return gotoLabel('search4');">search4                 DF54</span><span class='t1' onclick="return gotoLabel('sectors');">sectors                 F1C1</span><span class='t1' onclick="return gotoLabel('sectrn');">sectrn                  F230</span><span class='t2' onclick="return gotoLabel('seldsk');">seldsk                  F21B</span><br/><span class='t1' onclick="return gotoLabel('select');">select                  E759</span><span class='t1' onclick="return gotoLabel('select1');">select1                 E79D</span><span class='t1' onclick="return gotoLabel('setattr');">setattr                 F11D</span><span class='t2' onclick="return gotoLabel('setbit');">setbit                  E90B</span><br/><span class='t1' onclick="return gotoLabel('setcdrv');">setcdrv                 DD1A</span><span class='t1' onclick="return gotoLabel('setdir');">setdir                  E99C</span><span class='t1' onclick="return gotoLabel('setdma');">setdma                  F224</span><span class='t2' onclick="return gotoLabel('setdsk');">setdsk                  F045</span><br/><span class='t1' onclick="return gotoLabel('setext');">setext                  E8A6</span><span class='t1' onclick="return gotoLabel('setfile');">setfile                 EA6B</span><span class='t1' onclick="return gotoLabel('setfl1');">setfl1                  EA75</span><span class='t2' onclick="return gotoLabel('setfl2');">setfl2                  EA88</span><br/><span class='t1' onclick="return gotoLabel('setfl3');">setfl3                  EA8E</span><span class='t1' onclick="return gotoLabel('setfl4');">setfl4                  EA9D</span><span class='t1' onclick="return gotoLabel('sethlde');">sethlde                 E8AE</span><span class='t2' onclick="return gotoLabel('setiob');">setiob                  E6F3</span><br/><span class='t1' onclick="return gotoLabel('setnrec');">setnrec                 E8D2</span><span class='t1' onclick="return gotoLabel('setran');">setran                  F00E</span><span class='t1' onclick="return gotoLabel('sets2b7');">sets2b7                 E978</span><span class='t2' onclick="return gotoLabel('setsec');">setsec                  F221</span><br/><span class='t1' onclick="return gotoLabel('setstat');">setstat                 E701</span><span class='t1' onclick="return gotoLabel('settrk');">settrk                  F21E</span><span class='t1' onclick="return gotoLabel('setuser');">setuser                 F13B</span><span class='t2' onclick="return gotoLabel('shiftl');">shiftl                  E904</span><br/><span class='t1' onclick="return gotoLabel('shiftl1');">shiftl1                 E905</span><span class='t1' onclick="return gotoLabel('shiftr');">shiftr                  E8EA</span><span class='t1' onclick="return gotoLabel('shiftr1');">shiftr1                 E8EB</span><span class='t2' onclick="return gotoLabel('showit');">showit                  E57F</span><br/><span class='t1' onclick="return gotoLabel('slcterr');">slcterr                 E747</span><span class='t1' onclick="return gotoLabel('space');">space                   DCA2</span><span class='t1' onclick="return gotoLabel('srchfcb');">srchfcb                 DCE9</span><span class='t2' onclick="return gotoLabel('srchfst');">srchfst                 DCDF</span><br/><span class='t1' onclick="return gotoLabel('srchnxt');">srchnxt                 DCE4</span><span class='t1' onclick="return gotoLabel('starting');">starting                E70B</span><span class='t1' onclick="return gotoLabel('status');">status                  E745</span><span class='t2' onclick="return gotoLabel('stbitmap');">stbitmap                EA5C</span><br/><span class='t1' onclick="return gotoLabel('stbmap1');">stbmap1                 EA64</span><span class='t1' onclick="return gotoLabel('stddma');">stddma                  DDD5</span><span class='t1' onclick="return gotoLabel('stfilpos');">stfilpos                E9FE</span><span class='t2' onclick="return gotoLabel('stkarea');">stkarea                 E741</span><br/><span class='t1' onclick="return gotoLabel('stnrec1');">stnrec1                 E8DE</span><span class='t1' onclick="return gotoLabel('strdata');">strdata                 E8BB</span><span class='t1' onclick="return gotoLabel('ststatus');">ststatus                EB01</span><span class='t2' onclick="return gotoLabel('subhl');">subhl                   E995</span><br/><span class='t1' onclick="return gotoLabel('synerr');">synerr                  DE09</span><span class='t1' onclick="return gotoLabel('synerr1');">synerr1                 DE0F</span><span class='t1' onclick="return gotoLabel('synerr2');">synerr2                 DE22</span><span class='t2' onclick="return gotoLabel('tab');">tab                     0009</span><br/><span class='t1' onclick="return gotoLabel('tbase');">tbase                   0100</span><span class='t1' onclick="return gotoLabel('tbuff');">tbuff                   0080</span><span class='t1' onclick="return gotoLabel('tdrive');">tdrive                  0004</span><span class='t2' onclick="return gotoLabel('tfcb');">tfcb                    005C</span><br/><span class='t1' onclick="return gotoLabel('trksec');">trksec                  E7C3</span><span class='t1' onclick="return gotoLabel('trksec1');">trksec1                 E7D1</span><span class='t1' onclick="return gotoLabel('trksec2');">trksec2                 E7E4</span><span class='t2' onclick="return gotoLabel('trksec3');">trksec3                 E7FA</span><br/><span class='t1' onclick="return gotoLabel('trksec4');">trksec4                 E80F</span><span class='t1' onclick="return gotoLabel('type');">type                    E15D</span><span class='t1' onclick="return gotoLabel('type1');">type1                   E174</span><span class='t2' onclick="return gotoLabel('type2');">type2                   E177</span><br/><span class='t1' onclick="return gotoLabel('type3');">type3                   E187</span><span class='t1' onclick="return gotoLabel('type4');">type4                   E1A0</span><span class='t1' onclick="return gotoLabel('type5');">type5                   E1A7</span><span class='t2' onclick="return gotoLabel('unknown');">unknown                 E2A5</span><br/><span class='t1' onclick="return gotoLabel('unkwn0');">unkwn0                  E371</span><span class='t1' onclick="return gotoLabel('unkwn1');">unkwn1                  E2C4</span><span class='t1' onclick="return gotoLabel('unkwn2');">unkwn2                  E2CD</span><span class='t2' onclick="return gotoLabel('unkwn3');">unkwn3                  E2E1</span><br/><span class='t1' onclick="return gotoLabel('unkwn4');">unkwn4                  E301</span><span class='t1' onclick="return gotoLabel('unkwn5');">unkwn5                  E330</span><span class='t1' onclick="return gotoLabel('unkwn6');">unkwn6                  E33E</span><span class='t2' onclick="return gotoLabel('unkwn7');">unkwn7                  E343</span><br/><span class='t1' onclick="return gotoLabel('unkwn8');">unkwn8                  E34F</span><span class='t1' onclick="return gotoLabel('unkwn9');">unkwn9                  E36B</span><span class='t1' onclick="return gotoLabel('update');">update                  EC01</span><span class='t2' onclick="return gotoLabel('update1');">update1                 EC10</span><br/><span class='t1' onclick="return gotoLabel('upper');">upper                   DD30</span><span class='t1' onclick="return gotoLabel('user');">user                    E28E</span><span class='t1' onclick="return gotoLabel('userdma');">userdma                 F1B1</span><span class='t2' onclick="return gotoLabel('userno');">userno                  E741</span><br/><span class='t1' onclick="return gotoLabel('usrstack');">usrstack                E70F</span><span class='t1' onclick="return gotoLabel('verify');">verify                  DDF5</span><span class='t1' onclick="return gotoLabel('verify1');">verify1                 DDFD</span><span class='t2' onclick="return gotoLabel('wboot');">wboot                   F203</span><br/><span class='t1' onclick="return gotoLabel('write');">write                   F22A</span><span class='t1' onclick="return gotoLabel('writeran');">writeran                EF9C</span><span class='t1' onclick="return gotoLabel('wrtprt');">wrtprt                  F1AD</span><span class='t2' onclick="return gotoLabel('wrtprtd');">wrtprtd                 E92C</span><br/><span class='t1' onclick="return gotoLabel('wrtrec');">wrtrec                  DD04</span><span class='t1' onclick="return gotoLabel('wrtseq');">wrtseq                  F0E6</span><span class='t1' onclick="return gotoLabel('wtrandom');">wtrandom                F147</span><span class='t2' onclick="return gotoLabel('wtseq');">wtseq                   EDFE</span><br/><span class='t1' onclick="return gotoLabel('wtseq1');">wtseq1                  EE03</span><span class='t1' onclick="return gotoLabel('wtseq10');">wtseq10                 EED2</span><span class='t1' onclick="return gotoLabel('wtseq11');">wtseq11                 EEFE</span><span class='t2' onclick="return gotoLabel('wtseq12');">wtseq12                 EF00</span><br/><span class='t1' onclick="return gotoLabel('wtseq2');">wtseq2                  EE3B</span><span class='t1' onclick="return gotoLabel('wtseq3');">wtseq3                  EE48</span><span class='t1' onclick="return gotoLabel('wtseq4');">wtseq4                  EE64</span><span class='t2' onclick="return gotoLabel('wtseq5');">wtseq5                  EE6C</span><br/><span class='t1' onclick="return gotoLabel('wtseq6');">wtseq6                  EE6E</span><span class='t1' onclick="return gotoLabel('wtseq7');">wtseq7                  EE8C</span><span class='t1' onclick="return gotoLabel('wtseq8');">wtseq8                  EE9A</span><span class='t2' onclick="return gotoLabel('wtseq9');">wtseq9                  EEBB</span><br/><span class='t1' onclick="return gotoLabel('wtseq99');">wtseq99                 EEDF</span><span class='t1' onclick="return gotoLabel('wtspecl');">wtspecl                 F19B</span><span class='t1' onclick="return gotoLabel('xlate');">xlate                   F1D0</span><span class='t2' onclick="return gotoLabel('yesno');">yesno                   E152</span><br/></pre><div>&nbsp;</div><pre>Memory dump:</pre><div class="hordiv"></div><pre class="d0"> </pre><br/><pre class="d1">DC00:  C3 5C DF C3 58 DF 7F 00-43 6F 70 79 72 69 67 68  .\..X...Copyrigh</pre><br/><pre class="d0">DC10:  74 20 31 39 37 39 20 28-63 29 20 62 79 20 44 69  t.1979.(c).by.Di</pre><br/><pre class="d1">DC20:  67 69 74 61 6C 20 52 65-73 65 61 72 63 68 20 20  gital.Research..</pre><br/><pre class="d0">DC30:  20 20 20 20 00 00 00 00-00 00 00 00 00 00 00 00  ................</pre><br/><pre class="d1">DC40:  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................</pre><br/><pre class="d0">DC50:  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................</pre><br/><pre class="d1">DC60:  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................</pre><br/><pre class="d0">DC70:  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................</pre><br/><pre class="d1">DC80:  00 00 00 00 00 00 00 00-08 DC 00 00 5F 0E 02 C3  ............_...</pre><br/><pre class="d0">DC90:  05 00 C5 CD 8C DC C1 C9-3E 0D CD 92 DC 3E 0A C3  ........>....>..</pre><br/><pre class="d1">DCA0:  92 DC 3E 20 C3 92 DC C5-CD 98 DC E1 7E B7 C8 23  ..>.........~..#</pre><br/><pre class="d0">DCB0:  E5 CD 8C DC E1 C3 AC DC-0E 0D C3 05 00 5F 0E 0E  ............._..</pre><br/><pre class="d1">DCC0:  C3 05 00 CD 05 00 32 EE-E3 3C C9 0E 0F C3 C3 DC  ......2..<......</pre><br/><pre class="d0">DCD0:  AF 32 ED E3 11 CD E3 C3-CB DC 0E 10 C3 C3 DC 0E  .2..............</pre><br/><pre class="d1">DCE0:  11 C3 C3 DC 0E 12 C3 C3-DC 11 CD E3 C3 DF DC 0E  ................</pre><br/><pre class="d0">DCF0:  13 C3 05 00 CD 05 00 B7-C9 0E 14 C3 F4 DC 11 CD  ................</pre><br/><pre class="d1">DD00:  E3 C3 F9 DC 0E 15 C3 F4-DC 0E 16 C3 C3 DC 0E 17  ................</pre><br/><pre class="d0">DD10:  C3 05 00 1E FF 0E 20 C3-05 00 CD 13 DD 87 87 87  ................</pre><br/><pre class="d1">DD20:  87 21 EF E3 B6 32 04 00-C9 3A EF E3 32 04 00 C9  .!...2...:..2...</pre><br/><pre class="d0">DD30:  FE 61 D8 FE 7B D0 E6 5F-C9 3A AB E3 B7 CA 96 DD  .a..{.._.:......</pre><br/><pre class="d1">DD40:  3A EF E3 B7 3E 00 C4 BD-DC 11 AC E3 CD CB DC CA  :...>...........</pre><br/><pre class="d0">DD50:  96 DD 3A BB E3 3D 32 CC-E3 11 AC E3 CD F9 DC C2  ..:..=2.........</pre><br/><pre class="d1">DD60:  96 DD 11 07 DC 21 80 00-06 80 CD 42 E0 21 BA E3  .....!.....B.!..</pre><br/><pre class="d0">DD70:  36 00 23 35 11 AC E3 CD-DA DC CA 96 DD 3A EF E3  6.#5.........:..</pre><br/><pre class="d1">DD80:  B7 C4 BD DC 21 08 DC CD-AC DC CD C2 DD CA A7 DD  ....!...........</pre><br/><pre class="d0">DD90:  CD DD DD C3 82 DF CD DD-DD CD 1A DD 0E 0A 11 06  ................</pre><br/><pre class="d1">DDA0:  DC CD 05 00 CD 29 DD 21-07 DC 46 23 78 B7 CA BA  .....).!..F#x...</pre><br/><pre class="d0">DDB0:  DD 7E CD 30 DD 77 05 C3-AB DD 77 21 08 DC 22 88  .~.0.w....w!..".</pre><br/><pre class="d1">DDC0:  DC C9 0E 0B CD 05 00 B7-C8 0E 01 CD 05 00 B7 C9  ................</pre><br/><pre class="d0">DDD0:  0E 19 C3 05 00 11 80 00-0E 1A C3 05 00 21 AB E3  .............!..</pre><br/><pre class="d1">DDE0:  7E B7 C8 36 00 AF CD BD-DC 11 AC E3 CD EF DC 3A  ~..6...........:</pre><br/><pre class="d0">DDF0:  EF E3 C3 BD DC 11 28 DF-21 00 E4 06 06 1A BE C2  ......(.!.......</pre><br/><pre class="d1">DE00:  CF DF 13 23 05 C2 FD DD-C9 CD 98 DC 2A 8A DC 7E  ...#........*..~</pre><br/><pre class="d0">DE10:  FE 20 CA 22 DE B7 CA 22-DE E5 CD 8C DC E1 23 C3  ..."..."......#.</pre><br/><pre class="d1">DE20:  0F DE 3E 3F CD 8C DC CD-98 DC CD DD DD C3 82 DF  ..>?............</pre><br/><pre class="d0">DE30:  1A B7 C8 FE 20 DA 09 DE-C8 FE 3D C8 FE 5F C8 FE  ..........=.._..</pre><br/><pre class="d1">DE40:  2E C8 FE 3A C8 FE 3B C8-FE 3C C8 FE 3E C8 C9 1A  ...:..;..<..>...</pre><br/><pre class="d0">DE50:  B7 C8 FE 20 C0 13 C3 4F-DE 85 6F D0 24 C9 3E 00  .......O..o.$.>.</pre><br/><pre class="d1">DE60:  21 CD E3 CD 59 DE E5 E5-AF 32 F0 E3 2A 88 DC EB  !...Y....2..*...</pre><br/><pre class="d0">DE70:  CD 4F DE EB 22 8A DC EB-E1 1A B7 CA 89 DE DE 60  .O.."..........`</pre><br/><pre class="d1">DE80:  47 13 1A FE 3A CA 90 DE-1B 3A EF E3 77 C3 96 DE  G...:....:..w...</pre><br/><pre class="d0">DE90:  78 32 F0 E3 70 13 06 08-CD 30 DE CA B9 DE 23 FE  x2..p....0....#.</pre><br/><pre class="d1">DEA0:  2A C2 A9 DE 36 3F C3 AB-DE 77 13 05 C2 98 DE CD  *...6?...w......</pre><br/><pre class="d0">DEB0:  30 DE CA C0 DE 13 C3 AF-DE 23 36 20 05 C2 B9 DE  0........#6.....</pre><br/><pre class="d1">DEC0:  06 03 FE 2E C2 E9 DE 13-CD 30 DE CA E9 DE 23 FE  .........0....#.</pre><br/><pre class="d0">DED0:  2A C2 D9 DE 36 3F C3 DB-DE 77 13 05 C2 C8 DE CD  *...6?...w......</pre><br/><pre class="d1">DEE0:  30 DE CA F0 DE 13 C3 DF-DE 23 36 20 05 C2 E9 DE  0........#6.....</pre><br/><pre class="d0">DEF0:  06 03 23 36 00 05 C2 F2-DE EB 22 88 DC E1 01 0B  ..#6......".....</pre><br/><pre class="d1">DF00:  00 23 7E FE 3F C2 09 DF-04 0D C2 01 DF 78 B7 C9  .#~.?........x..</pre><br/><pre class="d0">DF10:  44 49 52 20 45 52 41 20-54 59 50 45 53 41 56 45  DIR.ERA.TYPESAVE</pre><br/><pre class="d1">DF20:  52 45 4E 20 55 53 45 52-00 16 00 00 00 00 21 10  REN.USER......!.</pre><br/><pre class="d0">DF30:  DF 0E 00 79 FE 06 D0 11-CE E3 06 04 1A BE C2 4F  ...y...........O</pre><br/><pre class="d1">DF40:  DF 13 23 05 C2 3C DF 1A-FE 20 C2 54 DF 79 C9 23  ..#..<.....T.y.#</pre><br/><pre class="d0">DF50:  05 C2 4F DF 0C C3 33 DF-AF 32 07 DC 31 AB E3 C5  ..O...3..2..1...</pre><br/><pre class="d1">DF60:  79 1F 1F 1F 1F E6 0F 5F-CD 15 DD CD B8 DC 32 AB  y......_......2.</pre><br/><pre class="d0">DF70:  E3 C1 79 E6 0F 32 EF E3-CD BD DC 3A 07 DC B7 C2  ..y..2.....:....</pre><br/><pre class="d1">DF80:  98 DF 31 AB E3 CD 98 DC-CD D0 DD C6 61 CD 8C DC  ..1.........a...</pre><br/><pre class="d0">DF90:  3E 3E CD 8C DC CD 39 DD-11 80 00 CD D8 DD CD D0  >>....9.........</pre><br/><pre class="d1">DFA0:  DD 32 EF E3 CD 5E DE C4-09 DE 3A F0 E3 B7 C2 A5  .2...^....:.....</pre><br/><pre class="d0">DFB0:  E2 CD 2E DF 21 C1 DF 5F-16 00 19 19 7E 23 66 6F  ....!.._....~#fo</pre><br/><pre class="d1">DFC0:  E9 77 E0 1F E1 5D E1 AD-E1 10 E2 8E E2 A5 E2 21  .w...].........!</pre><br/><pre class="d0">DFD0:  F3 76 22 00 DC 21 00 DC-E9 01 DF DF C3 A7 DC 52  .v"..!.........R</pre><br/><pre class="d1">DFE0:  65 61 64 20 65 72 72 6F-72 00 01 F0 DF C3 A7 DC  ead.error.......</pre><br/><pre class="d0">DFF0:  4E 6F 20 66 69 6C 65 00-CD 5E DE 3A F0 E3 B7 C2  No.file..^.:....</pre><br/><pre class="d1">E000:  09 DE 21 CE E3 01 0B 00-7E FE 20 CA 33 E0 23 D6  ..!.....~...3.#.</pre><br/><pre class="d0">E010:  30 FE 0A D2 09 DE 57 78-E6 E0 C2 09 DE 78 07 07  0.....Wx.....x..</pre><br/><pre class="d1">E020:  07 80 DA 09 DE 80 DA 09-DE 82 DA 09 DE 47 0D C2  .............G..</pre><br/><pre class="d0">E030:  08 E0 C9 7E FE 20 C2 09-DE 23 0D C2 33 E0 78 C9  ...~.....#..3.x.</pre><br/><pre class="d1">E040:  06 03 7E 12 23 13 05 C2-42 E0 C9 21 80 00 81 CD  ..~.#...B..!....</pre><br/><pre class="d0">E050:  59 DE 7E C9 AF 32 CD E3-3A F0 E3 B7 C8 3D 21 EF  Y.~..2..:....=!.</pre><br/><pre class="d1">E060:  E3 BE C8 C3 BD DC 3A F0-E3 B7 C8 3D 21 EF E3 BE  ......:....=!...</pre><br/><pre class="d0">E070:  C8 3A EF E3 C3 BD DC CD-5E DE CD 54 E0 21 CE E3  .:......^..T.!..</pre><br/><pre class="d1">E080:  7E FE 20 C2 8F E0 06 0B-36 3F 23 05 C2 88 E0 1E  ~.......6?#.....</pre><br/><pre class="d0">E090:  00 D5 CD E9 DC CC EA DF-CA 1B E1 3A EE E3 0F 0F  ...........:....</pre><br/><pre class="d1">E0A0:  0F E6 60 4F 3E 0A CD 4B-E0 17 DA 0F E1 D1 7B 1C  ..`O>..K......{.</pre><br/><pre class="d0">E0B0:  D5 E6 03 F5 C2 CC E0 CD-98 DC C5 CD D0 DD C1 C6  ................</pre><br/><pre class="d1">E0C0:  41 CD 92 DC 3E 3A CD 92-DC C3 D4 E0 CD A2 DC 3E  A...>:.........></pre><br/><pre class="d0">E0D0:  3A CD 92 DC CD A2 DC 06-01 78 CD 4B E0 E6 7F FE  :........x.K....</pre><br/><pre class="d1">E0E0:  20 C2 F9 E0 F1 F5 FE 03-C2 F7 E0 3E 09 CD 4B E0  ...........>..K.</pre><br/><pre class="d0">E0F0:  E6 7F FE 20 CA 0E E1 3E-20 CD 92 DC 04 78 FE 0C  .......>.....x..</pre><br/><pre class="d1">E100:  D2 0E E1 FE 09 C2 D9 E0-CD A2 DC C3 D9 E0 F1 CD  ................</pre><br/><pre class="d0">E110:  C2 DD C2 1B E1 CD E4 DC-C3 98 E0 D1 C3 86 E3 CD  ................</pre><br/><pre class="d1">E120:  5E DE FE 0B C2 42 E1 01-52 E1 CD A7 DC CD 39 DD  ^....B..R.....9.</pre><br/><pre class="d0">E130:  21 07 DC 35 C2 82 DF 23-7E FE 59 C2 82 DF 23 22  !..5...#~.Y...#"</pre><br/><pre class="d1">E140:  88 DC CD 54 E0 11 CD E3-CD EF DC 3C CC EA DF C3  ...T.......<....</pre><br/><pre class="d0">E150:  86 E3 41 6C 6C 20 28 79-2F 6E 29 3F 00 CD 5E DE  ..All.(y/n)?..^.</pre><br/><pre class="d1">E160:  C2 09 DE CD 54 E0 CD D0-DC CA A7 E1 CD 98 DC 21  ....T..........!</pre><br/><pre class="d0">E170:  F1 E3 36 FF 21 F1 E3 7E-FE 80 DA 87 E1 E5 CD FE  ..6.!..~........</pre><br/><pre class="d1">E180:  DC E1 C2 A0 E1 AF 77 34-21 80 00 CD 59 DE 7E FE  ......w4!...Y.~.</pre><br/><pre class="d0">E190:  1A CA 86 E3 CD 8C DC CD-C2 DD C2 86 E3 C3 74 E1  ..............t.</pre><br/><pre class="d1">E1A0:  3D CA 86 E3 CD D9 DF CD-66 E0 C3 09 DE CD F8 DF  =.......f.......</pre><br/><pre class="d0">E1B0:  F5 CD 5E DE C2 09 DE CD-54 E0 11 CD E3 D5 CD EF  ..^.....T.......</pre><br/><pre class="d1">E1C0:  DC D1 CD 09 DD CA FB E1-AF 32 ED E3 F1 6F 26 00  .........2...o&.</pre><br/><pre class="d0">E1D0:  29 11 00 01 7C B5 CA F1-E1 2B E5 21 80 00 19 E5  )...|....+.!....</pre><br/><pre class="d1">E1E0:  CD D8 DD 11 CD E3 CD 04-DD D1 E1 C2 FB E1 C3 D4  ................</pre><br/><pre class="d0">E1F0:  E1 11 CD E3 CD DA DC 3C-C2 01 E2 01 07 E2 CD A7  .......<........</pre><br/><pre class="d1">E200:  DC CD D5 DD C3 86 E3 4E-6F 20 73 70 61 63 65 00  .......No.space.</pre><br/><pre class="d0">E210:  CD 5E DE C2 09 DE 3A F0-E3 F5 CD 54 E0 CD E9 DC  .^....:....T....</pre><br/><pre class="d1">E220:  C2 79 E2 21 CD E3 11 DD-E3 06 10 CD 42 E0 2A 88  .y.!........B.*.</pre><br/><pre class="d0">E230:  DC EB CD 4F DE FE 3D CA-3F E2 FE 5F C2 73 E2 EB  ...O..=.?.._.s..</pre><br/><pre class="d1">E240:  23 22 88 DC CD 5E DE C2-73 E2 F1 47 21 F0 E3 7E  #"...^..s..G!..~</pre><br/><pre class="d0">E250:  B7 CA 59 E2 B8 70 C2 73-E2 70 AF 32 CD E3 CD E9  ..Y..p.s.p.2....</pre><br/><pre class="d1">E260:  DC CA 6D E2 11 CD E3 CD-0E DD C3 86 E3 CD EA DF  ..m.............</pre><br/><pre class="d0">E270:  C3 86 E3 CD 66 E0 C3 09-DE 01 82 E2 CD A7 DC C3  ....f...........</pre><br/><pre class="d1">E280:  86 E3 46 69 6C 65 20 65-78 69 73 74 73 00 CD F8  ..File.exists...</pre><br/><pre class="d0">E290:  DF FE 10 D2 09 DE 5F 3A-CE E3 FE 20 CA 09 DE CD  ......_:........</pre><br/><pre class="d1">E2A0:  15 DD C3 89 E3 CD F5 DD-3A CE E3 FE 20 C2 C4 E2  ........:.......</pre><br/><pre class="d0">E2B0:  3A F0 E3 B7 CA 89 E3 3D-32 EF E3 CD 29 DD CD BD  :......=2...)...</pre><br/><pre class="d1">E2C0:  DC C3 89 E3 11 D6 E3 1A-FE 20 C2 09 DE D5 CD 54  ...............T</pre><br/><pre class="d0">E2D0:  E0 D1 21 83 E3 CD 40 E0-CD D0 DC CA 6B E3 21 00  ..!...@.....k.!.</pre><br/><pre class="d1">E2E0:  01 E5 EB CD D8 DD 11 CD-E3 CD F9 DC C2 01 E3 E1  ................</pre><br/><pre class="d0">E2F0:  11 80 00 19 11 00 DC 7D-93 7C 9A D2 71 E3 C3 E1  .......}.|..q...</pre><br/><pre class="d1">E300:  E2 E1 3D C2 71 E3 CD 66-E0 CD 5E DE 21 F0 E3 E5  ..=.q..f..^.!...</pre><br/><pre class="d0">E310:  7E 32 CD E3 3E 10 CD 60-DE E1 7E 32 DD E3 AF 32  ~2..>..`..~2...2</pre><br/><pre class="d1">E320:  ED E3 11 5C 00 21 CD E3-06 21 CD 42 E0 21 08 DC  ...\.!...!.B.!..</pre><br/><pre class="d0">E330:  7E B7 CA 3E E3 FE 20 CA-3E E3 23 C3 30 E3 06 00  ~..>....>.#.0...</pre><br/><pre class="d1">E340:  11 81 00 7E 12 B7 CA 4F-E3 04 23 13 C3 43 E3 78  ...~...O..#..C.x</pre><br/><pre class="d0">E350:  32 80 00 CD 98 DC CD D5-DD CD 1A DD CD 00 01 31  2..............1</pre><br/><pre class="d1">E360:  AB E3 CD 29 DD CD BD DC-C3 82 DF CD 66 E0 C3 09  ...)........f...</pre><br/><pre class="d0">E370:  DE 01 7A E3 CD A7 DC C3-86 E3 42 61 64 20 6C 6F  ..z.......Bad.lo</pre><br/><pre class="d1">E380:  61 64 00 43 4F 4D CD 66-E0 CD 5E DE 3A CE E3 D6  ad.COM.f..^.:...</pre><br/><pre class="d0">E390:  20 21 F0 E3 B6 C2 09 DE-C3 82 DF 00 00 00 00 00  .!..............</pre><br/><pre class="d1">E3A0:  00 00 00 00 00 00 00 00-00 00 00 00 00 24 24 24  .............$$$</pre><br/><pre class="d0">E3B0:  20 20 20 20 20 53 55 42-00 00 00 00 00 00 00 00  .....SUB........</pre><br/><pre class="d1">E3C0:  00 00 00 00 00 00 00 00-00 00 00 00 00 00 20 20  ................</pre><br/><pre class="d0">E3D0:  20 20 20 20 20 20 20 20-20 00 00 00 00 00 20 20  ................</pre><br/><pre class="d1">E3E0:  20 20 20 20 20 20 20 20-20 00 00 00 00 00 00 00  ................</pre><br/><pre class="d0">E3F0:  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................</pre><br/><pre class="d1">E400:  00 16 00 00 00 00 C3 11-E4 99 E4 A5 E4 AB E4 B1  ................</pre><br/><pre class="d0">E410:  E4 EB 22 43 E7 EB 7B 32-D6 F1 21 00 00 22 45 E7  .."C..{2..!.."E.</pre><br/><pre class="d1">E420:  39 22 0F E7 31 41 E7 AF-32 E0 F1 32 DE F1 21 74  9"..1A..2..2..!t</pre><br/><pre class="d0">E430:  F1 E5 79 FE 29 D0 4B 21-47 E4 5F 16 00 19 19 5E  ..y.).K!G._....^</pre><br/><pre class="d1">E440:  23 56 2A 43 E7 EB E9 03-F2 C8 E6 90 E5 CE E6 12  #V*C............</pre><br/><pre class="d0">E450:  F2 0F F2 D4 E6 ED E6 F3-E6 F8 E6 E1 E5 FE E6 7E  ...............~</pre><br/><pre class="d1">E460:  F0 83 F0 45 F0 9C F0 A5-F0 AB F0 C8 F0 D7 F0 E0  ...E............</pre><br/><pre class="d0">E470:  F0 E6 F0 EC F0 F5 F0 FE-F0 04 F1 0A F1 11 F1 2C  ...............,</pre><br/><pre class="d1">E480:  E9 17 F1 1D F1 26 F1 2D-F1 41 F1 47 F1 4D F1 0E  .....&.-.A.G.M..</pre><br/><pre class="d0">E490:  F0 53 F1 04 E7 04 E7 9B-F1 21 CA E4 CD E5 E4 FE  .S.......!......</pre><br/><pre class="d1">E4A0:  03 CA 00 00 C9 21 D5 E4-C3 B4 E4 21 E1 E4 C3 B4  .....!.....!....</pre><br/><pre class="d0">E4B0:  E4 21 DC E4 CD E5 E4 C3-00 00 42 64 6F 73 20 45  .!........Bdos.E</pre><br/><pre class="d1">E4C0:  72 72 20 4F 6E 20 20 3A-20 24 42 61 64 20 53 65  rr.On..:.$Bad.Se</pre><br/><pre class="d0">E4D0:  63 74 6F 72 24 53 65 6C-65 63 74 24 46 69 6C 65  ctor$Select$File</pre><br/><pre class="d1">E4E0:  20 52 2F 4F 24 E5 CD C9-E5 3A 42 E7 C6 41 32 C6  .R/O$....:B..A2.</pre><br/><pre class="d0">E4F0:  E4 01 BA E4 CD D3 E5 C1-CD D3 E5 21 0E E7 7E 36  ...........!..~6</pre><br/><pre class="d1">E500:  00 B7 C0 C3 09 F2 CD FB-E4 CD 14 E5 D8 F5 4F CD  ..............O.</pre><br/><pre class="d0">E510:  90 E5 F1 C9 FE 0D C8 FE-0A C8 FE 09 C8 FE 08 C8  ................</pre><br/><pre class="d1">E520:  FE 20 C9 3A 0E E7 B7 C2-45 E5 CD 06 F2 E6 01 C8  ...:....E.......</pre><br/><pre class="d0">E530:  CD 09 F2 FE 13 C2 42 E5-CD 09 F2 FE 03 CA 00 00  ......B.........</pre><br/><pre class="d1">E540:  AF C9 32 0E E7 3E 01 C9-3A 0A E7 B7 C2 62 E5 C5  ..2..>..:....b..</pre><br/><pre class="d0">E550:  CD 23 E5 C1 C5 CD 0C F2-C1 C5 3A 0D E7 B7 C4 0F  .#........:.....</pre><br/><pre class="d1">E560:  F2 C1 79 21 0C E7 FE 7F-C8 34 FE 20 D0 35 7E B7  ..y!.....4...5~.</pre><br/><pre class="d0">E570:  C8 79 FE 08 C2 79 E5 35-C9 FE 0A C0 36 00 C9 79  .y...y.5....6..y</pre><br/><pre class="d1">E580:  CD 14 E5 D2 90 E5 F5 0E-5E CD 48 E5 F1 F6 40 4F  ........^.H...@O</pre><br/><pre class="d0">E590:  79 FE 09 C2 48 E5 0E 20-CD 48 E5 3A 0C E7 E6 07  y...H....H.:....</pre><br/><pre class="d1">E5A0:  C2 96 E5 C9 CD AC E5 0E-20 CD 0C F2 0E 08 C3 0C  ................</pre><br/><pre class="d0">E5B0:  F2 0E 23 CD 48 E5 CD C9-E5 3A 0C E7 21 0B E7 BE  ..#.H....:..!...</pre><br/><pre class="d1">E5C0:  D0 0E 20 CD 48 E5 C3 B9-E5 0E 0D CD 48 E5 0E 0A  ....H.......H...</pre><br/><pre class="d0">E5D0:  C3 48 E5 0A FE 24 C8 03-C5 4F CD 90 E5 C1 C3 D3  .H...$...O......</pre><br/><pre class="d1">E5E0:  E5 3A 0C E7 32 0B E7 2A-43 E7 4E 23 E5 06 00 C5  .:..2..*C.N#....</pre><br/><pre class="d0">E5F0:  E5 CD FB E4 E6 7F E1 C1-FE 0D CA C1 E6 FE 0A CA  ................</pre><br/><pre class="d1">E600:  C1 E6 FE 08 C2 16 E6 78-B7 CA EF E5 05 3A 0C E7  .......x.....:..</pre><br/><pre class="d0">E610:  32 0A E7 C3 70 E6 FE 7F-C2 26 E6 78 B7 CA EF E5  2...p....&.x....</pre><br/><pre class="d1">E620:  7E 05 2B C3 A9 E6 FE 05-C2 37 E6 C5 E5 CD C9 E5  ~.+......7......</pre><br/><pre class="d0">E630:  AF 32 0B E7 C3 F1 E5 FE-10 C2 48 E6 E5 21 0D E7  .2........H..!..</pre><br/><pre class="d1">E640:  3E 01 96 77 E1 C3 EF E5-FE 18 C2 5F E6 E1 3A 0B  >..w......._..:.</pre><br/><pre class="d0">E650:  E7 21 0C E7 BE D2 E1 E5-35 CD A4 E5 C3 4E E6 FE  .!......5....N..</pre><br/><pre class="d1">E660:  15 C2 6B E6 CD B1 E5 E1-C3 E1 E5 FE 12 C2 A6 E6  ..k.............</pre><br/><pre class="d0">E670:  C5 CD B1 E5 C1 E1 E5 C5-78 B7 CA 8A E6 23 4E 05  ........x....#N.</pre><br/><pre class="d1">E680:  C5 E5 CD 7F E5 E1 C1 C3-78 E6 E5 3A 0A E7 B7 CA  ........x..:....</pre><br/><pre class="d0">E690:  F1 E5 21 0C E7 96 32 0A-E7 CD A4 E5 21 0A E7 35  ..!...2.....!..5</pre><br/><pre class="d1">E6A0:  C2 99 E6 C3 F1 E5 23 77-04 C5 E5 4F CD 7F E5 E1  ......#w...O....</pre><br/><pre class="d0">E6B0:  C1 7E FE 03 78 C2 BD E6-FE 01 CA 00 00 B9 DA EF  .~..x...........</pre><br/><pre class="d1">E6C0:  E5 E1 70 0E 0D C3 48 E5-CD 06 E5 C3 01 E7 CD 15  ..p...H.........</pre><br/><pre class="d0">E6D0:  F2 C3 01 E7 79 3C CA E0-E6 3C CA 06 F2 C3 0C F2  ....y<...<......</pre><br/><pre class="d1">E6E0:  CD 06 F2 B7 CA 91 F1 CD-09 F2 C3 01 E7 3A 03 00  .............:..</pre><br/><pre class="d0">E6F0:  C3 01 E7 21 03 00 71 C9-EB 4D 44 C3 D3 E5 CD 23  ...!..q..MD....#</pre><br/><pre class="d1">E700:  E5 32 45 E7 C9 3E 01 C3-01 E7 00 02 00 00 00 00  .2E..>..........</pre><br/><pre class="d0">E710:  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................</pre><br/><pre class="d1">E720:  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................</pre><br/><pre class="d0">E730:  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................</pre><br/><pre class="d1">E740:  00 00 00 00 00 00 00 21-0B E4 5E 23 56 EB E9 0C  .......!..^#V...</pre><br/><pre class="d0">E750:  0D C8 1A 77 13 23 C3 50-E7 3A 42 E7 4F CD 1B F2  ...w.#.P.:B.O...</pre><br/><pre class="d1">E760:  7C B5 C8 5E 23 56 23 22-B3 F1 23 23 22 B5 F1 23  |..^#V#"..##"..#</pre><br/><pre class="d0">E770:  23 22 B7 F1 23 23 EB 22-D0 F1 21 B9 F1 0E 08 CD  #"..##."..!.....</pre><br/><pre class="d1">E780:  4F E7 2A BB F1 EB 21 C1-F1 0E 0F CD 4F E7 2A C6  O.*...!.....O.*.</pre><br/><pre class="d0">E790:  F1 7C 21 DD F1 36 FF B7-CA 9D E7 36 00 3E FF B7  .|!..6.....6.>..</pre><br/><pre class="d1">E7A0:  C9 CD 18 F2 AF 2A B5 F1-77 23 77 2A B7 F1 77 23  .....*..w#w*..w#</pre><br/><pre class="d0">E7B0:  77 C9 CD 27 F2 C3 BB E7-CD 2A F2 B7 C8 21 09 E4  w..'.....*...!..</pre><br/><pre class="d1">E7C0:  C3 4A E7 2A EA F1 0E 02-CD EA E8 22 E5 F1 22 EC  .J.*......."..".</pre><br/><pre class="d0">E7D0:  F1 21 E5 F1 4E 23 46 2A-B7 F1 5E 23 56 2A B5 F1  .!..N#F*..^#V*..</pre><br/><pre class="d1">E7E0:  7E 23 66 6F 79 93 78 9A-D2 FA E7 E5 2A C1 F1 7B  ~#foy.x.....*..{</pre><br/><pre class="d0">E7F0:  95 5F 7A 9C 57 E1 2B C3-E4 E7 E5 2A C1 F1 19 DA  ._z.W.+....*....</pre><br/><pre class="d1">E800:  0F E8 79 95 78 9C DA 0F-E8 EB E1 23 C3 FA E7 E1  ..y.x......#....</pre><br/><pre class="d0">E810:  C5 D5 E5 EB 2A CE F1 19-44 4D CD 1E F2 D1 2A B5  ....*...DM....*.</pre><br/><pre class="d1">E820:  F1 73 23 72 D1 2A B7 F1-73 23 72 C1 79 93 4F 78  .s#r.*..s#r.y.Ox</pre><br/><pre class="d0">E830:  9A 47 2A D0 F1 EB CD 30-F2 4D 44 C3 21 F2 21 C3  .G*....0.MD.!.!.</pre><br/><pre class="d1">E840:  F1 4E 3A E3 F1 B7 1F 0D-C2 45 E8 47 3E 08 96 4F  .N:......E.G>..O</pre><br/><pre class="d0">E850:  3A E2 F1 0D CA 5C E8 B7-17 C3 53 E8 80 C9 2A 43  :....\....S...*C</pre><br/><pre class="d1">E860:  E7 11 10 00 19 09 3A DD-F1 B7 CA 71 E8 6E 26 00  ......:....q.n&.</pre><br/><pre class="d0">E870:  C9 09 5E 23 56 EB C9 CD-3E E8 4F 06 00 CD 5E E8  ..^#V...>.O...^.</pre><br/><pre class="d1">E880:  22 E5 F1 C9 2A E5 F1 7D-B4 C9 3A C3 F1 2A E5 F1  "...*..}..:..*..</pre><br/><pre class="d0">E890:  29 3D C2 90 E8 22 E7 F1-3A C4 F1 4F 3A E3 F1 A1  )=..."..:..O:...</pre><br/><pre class="d1">E8A0:  B5 6F 22 E5 F1 C9 2A 43-E7 11 0C 00 19 C9 2A 43  .o"...*C......*C</pre><br/><pre class="d0">E8B0:  E7 11 0F 00 19 EB 21 11-00 19 C9 CD AE E8 7E 32  ......!.......~2</pre><br/><pre class="d1">E8C0:  E3 F1 EB 7E 32 E1 F1 CD-A6 E8 3A C5 F1 A6 32 E2  ...~2.....:...2.</pre><br/><pre class="d0">E8D0:  F1 C9 CD AE E8 3A D5 F1-FE 02 C2 DE E8 AF 4F 3A  .....:........O:</pre><br/><pre class="d1">E8E0:  E3 F1 81 77 EB 3A E1 F1-77 C9 0C 0D C8 7C B7 1F  ...w.:..w....|..</pre><br/><pre class="d0">E8F0:  67 7D 1F 6F C3 EB E8 0E-80 2A B9 F1 AF 86 23 0D  g}.o.....*....#.</pre><br/><pre class="d1">E900:  C2 FD E8 C9 0C 0D C8 29-C3 05 E9 C5 3A 42 E7 4F  .......)....:B.O</pre><br/><pre class="d0">E910:  21 01 00 CD 04 E9 C1 79-B5 6F 78 B4 67 C9 2A AD  !......y.ox.g.*.</pre><br/><pre class="d1">E920:  F1 3A 42 E7 4F CD EA E8-7D E6 01 C9 21 AD F1 4E  .:B.O...}...!..N</pre><br/><pre class="d0">E930:  23 46 CD 0B E9 22 AD F1-2A C8 F1 23 EB 2A B3 F1  #F..."..*..#.*..</pre><br/><pre class="d1">E940:  73 23 72 C9 CD 5E E9 11-09 00 19 7E 17 D0 21 0F  s#r..^.....~..!.</pre><br/><pre class="d0">E950:  E4 C3 4A E7 CD 1E E9 C8-21 0D E4 C3 4A E7 2A B9  ..J.....!...J.*.</pre><br/><pre class="d1">E960:  F1 3A E9 F1 85 6F D0 24-C9 2A 43 E7 11 0E 00 19  .:...o.$.*C.....</pre><br/><pre class="d0">E970:  7E C9 CD 69 E9 36 00 C9-CD 69 E9 F6 80 77 C9 2A  ~..i.6...i...w.*</pre><br/><pre class="d1">E980:  EA F1 EB 2A B3 F1 7B 96-23 7A 9E C9 CD 7F E9 D8  ...*..{.#z......</pre><br/><pre class="d0">E990:  13 72 2B 73 C9 7B 95 6F-7A 9C 67 C9 0E FF 2A EC  .r+s.{.oz.g...*.</pre><br/><pre class="d1">E9A0:  F1 EB 2A CC F1 CD 95 E9-D0 C5 CD F7 E8 2A BD F1  ..*..........*..</pre><br/><pre class="d0">E9B0:  EB 2A EC F1 19 C1 0C CA-C4 E9 BE C8 CD 7F E9 D0  .*..............</pre><br/><pre class="d1">E9C0:  CD 2C E9 C9 77 C9 CD 9C-E9 CD E0 E9 0E 01 CD B8  .,..w...........</pre><br/><pre class="d0">E9D0:  E7 C3 DA E9 CD E0 E9 CD-B2 E7 21 B1 F1 C3 E3 E9  ..........!.....</pre><br/><pre class="d1">E9E0:  21 B9 F1 4E 23 46 C3 24-F2 2A B9 F1 EB 2A B1 F1  !..N#F.$.*...*..</pre><br/><pre class="d0">E9F0:  0E 80 C3 4F E7 21 EA F1-7E 23 BE C0 3C C9 21 FF  ...O.!..~#..<.!.</pre><br/><pre class="d1">EA00:  FF 22 EA F1 C9 2A C8 F1-EB 2A EA F1 23 22 EA F1  ."...*...*..#"..</pre><br/><pre class="d0">EA10:  CD 95 E9 D2 19 EA C3 FE-E9 3A EA F1 E6 03 06 05  .........:......</pre><br/><pre class="d1">EA20:  87 05 C2 20 EA 32 E9 F1-B7 C0 C5 CD C3 E7 CD D4  .....2..........</pre><br/><pre class="d0">EA30:  E9 C1 C3 9E E9 79 E6 07-3C 5F 57 79 0F 0F 0F E6  .....y..<_Wy....</pre><br/><pre class="d1">EA40:  1F 4F 78 87 87 87 87 87-B1 4F 78 0F 0F 0F E6 1F  .Ox......Ox.....</pre><br/><pre class="d0">EA50:  47 2A BF F1 09 7E 07 1D-C2 56 EA C9 D5 CD 35 EA  G*...~...V....5.</pre><br/><pre class="d1">EA60:  E6 FE C1 B1 0F 15 C2 64-EA 77 C9 CD 5E E9 11 10  .......d.w..^...</pre><br/><pre class="d0">EA70:  00 19 C5 0E 11 D1 0D C8-D5 3A DD F1 B7 CA 88 EA  .........:......</pre><br/><pre class="d1">EA80:  C5 E5 4E 06 00 C3 8E EA-0D C5 4E 23 46 E5 79 B0  ..N.......N#F.y.</pre><br/><pre class="d0">EA90:  CA 9D EA 2A C6 F1 7D 91-7C 98 D4 5C EA E1 23 C1  ...*..}.|..\..#.</pre><br/><pre class="d1">EAA0:  C3 75 EA 2A C6 F1 0E 03-CD EA E8 23 44 4D 2A BF  .u.*.......#DM*.</pre><br/><pre class="d0">EAB0:  F1 36 00 23 0B 78 B1 C2-B1 EA 2A CA F1 EB 2A BF  .6.#.x....*...*.</pre><br/><pre class="d1">EAC0:  F1 73 23 72 CD A1 E7 2A-B3 F1 36 03 23 36 00 CD  .s#r...*..6.#6..</pre><br/><pre class="d0">EAD0:  FE E9 0E FF CD 05 EA CD-F5 E9 C8 CD 5E E9 3E E5  ............^.>.</pre><br/><pre class="d1">EAE0:  BE CA D2 EA 3A 41 E7 BE-C2 F6 EA 23 7E D6 24 C2  ....:A.....#~.$.</pre><br/><pre class="d0">EAF0:  F6 EA 3D 32 45 E7 0E 01-CD 6B EA CD 8C E9 C3 D2  ..=2E....k......</pre><br/><pre class="d1">EB00:  EA 3A D4 F1 C3 01 E7 C5-F5 3A C5 F1 2F 47 79 A0  .:.......:../Gy.</pre><br/><pre class="d0">EB10:  4F F1 A0 91 E6 1F C1 C9-3E FF 32 D4 F1 21 D8 F1  O.......>.2..!..</pre><br/><pre class="d1">EB20:  71 2A 43 E7 22 D9 F1 CD-FE E9 CD A1 E7 0E 00 CD  q*C."...........</pre><br/><pre class="d0">EB30:  05 EA CD F5 E9 CA 94 EB-2A D9 F1 EB 1A FE E5 CA  ........*.......</pre><br/><pre class="d1">EB40:  4A EB D5 CD 7F E9 D1 D2-94 EB CD 5E E9 3A D8 F1  J..........^.:..</pre><br/><pre class="d0">EB50:  4F 06 00 79 B7 CA 83 EB-1A FE 3F CA 7C EB 78 FE  O..y......?.|.x.</pre><br/><pre class="d1">EB60:  0D CA 7C EB FE 0C 1A CA-73 EB 96 E6 7F C2 2D EB  ..|.....s.....-.</pre><br/><pre class="d0">EB70:  C3 7C EB C5 4E CD 07 EB-C1 C2 2D EB 13 23 04 0D  .|..N.....-..#..</pre><br/><pre class="d1">EB80:  C3 53 EB 3A EA F1 E6 03-32 45 E7 21 D4 F1 7E 17  .S.:....2E.!..~.</pre><br/><pre class="d0">EB90:  D0 AF 77 C9 CD FE E9 3E-FF C3 01 E7 CD 54 E9 0E  ..w....>.....T..</pre><br/><pre class="d1">EBA0:  0C CD 18 EB CD F5 E9 C8-CD 44 E9 CD 5E E9 36 E5  .........D..^.6.</pre><br/><pre class="d0">EBB0:  0E 00 CD 6B EA CD C6 E9-CD 2D EB C3 A4 EB 50 59  ...k.....-....PY</pre><br/><pre class="d1">EBC0:  79 B0 CA D1 EB 0B D5 C5-CD 35 EA 1F D2 EC EB C1  y........5......</pre><br/><pre class="d0">EBD0:  D1 2A C6 F1 7B 95 7A 9C-D2 F4 EB 13 C5 D5 42 4B  .*..{.z.......BK</pre><br/><pre class="d1">EBE0:  CD 35 EA 1F D2 EC EB D1-C1 C3 C0 EB 17 3C CD 64  .5...........<.d</pre><br/><pre class="d0">EBF0:  EA E1 D1 C9 79 B0 C2 C0-EB 21 00 00 C9 0E 00 1E  ....y....!......</pre><br/><pre class="d1">EC00:  20 D5 06 00 2A 43 E7 09-EB CD 5E E9 C1 CD 4F E7  ....*C....^...O.</pre><br/><pre class="d0">EC10:  CD C3 E7 C3 C6 E9 CD 54-E9 0E 0C CD 18 EB 2A 43  .......T......*C</pre><br/><pre class="d1">EC20:  E7 7E 11 10 00 19 77 CD-F5 E9 C8 CD 44 E9 0E 10  .~....w.....D...</pre><br/><pre class="d0">EC30:  1E 0C CD 01 EC CD 2D EB-C3 27 EC 0E 0C CD 18 EB  ......-..'......</pre><br/><pre class="d1">EC40:  CD F5 E9 C8 0E 00 1E 0C-CD 01 EC CD 2D EB C3 40  ............-..@</pre><br/><pre class="d0">EC50:  EC 0E 0F CD 18 EB CD F5-E9 C8 CD A6 E8 7E F5 E5  .............~..</pre><br/><pre class="d1">EC60:  CD 5E E9 EB 2A 43 E7 0E-20 D5 CD 4F E7 CD 78 E9  .^..*C.....O..x.</pre><br/><pre class="d0">EC70:  D1 21 0C 00 19 4E 21 0F-00 19 46 E1 F1 77 79 BE  .!...N!...F..wy.</pre><br/><pre class="d1">EC80:  78 CA 8B EC 3E 00 DA 8B-EC 3E 80 2A 43 E7 11 0F  x...>....>.*C...</pre><br/><pre class="d0">EC90:  00 19 77 C9 7E 23 B6 2B-C0 1A 77 13 23 1A 77 1B  ..w.~#.+..w.#.w.</pre><br/><pre class="d1">ECA0:  2B C9 AF 32 45 E7 32 EA-F1 32 EB F1 CD 1E E9 C0  +..2E.2..2......</pre><br/><pre class="d0">ECB0:  CD 69 E9 E6 80 C0 0E 0F-CD 18 EB CD F5 E9 C8 01  .i..............</pre><br/><pre class="d1">ECC0:  10 00 CD 5E E9 09 EB 2A-43 E7 09 0E 10 3A DD F1  ...^...*C....:..</pre><br/><pre class="d0">ECD0:  B7 CA E8 EC 7E B7 1A C2-DB EC 77 B7 C2 E1 EC 7E  ....~.....w....~</pre><br/><pre class="d1">ECE0:  12 BE C2 1F ED C3 FD EC-CD 94 EC EB CD 94 EC EB  ................</pre><br/><pre class="d0">ECF0:  1A BE C2 1F ED 13 23 1A-BE C2 1F ED 0D 13 23 0D  ......#.......#.</pre><br/><pre class="d1">ED00:  C2 CD EC 01 EC FF 09 EB-09 1A BE DA 17 ED 77 01  ..............w.</pre><br/><pre class="d0">ED10:  03 00 09 EB 09 7E 12 3E-FF 32 D2 F1 C3 10 EC 21  .....~.>.2.....!</pre><br/><pre class="d1">ED20:  45 E7 35 C9 CD 54 E9 2A-43 E7 E5 21 AC F1 22 43  E.5..T.*C..!.."C</pre><br/><pre class="d0">ED30:  E7 0E 01 CD 18 EB CD F5-E9 E1 22 43 E7 C8 EB 21  .........."C...!</pre><br/><pre class="d1">ED40:  0F 00 19 0E 11 AF 77 23-0D C2 46 ED 21 0D 00 19  ......w#..F.!...</pre><br/><pre class="d0">ED50:  77 CD 8C E9 CD FD EB C3-78 E9 AF 32 D2 F1 CD A2  w.......x..2....</pre><br/><pre class="d1">ED60:  EC CD F5 E9 C8 2A 43 E7-01 0C 00 09 7E 3C E6 1F  .....*C.....~<..</pre><br/><pre class="d0">ED70:  77 CA 83 ED 47 3A C5 F1-A0 21 D2 F1 A6 CA 8E ED  w...G:...!......</pre><br/><pre class="d1">ED80:  C3 AC ED 01 02 00 09 34-7E E6 0F CA B6 ED 0E 0F  .......4~.......</pre><br/><pre class="d0">ED90:  CD 18 EB CD F5 E9 C2 AC-ED 3A D3 F1 3C CA B6 ED  .........:..<...</pre><br/><pre class="d1">EDA0:  CD 24 ED CD F5 E9 CA B6-ED C3 AF ED CD 5A EC CD  .$...........Z..</pre><br/><pre class="d0">EDB0:  BB E8 AF C3 01 E7 CD 05-E7 C3 78 E9 3E 01 32 D5  ..........x.>.2.</pre><br/><pre class="d1">EDC0:  F1 3E FF 32 D3 F1 CD BB-E8 3A E3 F1 21 E1 F1 BE  .>.2.....:..!...</pre><br/><pre class="d0">EDD0:  DA E6 ED FE 80 C2 FB ED-CD 5A ED AF 32 E3 F1 3A  .........Z..2..:</pre><br/><pre class="d1">EDE0:  45 E7 B7 C2 FB ED CD 77-E8 CD 84 E8 CA FB ED CD  E......w........</pre><br/><pre class="d0">EDF0:  8A E8 CD D1 E7 CD B2 E7-C3 D2 E8 C3 05 E7 3E 01  ..............>.</pre><br/><pre class="d1">EE00:  32 D5 F1 3E 00 32 D3 F1-CD 54 E9 2A 43 E7 CD 47  2..>.2...T.*C..G</pre><br/><pre class="d0">EE10:  E9 CD BB E8 3A E3 F1 FE-80 D2 05 E7 CD 77 E8 CD  ....:........w..</pre><br/><pre class="d1">EE20:  84 E8 0E 00 C2 6E EE CD-3E E8 32 D7 F1 01 00 00  .....n..>.2.....</pre><br/><pre class="d0">EE30:  B7 CA 3B EE 4F 0B CD 5E-E8 44 4D CD BE EB 7D B4  ..;.O..^.DM...}.</pre><br/><pre class="d1">EE40:  C2 48 EE 3E 02 C3 01 E7-22 E5 F1 EB 2A 43 E7 01  .H.>...."...*C..</pre><br/><pre class="d0">EE50:  10 00 09 3A DD F1 B7 3A-D7 F1 CA 64 EE CD 64 E9  ...:...:...d..d.</pre><br/><pre class="d1">EE60:  73 C3 6C EE 4F 06 00 09-09 73 23 72 0E 02 3A 45  s.l.O....s#r..:E</pre><br/><pre class="d0">EE70:  E7 B7 C0 C5 CD 8A E8 3A-D5 F1 3D 3D C2 BB EE C1  .......:..==....</pre><br/><pre class="d1">EE80:  C5 79 3D 3D C2 BB EE E5-2A B9 F1 57 77 23 14 F2  .y==....*..Ww#..</pre><br/><pre class="d0">EE90:  8C EE CD E0 E9 2A E7 F1-0E 02 22 E5 F1 C5 CD D1  .....*....".....</pre><br/><pre class="d1">EEA0:  E7 C1 CD B8 E7 2A E5 F1-0E 00 3A C4 F1 47 A5 B8  .....*....:..G..</pre><br/><pre class="d0">EEB0:  23 C2 9A EE E1 22 E5 F1-CD DA E9 CD D1 E7 C1 C5  #...."..........</pre><br/><pre class="d1">EEC0:  CD B8 E7 C1 3A E3 F1 21-E1 F1 BE DA D2 EE 77 34  ....:..!......w4</pre><br/><pre class="d0">EED0:  0E 02 00 00 21 00 00 F5-CD 69 E9 E6 7F 77 F1 FE  ....!....i...w..</pre><br/><pre class="d1">EEE0:  7F C2 00 EF 3A D5 F1 FE-01 C2 00 EF CD D2 E8 CD  ....:...........</pre><br/><pre class="d0">EEF0:  5A ED 21 45 E7 7E B7 C2-FE EE 3D 32 E3 F1 36 00  Z.!E.~....=2..6.</pre><br/><pre class="d1">EF00:  C3 D2 E8 AF 32 D5 F1 C5-2A 43 E7 EB 21 21 00 19  ....2...*C..!!..</pre><br/><pre class="d0">EF10:  7E E6 7F F5 7E 17 23 7E-17 E6 1F 4F 7E 1F 1F 1F  ~...~.#~...O~...</pre><br/><pre class="d1">EF20:  1F E6 0F 47 F1 23 6E 2C-2D 2E 06 C2 8B EF 21 20  ...G.#n,-.....!.</pre><br/><pre class="d0">EF30:  00 19 77 21 0C 00 19 79-96 C2 47 EF 21 0E 00 19  ..w!...y..G.!...</pre><br/><pre class="d1">EF40:  78 96 E6 7F CA 7F EF C5-D5 CD A2 EC D1 C1 2E 03  x...............</pre><br/><pre class="d0">EF50:  3A 45 E7 3C CA 84 EF 21-0C 00 19 71 21 0E 00 19  :E.<...!...q!...</pre><br/><pre class="d1">EF60:  70 CD 51 EC 3A 45 E7 3C-C2 7F EF C1 C5 2E 04 0C  p.Q.:E.<........</pre><br/><pre class="d0">EF70:  CA 84 EF CD 24 ED 2E 05-3A 45 E7 3C CA 84 EF C1  ....$...:E.<....</pre><br/><pre class="d1">EF80:  AF C3 01 E7 E5 CD 69 E9-36 C0 E1 C1 7D 32 45 E7  ......i.6...}2E.</pre><br/><pre class="d0">EF90:  C3 78 E9 0E FF CD 03 EF-CC C1 ED C9 0E 00 CD 03  .x..............</pre><br/><pre class="d1">EFA0:  EF CC 03 EE C9 EB 19 4E-06 00 21 0C 00 19 7E 0F  .......N..!...~.</pre><br/><pre class="d0">EFB0:  E6 80 81 4F 3E 00 88 47-7E 0F E6 0F 80 47 21 0E  ...O>..G~....G!.</pre><br/><pre class="d1">EFC0:  00 19 7E 87 87 87 87 F5-80 47 F5 E1 7D E1 B5 E6  ..~......G..}...</pre><br/><pre class="d0">EFD0:  01 C9 0E 0C CD 18 EB 2A-43 E7 11 21 00 19 E5 72  .......*C..!...r</pre><br/><pre class="d1">EFE0:  23 72 23 72 CD F5 E9 CA-0C F0 CD 5E E9 11 0F 00  #r#r.......^....</pre><br/><pre class="d0">EFF0:  CD A5 EF E1 E5 5F 79 96-23 78 9E 23 7B 9E DA 06  ....._y.#x.#{...</pre><br/><pre class="d1">F000:  F0 73 2B 70 2B 71 CD 2D-EB C3 E4 EF E1 C9 2A 43  .s+p+q.-......*C</pre><br/><pre class="d0">F010:  E7 11 20 00 CD A5 EF 21-21 00 19 71 23 70 23 77  .......!!..q#p#w</pre><br/><pre class="d1">F020:  C9 2A AF F1 3A 42 E7 4F-CD EA E8 E5 EB CD 59 E7  .*..:B.O......Y.</pre><br/><pre class="d0">F030:  E1 CC 47 E7 7D 1F D8 2A-AF F1 4D 44 CD 0B E9 22  ..G.}..*..MD..."</pre><br/><pre class="d1">F040:  AF F1 C3 A3 EA 3A D6 F1-21 42 E7 BE C8 77 C3 21  .....:..!B...w.!</pre><br/><pre class="d0">F050:  F0 3E FF 32 DE F1 2A 43-E7 7E E6 1F 3D 32 D6 F1  .>.2..*C.~..=2..</pre><br/><pre class="d1">F060:  FE 1E D2 75 F0 3A 42 E7-32 DF F1 7E 32 E0 F1 E6  ...u.:B.2..~2...</pre><br/><pre class="d0">F070:  E0 77 CD 45 F0 3A 41 E7-2A 43 E7 B6 77 C9 3E 22  .w.E.:A.*C..w.>"</pre><br/><pre class="d1">F080:  C3 01 E7 21 00 00 22 AD-F1 22 AF F1 AF 32 42 E7  ...!..".."...2B.</pre><br/><pre class="d0">F090:  21 80 00 22 B1 F1 CD DA-E9 C3 21 F0 CD 72 E9 CD  !.."......!..r..</pre><br/><pre class="d1">F0A0:  51 F0 C3 51 EC CD 51 F0-C3 A2 EC 0E 00 EB 7E FE  Q..Q..Q.......~.</pre><br/><pre class="d0">F0B0:  3F CA C2 F0 CD A6 E8 7E-FE 3F C4 72 E9 CD 51 F0  ?......~.?.r..Q.</pre><br/><pre class="d1">F0C0:  0E 0F CD 18 EB C3 E9 E9-2A D9 F1 22 43 E7 CD 51  ........*.."C..Q</pre><br/><pre class="d0">F0D0:  F0 CD 2D EB C3 E9 E9 CD-51 F0 CD 9C EB C3 01 EB  ..-.....Q.......</pre><br/><pre class="d1">F0E0:  CD 51 F0 C3 BC ED CD 51-F0 C3 FE ED CD 72 E9 CD  .Q.....Q.....r..</pre><br/><pre class="d0">F0F0:  51 F0 C3 24 ED CD 51 F0-CD 16 EC C3 01 EB 2A AF  Q..$..Q.......*.</pre><br/><pre class="d1">F100:  F1 C3 29 F1 3A 42 E7 C3-01 E7 EB 22 B1 F1 C3 DA  ..).:B....."....</pre><br/><pre class="d0">F110:  E9 2A BF F1 C3 29 F1 2A-AD F1 C3 29 F1 CD 51 F0  .*...).*...)..Q.</pre><br/><pre class="d1">F120:  CD 3B EC C3 01 EB 2A BB-F1 22 45 E7 C9 3A D6 F1  .;....*.."E..:..</pre><br/><pre class="d0">F130:  FE FF C2 3B F1 3A 41 E7-C3 01 E7 E6 1F 32 41 E7  ...;.:A......2A.</pre><br/><pre class="d1">F140:  C9 CD 51 F0 C3 93 EF CD-51 F0 C3 9C EF CD 51 F0  ..Q.....Q.....Q.</pre><br/><pre class="d0">F150:  C3 D2 EF 2A 43 E7 7D 2F-5F 7C 2F 2A AF F1 A4 57  ...*C.}/_|/*...W</pre><br/><pre class="d1">F160:  7D A3 5F 2A AD F1 EB 22-AF F1 7D A3 6F 7C A2 67  }._*..."..}.o|.g</pre><br/><pre class="d0">F170:  22 AD F1 C9 3A DE F1 B7-CA 91 F1 2A 43 E7 36 00  "...:......*C.6.</pre><br/><pre class="d1">F180:  3A E0 F1 B7 CA 91 F1 77-3A DF F1 32 D6 F1 CD 45  :......w:..2...E</pre><br/><pre class="d0">F190:  F0 2A 0F E7 F9 2A 45 E7-7D 44 C9 CD 51 F0 3E 02  .*...*E.}D..Q.>.</pre><br/><pre class="d1">F1A0:  32 D5 F1 0E 00 CD 07 EF-CC 03 EE C9 E5 00 00 00  2...............</pre><br/><pre class="d0">F1B0:  00 80 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................</pre><br/><pre class="d1">F1C0:  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................</pre><br/><pre class="d0">F1D0:  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................</pre><br/><pre class="d1">F1E0:  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................</pre><br/><pre class="d0">F1F0:  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................</pre><br/><pre class="d1">F200:  C3 00 00 C3 00 00 C3 00-00 C3 00 00 C3 00 00 C3  ................</pre><br/><pre class="d0">F210:  00 00 C3 00 00 C3 00 00-C3 00 00 C3 00 00 C3 00  ................</pre><br/><pre class="d1">F220:  00 C3 00 00 C3 00 00 C3-00 00 C3 00 00 C3 00 00  ................</pre><br/><pre class="d0">F230:  C3 00 00               -                         ................</pre><br/></body></html>